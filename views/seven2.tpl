<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Sevenplus </title>
 <!-- NOW NEW TEMPLATE -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  
  <link href="static/now/assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="static/now/assets/css/now-ui-dashboard.css?v=1.4.1" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="static/now/assets/demo/demo.css" rel="stylesheet" />

  <!-- Bootstrap core CSS -->

  <link rel="shortcut icon" href="static/favicon.ico">
  <link href="static/fonts/css/font-awesome.min.css" rel="stylesheet">
  <link href="static/css/animate.min.css" rel="stylesheet">
  <!--link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet"-->

  <!-- Custom styling plus plugins -->
  <link href="static/css/custom.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="static/css/maps/jquery-jvectormap-2.0.3.css" />
  <link href="static/css/icheck/flat/green.css" rel="stylesheet" />
  <link href="static/css/floatexamples.css" rel="stylesheet" type="text/css" />

  <script src="static/js/jquery-2.2.4.min.js"></script>
   
  <script src="static/js/autocomplete/jquery.autocomplete.js"></script>
  
  <script src="static/js/nprogress.js"></script>
  <script src="static/js/input_mask/jquery.inputmask.js"></script>
  <link href="static/handsome/handsontable.full.min.css" rel="stylesheet">
  <script src="static/handsome/handsontable.full.min.js"></script>
  <!--[if lt IE 9]>
        <script src="../assets/js/ie8-responsive-file-warning.js"></script>
        <![endif]-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
<style type="text/css">
   .bubbleChart {
      min-width: 100px;
      max-width: 1200px;
      height: 900px;
      margin: 0 auto;
      border-radius: 40px;
    }
    .bubbleChart svg{
      background: #000000;
    }
    .rojo {
      color :red;
    }
    .verde {
      color : green;
    }
    .swal2-modal{
          width: 80% !important;
    }

</style>
</head>


<body class="nav-md">

  <div class="container body">


    <div class="main_container">

      <div class="col-md-3 left_col menu_fixed">
        <div class="left_col scroll-view">

          <div class="navbar nav_title" style="border: 0;">
            <a href="" class="site_title"><span>Sevenplus</span></a>
             <style>
             /*
 * Imageless CSS3 Treeview with Checkbox Support
 * @namespace window.AcidJs
 * @class CSS3Treeview
 * @version 3.0
 * @author Martin Ivanov
 * @url developer website: http://wemakesites.net/
 * @url developer twitter: https://twitter.com/#!/wemakesitesnet
 * @url developer blog http://acidmartin.wordpress.com/
 **/
 
/*
 * Do you like this solution? Please, donate:
 * https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=QFUHPWJB2JDBS
 **/
 
.acidjs-css3-treeview,
.acidjs-css3-treeview *
{
    padding: 0;
    margin: 0;
    list-style: none;
}
 
.acidjs-css3-treeview label[for]::before,
.acidjs-css3-treeview label span::before
{
    content: "\25b6";
    display: inline-block;
    margin: 2px 0 0;
    width: 13px;
    height: 13px;
    vertical-align: top;
    text-align: center;
    color: #e74c3c;
    font-size: 8px;
    line-height: 13px;
}
 
.acidjs-css3-treeview li ul
{
    margin: 0 0 0 22px;
}
 
.acidjs-css3-treeview *
{
    vertical-align: middle;
}
 
.acidjs-css3-treeview
{
    font: normal 11px/16px "Segoe UI", Arial, Sans-serif;
}
 
.acidjs-css3-treeview li
{
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
}
 
.acidjs-css3-treeview input[type="checkbox"]
{
    display: none;
}
 
.acidjs-css3-treeview label
{
    cursor: pointer;
}
 
.acidjs-css3-treeview label[for]::before
{
    -webkit-transform: translatex(-24px);
    -moz-transform: translatex(-24px);
    -ms-transform: translatex(-24px);
    -o-transform: translatex(-24px);
    transform: translatex(-24px);
}
 
.acidjs-css3-treeview label span::before
{
    -webkit-transform: translatex(16px);
    -moz-transform: translatex(16px);
    -ms-transform: translatex(16px);
    -o-transform: translatex(16px);
    transform: translatex(16px);
}
 
.acidjs-css3-treeview input[type="checkbox"][id]:checked ~ label[for]::before
{
    content: "\25bc";
}
 
.acidjs-css3-treeview input[type="checkbox"][id]:not(:checked) ~ ul
{
    display: none;
}
 
.acidjs-css3-treeview label:not([for])
{
    margin: 0 8px 0 0;
}
 
.acidjs-css3-treeview label span::before
{
    content: "";
    border: solid 1px #1375b3;
    color: #1375b3;
    opacity: .50;
}
 
.acidjs-css3-treeview label input:checked + span::before
{
    content: "\2714";
    box-shadow: 0 0 2px rgba(0, 0, 0, .25) inset;
    opacity: 1;
}
/* ///////////////////////////////////////////////////////////////////////////// */
input[type='checkbox'] {
    transform: scale(2);
}
  .speech {border: 0px solid #DDD; width: 300px; padding: 0; margin: 0}
  .speech input {border: 0; width: 240px; display: inline-block; height: 30px;}
  .speech img {float: left; width: 40px }
  .detalleIglesiaSabana, .veCampos { text-decoration: underline; cursor: pointer; }
</style>
 
<!-- Search Form -->
<form id="labnol" method="get" action="https://www.google.com/search">
  <div id="transcript2"></div>
  <div class="speech">
    <input type="text" name="q" id="transcript" style="display:none;" placeholder="Speak" />
    <img  style="display:none;" src="static/img/micro.png" />
  </div>
</form>
 

          </div>
          <div id="tipoDeUsuario" style="display:none;">{{.tipoDeUsuario}}</div>
          <div class="clearfix"></div>

          <!-- menu prile quick info -->
          <div class="profile">
            <div class="profile_pic">
              <img onclick="startDictation()" src="static/img/micro.png" alt="..." class="img-circle profile_img">
            </div>
            <div class="profile_info">
              <span>Bienvenido,</span>
              <h2><span id="USUARIOACTUAL">{{.alias}}</span>, est&aacute;s en: <span id="BUNITACTUAL">{{.BUNIT}}</span></h2>
            </div>
          </div>
          <!-- /menu prile quick info -->

          <br />
{{.LayoutContent}}
          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">

            <div class="menu_section">
              {{.menu}}
                  <!--iframe src="https://open.spotify.com/embed/album/4oZK52cIvAxAg04h2mrO7A" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe-->
      <a href="static/grupo.jpg" target="_blank"><img src="static/grupo.jpg" style="width: 100%;"></a>
            </div>
          </div>
          <!-- /sidebar menu -->
        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">

        <div class="nav_menu">
          <nav class="" role="navigation">
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                  <img src="static/images/img.jpg" alt="">{{.alias}}
                  <span class=" fa fa-angle-down"></span>
                </a>
                <ul class="dropdown-menu dropdown-usermenu animated fadeInDown pull-right">
                  <li><a href="javascript:;">  Profile</a>
                    <!--input type="file" id="cambiaCuentasALaBrava"/-->
                  </li>
                  <li>
                    <a href="javascript:;">
                      <span class="badge bg-red pull-right">50%</span>
                      <span>Settings</span>
                      <!--input type="file" id="cambiaTFWWALaBrava"/-->
                    </a>
                  </li>
                  <li>
                    <a href="javascript:;"  >Help</a><!-- id="tadpoles" -->
                  </li>
                  <li><a href="/"><i class="fa fa-sign-out pull-right"></i> Salir</a>
                  </li>
                </ul>
              </li>

              <li role="presentation" class="dropdown">
                <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                  <i class="fa fa-envelope-o"></i>
                  <span class="badge bg-green" id="numeroDeNotificaciones"></span>
                </a>
                <ul id="menu1" class="dropdown-menu list-unstyled msg_list animated fadeInDown" role="menu">
                  <li>
                    <a>
                      <span class="image">
                                        <img src="static/images/img.jpg" alt="Profile Image" />
                                    </span>
                      <span>
                                        <span>John Smith</span>
                      <span class="time">3 mins ago</span>
                      </span>
                      <span class="message">
                                        Film festivals used to be do-or-die moments for movie makers. They were where...
                                    </span>
                    </a>
                  </li>
                  <li>
                    <a>
                      <span class="image">
                                        <img src="static/images/img.jpg" alt="Profile Image" />
                                    </span>
                      <span>
                                        <span>John Smith</span>
                      <span class="time">3 mins ago</span>
                      </span>
                      <span class="message">
                                        Film festivals used to be do-or-die moments for movie makers. They were where...
                                    </span>
                    </a>
                  </li>
                  <li>
                    <a>
                      <span class="image">
                                        <img src="static/images/img.jpg" alt="Profile Image" />
                                    </span>
                      <span>
                                        <span>John Smith</span>
                      <span class="time">3 mins ago</span>
                      </span>
                      <span class="message">
                                        Film festivals used to be do-or-die moments for movie makers. They were where...
                                    </span>
                    </a>
                  </li>
                  <li>
                    <a>
                      <span class="image">
                                        <img src="static/images/img.jpg" alt="Profile Image" />
                                    </span>
                      <span>
                                        <span>John Smith</span>
                      <span class="time">3 mins ago</span>
                      </span>
                      <span class="message">
                                        Film festivals used to be do-or-die moments for movie makers. They were where...
                                    </span>
                    </a>
                  </li>
                  <li>
                    <div class="text-center">
                      <a href="inbox.html">
                        <strong>See All Alerts</strong>
                        <i class="fa fa-angle-right"></i>
                      </a>
                    </div>
                  </li>
                </ul>
              </li>

            </ul>
          </nav>
        </div>

      </div>
      <!-- /top navigation -->


      <!-- page content -->
      <div id="mainContent" class="right_col" role="main">

       
       {{.contenido}}
        <!-- footer content -->

        <footer>
          <div class="copyright-info">
            <p class="pull-right">Sevenplus</a>  
            </p>
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
      <!-- /page content -->

    </div>

  </div>

  <div id="custom_notifications" class="custom-notifications dsp_none">
    <ul class="list-unstyled notifications clearfix" data-tabbed_notifications="notif-group">
    </ul>
    <div class="clearfix"></div>
    <div id="notif-group" class="tabbed_notifications"></div>
  </div>

  <script src="static/js/bootstrap.min.js"></script>
  <div id="audios"></div>
<!-- NOW -->

  <!--   Core JS Files   -->
  <script src="static/now/assets/js/core/jquery.min.js"></script>
  <script src="static/now/assets/js/core/popper.min.js"></script>
  <script src="static/now/assets/js/core/bootstrap.min.js"></script>
  <script src="static/now/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <script src="static/now/assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="static/now/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Plugin for Sweet Alert -->
  <script src="static/now/assets/js/plugins/sweetalert2.min.js"></script>
  <!-- Forms Validations Plugin -->
  <script src="static/now/assets/js/plugins/jquery.validate.min.js"></script>
  <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <script src="static/now/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
  <!--  Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
  <script src="static/now/assets/js/plugins/bootstrap-selectpicker.js"></script>
  <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
  <script src="static/now/assets/js/plugins/bootstrap-datetimepicker.js"></script>
  <!--  DataTables.net Plugin, full documentation here: https://datatables.net/    -->
  <script src="static/now/assets/js/plugins/jquery.dataTables.min.js"></script>
  <!--  Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
  <script src="static/now/assets/js/plugins/bootstrap-tagsinput.js"></script>
  <!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
  <script src="static/now/assets/js/plugins/jasny-bootstrap.min.js"></script>
  <!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
  <script src="static/now/assets/js/plugins/fullcalendar.min.js"></script>
  <!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
  <script src="static/now/assets/js/plugins/jquery-jvectormap.js"></script>
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <script src="static/now/assets/js/plugins/nouislider.min.js"></script>
  <!--  Google Maps Plugin    -->
  <!-- Chart JS -->
  <script src="static/now/assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="static/now/assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="static/now/assets/js/now-ui-dashboard.min.js?v=1.4.1" type="text/javascript"></script>
  <!-- Now Ui Dashboard DEMO methods, don't include it in your project! -->
  <script src="static/now/assets/demo/demo.js"></script>
  <!-- NOW --> 
 
  <!-- gauge js -->
  <!--script type="text/javascript" src="static/js/gauge/gauge.min.js"></script-->
  <!--script type="text/javascript" src="static/js/gauge/gauge_demo.js"></script-->
  <!-- bootstrap progress js -->
  <!--script src="static/js/progressbar/bootstrap-progressbar.min.js"></script-->
  <script src="static/js/nicescroll/jquery.nicescroll.min.js"></script>
  <!-- icheck -->
  <!--script src="static/js/icheck/icheck.min.js"></script-->
  <!-- daterangepicker -->
  <script type="text/javascript" src="static/js/moment/moment.min.js"></script>
  <script type="text/javascript" src="static/js/datepicker/daterangepicker.js"></script>
  <!-- chart js -->
  <!--script src="static/js/chartjs/chart.min.js"></script>
  <script src="static/js/echart/echarts-all.js"></script>
  <script src="static/js/jquery.maskMoney.min.js"></script>
  <script src="static/js/custom.js"></script-->

  <!-- flot js -->
  <!--[if lte IE 8]><script type="text/javascript" src="static/js/excanvas.min.js"></script><![endif]-->
  <!--script type="text/javascript" src="static/js/flot/jquery.flot.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.pie.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.orderBars.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.time.min.js"></script>
  <script type="text/javascript" src="static/js/flot/date.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.spline.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.stack.js"></script>
  <script type="text/javascript" src="static/js/flot/curvedLines.js"></script>
  <script type="text/javascript" src="static/js/flot/jquery.flot.resize.js"></script-->
  
  <!-- worldmap -->
  <!--script type="text/javascript" src="static/js/maps/jquery-jvectormap-2.0.3.min.js"></script>
  <script type="text/javascript" src="static/js/maps/gdp-data.js"></script>
  <script type="text/javascript" src="static/js/maps/jquery-jvectormap-world-mill-en.js"></script>
  <script type="text/javascript" src="static/js/maps/jquery-jvectormap-us-aea-en.js"></script-->
  <!-- pace -->
  <script src="static/js/pace/pace.min.js"></script>
  <script src="static/js/papaparse.min.js"></script>
  <script src="static/js/sha512.min.js"></script>
  <script src="static/highcharts.js"></script>
<script src="static/highcharts-3d.js"></script>
<script src="static/modules/exporting.js"></script>
<script src="static/js/jquery.maskedinput.min.js"></script>

    <!--script src="https://d3js.org/d3.v5.min.js"></script-->
    <!--script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script-->

<script src="https://unpkg.com/d3-array@1"></script>
<script src="https://unpkg.com/d3-collection@1"></script>
<script src="https://unpkg.com/d3-dispatch@1"></script>
<script src="https://unpkg.com/d3-request@1"></script>
<script src="https://unpkg.com/d3-selection@1"></script>
<script src="https://unpkg.com/d3-geo@1"></script>
<script src="https://unpkg.com/topojson-client@3"></script>


<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
<script src="https://d3js.org/d3-ease.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-selection.v1.min.js"></script>
<script src="https://d3js.org/d3-timer.v1.min.js"></script>
<script src="https://d3js.org/d3-transition.v1.min.js"></script>
<script src="https://d3js.org/d3-drag.v1.min.js"></script>
<script src="https://d3js.org/d3-zoom.v1.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!--script src="http://phuonghuynh.github.io/js/bower_components/jquery/dist/jquery.min.js"></script-->

<script src="static/js/d4.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<!--script src="http://phuonghuynh.github.io/js/bower_components/d3/d3.min.js"></script>
 <script src="http://phuonghuynh.github.io/js/bower_components/d3-transform/src/d3-transform.js"></script-->
<script src="static/js/bubble_0.js"></script>
 <script src="http://phuonghuynh.github.io/js/bower_components/cafej/src/extarray.js"></script>
  <script src="http://phuonghuynh.github.io/js/bower_components/cafej/src/misc.js"></script>
  <script src="http://phuonghuynh.github.io/js/bower_components/cafej/src/micro-observer.js"></script>
  <script src="http://phuonghuynh.github.io/js/bower_components/microplugin/src/microplugin.js"></script>
   <!--script src="http://phuonghuynh.github.io/js/bower_components/bubble-chart/src/bubble-chart.js"></script>
  <script src="http://phuonghuynh.github.io/js/bower_components/bubble-chart/src/plugins/central-click/central-click.js"></script>
  <script src="http://phuonghuynh.github.io/js/bower_components/bubble-chart/src/plugins/lines/lines.js"></script-->
 
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sweetalert2@7.29.2/dist/sweetalert2.all.min.js"></script>

  <!--script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script-->

  
  <script src="static/js/bubble.js"></script>
  <!--script src="static/js/bubble_2.js"></script-->
  <script src="static/js/d5.min.js"></script>
<div id="mensaje" style="display:none;">{{.mensaje}}</div>
  <!-- /dashbord linegraph https://d3js.org/d3.v3.min.js -->
  <!-- datepicker -->
  <script type="text/javascript">
    /**
 * central-click.js
 */
 function cargaDistritos() {
  $("#mainContent").html('<canvas height="1300" width="1500" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas>');
  var canvas = document.querySelector("canvas"),
                width = 1500,
                height = 1300;
              var o = [];
              var i = [];
               o.push({
                    id: 0,
                    name: "Asociacion Baja Norte",
                    budget : "",
                    DT : "AGM411"
                });
              $.ajax({
        url: "/listaDistritosPresupuesto",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp) {
          if(resp.success==1)
          {
var ii = 0, aver2 = Object.keys(resp.distritos);
var con = 1;
            for(ii=0;ii<aver2.length;ii++)
            {
              o.push({
                    id: con,
                    name: resp.distritos[aver2[ii]].Name.trim().replace("DS-",""),
                    budget : "$200,000.00",
                    DT : aver2[ii]
                });
               i.push({
                    source: 0,
                    target: con
                });
               
              con++;
            }  

                initColor(o), initRadius(o);
                var s = new relation;
                s.setNodes(o), s.setLinks(i), s.setCanvas(canvas), s.setSize(width, height), s.setRadius(12), s.setLinkLength(90), s.setCharge(-60), s.init(), s.run();
         
          }
        }
    });
     
            
 }
d4.svg.BubbleChart.define("central-click", function (options) {
  var self = this;
  self.setup = (function (node) {
    var original = self.setup;
    return function (node) {
      var fn = original.apply(this, arguments);
      self.event.on("click", function(node) {
        if (node.selectAll("text.central-click")[0].length === 1) {
          console.log(node);
          if(modoBolitasGlobal==0){
            cargaDistritos();  
          } else {
            cargaTadpoles();
           } 
          
          //alert("Hello there!\nCentral bubble is clicked.");
        }
      });
      return fn;
    };
  })();

  self.reset = (function (node) {
    var original = self.reset;
    return function (node) {
      var fn = original.apply(this, arguments);
      node.select("text.central-click").remove();
      return fn;
    };
  })();

  self.moveToCentral = (function (node) {
    var original = self.moveToCentral;
    return function (node) {
      var fn = original.apply(this, arguments);
      var transition = self.getTransition().centralNode;
      var i;
      transition.each("end", function() {
        node.append("text").classed({"central-click": true})
          .attr(options.attr)
          .style(options.style)
          .attr("x", function (d) {return d.cx;})
          .attr("y", function (d) {return d.cy;})
          .text(options.text)
          .style("opacity", 0).transition().duration(self.getOptions().transitDuration / 2).style("opacity", "0.8");
      });
      
      return fn;
    };
  })();
});
var transitionGlobal;
/**
 * Text lines
 *
 * @module
 *
 * @param {object} options - setting of text lines
 * @param {object[]} options.format - n-th object is used to format n-th line
 * @param {string} options.format.textField - name of property will be used in function text()
 * @param {string} options.format.classed - classes used to apply to [text](http://www.w3.org/TR/SVG/text.html#TextElement)
 * @param {string} options.format.style - style used to apply to [text](http://www.w3.org/TR/SVG/text.html#TextElement)
 * @param {string} options.format.attr - attribute used to apply to [text](http://www.w3.org/TR/SVG/text.html#TextElement)
 * @param {object[]} options.centralFormat - like #format but used to format central-bubble
 */
d4.svg.BubbleChart.define("lines", function (options) {
  /*
   * @param
   *  options = {
   *    format: [ //n-th object is used to format n-th line
   *      {
   *        textField: #string, name of property will be used in function text(), @link
   *        classed: #object, @link
   *        style: #object, @link
   *        attr: #object, @link
   *      }
   *    ],
   *    centralFormat: [ //@see #format, but used to format central-bubble
   *    ]
   *  }
   * */

  var self = this;

  self.setup = (function () {
    var original = self.setup;
    return function () {
      var fn = original.apply(this, arguments);
      var node = self.getNodes();
      var i;
     /* for(i=0;i<options.format.length;i++){
        var f = options.format[i];
        node.append("text")
          .classed(f.classed)
          .style(f.style)
          .attr(f.attr)
          .text(function (d) {return d.item[f.textField];});
      }*/
      
      $.each(options.format, function (i, f) {
        node.append("text")
          .classed(f.classed)
          .style(f.style)
          .attr(f.attr)
          .text(function (d) {return d.item[f.textField];});
      });
      
      return fn;
    };
  })();

  self.reset = (function (node) {
    var original = self.reset;
    return function (node) {
      var fn = original.apply(this, arguments);
     /* for(i=0;i<options.format.length;i++){
        var f = options.format[i];
        var tNode = d4.select(node.selectAll("text")[0][i]);
        tNode.classed(f.classed).text(function (d) {return d.item[f.textField];})
          .transition().duration(self.getOptions().transitDuration)
          .style(f.style)
          .attr(f.attr);
      }*/
      
      $.each(options.format, function (i, f) {
        var tNode = d4.select(node.selectAll("text")[0][i]);
        tNode.classed(f.classed).text(function (d) {return d.item[f.textField];})
          .transition().duration(self.getOptions().transitDuration)
          .style(f.style)
          .attr(f.attr);
      });
      
      return fn;
    };
  })();

  self.moveToCentral = (function (node) {
    var original = self.moveToCentral;
    return function (node) {
      var fn = original.apply(this, arguments);
    /*  for(i=0;i<options.format.length;i++){
        var f = options.format[i];
          var tNode = d4.select(node.selectAll("text")[0][i]);
        tNode.transition().duration(self.getOptions().transitDuration)
          .style(f.style)
          .attr(f.attr);
        f.classed !== undefined && tNode.classed(f.classed);
        f.textField !== undefined && tNode.text(function (d) {return d.item[f.textField];});
      }*/
      
      $.each(options.centralFormat, function (i, f) {
        var tNode = d4.select(node.selectAll("text")[0][i]);
        tNode.transition().duration(self.getOptions().transitDuration)
          .style(f.style)
          .attr(f.attr);
        f.classed !== undefined && tNode.classed(f.classed);
        f.textField !== undefined && tNode.text(function (d) {return d.item[f.textField];});
      });
      
      return fn;
    };
  })();
});
var modoBolitasGlobal = 0;//0 ingresos, 1 egresos
    //name
    function initColor(r) {
                r[0].color = "#007FFF"; 
                r[1].color = "#A142FF";
                 r[2].color = "#FF85C2";
                  r[3].color = "#FFA142"; 
                  r[4].color = "#FF4242";
                for (var o = 5; o < r.length; o++) {
                    var t = d3.color(r[o % 4 + 1].color);
                    r[o].color = t.brighter(1.5).toString()
                }
            }

            function initRadius(r) {
              var radi = 20;
                r[0].radius = 28, r[1].radius = radi, r[2].radius = radi, r[3].radius = radi, r[4].radius = radi;
                for (var o = 5; o < r.length; o++) r[o].radius = radi
            }
            
    function relation() {
    var a, b, c, d, e, f = "id",
        g = 55,//15
        h = 600,
        i = 600,
        j = -30,
        k = 60,//20
        l = 2;
    this.init = function() {
        c = d5.forceSimulation().force("charge", d5.forceManyBody().strength(j)).force("center", d5.forceCenter(h / 2, i / 2)).force("collide", d5.forceCollide(1.2 * g)), c.nodes(a).on("tick", this.render);
       
         c.force("link", d5.forceLink().links(b).id(function(a) {
            return a[f]
        }).distance(k)), this.initDrag(), e = d.getContext("2d"), this.restart(), this.pause();
    }, this.render = function() {
        e.clearRect(0, 0, h, i); 
        e.lineWidth = l;
         e.strokeStyle = "black"; e.beginPath();
          b.forEach(function(a) {
            e.moveTo(a.source.x, a.source.y);
            e.lineTo(a.target.x, a.target.y);
        });
         e.stroke(); 
         e.lineWidth = 3;
          e.strokeStyle = "black";
        a.forEach(function(a) {
            e.fillStyle = a.color; 
            e.beginPath();
             e.arc(a.x, a.y, a.radius, 0, 2 * Math.PI);
              e.fill();
               e.stroke();
        });
         e.font = "14px Comic Sans MS";
          e.fillStyle = "black";
           e.textAlign = "center";
            a.forEach(function(a) {
            e.fillText(a.name, a.x, a.y + 2.5 * a.radius);
            e.fillText(a.budget, a.x, a.y + 5.0 * a.radius);
        })
    }, this.initDrag = function() {
        function aa() {
            return c.find(d5.event.x, d5.event.y)
        }

        function b() {
            d5.event.active || c.alphaTarget(.3).restart(), d5.event.subject.fx = d5.event.subject.x, d5.event.subject.fy = d5.event.subject.y
        }

        function ee() {
            d5.event.subject.fx = d5.event.x, d5.event.subject.fy = d5.event.y
        }

        function f() {
            d5.event.active || c.alphaTarget(0), d5.event.subject.fx = null, d5.event.subject.fy = null
        }
        function cli() {
//console.log("e:"+e);
console.log("a:"+a[1].DT);
        }
        d5.select(d).call(d5.drag().container(d).subject(aa).on("start", b).on("drag", ee).on("end", f)).on("click", cli);
    }, this.pause = function() {
        c.stop()
    }, this.run = function() {
        c.restart()
    }, this.restart = function() {
        c.alpha(1), this.run()
    }, this.setNodes = function(b) {
        a = b
    }, this.setLinks = function(a) {
        b = a
    }, this.setId = function(a) {
        f = a
    }, this.setRadius = function(a) {
        g = a
    }, this.setCanvas = function(a) {
        d = a
    }, this.setSize = function(a, b) {
        h = a, i = b
    }, this.setCharge = function(a) {
        j = a
    }, this.setLinkLength = function(a) {
        k = 360;//a
    }
}

    
  var xhrPool = [];
  $(document).ajaxSend(function(e, jqXHR, options){
    xhrPool.push(jqXHR);
  });
  $(document).ajaxComplete(function(e, jqXHR, options) {
    xhrPool = $.grep(xhrPool, function(x){return x!=jqXHR});
  });
  var abort = function() {
    $.each(xhrPool, function(idx, jqXHR) {
      jqXHR.abort();
    });
  };

  var oldbeforeunload = window.onbeforeunload;
  window.onbeforeunload = function() {
    var r = oldbeforeunload ? oldbeforeunload() : undefined;
    if (r == undefined) {
      // only cancel requests if there is no prompt to stay on the page
      // if there is a prompt, it will likely give the requests enough time to finish
      abort();
    }
    return r;
  }




  var palabrasComunes = ["hello","dame","damela","hola",];
 function startDictation() {
  document.getElementById('transcript2').innerHTML='';
    if (window.hasOwnProperty('webkitSpeechRecognition')) {
 
      var recognition = new webkitSpeechRecognition();
 
      recognition.continuous = false;
      recognition.interimResults = false;
 
      recognition.lang = "es-MX";
      recognition.start();
 
      recognition.onresult = function(e) {
        document.getElementById('transcript').value
                                 = e.results[0][0].transcript;
        document.getElementById('transcript2').innerHTML
                                 = e.results[0][0].transcript;
        recognition.stop();
        var texto =  document.getElementById('transcript2').innerHTML;
        if(texto.indexOf("conciliacion")>-1 || texto.indexOf("conciliación")>-1)
        {
          if(texto.indexOf("cuenta")>-1)
          {
             var palabras = texto.split(' ');
             var i, cuenta="";
             for(i=0;i<palabras.length;i++)
             {
                if(palabras[i]=="cuenta")
                {
                  cuenta = palabras[i+1];
                }
             }
              var anio = palabras[palabras.length-1];
              var mes = palabras[palabras.length-2];

               $("#audios").html('<audio src="static/siri/generandoDiario.m4a" autoplay="autoplay"></audio>');
                 /* window.open(
                    "/generarDiario?diario=" + talvesNumero,
                    '_blank'
                  );*/
                  //conciliacionEdoCuenta
             
          }
        }
        else
        {
          if(texto.indexOf("cuenta")>-1)
          {
            if(texto.indexOf("estado")>-1)//estado de cuenta
            {
              var palabras = texto.split(' ');
              //pensando que podría ser la ultima y/o penultima
              var ultima = palabras[palabras.length-1];
             // var cuenta = '';
              var penultima = palabras[palabras.length-2];
              /*if(ultima.length==6)
              {
                cuenta = ultima;
              }
              else
              {
                if(ultima.length==3 && penultima.length==3)
                {
                  cuenta=penultima+ultima;
                }
              }
              if(cuenta.length>0)
              {*/
                $("#audios").html('<audio src="static/siri/generandoEstadoDeCuenta.m4a" autoplay="autoplay"></audio>');
                var delPeriodo = 2000001;
                var alPeriodo = 2100012;
                window.open(
                  "/generarEstadoDeCuenta?cuenta=" + penultima.toUpperCase()+" "+ultima.toUpperCase()+"&delPeriodo="+delPeriodo+"&alPeriodo="+alPeriodo+"&busca=1",
                  '_blank'
                );
              //}

            }  
          }
          else
          {
            if(texto.indexOf("poliza")>-1 || texto.indexOf("diario")>-1)
            {
              var palabras = texto.split(' ');
              var i;
              for(i=0;i<palabras.length;i++)
              {
                var talvesNumero = palabras[i];
                if(!isNaN(talvesNumero))
                {
                  $("#audios").html('<audio src="static/siri/generandoDiario.m4a" autoplay="autoplay"></audio>');
                  window.open(
                    "/generarDiario?libro=A&diario=" + talvesNumero,
                    '_blank'
                  );
                  break;
                }
              }
            }
          }
        }
        
       // document.getElementById('labnol').submit();
      };
 
      recognition.onerror = function(e) {
        recognition.stop();
      }
 
    }
  }
  




  $(document).on("change", "#lineaInformeDiezmoSelect", function (){
    actualizaTablaDeLineasInforme();
  });

  $(document).on("change", "#conceptoInformeSelect", function (){
    actualizaLineaDiezmoInforme();
  });

  $(document).on("change", "#cedulasSelect", function (){
    actualizaLineaCedulas();
  });
  var theme = {
          color: [
              "#26B99A", "#34495E", "#BDC3C7", "#3498DB",
              "#9B59B6", "#8abb6f", "#759c6a", "#bfd3b7"
          ],
          title: {
              itemGap: 8,
              textStyle: {
                  fontWeight: "normal",
                  color: "#408829"
              }
          },
          dataRange: {
              color: ["#1f610a", "#97b58d"]
          },
          toolbox: {
              color: ["#408829", "#408829", "#408829", "#408829"]
          },
          tooltip: {
              backgroundColor: "rgba(0,0,0,0.5)",
              axisPointer: {
                  type: "line",
                  lineStyle: {
                      color: "#408829",
                      type: "dashed"
                  },
                  crossStyle: {
                      color: "#408829"
                  },
                  shadowStyle: {
                      color: "rgba(200,200,200,0.3)"
                  }
              }
          },
          dataZoom: {
              dataBackgroundColor: '#eee',
              fillerColor: "rgba(64,136,41,0.2)",
              handleColor: "#408829"
          },
          grid: {
              borderWidth: 0
          },
          categoryAxis: {
              axisLine: {
                  lineStyle: {
                      color: "#408829"
                  }
              },
              splitLine: {
                  lineStyle: {
                      color: ["#eee"]
                  }
              }
          },
          valueAxis: {
              axisLine: {
                  lineStyle: {
                      color: "#408829"
                  }
              },
              splitArea: {
                  show: true,
                  areaStyle: {
                      color: ["rgba(250,250,250,0.1)", "rgba(200,200,200,0.1)"]
                  }
              },
              splitLine: {
                  lineStyle: {
                      color: ["#eee"]
                  }
              }
          },
          timeline: {
              lineStyle: {
                  color: "#408829"
              },
              controlStyle: {
                  normal: {color: "#408829"},
                  emphasis: {color: "#408829"}
              }
          },
          k: {
              itemStyle: {
                  normal: {
                      color: "#68a54a",
                      color0: "#a9cba2",
                      lineStyle: {
                          width: 1,
                          color: "#408829",
                          color0: "#86b379"
                      }
                  }
              }
          },
          map: {
              itemStyle: {
                  normal: {
                      areaStyle: {
                          color: "#ddd"
                      },
                      label: {
                          textStyle: {
                              color: "#c12e34"
                          }
                      }
                  },
                  emphasis: {
                      areaStyle: {
                          color: "#99d2dd"
                      },
                      label: {
                          textStyle: {
                              color: "#c12e34"
                          }
                      }
                  }
              }
          },
          force: {
              itemStyle: {
                  normal: {
                      linkStyle: {
                          strokeColor: "#408829"
                      }
                  }
              }
          },
          chord: {
              padding: 4,
              itemStyle: {
                  normal: {
                      lineStyle: {
                          width: 1,
                          color: "rgba(128, 128, 128, 0.5)"
                      },
                      chordStyle: {
                          lineStyle: {
                              width: 1,
                              color: "rgba(128, 128, 128, 0.5)"
                          }
                      }
                  },
                  emphasis: {
                      lineStyle: {
                          width: 1,
                          color: "rgba(128, 128, 128, 0.5)"
                      },
                      chordStyle: {
                          lineStyle: {
                              width: 1,
                              color: "rgba(128, 128, 128, 0.5)"
                          }
                      }
                  }
              }
          },
          gauge: {
              startAngle: 225,
              endAngle: -45,
              axisLine: {
                  show: true,
                  lineStyle: {
                      color: [[0.2, "#86b379"], [0.8, "#68a54a"], [1, "#408829"]],
                      width: 8
                  }
              },
              axisTick: {
                  splitNumber: 10,
                  length: 12,
                  lineStyle: {
                      color: "auto"
                  }
              },
              axisLabel: {
                  textStyle: {
                      color: "auto"
                  }
              },
              splitLine: {
                  length: 18,
                  lineStyle: {
                      color: "auto"
                  }
              },
              pointer: {
                  length: "90%",
                  color: "auto"
              },
              title: {
                  textStyle: {
                      color: "#333"
                  }
              },
              detail: {
                  textStyle: {
                      color: "auto"
                  }
              }
          },
          textStyle: {
              fontFamily: "Arial, Verdana, sans-serif"
          }
      };
  

  $(document).on("change", "#tipoDeDiarioSelect", function (){
    actualizaLaTablaDondeEstanLasLineasDelTipoDeDiario();
  });
  $(document).on("change", "#conceptoSelect", function (){
    actualizaLaTablaDondeEstanLasLineasDeLasCedulaSegunElConcepto();
  });

  $(document).on("change", "#cedulasSelectConceptos", function (){
    actualizaConceptosCedulas();
  });
  
  $(document).on("click", ".cancelaAjax", function (){
    abort();
  });

  $(document).on("click", "#generarDiarioEnExcel", function (){
    var diario = parseInt($("#diario").val());
    window.open(
      "/generarDiarioEnExcel?diario=" + diario,
      '_blank'
    );

  });


  $(document).on("click", "#generarReciboEnPDF", function (){
    var diario = parseInt($("#diario").val());
    window.open(
      "/generarReciboDiario?diario=" + diario,
      '_blank'
    );

  });


  $(document).on("click", "#generarDiarioEnPDF", function (){
    var diario = parseInt($("#diario").val());
    window.open(
      "/generarDiario?libro=A&diario=" + diario,
      '_blank'
    );

  });

  
  


  $(document).on("click", "#generarEstadoDeCuentaPorFNCTyPROJ", function (){
    var auxC = $("#autocomplete-custom-append").val();
    var cuenta = "";
    var descr = "";
    if (auxC.indexOf("|")>0)
    {
      cuenta = auxC.split("|")[0].trim();
      descr = auxC.split("|")[1].trim();
    }
      var delPeriodo = $("#delPeriodo").val();
      var alPeriodo = $("#alPeriodo").val();
      var ANAL_T0_START = "";
      if($("#ANAL_T0_START").length>0)
      {
        ANAL_T0_START = $("#ANAL_T0_START").val();  
      }
      var ANAL_T0_END = "";
      if($("#ANAL_T0_END").length>0)
      {
        ANAL_T0_END = $("#ANAL_T0_END").val();
      }
      var ANAL_T1_START = "";
      if($("#ANAL_T1_START").length>0)
      {
        ANAL_T1_START = $("#ANAL_T1_START").val();  
      }
      var ANAL_T1_END = "";
      if($("#ANAL_T1_END").length>0)
      {
        ANAL_T1_END = $("#ANAL_T1_END").val();  
      }
      var ANAL_T2_START = "";
      if($("#ANAL_T2_START").length>0)
      {
        ANAL_T2_START = $("#ANAL_T2_START").val();  
      }
      var ANAL_T2_END = "";
      if($("#ANAL_T2_END").length>0)
      {
        ANAL_T2_END = $("#ANAL_T2_END").val();  
      }
      var ANAL_T3_START = "";
      if($("#ANAL_T3_START").length>0)
      {
        ANAL_T3_START = $("#ANAL_T3_START").val();  
      }
      var ANAL_T3_END = "";
      if($("#ANAL_T3_END").length>0)
      {
        ANAL_T3_END = $("#ANAL_T3_END").val();  
      }
      var ANAL_T4_START = "";
      if($("#ANAL_T4_START").length>0)
      {
        ANAL_T4_START = $("#ANAL_T4_START").val();  
      }
      var ANAL_T4_END = "";
      if($("#ANAL_T4_END").length>0)
      {
        ANAL_T4_END = $("#ANAL_T4_END").val();  
      }
      var ANAL_T5_START = "";
      if($("#ANAL_T5_START").length>0)
      {
        ANAL_T5_START = $("#ANAL_T5_START").val();  
      }
      var ANAL_T5_END = "";
      if($("#ANAL_T5_END").length>0)
      {
        ANAL_T5_END = $("#ANAL_T5_END").val();  
      }
      var ANAL_T6_START = "";
      if($("#ANAL_T6_START").length>0)
      {
        ANAL_T6_START = $("#ANAL_T6_START").val();  
      }
      var ANAL_T6_END = "";
      if($("#ANAL_T6_END").length>0)
      {
        ANAL_T6_END = $("#ANAL_T6_END").val();
      }

      var ANAL_T7_START = "";
      if($("#ANAL_T7_START").length>0)
      {
        ANAL_T7_START = $("#ANAL_T7_START").val();  
      }
      var ANAL_T7_END = "";
      if($("#ANAL_T7_START").length>0)
      {
      ANAL_T7_END = $("#ANAL_T7_END").val();
      }
      var ANAL_T8_START = $("#ANAL_T8_START").val();
      var ANAL_T8_END = $("#ANAL_T8_END").val();

      var ANAL_T9_START = $("#ANAL_T9_START").val();
      var ANAL_T9_END = $("#ANAL_T9_END").val();



      window.open(
        "/generarEstadoDeCuentaPorFNCTyPROJ?cuenta=" + cuenta+"&delPeriodo="+delPeriodo+"&alPeriodo="+alPeriodo+"&descr="+descr+"&d0s="+ANAL_T0_START+"&d0e="+ANAL_T0_END+"&d1s="+ANAL_T1_START+"&d1e="+ANAL_T1_END+"&d2s="+ANAL_T2_START+"&d2e="+ANAL_T2_END+"&d3s="+ANAL_T3_START+"&d3e="+ANAL_T3_END+"&d4s="+ANAL_T4_START+"&d4e="+ANAL_T4_END+"&d5s="+ANAL_T5_START+"&d5e="+ANAL_T5_END+"&d6s="+ANAL_T6_START+"&d6e="+ANAL_T6_END+"&d7s="+ANAL_T7_START+"&d7e="+ANAL_T7_END+"&d8s="+ANAL_T8_START+"&d8e="+ANAL_T8_END+"&d9s="+ANAL_T9_START+"&d9e="+ANAL_T9_END+"&busca=0",
        '_blank'
      );
  });
  $(document).on("click", "#generarEstadoDeCuenta", function (){
    var auxC = $("#autocomplete-custom-append").val();
    var cuenta = "";
    var descr = "";
    if (auxC.indexOf("|")>0)
    {
      cuenta = auxC.split("|")[0].trim();
      descr = auxC.split("|")[1].trim();
    }
      var delPeriodo = $("#delPeriodo").val();
      var alPeriodo = $("#alPeriodo").val();
      var ANAL_T0_START = "";
      if($("#ANAL_T0_START").length>0)
      {
        ANAL_T0_START = $("#ANAL_T0_START").val();  
      }
      var ANAL_T0_END = "";
      if($("#ANAL_T0_END").length>0)
      {
        ANAL_T0_END = $("#ANAL_T0_END").val();
      }
      var ANAL_T1_START = "";
      if($("#ANAL_T1_START").length>0)
      {
        ANAL_T1_START = $("#ANAL_T1_START").val();  
      }
      var ANAL_T1_END = "";
      if($("#ANAL_T1_END").length>0)
      {
        ANAL_T1_END = $("#ANAL_T1_END").val();  
      }
      var ANAL_T2_START = "";
      if($("#ANAL_T2_START").length>0)
      {
        ANAL_T2_START = $("#ANAL_T2_START").val();  
      }
      var ANAL_T2_END = "";
      if($("#ANAL_T2_END").length>0)
      {
        ANAL_T2_END = $("#ANAL_T2_END").val();  
      }
      var ANAL_T3_START = "";
      if($("#ANAL_T3_START").length>0)
      {
        ANAL_T3_START = $("#ANAL_T3_START").val();  
      }
      var ANAL_T3_END = "";
      if($("#ANAL_T3_END").length>0)
      {
        ANAL_T3_END = $("#ANAL_T3_END").val();  
      }
      var ANAL_T4_START = "";
      if($("#ANAL_T4_START").length>0)
      {
        ANAL_T4_START = $("#ANAL_T4_START").val();  
      }
      var ANAL_T4_END = "";
      if($("#ANAL_T4_END").length>0)
      {
        ANAL_T4_END = $("#ANAL_T4_END").val();  
      }
      var ANAL_T5_START = "";
      if($("#ANAL_T5_START").length>0)
      {
        ANAL_T5_START = $("#ANAL_T5_START").val();  
      }
      var ANAL_T5_END = "";
      if($("#ANAL_T5_END").length>0)
      {
        ANAL_T5_END = $("#ANAL_T5_END").val();  
      }
      var ANAL_T6_START = "";
      if($("#ANAL_T6_START").length>0)
      {
        ANAL_T6_START = $("#ANAL_T6_START").val();  
      }
      var ANAL_T6_END = "";
      if($("#ANAL_T6_END").length>0)
      {
        ANAL_T6_END = $("#ANAL_T6_END").val();
      }

      var ANAL_T7_START = "";
      if($("#ANAL_T7_START").length>0)
      {
        ANAL_T7_START = $("#ANAL_T7_START").val();  
      }
      var ANAL_T7_END = "";
      if($("#ANAL_T7_START").length>0)
      {
      ANAL_T7_END = $("#ANAL_T7_END").val();
      }
      var ANAL_T8_START = $("#ANAL_T8_START").val();
      var ANAL_T8_END = $("#ANAL_T8_END").val();

      var ANAL_T9_START = $("#ANAL_T9_START").val();
      var ANAL_T9_END = $("#ANAL_T9_END").val();



      window.open(
        "/generarEstadoDeCuenta?cuenta=" + cuenta+"&delPeriodo="+delPeriodo+"&alPeriodo="+alPeriodo+"&descr="+descr+"&d0s="+ANAL_T0_START+"&d0e="+ANAL_T0_END+"&d1s="+ANAL_T1_START+"&d1e="+ANAL_T1_END+"&d2s="+ANAL_T2_START+"&d2e="+ANAL_T2_END+"&d3s="+ANAL_T3_START+"&d3e="+ANAL_T3_END+"&d4s="+ANAL_T4_START+"&d4e="+ANAL_T4_END+"&d5s="+ANAL_T5_START+"&d5e="+ANAL_T5_END+"&d6s="+ANAL_T6_START+"&d6e="+ANAL_T6_END+"&d7s="+ANAL_T7_START+"&d7e="+ANAL_T7_END+"&d8s="+ANAL_T8_START+"&d8e="+ANAL_T8_END+"&d9s="+ANAL_T9_START+"&d9e="+ANAL_T9_END+"&busca=0",
        '_blank'
      );
  });


   

  function configInicialDeTimbresUsados()
  {
     $.ajax({
        url: "/configInicialDeTimbresUsados",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
          if(resp.success==1)
          {
            var valorPorTimbre = 1.1252;
            var cad = '<tr><td>'+resp.rfc+'</td><td>'+resp.razonSocial+'</td><td>'+resp.mov+'</td><td>'+format2(parseFloat(parseInt(resp.mov)*valorPorTimbre),'$')+'</td></tr>';
             $("#tablaTimbresUsados").html(cad);
          }
        }
    });
  }
  function configInicialDeDiariosReversiados()
  {
     $.ajax({
        url: "/configInicialDiariosReversiados",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.diariosReversiados);
             var cad = '';
             var palabra = "Original";
            for(i=0;i<aver2.length;i++)
            {
              var diario = resp.diariosReversiados[aver2[i]]["Diario"];
              var ref = resp.diariosReversiados[aver2[i]]["AllocRef"];
              var PERIOD = resp.diariosReversiados[aver2[i]]["PERIOD"];
              //<a class="vesAlDiario" href="javascript:void(0)" diario="10">10-1</a>
              if(i%2==0)
              {
                palabra = "Original";
              }
              else
              {
                palabra = "Reverseado";
              }
              cad=cad+'<tr><td><a class="vesAlDiario" href="javascript:void(0)" diario="'+diario+'">'+diario+'</a></td><td>'+ref+'</td><td>'+PERIOD+'</td></tr>';
            }
            $("#tablaDiariosReversiados").html(cad);
          }
      });
  }
  function configInicialDeCedulasConceptos()
  {
     $.ajax({
        url: "/configInicialLineasCedulas",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
             var cedulas = Object.keys(resp.cedulas);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<cedulas.length;i++)
            {
              var todo = cedulas[i].split('|');
              var nombre = todo[0];
              var idCedula = todo[1];
              cad=cad+'<option value="'+idCedula+'">'+nombre+'</option>';
            }
            $("#cedulasSelectConceptos").html(cad);
          }
      });
  }
  function configInicialDeCedulas()
  {
     $.ajax({
        url: "/configInicialLineasCedulas",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
             var cedulas = Object.keys(resp.cedulas);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<cedulas.length;i++)
            {
              var todo = cedulas[i].split('|');
              var nombre = todo[0];
              var idCedula = todo[1];
              cad=cad+'<option value="'+idCedula+'">'+nombre+'</option>';
            }
            $("#cedulasSelect").html(cad);

             aver2 = Object.keys(resp.periodos);
              var cad = '';
              for(i=0;i<aver2.length;i++)
              {
                cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
              } 
              $("#delPeriodo").html(cad);
              $("#alPeriodo").html(cad);
              $("#alPeriodo option:last").attr("selected","selected");
              actualizaConceptosCedulas();
          }
      });
  }
   function configInicialDeCedulasParaVer()
  {
     $.ajax({
        url: "/configInicialLineasCedulas",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
             var cedulas = Object.keys(resp.cedulas);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<cedulas.length;i++)
            {
              var todo = cedulas[i].split('|');
              var nombre = todo[0];
              var idCedula = todo[1];
              cad=cad+'<option value="'+idCedula+'">'+nombre+'</option>';
            }
            $("#cedulasSelectVer").html(cad);

             aver2 = Object.keys(resp.periodos);
              var cad = '';
              for(i=0;i<aver2.length;i++)
              {
                cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
              } 
              $("#delPeriodo").html(cad);
              $("#alPeriodo").html(cad);
              $("#alPeriodo option:last").attr("selected","selected");
          }
      });
  }
  
   function configInicialDeLineasDeCapturaDeDiario()
  {
     $.ajax({
        url: "/configInicialDeLineasDeTiposDeDiario",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            timestampActual = resp.time;
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
            var ANAL_T0 = Object.keys(resp.ANAL_T0);
            var ANAL_T1 = Object.keys(resp.ANAL_T1);
            var ANAL_T2 = Object.keys(resp.ANAL_T2);
            var ANAL_T3 = Object.keys(resp.ANAL_T3);
            var ANAL_T4 = Object.keys(resp.ANAL_T4);
            var ANAL_T5 = Object.keys(resp.ANAL_T5);
            var ANAL_T6 = Object.keys(resp.ANAL_T6);
            var ANAL_T7 = Object.keys(resp.ANAL_T7);
            var ANAL_T8 = Object.keys(resp.ANAL_T8);
            var ANAL_T9 = Object.keys(resp.ANAL_T9);
            var tiposDeDiario = Object.keys(resp.tiposDeDiario);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<tiposDeDiario.length;i++)
            {
              var IdTipoDeDiario = resp.tiposDeDiario[tiposDeDiario[i]]["IdTipoDeDiario"];
              var nombre = resp.tiposDeDiario[tiposDeDiario[i]]["Nombre"];
              cad=cad+'<option value="'+IdTipoDeDiario+'">'+nombre+'</option>';
            }
            $("#tipoDeDiarioSelectDeCaptura").html(cad);
            if(resp.D1=="")
            {
              resp.D1 = "sin nombre";
            }
            $("#ANAL_T0_LABEL").html(resp.D1);
            $("#ANAL_T1_LABEL").html(resp.D2);
            $("#ANAL_T2_LABEL").html(resp.D3);
            $("#ANAL_T3_LABEL").html(resp.D4);
            $("#ANAL_T4_LABEL").html(resp.D5);
            $("#ANAL_T5_LABEL").html(resp.D6);
            $("#ANAL_T6_LABEL").html(resp.D7);
            $("#ANAL_T7_LABEL").html(resp.D8);
            $("#ANAL_T8_LABEL").html(resp.D9);
            $("#ANAL_T9_LABEL").html(resp.D10);


            $("#tdD0").html(resp.D1);
            $("#tdD1").html(resp.D2);
            $("#tdD2").html(resp.D3);
            $("#tdD3").html(resp.D4);
            $("#tdD4").html(resp.D5);
            $("#tdD5").html(resp.D6);
            $("#tdD6").html(resp.D7);
            $("#tdD7").html(resp.D8);
            $("#tdD8").html(resp.D9);
            $("#tdD9").html(resp.D10);
            
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.cuentas[aver2[i]]);
              //var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
              cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
            }
            $('#autocomplete-custom-append').autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'
            }); 
               
            var ANAL_T0Array = new Array();
            for(i=0;i<ANAL_T0.length;i++)
            {
              var aver3 = Object.keys(resp.ANAL_T0[ANAL_T0[i]]);
              ANAL_T0Array.push( ANAL_T0[i].toString().trim() + "|"+ resp.ANAL_T0[ANAL_T0[i]]["NAME"]);
            }    
            $('#ANAL_T0').autocomplete({
              lookup: ANAL_T0Array,
              appendTo: '#ANAL_T0-container'
            }); 
            
            var ANAL_T1Array = new Array();
            for(i=0;i<ANAL_T1.length;i++)
            {
              ANAL_T1Array.push( ANAL_T1[i].toString().trim() + "|"+ resp.ANAL_T1[ANAL_T1[i]]["NAME"]);
            }    
            $('#ANAL_T1').autocomplete({
              lookup: ANAL_T1Array,
              appendTo: '#ANAL_T1-container'
            });
            
            var ANAL_T2Array = new Array();
            for(i=0;i<ANAL_T2.length;i++)
            {
              ANAL_T2Array.push( ANAL_T2[i].toString().trim() + "|"+ resp.ANAL_T2[ANAL_T2[i]]["NAME"]);
            }    
            $('#ANAL_T2').autocomplete({
              lookup: ANAL_T2Array,
              appendTo: '#ANAL_T2-container'
            });

            var ANAL_T3Array = new Array();
            for(i=0;i<ANAL_T3.length;i++)
            {
              ANAL_T3Array.push( ANAL_T3[i].toString().trim() + "|"+ resp.ANAL_T3[ANAL_T3[i]]["NAME"]);
            }    
            $('#ANAL_T3').autocomplete({
              lookup: ANAL_T3Array,
              appendTo: '#ANAL_T3-container'
            });

            var ANAL_T4Array = new Array();
            for(i=0;i<ANAL_T4.length;i++)
            {
              ANAL_T4Array.push( ANAL_T4[i].toString().trim() + "|"+ resp.ANAL_T4[ANAL_T4[i]]["NAME"]);
            }    
            $('#ANAL_T4').autocomplete({
              lookup: ANAL_T4Array,
              appendTo: '#ANAL_T4-container'
            });
            
            var ANAL_T5Array = new Array();
            for(i=0;i<ANAL_T5.length;i++)
            {
              ANAL_T5Array.push( ANAL_T5[i].toString().trim() + "|"+ resp.ANAL_T5[ANAL_T5[i]]["NAME"]);
            }    
            $('#ANAL_T5').autocomplete({
              lookup: ANAL_T5Array,
              appendTo: '#ANAL_T5-container'
            }); 


            var ANAL_T6Array = new Array();
            for(i=0;i<ANAL_T6.length;i++)
            {
              ANAL_T6Array.push( ANAL_T6[i].toString().trim() + "|"+ resp.ANAL_T6[ANAL_T6[i]]["NAME"]);
            }    
            $('#ANAL_T6').autocomplete({
              lookup: ANAL_T6Array,
              appendTo: '#ANAL_T6-container'
            });

             var ANAL_T7Array = new Array();
            for(i=0;i<ANAL_T7.length;i++)
            {
              ANAL_T7Array.push( ANAL_T7[i].toString().trim() + "|"+ resp.ANAL_T7[ANAL_T7[i]]["NAME"]);
            }    
            $('#ANAL_T7').autocomplete({
              lookup: ANAL_T7Array,
              appendTo: '#ANAL_T7-container'
            }); 

             var ANAL_T8Array = new Array();
            for(i=0;i<ANAL_T8.length;i++)
            {
              ANAL_T8Array.push( ANAL_T8[i].toString().trim() + "|"+ resp.ANAL_T8[ANAL_T8[i]]["NAME"]);
            }    
            $('#ANAL_T8').autocomplete({
              lookup: ANAL_T8Array,
              appendTo: '#ANAL_T8-container'
            }); 

             var ANAL_T9Array = new Array();
            for(i=0;i<ANAL_T9.length;i++)
            {
              ANAL_T9Array.push( ANAL_T9[i].toString().trim() + "|"+ resp.ANAL_T9[ANAL_T9[i]]["NAME"]);
            }    
            $('#ANAL_T9').autocomplete({
              lookup: ANAL_T9Array,
              appendTo: '#ANAL_T9-container'
            });  
          

          }
      });
  }

   function configInicialDeLineasDeTiposDeDiario()
  {
     $.ajax({
        url: "/configInicialDeLineasDeTiposDeDiario",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
            var ANAL_T0 = Object.keys(resp.ANAL_T0);
            var ANAL_T1 = Object.keys(resp.ANAL_T1);
            var ANAL_T2 = Object.keys(resp.ANAL_T2);
            var ANAL_T3 = Object.keys(resp.ANAL_T3);
            var ANAL_T4 = Object.keys(resp.ANAL_T4);
            var ANAL_T5 = Object.keys(resp.ANAL_T5);
            var ANAL_T6 = Object.keys(resp.ANAL_T6);
            var ANAL_T7 = Object.keys(resp.ANAL_T7);
            var ANAL_T8 = Object.keys(resp.ANAL_T8);
            var ANAL_T9 = Object.keys(resp.ANAL_T9);
            var tiposDeDiario = Object.keys(resp.tiposDeDiario);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<tiposDeDiario.length;i++)
            {
              var IdTipoDeDiario = resp.tiposDeDiario[tiposDeDiario[i]]["IdTipoDeDiario"];
              var nombre = resp.tiposDeDiario[tiposDeDiario[i]]["Nombre"];
              cad=cad+'<option value="'+IdTipoDeDiario+'">'+nombre+'</option>';
            }
            $("#tipoDeDiarioSelect").html(cad);
            if(resp.D1=="")
            {
              resp.D1 = "sin nombre";
            }
            $("#ANAL_T0_LABEL").html(resp.D1);
            $("#ANAL_T1_LABEL").html(resp.D2);
            $("#ANAL_T2_LABEL").html(resp.D3);
            $("#ANAL_T3_LABEL").html(resp.D4);
            $("#ANAL_T4_LABEL").html(resp.D5);
            $("#ANAL_T5_LABEL").html(resp.D6);
            $("#ANAL_T6_LABEL").html(resp.D7);
            $("#ANAL_T7_LABEL").html(resp.D8);
            $("#ANAL_T8_LABEL").html(resp.D9);
            $("#ANAL_T9_LABEL").html(resp.D10);


            $("#tdD0").html(resp.D1);
            $("#tdD1").html(resp.D2);
            $("#tdD2").html(resp.D3);
            $("#tdD3").html(resp.D4);
            $("#tdD4").html(resp.D5);
            $("#tdD5").html(resp.D6);
            $("#tdD6").html(resp.D7);
            $("#tdD7").html(resp.D8);
            $("#tdD8").html(resp.D9);
            $("#tdD9").html(resp.D10);
            
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.cuentas[aver2[i]]);
              //var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
              cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
            }
            $('#autocomplete-custom-append').autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'
            }); 
               
            var ANAL_T0Array = new Array();
            for(i=0;i<ANAL_T0.length;i++)
            {
              var aver3 = Object.keys(resp.ANAL_T0[ANAL_T0[i]]);
              ANAL_T0Array.push( ANAL_T0[i].toString().trim() + "|"+ resp.ANAL_T0[ANAL_T0[i]]["NAME"]);
            }    
            $('#ANAL_T0').autocomplete({
              lookup: ANAL_T0Array,
              appendTo: '#ANAL_T0-container'
            }); 
            
            var ANAL_T1Array = new Array();
            for(i=0;i<ANAL_T1.length;i++)
            {
              ANAL_T1Array.push( ANAL_T1[i].toString().trim() + "|"+ resp.ANAL_T1[ANAL_T1[i]]["NAME"]);
            }    
            $('#ANAL_T1').autocomplete({
              lookup: ANAL_T1Array,
              appendTo: '#ANAL_T1-container'
            });
            
            var ANAL_T2Array = new Array();
            for(i=0;i<ANAL_T2.length;i++)
            {
              ANAL_T2Array.push( ANAL_T2[i].toString().trim() + "|"+ resp.ANAL_T2[ANAL_T2[i]]["NAME"]);
            }    
            $('#ANAL_T2').autocomplete({
              lookup: ANAL_T2Array,
              appendTo: '#ANAL_T2-container'
            });

            var ANAL_T3Array = new Array();
            for(i=0;i<ANAL_T3.length;i++)
            {
              ANAL_T3Array.push( ANAL_T3[i].toString().trim() + "|"+ resp.ANAL_T3[ANAL_T3[i]]["NAME"]);
            }    
            $('#ANAL_T3').autocomplete({
              lookup: ANAL_T3Array,
              appendTo: '#ANAL_T3-container'
            });

            var ANAL_T4Array = new Array();
            for(i=0;i<ANAL_T4.length;i++)
            {
              ANAL_T4Array.push( ANAL_T4[i].toString().trim() + "|"+ resp.ANAL_T4[ANAL_T4[i]]["NAME"]);
            }    
            $('#ANAL_T4').autocomplete({
              lookup: ANAL_T4Array,
              appendTo: '#ANAL_T4-container'
            });
            
            var ANAL_T5Array = new Array();
            for(i=0;i<ANAL_T5.length;i++)
            {
              ANAL_T5Array.push( ANAL_T5[i].toString().trim() + "|"+ resp.ANAL_T5[ANAL_T5[i]]["NAME"]);
            }    
            $('#ANAL_T5').autocomplete({
              lookup: ANAL_T5Array,
              appendTo: '#ANAL_T5-container'
            }); 


            var ANAL_T6Array = new Array();
            for(i=0;i<ANAL_T6.length;i++)
            {
              ANAL_T6Array.push( ANAL_T6[i].toString().trim() + "|"+ resp.ANAL_T6[ANAL_T6[i]]["NAME"]);
            }    
            $('#ANAL_T6').autocomplete({
              lookup: ANAL_T6Array,
              appendTo: '#ANAL_T6-container'
            });

             var ANAL_T7Array = new Array();
            for(i=0;i<ANAL_T7.length;i++)
            {
              ANAL_T7Array.push( ANAL_T7[i].toString().trim() + "|"+ resp.ANAL_T7[ANAL_T7[i]]["NAME"]);
            }    
            $('#ANAL_T7').autocomplete({
              lookup: ANAL_T7Array,
              appendTo: '#ANAL_T7-container'
            }); 

             var ANAL_T8Array = new Array();
            for(i=0;i<ANAL_T8.length;i++)
            {
              ANAL_T8Array.push( ANAL_T8[i].toString().trim() + "|"+ resp.ANAL_T8[ANAL_T8[i]]["NAME"]);
            }    
            $('#ANAL_T8').autocomplete({
              lookup: ANAL_T8Array,
              appendTo: '#ANAL_T8-container'
            }); 

             var ANAL_T9Array = new Array();
            for(i=0;i<ANAL_T9.length;i++)
            {
              ANAL_T9Array.push( ANAL_T9[i].toString().trim() + "|"+ resp.ANAL_T9[ANAL_T9[i]]["NAME"]);
            }    
            $('#ANAL_T9').autocomplete({
              lookup: ANAL_T9Array,
              appendTo: '#ANAL_T9-container'
            });  
          

          }
      });
  }

  
  function configInicialDeLineasDeInformes()
  {
     $.ajax({
        url: "/configInicialLineasDeInformes",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
            var ANAL_T0 = Object.keys(resp.ANAL_T0);
            var ANAL_T1 = Object.keys(resp.ANAL_T1);
            var ANAL_T2 = Object.keys(resp.ANAL_T2);
            var ANAL_T3 = Object.keys(resp.ANAL_T3);
            var ANAL_T4 = Object.keys(resp.ANAL_T4);
            var ANAL_T5 = Object.keys(resp.ANAL_T5);
            var ANAL_T6 = Object.keys(resp.ANAL_T6);
            var ANAL_T7 = Object.keys(resp.ANAL_T7);
            var ANAL_T8 = Object.keys(resp.ANAL_T8);
            var ANAL_T9 = Object.keys(resp.ANAL_T9);
            var aver3 = Object.keys(resp.DiezmoConcepto);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<aver3.length;i++)
            {
              var Concepto = resp.DiezmoConcepto[aver3[i]]["Concepto"];
              var IdDiezmoConcepto = resp.DiezmoConcepto[aver3[i]]["IdDiezmoConcepto"];
              
              
              cad=cad+'<option value="'+IdDiezmoConcepto+'">'+Concepto+'</option>';
            }
            $("#conceptoInformeSelect").html(cad);
            if(resp.D1=="")
            {
              resp.D1 = "sin nombre";
            }
            $("#ANAL_T0_LABEL").html(resp.D1);
            $("#ANAL_T1_LABEL").html(resp.D2);
            $("#ANAL_T2_LABEL").html(resp.D3);
            $("#ANAL_T3_LABEL").html(resp.D4);
            $("#ANAL_T4_LABEL").html(resp.D5);
            $("#ANAL_T5_LABEL").html(resp.D6);
            $("#ANAL_T6_LABEL").html(resp.D7);
            $("#ANAL_T7_LABEL").html(resp.D8);
            $("#ANAL_T8_LABEL").html(resp.D9);
            $("#ANAL_T9_LABEL").html(resp.D10);


            $("#tdD0").html(resp.D1);
            $("#tdD1").html(resp.D2);
            $("#tdD2").html(resp.D3);
            $("#tdD3").html(resp.D4);
            $("#tdD4").html(resp.D5);
            $("#tdD5").html(resp.D6);
            $("#tdD6").html(resp.D7);
            $("#tdD7").html(resp.D8);
            $("#tdD8").html(resp.D9);
            $("#tdD9").html(resp.D10);
            
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.cuentas[aver2[i]]);
              //var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
              cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
            }
            $('#autocomplete-custom-append').autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'
            }); 
               
            var ANAL_T0Array = new Array();
            for(i=0;i<ANAL_T0.length;i++)
            {
              var aver3 = Object.keys(resp.ANAL_T0[ANAL_T0[i]]);
              ANAL_T0Array.push( ANAL_T0[i].toString().trim() + "|"+ resp.ANAL_T0[ANAL_T0[i]]["NAME"]);
            }    
            $('#ANAL_T0').autocomplete({
              lookup: ANAL_T0Array,
              appendTo: '#ANAL_T0-container'
            }); 
            
            var ANAL_T1Array = new Array();
            for(i=0;i<ANAL_T1.length;i++)
            {
              ANAL_T1Array.push( ANAL_T1[i].toString().trim() + "|"+ resp.ANAL_T1[ANAL_T1[i]]["NAME"]);
            }    
            $('#ANAL_T1').autocomplete({
              lookup: ANAL_T1Array,
              appendTo: '#ANAL_T1-container'
            });
            
            var ANAL_T2Array = new Array();
            for(i=0;i<ANAL_T2.length;i++)
            {
              ANAL_T2Array.push( ANAL_T2[i].toString().trim() + "|"+ resp.ANAL_T2[ANAL_T2[i]]["NAME"]);
            }    
            $('#ANAL_T2').autocomplete({
              lookup: ANAL_T2Array,
              appendTo: '#ANAL_T2-container'
            });

            var ANAL_T3Array = new Array();
            for(i=0;i<ANAL_T3.length;i++)
            {
              ANAL_T3Array.push( ANAL_T3[i].toString().trim() + "|"+ resp.ANAL_T3[ANAL_T3[i]]["NAME"]);
            }    
            $('#ANAL_T3').autocomplete({
              lookup: ANAL_T3Array,
              appendTo: '#ANAL_T3-container'
            });

            var ANAL_T4Array = new Array();
            for(i=0;i<ANAL_T4.length;i++)
            {
              ANAL_T4Array.push( ANAL_T4[i].toString().trim() + "|"+ resp.ANAL_T4[ANAL_T4[i]]["NAME"]);
            }    
            $('#ANAL_T4').autocomplete({
              lookup: ANAL_T4Array,
              appendTo: '#ANAL_T4-container'
            });
            
            var ANAL_T5Array = new Array();
            for(i=0;i<ANAL_T5.length;i++)
            {
              ANAL_T5Array.push( ANAL_T5[i].toString().trim() + "|"+ resp.ANAL_T5[ANAL_T5[i]]["NAME"]);
            }    
            $('#ANAL_T5').autocomplete({
              lookup: ANAL_T5Array,
              appendTo: '#ANAL_T5-container'
            }); 


            var ANAL_T6Array = new Array();
            for(i=0;i<ANAL_T6.length;i++)
            {
              ANAL_T6Array.push( ANAL_T6[i].toString().trim() + "|"+ resp.ANAL_T6[ANAL_T6[i]]["NAME"]);
            }    
            $('#ANAL_T6').autocomplete({
              lookup: ANAL_T6Array,
              appendTo: '#ANAL_T6-container'
            });

             var ANAL_T7Array = new Array();
            for(i=0;i<ANAL_T7.length;i++)
            {
              ANAL_T7Array.push( ANAL_T7[i].toString().trim() + "|"+ resp.ANAL_T7[ANAL_T7[i]]["NAME"]);
            }    
            $('#ANAL_T7').autocomplete({
              lookup: ANAL_T7Array,
              appendTo: '#ANAL_T7-container'
            }); 

             var ANAL_T8Array = new Array();
            for(i=0;i<ANAL_T8.length;i++)
            {
              ANAL_T8Array.push( ANAL_T8[i].toString().trim() + "|"+ resp.ANAL_T8[ANAL_T8[i]]["NAME"]);
            }    
            $('#ANAL_T8').autocomplete({
              lookup: ANAL_T8Array,
              appendTo: '#ANAL_T8-container'
            }); 

             var ANAL_T9Array = new Array();
            for(i=0;i<ANAL_T9.length;i++)
            {
              ANAL_T9Array.push( ANAL_T9[i].toString().trim() + "|"+ resp.ANAL_T9[ANAL_T9[i]]["NAME"]);
            }    
            $('#ANAL_T9').autocomplete({
              lookup: ANAL_T9Array,
              appendTo: '#ANAL_T9-container'
            });  
          

          }
      });
  }
  
  function configInicialDeLineasDeCedulas()
  {
     $.ajax({
        url: "/configInicialLineasCedulas",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
            var cuentasArray = new Array();
            var descrArray = new Array();
            var aver2 = Object.keys(resp.cuentas);
            var ANAL_T0 = Object.keys(resp.ANAL_T0);
            var ANAL_T1 = Object.keys(resp.ANAL_T1);
            var ANAL_T2 = Object.keys(resp.ANAL_T2);
            var ANAL_T3 = Object.keys(resp.ANAL_T3);
            var ANAL_T4 = Object.keys(resp.ANAL_T4);
            var ANAL_T5 = Object.keys(resp.ANAL_T5);
            var ANAL_T6 = Object.keys(resp.ANAL_T6);
            var ANAL_T7 = Object.keys(resp.ANAL_T7);
            var ANAL_T8 = Object.keys(resp.ANAL_T8);
            var ANAL_T9 = Object.keys(resp.ANAL_T9);
            var cedulas = Object.keys(resp.cedulas);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<cedulas.length;i++)
            {
              var todo = cedulas[i].split('|');
              var nombre = todo[0];
              var idCedula = todo[1];
              cad=cad+'<option value="'+idCedula+'">'+nombre+'</option>';
            }
            $("#cedulasSelect").html(cad);
            if(resp.D1=="")
            {
              resp.D1 = "sin nombre";
            }
            $("#ANAL_T0_LABEL").html(resp.D1);
            $("#ANAL_T1_LABEL").html(resp.D2);
            $("#ANAL_T2_LABEL").html(resp.D3);
            $("#ANAL_T3_LABEL").html(resp.D4);
            $("#ANAL_T4_LABEL").html(resp.D5);
            $("#ANAL_T5_LABEL").html(resp.D6);
            $("#ANAL_T6_LABEL").html(resp.D7);
            $("#ANAL_T7_LABEL").html(resp.D8);
            $("#ANAL_T8_LABEL").html(resp.D9);
            $("#ANAL_T9_LABEL").html(resp.D10);


            $("#tdD0").html(resp.D1);
            $("#tdD1").html(resp.D2);
            $("#tdD2").html(resp.D3);
            $("#tdD3").html(resp.D4);
            $("#tdD4").html(resp.D5);
            $("#tdD5").html(resp.D6);
            $("#tdD6").html(resp.D7);
            $("#tdD7").html(resp.D8);
            $("#tdD8").html(resp.D9);
            $("#tdD9").html(resp.D10);
            
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.cuentas[aver2[i]]);
              //var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
              cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
            }
            $('#autocomplete-custom-append').autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'
            }); 
               
            var ANAL_T0Array = new Array();
            for(i=0;i<ANAL_T0.length;i++)
            {
              var aver3 = Object.keys(resp.ANAL_T0[ANAL_T0[i]]);
              ANAL_T0Array.push( ANAL_T0[i].toString().trim() + "|"+ resp.ANAL_T0[ANAL_T0[i]]["NAME"]);
            }    
            $('#ANAL_T0').autocomplete({
              lookup: ANAL_T0Array,
              appendTo: '#ANAL_T0-container'
            }); 
            
            var ANAL_T1Array = new Array();
            for(i=0;i<ANAL_T1.length;i++)
            {
              ANAL_T1Array.push( ANAL_T1[i].toString().trim() + "|"+ resp.ANAL_T1[ANAL_T1[i]]["NAME"]);
            }    
            $('#ANAL_T1').autocomplete({
              lookup: ANAL_T1Array,
              appendTo: '#ANAL_T1-container'
            });
            
            var ANAL_T2Array = new Array();
            for(i=0;i<ANAL_T2.length;i++)
            {
              ANAL_T2Array.push( ANAL_T2[i].toString().trim() + "|"+ resp.ANAL_T2[ANAL_T2[i]]["NAME"]);
            }    
            $('#ANAL_T2').autocomplete({
              lookup: ANAL_T2Array,
              appendTo: '#ANAL_T2-container'
            });

            var ANAL_T3Array = new Array();
            for(i=0;i<ANAL_T3.length;i++)
            {
              ANAL_T3Array.push( ANAL_T3[i].toString().trim() + "|"+ resp.ANAL_T3[ANAL_T3[i]]["NAME"]);
            }    
            $('#ANAL_T3').autocomplete({
              lookup: ANAL_T3Array,
              appendTo: '#ANAL_T3-container'
            });

            var ANAL_T4Array = new Array();
            for(i=0;i<ANAL_T4.length;i++)
            {
              ANAL_T4Array.push( ANAL_T4[i].toString().trim() + "|"+ resp.ANAL_T4[ANAL_T4[i]]["NAME"]);
            }    
            $('#ANAL_T4').autocomplete({
              lookup: ANAL_T4Array,
              appendTo: '#ANAL_T4-container'
            });
            
            var ANAL_T5Array = new Array();
            for(i=0;i<ANAL_T5.length;i++)
            {
              ANAL_T5Array.push( ANAL_T5[i].toString().trim() + "|"+ resp.ANAL_T5[ANAL_T5[i]]["NAME"]);
            }    
            $('#ANAL_T5').autocomplete({
              lookup: ANAL_T5Array,
              appendTo: '#ANAL_T5-container'
            }); 


            var ANAL_T6Array = new Array();
            for(i=0;i<ANAL_T6.length;i++)
            {
              ANAL_T6Array.push( ANAL_T6[i].toString().trim() + "|"+ resp.ANAL_T6[ANAL_T6[i]]["NAME"]);
            }    
            $('#ANAL_T6').autocomplete({
              lookup: ANAL_T6Array,
              appendTo: '#ANAL_T6-container'
            });

             var ANAL_T7Array = new Array();
            for(i=0;i<ANAL_T7.length;i++)
            {
              ANAL_T7Array.push( ANAL_T7[i].toString().trim() + "|"+ resp.ANAL_T7[ANAL_T7[i]]["NAME"]);
            }    
            $('#ANAL_T7').autocomplete({
              lookup: ANAL_T7Array,
              appendTo: '#ANAL_T7-container'
            }); 

             var ANAL_T8Array = new Array();
            for(i=0;i<ANAL_T8.length;i++)
            {
              ANAL_T8Array.push( ANAL_T8[i].toString().trim() + "|"+ resp.ANAL_T8[ANAL_T8[i]]["NAME"]);
            }    
            $('#ANAL_T8').autocomplete({
              lookup: ANAL_T8Array,
              appendTo: '#ANAL_T8-container'
            }); 

             var ANAL_T9Array = new Array();
            for(i=0;i<ANAL_T9.length;i++)
            {
              ANAL_T9Array.push( ANAL_T9[i].toString().trim() + "|"+ resp.ANAL_T9[ANAL_T9[i]]["NAME"]);
            }    
            $('#ANAL_T9').autocomplete({
              lookup: ANAL_T9Array,
              appendTo: '#ANAL_T9-container'
            });  
          

          }
      });
  }
  
  

  function actualizaConceptosCedulas()
  {
    var idCedula = $("#cedulasSelectConceptos").val();
    var param = {idCedula : idCedula};
     $.ajax({
        url: "/listaConceptosCedulas",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.cedulasConceptos);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<tr><td>'+resp.cedulasConceptos[aver2[i]]["IdConcepto"]+'</td><td>'+resp.cedulasConceptos[aver2[i]]["Nombre"]+'</td><td><button type="button" IdConcepto="'+resp.cedulasConceptos[aver2[i]]["IdConcepto"]+'" nombre="'+resp.cedulasConceptos[aver2[i]]["Nombre"]+'" class="btn btn-round btn-warning editarConceptoCedula">Editar</button></td></tr>';
            } 
            $("#tablaCedulaConceptos").html(cad);
        }
      });
  }


  
  function actualizaLaTablaDondeEstanLasLineasDelTipoDeDiario()
  {
    var idTipoDeDiario = $("#tipoDeDiarioSelect").val();
    var param = {idTipoDeDiario : idTipoDeDiario};
     $.ajax({
        url: "/listaLineasTiposDeDiario",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
           
            var aver2 = Object.keys(resp.tiposDeDiarioLineas);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              var tipoDC = parseInt(resp.tiposDeDiarioLineas[aver2[i]]["D_C"]);
              var palabraDC ="";
              if(tipoDC=="D")
              {
                palabraDC = "D&eacute;bitos";
              }
              if(tipoDC=="C")
              {
                palabraDC = "Cr&eacute;ditos";
              }
              cad=cad+'<tr><td>'+resp.tiposDeDiarioLineas[aver2[i]]["Linea"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["Cuenta"]+'</td><td>'+palabraDC+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T0"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T1"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T2"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T3"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T4"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T5"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T6"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T7"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T8"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["ANAL_T9"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["DeboFacturar"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["Cliente"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["Servicio"]+'</td><td>'+resp.tiposDeDiarioLineas[aver2[i]]["Concepto"]+'</td><td><button type="button" idLinea="'+resp.tiposDeDiarioLineas[aver2[i]]["IdLinea"]+'" class="btn btn-round btn-warning editarLineaTipoDeDiario">Editar</button></td></tr>';
            } 
            $("#tablaLineaTiposDeDiario").html(cad);
            
        }
      });
  }
  function actualizaLaTablaDondeEstanLasLineasDeLasCedulaSegunElConcepto()
  {
    var IdConcepto = $("#conceptoSelect").val();
    var param = {IdConcepto : IdConcepto};
     $.ajax({
        url: "/listaLineasCedulas",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
           
            var aver2 = Object.keys(resp.cedulasLineas);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              var tipoDC = parseInt(resp.cedulasLineas[aver2[i]]["TipoDC"]);
              var palabraDC ="";
              if(tipoDC==1)
              {
                palabraDC = "D&eacute;bitos";
              }
              if(tipoDC==2)
              {
                palabraDC = "Cr&eacute;ditos";
              }
              if(tipoDC==4)
              {
                palabraDC = "Ambos D y C";
              }
              
              cad=cad+'<tr><td>'+resp.cedulasLineas[aver2[i]]["Cuenta"]+'</td><td>'+palabraDC+'</td><td>'+resp.cedulasLineas[aver2[i]]["NumCtaPago"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["MetodoDePago"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["RFC"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["RazonSocial"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["Correo"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T0"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T1"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T2"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T3"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T4"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T5"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T6"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T7"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T8"]+'</td><td>'+resp.cedulasLineas[aver2[i]]["ANAL_T9"]+'</td><td><button type="button" idLinea="'+resp.cedulasLineas[aver2[i]]["IdLinea"]+'" nombre="'+resp.cedulasLineas[aver2[i]]["Nombre"]+'" class="btn btn-round btn-danger eliminarLineaCedula">Eliminar</button></td></tr>';
            } 
            $("#tablaLineaCedulas").html(cad);
            
        }
      });
  }

  function actualizaTablaDeLineasInforme()
  {
    var IdDiezmoConcepto = parseInt($("#conceptoInformeSelect").val());
    var orden = parseInt($("#lineaInformeDiezmoSelect").val());
    var param = {IdDiezmoConcepto : IdDiezmoConcepto};
     $.ajax({
        url: "/listaLineasInformeDiezmo",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.DiezmoConceptoLinea);
            var cad2 = '';
            for(i=0;i<aver2.length;i++)
            {
             cad2 = cad2 + '<tr><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Orden"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Cuenta"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Aparece"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T0"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T1"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T2"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T3"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T4"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T5"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T6"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T7"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T8"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T9"]+'</td><td></td></tr>';
             
              if(parseInt(resp.DiezmoConceptoLinea[aver2[i]]["Orden"])==orden)
              {
                $('input[name="aparece"][value="0"]').parent().removeClass("active");
                $('input[name="aparece"][value="1"]').parent().removeClass("active");
                $('input[name="aparece"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["Aparece"]+'"]').attr("checked","checked");
                $('input[name="aparece"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["Aparece"]+'"]').parent().addClass('active');
                $('input[name="gender"][value="0"]').parent().removeClass("active");
                $('input[name="gender"][value="1"]').parent().removeClass("active");
                $('input[name="gender"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["DeboFacturar"]+'"]').attr("checked","checked");
                $('input[name="gender"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["DeboFacturar"]+'"]').parent().addClass('active');
                $('input[name="essuma"][value="0"]').parent().removeClass("active");
                $('input[name="essuma"][value="1"]').parent().removeClass("active");
                $('input[name="essuma"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["EsSuma"]+'"]').attr("checked","checked");
                $('input[name="essuma"][value="'+resp.DiezmoConceptoLinea[aver2[i]]["EsSuma"]+'"]').parent().addClass('active');
                $("#nombre").val(resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]);
                $("#tipoDC").val(resp.DiezmoConceptoLinea[aver2[i]]["D_C"]);
                $("#autocomplete-custom-append").val(resp.DiezmoConceptoLinea[aver2[i]]["Cuenta"]);
                $("#rfc").val(resp.DiezmoConceptoLinea[aver2[i]]["Rfc"]);
                $("#tipo").val(resp.DiezmoConceptoLinea[aver2[i]]["Tipo"]);
                $("#ANAL_T0").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T0"]);
                $("#ANAL_T1").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T1"]);
                $("#ANAL_T2").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T2"]);
                $("#ANAL_T3").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T3"]);
                $("#ANAL_T4").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T4"]);
                $("#ANAL_T5").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T5"]);
                $("#ANAL_T6").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T6"]);
                $("#ANAL_T7").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T7"]);
                $("#ANAL_T8").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T8"]);
                $("#ANAL_T9").val(resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T9"]);
                $("#descripcion").val(resp.DiezmoConceptoLinea[aver2[i]]["DESCRIPTN"]);
                $("#referencia").val(resp.DiezmoConceptoLinea[aver2[i]]["TREFERENCE"]);
              }
            }
             $("#tablaLineasDiezmoInforme").html(cad2);
           
        }
      });
  }

  function actualizaLineaDiezmoInforme()
  {
    var IdDiezmoConcepto = $("#conceptoInformeSelect").val();
    var param = {IdDiezmoConcepto : IdDiezmoConcepto};
    //listaLineasCedulas
     $.ajax({
        url: "/listaLineasInformeDiezmo",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.DiezmoConceptoLinea);
            var cad = '<option value="0">Nueva Linea</option>';
            var cad2 = '';
            //burbuja!
           /* var i , j;
            for(i=0;i<aver2.length;i++)
            {
              for(j=i+1;j<aver2.length;j++)
              {

                var auxI = aver2[i];
                var auxI = aver2[i];


              }
            }
*/



            for(i=0;i<aver2.length;i++)
            {
              cad2 = cad2 + '<tr><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Orden"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Cuenta"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["Aparece"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T0"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T1"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T2"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T3"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T4"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T5"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T6"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T7"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T8"]+'</td><td>'+resp.DiezmoConceptoLinea[aver2[i]]["ANAL_T9"]+'</td><td><button type="button" idDiezmoLinea="'+resp.DiezmoConceptoLinea[aver2[i]]["IdDiezmoLinea"]+'" class="btn btn-round btn-warning subirLineaConceptoInforme">Subir</button></td></tr>';

              cad=cad+'<option value="'+resp.DiezmoConceptoLinea[aver2[i]]["Orden"]+'">'+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]+'</option>';
            }
            $("#tablaLineasDiezmoInforme").html(cad2);
            $("#lineaInformeDiezmoSelect").html(cad);
        }
      });
  }


  function actualizaLineaCedulas()
  {
    var idCedula = $("#cedulasSelect").val();
    var param = {idCedula : idCedula};
    //listaLineasCedulas
     $.ajax({
        url: "/listaConceptosCedulas",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
         },
        complete : function (){
        }, 
        success : function (resp){
            var cedulas = Object.keys(resp.cedulasConceptos);
            var cad = '<option value="-1">Selecciona una opci&oacute;n</option>';
            for(i=0;i<cedulas.length;i++)
            {

              cad=cad+'<option value="'+resp.cedulasConceptos[cedulas[i]]["IdConcepto"]+'">'+resp.cedulasConceptos[cedulas[i]]["Nombre"]+'</option>';
            }
            $("#conceptoSelect").html(cad);
        }
      });
  }


  function actualizaDiariosRetenidos()
  {
     $.ajax({
        url: "/listaDiariosRetenidos",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.diariosRetenidos);
            var cad = '';
//          '<thead><tr><th>Fecha</th><th>Tipo de diario</th><th>Quien</th><th>Numeros de lineas</th><th>Ver</th></thead>'+
        
            for(i=0;i<aver2.length;i++)
            {
              var Timestamp = resp.diariosRetenidos [aver2[i]]["Timestamp"];
              var Cuantas = resp.diariosRetenidos [aver2[i]]["Cuantas"];
              var Usuario = resp.diariosRetenidos [aver2[i]]["Usuario"];
              var TipoDiario = resp.diariosRetenidos [aver2[i]]["TipoDiario"];
              
              cad=cad+'<tr><td>'+timeConverter(parseInt(Timestamp))+'</td><td>'+Cuantas+'</td><td>'+Usuario+'</td><td>'+TipoDiario+'</td><td><button type="button" timestamp="'+Timestamp+'" class="btn btn-round btn-warning verDiarioRetenido">Ver</button></td></tr>';
            } 
            $("#tablaDiariosRetenidos").html(cad);
        }
      });
  }

  

  function actualizaTiposDeDiario()
  {
     $.ajax({
        url: "/listaTiposDeDiario",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.tiposDeDiario);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              var nombre = resp.tiposDeDiario [aver2[i]]["Nombre"];
              var Codigo = resp.tiposDeDiario [aver2[i]]["Codigo"];
              var IdTipoDeDiario = resp.tiposDeDiario [aver2[i]]["IdTipoDeDiario"];
              cad=cad+'<tr><td>'+IdTipoDeDiario+'</td><td>'+nombre+'</td><td>'+Codigo+'</td><td><button type="button" IdTipoDeDiario="'+IdTipoDeDiario+'" nombre="'+nombre+'" Codigo="'+Codigo+'" class="btn btn-round btn-warning editarTipoDeDiario">Editar</button></td></tr>';
            } 
            $("#tablaTiposDeDiario").html(cad);
        }
      });
  }

   function actualizaDiezmoConcepto()
  {
     $.ajax({
        url: "/listaDiezmoConcepto",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.DiezmoConcepto);
            var cad = '';
            var palabraActivo = '';
            for(i=0;i<aver2.length;i++)
            {
              var Concepto = resp.DiezmoConcepto[aver2[i]]["Concepto"];
              var IdDiezmoConcepto = resp.DiezmoConcepto[aver2[i]]["IdDiezmoConcepto"];
              var Activo = parseInt(resp.DiezmoConcepto[aver2[i]]["Activo"]);
              if(Activo==1)
              {
                palabraActivo="Activo";
              }
              else
              {
                palabraActivo="Inactivo"; 
              }
              cad=cad+'<tr><td>'+Concepto+'</td><td>'+palabraActivo+'</td><td><button type="button" IdDiezmoConcepto="'+IdDiezmoConcepto+'" Concepto="'+Concepto+'" class="btn btn-round btn-warning editarDiezmoConcepto">Editar</button></td></tr>';
            } 
            $("#tablaDiezmoConcepto").html(cad);
        }
      });
  }

  function actualizaCedulas()
  {
     $.ajax({
        url: "/listaCedulas",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.cedulas);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              var todo = aver2[i].split('|');
              var nombre = todo[0];
              var idCedula = todo[1];
              cad=cad+'<tr><td>'+idCedula+'</td><td>'+nombre+'</td><td><button type="button" idCedula="'+idCedula+'" nombre="'+nombre+'" class="btn btn-round btn-warning editarCedula">Editar</button></td></tr>';
            } 
            $("#tablaCedulas").html(cad);
        }
      });
  }

  function actualizaTipoDeDimensiones()
  {
     $.ajax({
        url: "/tipoDeDimensiones",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.dimensiones);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<tr><td>'+resp.dimensiones[aver2[i]]["ANL_CAT_ID"]+'</td><td>'+resp.dimensiones[aver2[i]]["S_HEAD"]+'</td><td>'+resp.dimensiones[aver2[i]]["DESCR"]+'</td><td><button type="button" ANL_CAT_ID="'+resp.dimensiones[aver2[i]]["ANL_CAT_ID"]+'" S_HEAD="'+resp.dimensiones[aver2[i]]["S_HEAD"]+'" DESCR="'+resp.dimensiones[aver2[i]]["DESCR"]+'" class="btn btn-round btn-warning editarTipoDeDimension">Editar</button></td></tr>';
            } 
            $("#tablaDimensiones").html(cad);
        }
      });
  }



  function actualizaClasificacionDimensiones()
  {
     $.ajax({
        url: "/clasificacionDeDimensiones",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.dimensiones);
            var cad = '<option selected="selected" value="0">Seleccione una opci&oacute;n</option>';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<option S_HEAD="'+resp.dimensiones[aver2[i]]["S_HEAD"]+'" value="'+resp.dimensiones[aver2[i]]["ANL_CAT_ID"]+'">'+resp.dimensiones[aver2[i]]["S_HEAD"]+' - '+resp.dimensiones[aver2[i]]["DESCR"]+'</option>';
            } 
            $("#entry1").html(cad);
            $("#entry2").html(cad);
            $("#entry3").html(cad);
            $("#entry4").html(cad);
            $("#entry5").html(cad);
            $("#entry6").html(cad);
            $("#entry7").html(cad);
            $("#entry8").html(cad);
            $("#entry9").html(cad);
            $("#entry10").html(cad);
        }
      });
  }


  function actualizaDimensiones()
  {
     $.ajax({
        url: "/dimensiones",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
            var aver2 = Object.keys(resp.dimensiones);
            var cad = '';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<tr><td>'+resp.dimensiones[aver2[i]]["S_HEAD"]+'</td><td>'+resp.dimensiones[aver2[i]]["ANL_CODE"]+'</td><td>'+resp.dimensiones[aver2[i]]["NAME"]+'</td><td>'+resp.dimensiones[aver2[i]]["STATUS"]+'</td><td>'+resp.dimensiones[aver2[i]]["PROHIBIT_POSTING"]+'</td><td><button type="button" ANL_CAT_ID="'+resp.dimensiones[aver2[i]]["ANL_CAT_ID"]+'" S_HEAD="'+resp.dimensiones[aver2[i]]["S_HEAD"]+'" ANL_CODE="'+resp.dimensiones[aver2[i]]["ANL_CODE"]+'"  NAME="'+resp.dimensiones[aver2[i]]["NAME"]+'" STATUS="'+resp.dimensiones[aver2[i]]["STATUS"]+'" PROHIBIT_POSTING="'+resp.dimensiones[aver2[i]]["PROHIBIT_POSTING"]+'" class="btn btn-round btn-warning editarDimension">Editar</button></td></tr>';
            } 
            $("#tablaDimensionesEditar").html(cad);
        }
      });
  }

  

$(document).on("click", ".eliminarLineaCedula", function (){
  var IdLinea = $(this).attr("idLinea");
  var param = { IdLinea : IdLinea };
  $.ajax({
    url: "/eliminarLineaCedula",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
     },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaLaTablaDondeEstanLasLineasDeLasCedulaSegunElConcepto();
      }
    }
  });
});
$(document).on("click", ".subirLineaConceptoInforme", function (){
  var idDiezmoLinea = $(this).attr("idDiezmoLinea");
  var param = { idDiezmoLinea : idDiezmoLinea };
  $.ajax({
    url: "/subeLineasInformeDiezmo",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
     },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaLineaDiezmoInforme();
      }
    }
  });
});
  $(document).on("click", "#guardarNuevaDimension", function (){
    var ANL_CAT_ID = $(this).attr("ANL_CAT_ID");
    var ANL_CODE = $(this).attr("ANL_CODE");
    var NAME = $("#nombre").val();
    var STATUS = $("#status").val();
    var PROHIBIT_POSTING = $("#prohibido").val();
    
    if(ANL_CAT_ID=="-1" && ANL_CODE =="-1")
    {
      ANL_CAT_ID = $("#tipo").val();
      ANL_CODE = $("#codigo").val();

      var param = {
      tipo : ANL_CAT_ID,
      codigo : ANL_CODE,
      status : STATUS,
      nombre : NAME,
      prohibido : PROHIBIT_POSTING
    };
       $.ajax({
        url: "/nuevaDimension",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Dimension creada exitosamente");
            actualizaDimensiones();
          }
          if(resp.success==2)
          {
            alert("Ya existe esa dimension!");
          }
           if(resp.success==3)
          {
            alert("Hubo un error desconocido! Perdon!");
          }
        }
      });
    }
    else
    {
      var param = {
        tipo : ANL_CAT_ID,
        codigo : ANL_CODE,
        status : STATUS,
        nombre : NAME,
        prohibido : PROHIBIT_POSTING
      };
      $.ajax({
        url: "/editarDimension",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaDimensiones();
          }
          if(resp.success==2)
          {
            alert("eh? no nos hackies por favor");
            actualizaDimensiones();
          }
          if(resp.success==3)
          {
            alert("Hubo un error!");
            actualizaDimensiones();
          }
        }
      });
    }
  });

  $(document).on("click", "#guardarConceptoCedula", function (){
    var idCedula = parseInt($("#cedulasSelectConceptos").val());
    var nombre = $("#nombreConcepto").val();
    if(idCedula>0)
    {
      var param = {nombre : nombre, idCedula : idCedula};
      $.ajax({
        url: "/guardarConceptoCedula",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Linea cedula creada exitosamente");
            actualizaConceptosCedulas();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    }
  });
  


  $(document).on("click", "#guardarNuevaLineaInforme", function (){
    var IdDiezmoConcepto = parseInt($("#conceptoInformeSelect").val());
    var linea = parseInt($("#lineaInformeDiezmoSelect").val());
    var rfc = $("#rfc").val().trim();
    var tipo = $("#tipo").val();
    var descripcion = $("#descripcion").val().trim();
    var nombre = $("#nombre").val().trim();
    var referencia = $("#referencia").val().trim();
    var debofacturar = $('input[name="gender"]:checked').val();
    var essuma = $('input[name="essuma"]:checked').val();
    var aparece = $('input[name="aparece"]:checked').val();
    var cuenta = $("#autocomplete-custom-append").val().trim();
    var tipoDC = $("#tipoDC").val();
    var ANAL_T0 = $("#ANAL_T0").val();
    var ANAL_T1 = $("#ANAL_T1").val();
    var ANAL_T2 = $("#ANAL_T2").val();
    var ANAL_T3 = $("#ANAL_T3").val();
    var ANAL_T4 = $("#ANAL_T4").val();
    var ANAL_T5 = $("#ANAL_T5").val();
    var ANAL_T6 = $("#ANAL_T6").val();
    var ANAL_T7 = $("#ANAL_T7").val();
    var ANAL_T8 = $("#ANAL_T8").val();
    var ANAL_T9 = $("#ANAL_T9").val();

      
    if(cuenta.indexOf('|')>-1)
    {
      cuenta = cuenta.split('|')[0];
    }
    if(ANAL_T0.indexOf('|')>-1)
    {
      ANAL_T0 = ANAL_T0.split('|')[0];
    }
    if(ANAL_T1.indexOf('|')>-1)
    {
      ANAL_T1 = ANAL_T1.split('|')[0];
    }
    if(ANAL_T2.indexOf('|')>-1)
    {
      ANAL_T2 = ANAL_T2.split('|')[0];
    }
    if(ANAL_T3.indexOf('|')>-1)
    {
      ANAL_T3 = ANAL_T3.split('|')[0];
    }
    if(ANAL_T4.indexOf('|')>-1)
    {
      ANAL_T4 = ANAL_T4.split('|')[0];
    }
    if(ANAL_T5.indexOf('|')>-1)
    {
      ANAL_T5 = ANAL_T5.split('|')[0];
    }
    if(ANAL_T6.indexOf('|')>-1)
    {
      ANAL_T6 = ANAL_T6.split('|')[0];
    }
    if(ANAL_T7.indexOf('|')>-1)
    {
      ANAL_T7 = ANAL_T7.split('|')[0];
    }
    if(ANAL_T8.indexOf('|')>-1)
    {
      ANAL_T8 = ANAL_T8.split('|')[0];
    }
    if(ANAL_T9.indexOf('|')>-1)
    {
      ANAL_T9 = ANAL_T9.split('|')[0];
    }
    if(cuenta=="")
    {
      alert("Tienes que seleccionar una cuenta primero!");
      return;
    }
  
    var param = {debofacturar: debofacturar, tipo: tipo, rfc: rfc, descripcion: descripcion, linea: linea, IdDiezmoConcepto : IdDiezmoConcepto, cuenta : cuenta , tipoDC : tipoDC, ANAL_T0 : ANAL_T0, ANAL_T1 : ANAL_T1, ANAL_T2 : ANAL_T2, ANAL_T3 : ANAL_T3, ANAL_T4 : ANAL_T4, ANAL_T5 : ANAL_T5, ANAL_T6 : ANAL_T6, ANAL_T7 : ANAL_T7, ANAL_T8 : ANAL_T8, ANAL_T9 : ANAL_T9, nombre: nombre, referencia: referencia, essuma: essuma, aparece : aparece};
       $.ajax({
        url: "/nuevoOModificaLineaDiezmoConcepto",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Linea de informe creada exitosamente");
            actualizaTablaDeLineasInforme();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    
  });

  $(document).on("click", "#guardarNuevaLineaDelTipoDeDiario", function (){
    var IdTipoDeDiario = parseInt($("#tipoDeDiarioSelect").val());
    var linea = parseInt($("#lineaDelTipoDeDiario").val());
    var servicio = $("#servicio").val().trim();
    var cliente = $("#cliente").val().trim();
    var concepto = $("#concepto").val().trim();
    var descripcion = $("#descripcion").val().trim();
    var debofacturar = $('input[name=gender]:checked').val();
    var cuenta = $("#autocomplete-custom-append").val().trim();
    var tipoDC = $("#tipoDC").val();
    var ANAL_T0 = $("#ANAL_T0").val();
    var ANAL_T1 = $("#ANAL_T1").val();
    var ANAL_T2 = $("#ANAL_T2").val();
    var ANAL_T3 = $("#ANAL_T3").val();
    var ANAL_T4 = $("#ANAL_T4").val();
    var ANAL_T5 = $("#ANAL_T5").val();
    var ANAL_T6 = $("#ANAL_T6").val();
    var ANAL_T7 = $("#ANAL_T7").val();
    var ANAL_T8 = $("#ANAL_T8").val();
    var ANAL_T9 = $("#ANAL_T9").val();

      
    if(cuenta.indexOf('|')>-1)
    {
      cuenta = cuenta.split('|')[0];
    }
    if(ANAL_T0.indexOf('|')>-1)
    {
      ANAL_T0 = ANAL_T0.split('|')[0];
    }
    if(ANAL_T1.indexOf('|')>-1)
    {
      ANAL_T1 = ANAL_T1.split('|')[0];
    }
    if(ANAL_T2.indexOf('|')>-1)
    {
      ANAL_T2 = ANAL_T2.split('|')[0];
    }
    if(ANAL_T3.indexOf('|')>-1)
    {
      ANAL_T3 = ANAL_T3.split('|')[0];
    }
    if(ANAL_T4.indexOf('|')>-1)
    {
      ANAL_T4 = ANAL_T4.split('|')[0];
    }
    if(ANAL_T5.indexOf('|')>-1)
    {
      ANAL_T5 = ANAL_T5.split('|')[0];
    }
    if(ANAL_T6.indexOf('|')>-1)
    {
      ANAL_T6 = ANAL_T6.split('|')[0];
    }
    if(ANAL_T7.indexOf('|')>-1)
    {
      ANAL_T7 = ANAL_T7.split('|')[0];
    }
    if(ANAL_T8.indexOf('|')>-1)
    {
      ANAL_T8 = ANAL_T8.split('|')[0];
    }
    if(ANAL_T9.indexOf('|')>-1)
    {
      ANAL_T9 = ANAL_T9.split('|')[0];
    }
    if(cuenta=="")
    {
      alert("Tienes que seleccionar una cuenta primero!");
      return;
    }
    if(IdTipoDeDiario>0)
    {
        var param = {debofacturar: debofacturar, cliente: cliente, servicio: servicio, concepto: concepto, descripcion: descripcion, linea: linea, IdTipoDeDiario : IdTipoDeDiario, cuenta : cuenta , tipoDC : tipoDC, ANAL_T0 : ANAL_T0, ANAL_T1 : ANAL_T1, ANAL_T2 : ANAL_T2, ANAL_T3 : ANAL_T3, ANAL_T4 : ANAL_T4, ANAL_T5 : ANAL_T5, ANAL_T6 : ANAL_T6, ANAL_T7 : ANAL_T7, ANAL_T8 : ANAL_T8, ANAL_T9 : ANAL_T9};
       $.ajax({
        url: "/nuevoOModificaLineaTipoDeDiario",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Linea de tipo de diario creada exitosamente");
            actualizaLaTablaDondeEstanLasLineasDelTipoDeDiario();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    }
  });
  $(document).on("click", "#guardarNuevaLineaCedula", function (){
    var IdConcepto = parseInt($("#conceptoSelect").val());
    var nombre = $("#nombreLinea").val();
    var cuenta = $("#autocomplete-custom-append").val();
    var tipoDC = $("#tipoDC").val();
    var ANAL_T0 = $("#ANAL_T0").val();
    var ANAL_T1 = $("#ANAL_T1").val();
    var ANAL_T2 = $("#ANAL_T2").val();
    var ANAL_T3 = $("#ANAL_T3").val();
    var ANAL_T4 = $("#ANAL_T4").val();
    var ANAL_T5 = $("#ANAL_T5").val();
    var ANAL_T6 = $("#ANAL_T6").val();
    var ANAL_T7 = $("#ANAL_T7").val();
    var ANAL_T8 = $("#ANAL_T8").val();
    var ANAL_T9 = $("#ANAL_T9").val();

    var metodoDePago = $("#metodoDePago").val();

    var NumCtaPago = $("#NumCtaPago").val().trim();
    if(NumCtaPago=="")
    {
      alert("Escribe el Num Cta de Pago primero");
      return;
    }

    var correo = $("#correo").val().trim();
    if(correo=="")
    {
      alert("Escribe el correo primero");
      return;
    }

    var RFC = $("#rfc").val().trim();
    if(RFC=="")
    {
      alert("Escribe el RFC primero");
      return;
    }
    var RazonSocial  = $("#razonSocial").val().trim();
    if(RazonSocial =="")
    {
      alert("Escribe la razon social primero");
      return;
    }
    if(cuenta.indexOf('|')>-1)
    {
      cuenta = cuenta.split('|')[0];
    }


    if(ANAL_T0.indexOf('|')>-1)
    {
      ANAL_T0 = ANAL_T0.split('|')[0];
    }


    if(ANAL_T1.indexOf('|')>-1)
    {
      ANAL_T1 = ANAL_T1.split('|')[0];
    }


    if(ANAL_T2.indexOf('|')>-1)
    {
      ANAL_T2 = ANAL_T2.split('|')[0];
    }


    if(ANAL_T3.indexOf('|')>-1)
    {
      ANAL_T3 = ANAL_T3.split('|')[0];
    }


    if(ANAL_T4.indexOf('|')>-1)
    {
      ANAL_T4 = ANAL_T4.split('|')[0];
    }


    if(ANAL_T5.indexOf('|')>-1)
    {
      ANAL_T5 = ANAL_T5.split('|')[0];
    }


    if(ANAL_T6.indexOf('|')>-1)
    {
      ANAL_T6 = ANAL_T6.split('|')[0];
    }


    if(ANAL_T7.indexOf('|')>-1)
    {
      ANAL_T7 = ANAL_T7.split('|')[0];
    }


    if(ANAL_T8.indexOf('|')>-1)
    {
      ANAL_T8 = ANAL_T8.split('|')[0];
    }


    if(ANAL_T9.indexOf('|')>-1)
    {
      ANAL_T9 = ANAL_T9.split('|')[0];
    }
    if(IdConcepto>0)
    {
      var param = {nombre : nombre, IdConcepto : IdConcepto, cuenta : cuenta , tipoDC : tipoDC, ANAL_T0 : ANAL_T0, ANAL_T1 : ANAL_T1, ANAL_T2 : ANAL_T2, ANAL_T3 : ANAL_T3, ANAL_T4 : ANAL_T4, ANAL_T5 : ANAL_T5, ANAL_T6 : ANAL_T6, ANAL_T7 : ANAL_T7, ANAL_T8 : ANAL_T8, ANAL_T9 : ANAL_T9, RFC : RFC, RazonSocial : RazonSocial, correo : correo, NumCtaPago : NumCtaPago, metodoDePago : metodoDePago  };
      $.ajax({
        url: "/nuevoLineaCedula",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Linea de factura creada exitosamente");
            actualizaLaTablaDondeEstanLasLineasDeLasCedulaSegunElConcepto();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    }
    else
    {
     /* var param = {ANL_CAT_ID: ANL_CAT_ID, S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/editarTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaTipoDeDimensiones();
          }
          
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });*/
    }
  });


  
    $(document).on("click", "#guardarNuevoTipoDeDiario", function (){
    var idTipoDeDiario = $(this).attr("idTipoDeDiario");
    var nombre = $("#nombre").val();
    var codigo = $("#codigo").val();
    
    if(idTipoDeDiario=="-1")
    {
      var param = {nombre : nombre, codigo: codigo};
      $.ajax({
        url: "/nuevoTipoDeDiario",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de diario creado exitosamente");
            actualizaTiposDeDiario();
          }
          if(resp.success==0)
          {
            alert("Hubo un error! perdon!");
          }
        }
      });
    }
    else
    {
     /* var param = {ANL_CAT_ID: ANL_CAT_ID, S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/editarTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaTipoDeDimensiones();
          }
          
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });*/
    }
  });
    
    $(document).on("change", "#tipoDeDiarioSelectDeCaptura", function (){
      $("#referencia").select();
      });

$(document).on("click", "#nuevoUsuarioIglesia", function (){
  var iglesia = $("#iglesiaSelect").val();
  var name = $("#iglesiaSelect option:selected").attr("name"); 
  var nombre = $("#nombre").val().trim();
  var correo = $("#correo").val().trim();
  var password = $("#password").val().trim();
  password = sha512(password);
  var param = {nombre : nombre, correo : correo, password : password, iglesia : iglesia, name : name};
  $.ajax({
    url: "/nuevoUsuarioIglesia",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaUsuariosIglesias();
      }
    }
  });
});

  $(document).on("click", "#guardarNuevoConcepto", function (){
    var idDiezmoConcepto = $(this).attr("idDiezmoConcepto");
    var nombre = $("#nombre").val();
    if(idDiezmoConcepto=="-1")
    {
      var param = {nombre : nombre};
      $.ajax({
        url: "/nuevoDiezmoConcepto",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            actualizaDiezmoConcepto();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    }
    else
    {
     /* var param = {ANL_CAT_ID: ANL_CAT_ID, S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/editarTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaTipoDeDimensiones();
          }
          
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });*/
    }
  });

  $(document).on("click", "#guardarNuevaCedula", function (){
    var idCedula = $(this).attr("idCedula");
    var nombre = $("#nombre").val();
    if(idCedula=="-1")
    {
      var param = {nombre : nombre};
      $.ajax({
        url: "/nuevoCedula",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Cedula creada exitosamente");
            actualizaCedulas();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    }
    else
    {
     /* var param = {ANL_CAT_ID: ANL_CAT_ID, S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/editarTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaTipoDeDimensiones();
          }
          
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });*/
    }
  });

  function toFixed2(value, precision) {
    var power = Math.pow(10, precision || 0);
    return String(Math.round(value * power) / power);
}
function format2(n, currency) {
    return currency + " " + toFixed2(n,2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,");
}
function format3(n, currency) {
    return currency + " " + toFixed2(n,3).replace(/(\d)(?=(\d{3})+\.)/g, "$1,");
}

 $(document).on("click", ".vesAlISR", function (){
    var periodo = parseInt($(this).attr("periodo"));
    window.open(
      "/isr?periodo=" + periodo,
      '_blank'
    );
  });


 $(document).on("click", ".vesAlISRAnual", function (){
    var periodo = parseInt($(this).attr("periodo"));
    window.open(
      "/isrAnual?periodo=" + periodo,
      '_blank'
    );
  });

 $(document).on("click", ".vesAlISRAnualExcel", function (){
    var periodo = parseInt($(this).attr("periodo"));
    window.open(
      "/isrAnualExcel?periodo=" + periodo,
      '_blank'
    );
  });


$(document).on("click", "#vesAlSDI", function (){
    var periodo = parseInt($(this).attr("periodo"));
    var BUNIT = $(this).attr("BUNIT");
    var rows=hot.countRows();  
    var cols=hot.countCols();
    var cuak = hot.getData(0,0,rows,cols);
    var cad ='';
    for(i=0;i<cuak.length;i++)
    {
      var sdi=cuak[i][43];
      var ER =cuak[i][0];
      cad=cad+ER+'|'+sdi+'|';
    }
    window.open(
      "/sdi?periodo=" + periodo+"&BUNIT="+BUNIT+"&sdi="+cad ,
      '_blank'
    );
  });
$(document).on("click", ".vesAlISR2", function (){
    var periodo = parseInt($(this).attr("periodo"));
    var BUNIT = $(this).attr("BUNIT");
    window.open(
      "/isr?periodo=" + periodo+"&BUNIT="+BUNIT ,
      '_blank'
    );
  });



 $(document).on("click", ".vesAlDiario", function (){
    var diario = parseInt($(this).attr("diario"));
    window.open(
      "/generarDiario?libro=A&diario=" + diario,
      '_blank'
    );
  });
 $(document).on("click", ".vesADetallePorDiario", function (){
    var idLinea = parseInt($(this).attr("idLinea"));
    var delPeriodo = $("#delPeriodo").val();
    var alPeriodo = $("#alPeriodo").val();
    if(idLinea>-1)
    {
      var param = {idLinea : idLinea, delPeriodo: delPeriodo, alPeriodo : alPeriodo};
      $.ajax({
        url: "/generaCedulaPorLinea",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = resp.cedulasAcumulador;
          var cad='';
          for (var p in aver2) {
            var objeto=resp.cedulasAcumulador[p];
            var diario = p.split('-')[0];
               cad=cad+'<tr><td><a class="vesAlDiario" href="javascript:void(0)" diario="'+diario+'" >'+p+'</a></td><td>'+format2(parseFloat(objeto["Cantidad"]),"$")+'</td></tr>';
          }
          $("#tablaConcentradoDiarios").html(cad);
        }
      });
    }
  });
 $(document).on("click", ".vesADetallePorCuenta", function (){
    var idConcepto = parseInt($(this).attr("idConcepto"));
    var delPeriodo = $("#delPeriodo").val();
    var alPeriodo = $("#alPeriodo").val();
    if(idConcepto>-1)
    {
      var param = {idConcepto : idConcepto, delPeriodo: delPeriodo, alPeriodo : alPeriodo};
      $.ajax({
        url: "/generaCedulaPorConcepto",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = resp.cedulasAcumulador;
          var cad='';
          for (var p in aver2) {
            var objeto=resp.cedulasAcumulador[p];
               cad=cad+'<tr><td><a class="vesADetallePorDiario" href="javascript:void(0)" idLinea="'+objeto["IdConceptoOLinea"]+'" >'+p+'</a></td><td>'+format2(parseFloat(objeto["Cantidad"]),"$")+'</td></tr>';
          }
          $("#tablaConcentradoCuenta").html(cad);
        }
      });
    }
  });
  $(document).on("click", "#verCedulaButton", function (){
    var idCedula = parseInt($("#cedulasSelectVer").val());
    var delPeriodo = $("#delPeriodo").val();
    var alPeriodo = $("#alPeriodo").val();
    if(idCedula>-1)
    {
      var param = {idCedula : idCedula, delPeriodo: delPeriodo, alPeriodo : alPeriodo};
      $.ajax({
        url: "/generaCedula",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = resp.cedulasAcumulador;
          var cad='';
          for (var p in aver2) {
            var objeto=resp.cedulasAcumulador[p];
               cad=cad+'<tr><td><a class="vesADetallePorCuenta" href="javascript:void(0)" idConcepto="'+objeto["IdConceptoOLinea"]+'" >'+p+'</a></td><td>'+format2(parseFloat(objeto["Cantidad"]),"$")+'</td></tr>';
          }
          $("#tablaConcentradoCedula").html(cad);
        }
      });
    }
  });
  $(document).on("click", "#guardarNuevoTipoDeDimension", function (){
    var ANL_CAT_ID = $(this).attr("ANL_CAT_ID");
    var S_HEAD = $("#codigo").val();
    var DESCR = $("#descr").val();
    if(ANL_CAT_ID=="-1")
    {
      var param = {S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/nuevoTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension creada exitosamente");
            actualizaTipoDeDimensiones();
          }
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });
    }
    else
    {
      var param = {ANL_CAT_ID: ANL_CAT_ID, S_HEAD : S_HEAD, DESCR : DESCR};
      $.ajax({
        url: "/editarTipoDeDimensiones",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Tipo de dimension editado exitosamente");
            actualizaTipoDeDimensiones();
          }
          
          if(resp.success==2)
          {
            alert("Hubo un error!");
            actualizaTipoDeDimensiones();
          }
        }
      });
    }
  });
  

$(document).on("click", ".editarDimension", function (){
  var ANL_CAT_ID = $(this).attr("ANL_CAT_ID").trim();
  var S_HEAD = $(this).attr("S_HEAD").trim();
  var NAME = $(this).attr("NAME").trim();
  var ANL_CODE = $(this).attr("ANL_CODE").trim();
  var STATUS = $(this).attr("STATUS").trim();
  var PROHIBIT_POSTING = $(this).attr("PROHIBIT_POSTING").trim();
  $("#guardarNuevaDimension").attr("ANL_CAT_ID",ANL_CAT_ID);
  $("#guardarNuevaDimension").attr("ANL_CODE",ANL_CODE);
  $("#codigo").val(ANL_CODE);
  $("#tipo").val(S_HEAD);
  $("#nombre").val(NAME);
  $("#status").val(STATUS);
  $("#prohibido").val(PROHIBIT_POSTING);
  $("#tipo").attr("readonly", true);
  $("#codigo").attr("readonly", true);
});



  $(document).on("click", ".editarTipoDeDimension", function (){
    var ANL_CAT_ID = $(this).attr("ANL_CAT_ID");
    var S_HEAD = $(this).attr("S_HEAD");
    var DESCR = $(this).attr("DESCR");
    $("#guardarNuevoTipoDeDimension").attr("ANL_CAT_ID",ANL_CAT_ID);
    $("#codigo").val(S_HEAD);
    $("#descr").val(DESCR);
  });

  
  $(document).on("click", "#limpiar", function (){
    $("#guardarNuevoTipoDeDimension").attr("ANL_CAT_ID","-1");
    $("#codigo").val("");
    $("#descr").val("");
  });

$(document).on("click", "#limpiarD", function (){
    $("#guardarNuevaDimension").attr("ANL_CAT_ID","-1");
    $("#guardarNuevaDimension").attr("ANL_CODE","-1");
    $("#tipo").val("");
    $("#codigo").val("");
    $("#tipo").attr("readonly", false);
    $("#codigo").attr("readonly", false);
    $("#nombre").val("");
    $("#status").val("");
    $("#prohibido").val("");
  });

$(document).on("click", "#subidaInicialCuentas", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subida inicial de cuentas</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Cuentas <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                    '<p>Descarga esta lista de ejemplo de las cuentas, llenala y conviertela en archivo CSV, despu&eacute;s subela aqu&iacute;.</p>'+
                    '<a href="static/files/FormatoParaSubirCuentas.xlsx" target="_blank"><button type="button" class="btn btn-primary">Descargar lista de ejemplo</button></a>'+
                    '<input type="file"  id="archivoCSVCuentas" />'+
                    '<br>'+
                    '<br>'+
                    '<br>'+
                    '<br>'+
                '</div>'+
                '<div class="clearfix"></div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });
  $(document).on("click", "#subidaInicialDimensiones", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Tipo de dimensiones</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Tipo de dimensiones <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                    '<p>Descarga esta lista de ejemplo, llenala y conviertela en archivo CSV, despu&eacute;s subela aqu&iacute;.</p>'+
                    '<a href="static/files/FormatoParaSubirDimensiones.xlsx" target="_blank"><button type="button" class="btn btn-primary">Descargar lista de ejemplo</button></a>'+
                    '<input type="file"  id="archivoCSV" />'+
                    '<br>'+
                    '<br>'+
                    '<br>'+
                    '<br>'+
                '</div>'+
                '<div class="clearfix"></div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
});
  

$(document).on("change", "#TipoDondeEstaranLasDimensiones", function (){  
  var numeroTipo = parseInt($(this).val());
  $('#entry1').val(0);
  $('#entry2').val(0);
  $('#entry3').val(0);
  $('#entry4').val(0);
  $('#entry5').val(0);
  $('#entry6').val(0);
  $('#entry7').val(0);
  $('#entry8').val(0);
  $('#entry9').val(0);
  $('#entry10').val(0);
  if(numeroTipo==0)
  {
//clasificacionDeDimensiones
  }
  else
  {
    var param = {numero : numeroTipo}
    $.ajax({
      url: "/obtieneDimensionesAsignadasATipo",
      dataType : "json",
      type : "post",
      data: param,
      async : true,
      beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
      },
      complete : function (){
      }, 
      success : function (resp){
        var i;
        var aver2 = Object.keys(resp.dimensiones);
        var cad = '';
        var numero, S_HEAD, ANL_CAT_ID;
         for(i=0;i<aver2.length;i++)
        {
          numero = parseInt(resp.dimensiones[aver2[i]]["ENTRY_NUM"]);
          //S_HEAD = resp.dimensiones[aver2[i]]["S_HEAD"];
          ANL_CAT_ID = resp.dimensiones[aver2[i]]["ANL_CAT_ID"];
          $('#entry'+numero).val(ANL_CAT_ID);
          //$('#startTime option[value=17:00:00]').prop('selected', 'selected');
        } 
      }
    });  
  }

});
$(document).on("change", "#archivoCSVCuentas", function (){  
  var fileName = $('#archivoCSVCuentas').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'txt' )
  {
    var results = Papa.parse($('#archivoCSVCuentas')[0].files[0], {
      complete: function(filas) {
        var i;
        var exitosos = 0;
        var yaExistian = 0;
        var conErrores = 0;
        var cuantosTotales = filas.data.length-2;
        for(i=1;i<filas.data.length;i++)
        {
          var unaFila = filas.data[i];
          if(unaFila[0]=="D"){unaFila[0]=0;}
          if(unaFila[0]=="C"){unaFila[0]=1;}
          if(unaFila[0]=="T"){unaFila[0]=2;}
          if(unaFila[0]=="P"){unaFila[0]=3;}
          if(unaFila[0]=="B"){unaFila[0]=4;}
          if(unaFila[0]=="M"){unaFila[0]=5;}

          if(unaFila[6]=="B"){unaFila[6]=0;}
          if(unaFila[6]=="O"){unaFila[6]=1;}

          if(unaFila[7]=="O"){unaFila[7]=0;}
          if(unaFila[7]=="C"){unaFila[7]=3;}
         
         var j=0;
         for(j=15;j<=24;j++)
         {
          if(unaFila[j]=="P"){unaFila[j]=3;}
          if(unaFila[j]=="O"){unaFila[j]=2;}
          if(unaFila[j]=="M"){unaFila[j]=1;}
         }
          

         
         //cuacua
            var param = {
              ACNT_CODE : unaFila[1].trim(),
              DESCR : unaFila[2],
              ACNT_TYPE : unaFila[0],
              BAL_TYPE : unaFila[6],
              STATUS : unaFila[7],
              LINK_ACNT : unaFila[12],
              ENTER_ANL_1 : unaFila[15],
              ENTER_ANL_2 : unaFila[16],
              ENTER_ANL_3 : unaFila[17],
              ENTER_ANL_4 : unaFila[18],
              ENTER_ANL_5 : unaFila[19],
              ENTER_ANL_6 : unaFila[20],
              ENTER_ANL_7 : unaFila[21],
              ENTER_ANL_8 : unaFila[22],
              ENTER_ANL_9 : unaFila[23],
              ENTER_ANL_10 : unaFila[24],
              D1 : unaFila[29],
              D2 : unaFila[30],
              D3 : unaFila[31],
              D4 : unaFila[32],
              D5 : unaFila[33],
              D6 : unaFila[34],
              D7 : unaFila[35],
              D8 : unaFila[36],
              D9 : unaFila[37],
              D10 : unaFila[38]
            };
             $.ajax({
                url: "/nuevaCuenta",
                dataType : "json",
                type : "post",
                data: param,
                async : false,
                beforeSend : function (){
            //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    yaExistian++;
                  }
                  if(resp.success==3)
                  {
                    conErrores++;
                  }
                }
              });  
          
        }
        alert("Exitosos: "+exitosos+", Ya existian: "+yaExistian+", con error: "+conErrores+", de un total de: "+cuantosTotales);  
      }
    });
  }
  else
  {
    alert('El formato de archivo permitido es csv o txt.');
  }
});

$(document).on("change", "#archivoCSV", function (){  
  var fileName = $('#archivoCSV').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'txt' )
  {
    var results = Papa.parse($('#archivoCSV')[0].files[0], {
      complete: function(filas) {
        var i;
        var exitosos = 0;
        var yaExistian = 0;
        var conErrores = 0;
        var cuantosTotales = filas.data.length-2;
        for(i=1;i<filas.data.length;i++)
        {
          var unaFila = filas.data[i];
         
            var param = {
              tipo : unaFila[0],
              codigo : unaFila[1],
              status : unaFila[2],
              nombre : unaFila[3],
              prohibido : unaFila[4]
            };
             $.ajax({
                url: "/nuevaDimension",
                dataType : "json",
                type : "post",
                data: param,
                async : false,
                beforeSend : function (){
            //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    yaExistian++;
                  }
                  if(resp.success==3)
                  {
                    conErrores++;
                  }
                }
              });  
          
        }
        alert("Exitosos: "+exitosos+", Ya existian: "+yaExistian+", con error: "+conErrores+", de un total de: "+cuantosTotales);  
      }
    });
  }
  else
  {
    alert('El formato de archivo permitido es csv o txt.');
  }
});


$(document).on("change", "#fechaTrans", function (){
  $("#cantidad").select();
  $("#cantidad").focus();
  $("#cantidad").click();
});  


  $(document).on("click", "#depre", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Depreciaci&oacute;n de activos fijos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Depreciaci&oacute;n <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="depreciarTodaLaBanda"  class="btn btn-success">Depreciar todos</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Activos <small>fijos</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>C&oacute;digo</th><th>Nombre</th><th>Status</th><th>Status</th><th>Periodo inicial</th><th>Periodo final</th><th>&Uacute;ltimo periodo</th><th>Periodo disposal</th><th>Disposed</th><th>Cantidad inicial base</th><th>Cantidad depreciado base</th><th>Cantidad neta base</th><th>Porcentaje de depreciaci&oacute;n base</th><th>Cantidad inicial transacci&oacute;n</th><th>Cantidad depreciado transacci&oacute;n</th><th>Cantidad neta transacci&oacute;n</th><th>Porcentaje de depreciaci&oacute;n transacci&oacute;n</th></thead>'+
                        '<tbody id="tablaActivosFijosDepre"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaActivosFijos();
 });

   $(document).on("click", "#modificarDimensiones", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Tipo de dimensiones</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Tipo de dimensiones <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Tipo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text"  name="tipo" id="tipo" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">C&oacute;digo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text"  name="codigo" id="codigo" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombre" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Status: (0 normal, 3 cerrado)</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="status" maxlength="1"  id="status" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Prohibido contabilizar: (0 no, 1 prohibido contabilizar)</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="prohibido" maxlength="1" id="prohibido" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevaDimension" ANL_CAT_ID="-1" ANL_CODE="-1"  class="btn btn-success">Guardar nuevo o modificacion</button>'+
                      '</div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="limpiarD" class="btn btn-warning">Limpiar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Dimensiones <small>Tipos de dimensiones</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Tipo</th><th>C&oacute;digo</th><th>Nombre</th><th>Status</th><th>Prohibido contabilizar</th><th>Editar</th></thead>'+
                        '<tbody id="tablaDimensionesEditar"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaDimensiones();
 });


function dameOptionSegunTipoConceptoSATDeLaBD(TipoConcepto) {
  var cad = '';
  var param = {tipo: TipoConcepto};
  $.ajax({
    url: "/dameOptionSegunTipoConceptoSATDeLaBD",
    dataType : "json",
    type : "post",
    data: param, 
    async : false,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.conceptos);
        var i;
        for(i=0;i<aver2.length;i++)
        {
          var tipoPalabra = dameDescripcionDeTipoSAT(resp.conceptos[aver2[i]].Tipo,resp.conceptos[aver2[i]].TipoSAT);
          if(parseInt(resp.conceptos[aver2[i]].Tipo)==1)
          {
            palabra = 'Percepci&oacute;n'; 
          }
          else
          {
            if(parseInt(resp.conceptos[aver2[i]].Tipo)==2)
            {
              palabra = 'Deducci&oacute;n';  
            }
            else
            {
              palabra = 'Otro Pago';
            }
          }
          cad=cad+'<option TipoSAT="'+resp.conceptos[aver2[i]].TipoSAT+'" concepto="'+resp.conceptos[aver2[i]].Concepto+'" value="'+resp.conceptos[aver2[i]].IdRegistro+'">'+tipoPalabra+'</option>';
        }
        if(parseInt(TipoConcepto)==1)
        {
          $('#nuevaPercepcion').html(cad)
        }
        if(parseInt(TipoConcepto)==2)
        {
          $('#nuevaDeduccion').html(cad)
        }
        if(parseInt(TipoConcepto)==3)
        {
          $('#nuevaOtrosPagos').html(cad)
        }
      }
    }
  });
 // return "<option>Hola</option>";
}
function dameOptionSegunTipoConceptoSAT(TipoConcepto) {
  var cad = '';
  if(TipoConcepto==1)//percepciones 
  {
    cad = cad +   '<option value="001">Sueldos, Salarios Rayas y Jornales</option>'+
                          '<option value="002">Gratificaci&oacute;n Anual (Aguinaldo)</option>'+
                          '<option value="003">Participaci&oacute;n de los Trabajadores en las Utilidades PTU</option>'+
                          '<option value="004">Reembolso de Gastos M&eacute;dicos Dentales y Hospitalarios</option>'+
                          '<option value="005">Fondo de ahorro</option>'+
                          '<option value="006">Caja de ahorro</option>'+
                          '<option value="009">Contribuciones a Cargo del Trabajador Pagadas por el Patr&oacite;n</option>'+
                          '<option value="010">Premios por puntualidad</option>'+
                          '<option value="011">Prima de seguro de vida</option>'+
                          '<option value="012">Seguro de Gastos M&eacute;dicos Mayores</option>'+
                          '<option value="013">Cuotas Sindicales Pagadas por el Patr&oacute;n</option>'+
                          '<option value="014">Subsidios por incapacidad</option>'+
                          '<option value="015">Becas para trabajadores y/o hijos</option>'+
                          '<option value="019">Horas extra</option>'+
                          '<option value="020">Prima dominical</option>'+
                          '<option value="021">Prima vacacional</option>'+
                          '<option value="022">Prima por antiguedad</option>'+
                          '<option value="023">Pagos por separaci&oacute;n</option>'+
                          '<option value="024">Seguro de retiro</option>'+
                          '<option value="025">Indemnizaciones</option>'+
                          '<option value="026">Reembolso por funeral</option>'+
                          '<option value="027">Cuotas de seguridad social pagadas por el patr&oacute;n</option>'+
                          '<option value="028">Comisiones</option>'+
                          '<option value="029">Vales de despensa</option>'+
                          '<option value="030">Vales de restaurante</option>'+
                          '<option value="031">Vales de gasolina</option>'+
                          '<option value="032">Vales de ropa</option>'+
                          '<option value="033">Ayuda para renta</option>'+
                          '<option value="034">Ayuda para art&iacute;culos escolares</option>'+
                          '<option value="035">Ayuda para anteojos</option>'+
                          '<option value="036">Ayuda para transporte</option>'+
                          '<option value="037">Ayuda para gastos de funeral</option>'+
                          '<option value="038">Otros ingresos por salarios</option>'+
                          '<option value="039">Jubilaciones, pensiones o haberes de retiro</option>'+
                          '<option value="044">Jubilaciones, pensiones o haberes de retiro en parcialidades</option>'+
                          '<option value="045">Ingresos en acciones o títulos valor que representan bienes</option>'+
                          '<option value="046">Ingresos asimilados a salarios</option>'+
                          '<option value="047">Alimentaci&oacute;n</option>'+
                          '<option value="048">Habitación</option>'+
                          '<option value="049">Premios por asistencia</option>'+
                          '<option value="050">Vi&aacute;ticos</option>';
  }
  else
  {
    if(TipoConcepto==2)//deducciones
    {
cad = cad +   '<option value="001">Seguridad social</option>'+
'<option value="002">ISR</option>'+
                          '<option value="003">Aportaciones a retiro, cesant&iacute;a en edad avanzada y vejez</option>'+
                          '<option value="004">Otros</option>'+
                          '<option value="005">Aportaciones a Fondo de vivienda</option>'+
                          '<option value="006">Descuento por incapacidad</option>'+
                          '<option value="007">Pensi&oacute;n alimenticia</option>'+
                          '<option value="008">Renta</option>'+
                          '<option value="009">Pr&eacute;stamos provenientes del Fondo Nacional de la Vivienda para los Trabajadores</option>'+
                          '<option value="010">Pago por cr&eacute;dito de vivienda</option>'+
                          '<option value="011">Pago de abonos INFONACOT</option>'+
                          '<option value="012">Anticipo de salarios</option>'+
                          '<option value="013">Pagos hechos con exceso al trabajador</option>'+
                          '<option value="014">Errores</option>'+
                          '<option value="015">P&eacute;rdidas</option>'+
                          '<option value="016">Aver&iacute;as</option>'+
                          '<option value="017">Adquisici&oacute;n de artículos producidos por la empresa o establecimiento</option>'+
                          '<option value="018">Cuotas para la constituci&oacute;n y fomento de sociedades cooperativas y de cajas de ahorro</option>'+
                          '<option value="019">Cuotas sindicales</option>'+
                          '<option value="020">Ausencia (Ausentismo)</option>'+
                          '<option value="021">Cuotas obrero patronales</option>'+
                          '<option value="022">Impuestos Locales</option>'+
                          '<option value="023">Aportaciones voluntarias</option>'+
                          '<option value="024">Ajuste en Gratificación Anual (Aguinaldo) Exento</option>'+
                          '<option value="025">Ajuste en Gratificación Anual (Aguinaldo) Gravado</option>'+
                          '<option value="026">Ajuste en Participación de los Trabajadores en las Utilidades PTU Exento</option>'+
                          '<option value="027">Ajuste en Participación de los Trabajadores en las Utilidades PTU Gravado</option>'+
                          '<option value="028">Ajuste en Reembolso de Gastos Médicos Dentales y Hospitalarios Exento</option>'+
                          '<option value="029">Ajuste en Fondo de ahorro Exento</option>'+
                          '<option value="030">Ajuste en Caja de ahorro Exento</option>'+
                          '<option value="031">Ajuste en Contribuciones a Cargo del Trabajador Pagadas por el Patrón Exento</option>'+
                          '<option value="032">Ajuste en Premios por puntualidad Gravado</option>'+
                          '<option value="033">Ajuste en Prima de Seguro de vida Exento</option>'+
                          '<option value="034">Ajuste en Seguro de Gastos Médicos Mayores Exento</option>'+
                          '<option value="035">Ajuste en Cuotas Sindicales Pagadas por el Patrón Exento</option>'+
                          '<option value="036">Ajuste en Subsidios por incapacidad Exento</option>'+
                          '<option value="037">Ajuste en Becas para trabajadores y/o hijos Exento</option>'+
                          '<option value="038">Ajuste en Horas extra Exento</option>'+ 
                          '<option value="039">Ajuste en Horas extra Gravado</option>'+ 
                          '<option value="040">Ajuste en Prima dominical Exento</option>'+ 
                          '<option value="041">Ajuste en Prima dominical Gravado</option>'+ 
                          '<option value="042">Ajuste en Prima vacacional Exento</option>'+ 
                          '<option value="043">Ajuste en Prima vacacional Gravado</option>'+ 
                          '<option value="044">Ajuste en Prima por antigüedad Exento</option>'+ 
                          '<option value="045">Ajuste en Prima por antigüedad Gravado</option>'+ 
                          '<option value="046">Ajuste en Pagos por separación Exento</option>'+ 
                          '<option value="047">Ajuste en Pagos por separación Gravado</option>'+ 
                          '<option value="048">Ajuste en Seguro de retiro Exento</option>'+ 
                          '<option value="049">Ajuste en Indemnizaciones Exento</option>'+ 
                          '<option value="050">Ajuste en Indemnizaciones Gravado</option>'+ 
                          '<option value="051">Ajuste en Reembolso por funeral Exento</option>'+ 
                          '<option value="052">Ajuste en Cuotas de seguridad social pagadas por el patrón Exento</option>'+ 
                          '<option value="053">Ajuste en Comisiones Gravado</option>'+ 
                          '<option value="054">Ajuste en Vales de despensa Exento</option>'+ 
                          '<option value="055">Ajuste en Vales de restaurante Exento</option>'+ 
                          '<option value="056">Ajuste en Vales de gasolina Exento</option>'+ 
                          '<option value="057">Ajuste en Vales de ropa Exento</option>'+ 
                          '<option value="058">Ajuste en Ayuda para renta Exento</option>'+ 
                          '<option value="059">Ajuste en Ayuda para artículos escolares Exento</option>'+ 
                          '<option value="060">Ajuste en Ayuda para anteojos Exento</option>'+ 
                          '<option value="061">Ajuste en Ayuda para transporte Exento</option>'+ 
                          '<option value="062">Ajuste en Ayuda para gastos de funeral Exento</option>'+ 
                          '<option value="063">Ajuste en Otros ingresos por salarios Exento</option>'+ 
                          '<option value="064">Ajuste en Otros ingresos por salarios Gravado</option>'+ 
                          '<option value="065">Ajuste en Jubilaciones, pensiones o haberes de retiro Exento</option>'+ 
                          '<option value="066">Ajuste en Jubilaciones, pensiones o haberes de retiro Gravado</option>'+ 
                          '<option value="067">Ajuste en Pagos por separación Acumulable</option>'+ 
                          '<option value="068">Ajuste en Pagos por separación No acumulable</option>'+ 
                          '<option value="069">Ajuste en Jubilaciones, pensiones o haberes de retiro Acumulable</option>'+ 
                          '<option value="070">Ajuste en Jubilaciones, pensiones o haberes de retiro No acumulable</option>'+ 
                          '<option value="071">Ajuste en Subsidio para el empleo (efectivamente entregado al trabajador)</option>'+ 
                          '<option value="072">Ajuste en Ingresos en acciones o títulos valor que representan bienes Exento</option>'+ 
                          '<option value="073">Ajuste en Ingresos en acciones o títulos valor que representan bienes Gravado</option>'+ 
                          '<option value="074">Ajuste en Alimentaci&oacute;n Exento</option>'+ 
                          '<option value="075">Ajuste en Alimentaci&oacute;n Gravado</option>'+ 
                          '<option value="076">Ajuste en Habitaci&oacute;n Exento</option>'+ 
                          '<option value="077">Ajuste en Habitaci&oacute;n Gravado</option>'+ 
                          '<option value="078">Ajuste en Premios por asistencia</option>'+ 
                          '<option value="079">Ajuste en Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados.</option>'+ 
                          '<option value="080">Ajuste en Vi&aacute;ticos gravados</option>'+ 
                          '<option value="081">Ajuste en Vi&aacute;ticos (entregados al trabajador)</option>'+
                          '<option value="082">Ajuste en Fondo de ahorro Gravado</option>'+ 
                          '<option value="083">Ajuste en Caja de ahorro Gravado</option>'+ 
                          '<option value="084">Ajuste en Prima de Seguro de vida Gravado</option>'+ 
                          '<option value="085">Ajuste en Seguro de Gastos Médicos Mayores Gravado</option>'+ 
                          '<option value="086">Ajuste en Subsidios por incapacidad Gravado</option>'+ 
                          '<option value="087">Ajuste en Becas para trabajadores y/o hijos Gravado</option>'+ 
                          '<option value="088">Ajuste en Seguro de retiro Gravado</option>'+ 
                          '<option value="089">Ajuste en Vales de despensa Gravado</option>'+ 
                          '<option value="090">Ajuste en Vales de restaurante Gravado</option>'+ 
                          '<option value="091">Ajuste en Vales de gasolina Gravado</option>'+ 
                          '<option value="092">Ajuste en Vales de ropa Gravado</option>'+ 
                          '<option value="093">Ajuste en Ayuda para renta Gravado</option>'+ 
                          '<option value="094">Ajuste en Ayuda para artículos escolares Gravado</option>'+ 
                          '<option value="095">Ajuste en Ayuda para anteojos Gravado</option>'+ 
                          '<option value="096">Ajuste en Ayuda para transporte Gravado</option>'+ 
                          '<option value="097">Ajuste en Ayuda para gastos de funeral Gravado</option>'+ 
                          '<option value="098">Ajuste a ingresos asimilados a salarios gravados</option>'+ 
                          '<option value="099">Ajuste a ingresos por sueldos y salarios gravados</option>'+ 
                          '<option value="100">Ajuste en Vi&aacute;ticos exentos</option>';
                        }
                        else//tipo otro pago
                        {
                          cad = cad +   '<option value="001">Reintegro de ISR pagado en exceso (siempre que no haya sido enterado al SAT).</option>'+
                            '<option value="002">Subsidio para el empleo (efectivamente entregado al trabajador).</option>'+
                            '<option value="003">Viáticos (entregados al trabajador).</option>'+
                            '<option value="004">Aplicación de saldo a favor por compensación anual.</option>'+
                            '<option value="999">Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados.</option>';
                        }
  }
  return cad;
}
$(document).on("change", "#TipoConceptoSAT", function (){
  var TipoConcepto = parseInt($(this).val());
  var cad = dameOptionSegunTipoConceptoSAT(TipoConcepto);
  $("#TipoSAT").html(cad);
});

$(document).on("click", "#nuevoConceptoNomina", function (){
  var GravadoExcento = $("#GravadoExcento").val();
  var TipoSAT = $("#TipoSAT").val();
  var TipoConceptoSAT = $("#TipoConceptoSAT").val();
  var Concepto = $("#Concepto").val().trim();

  var cuenta = $("#autocomplete-custom-append").val().trim();
  if(cuenta.indexOf('|')>-1)
  {
    cuenta = cuenta.split('|')[0];
  }
  if(cuenta=="")
  {
    alert("Te falto de indicar la cuenta");
    return;
  }
  if(Concepto=="")
  {
    alert("Te falto de indicar el concepto");
    return;
  }

  var param = {GravadoExcento: GravadoExcento, TipoSAT: TipoSAT, TipoConceptoSAT: TipoConceptoSAT, Concepto: Concepto, cuenta: cuenta};
       $.ajax({
        url: "/nuevoConceptoNomina",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            actualizaTablaConceptosDeNomina();
          }
        }
      });
});



$(document).on("click", ".nombreCuentaGuardar", function (){
  var cuenta = $(this).attr("cuenta");
  var nombre = $('.nombre[cuenta="'+cuenta+'"]').val();
  var ACNT_CODE = $('.ACNT_CODE[cuenta="'+cuenta+'"]').val();
  
  var param = {cuenta : cuenta, nombre : nombre, ACNT_CODE : ACNT_CODE}
   $.ajax({
        url: "/nombreCuentaGuardar",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            actualizaTablaNombresCuentas();
          }
        }
      });
});


$(document).on("click", ".procesaArchivo", function (){
  var archivo = $(this).attr("archivo");
  var param = {archivo : archivo}
   $.ajax({
        url: "/procesaArchivo",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            actualizaTablaArchivosBanco();
            alert("Movimientos registrados: "+resp.exitosos+" Errores: "+resp.errores+" Errores de Fecha: "+resp.fecha);
          }
        }
      });
});



$(document).on("click", ".abonoCargoMarcar", function (){
  var STATUS = $(this).attr("STATUS");
  var concentrado = $(this).attr("concentrado");
  var idBanco = concentrado;
  var param = {STATUS : STATUS, idBanco : idBanco}
   $.ajax({
        url: "/abonoCargoMarcar",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            $('tr[concentrado="'+concentrado+'"]').remove();
          }
        }
      });
});

$(document).on("click", ".cuentaPropiaMarcar", function (){
  var banderita = 0;
  var CuentaPropia = parseInt($(this).attr("CuentaPropia"));
  if(CuentaPropia==-2)//estoy en TECP desmarcar por cuenta
  {
    CuentaPropia=-1;//lo dejo como estaba
    banderita=1;//pero activo mi banderita que me calculara de nuevo la cuenta
  }
  var concentrado = $(this).attr("concentrado");
  var idBanco = concentrado.split("-")[0];
  var idBancoPrima = concentrado.split("-")[1];
  var param = {CuentaPropia : CuentaPropia, idBanco : idBanco, idBancoPrima : idBancoPrima}
   $.ajax({
        url: "/cuentaPropiaMarcar",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            $('tr[concentrado="'+concentrado+'"]').remove();
            if(banderita==1)
            {
              var cuenta = $("#selectCuentaTECP").val();
              calculaTCEP_por_Cuenta(cuenta);
            }
          }
        }
      });
});

$(document).on("click", ".ligarIngresos", function (){
  var idBanco = $(this).attr("idBanco");
  var bruto = $('#autocomplete-custom-append'+idBanco).val();
   var folioFiscal = "";
  var maximo = 99999999;
 
   if(bruto.length==16)
  {
    //1802000097323651
    folioFiscal = bruto;
  }
  else
  {
  var splitBruto = bruto.split('|');
 
  if(splitBruto.length!=3)
  {
    alert("No modifiques lo que se pone en la caja de texto!")
    return;
  }
  var folioFiscal = splitBruto[2];
  if(folioFiscal.length!=36)
  {
    alert("No modifiques lo que se pone en la caja de texto")
    return; 
  }
maximo = parseFloat(splitBruto[1]);
}
  var maximoDeIdBanco = parseFloat( $('#cantidad'+idBanco).attr("maximo"));
  var maxMinimo = maximoDeIdBanco;
  if(maximo<maximoDeIdBanco)
  {
    maxMinimo = maximo;
  }
  var cantidad = $('#cantidad'+idBanco).val();
  if(cantidad>maxMinimo)
  {
    alert("No puedes ligar mas de $ "+maxMinimo+"     Estas tratando de ligar $ "+cantidad  )
    return;
  }
  var param = {cantidad : cantidad, folioFiscal : folioFiscal, idBanco : idBanco }
  $.ajax({
    url: "/ligar",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaLigadoDeDiaIngresos();
      }
      if(resp.success==2)
      {
        var i=0;
        var cad="La factura tiene un limite de "+resp.total+" y ya se ha ligado: "+resp.ligado+" lista de mov ligados: ";
        var aver2 = Object.keys(resp.ligados);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+' '+resp.ligados[aver2[i]].Leyenda1+" "+resp.ligados[aver2[i]].Fecha+" "+resp.ligados[aver2[i]].Descripcion;
        }
        alert(cad);
      }
    }
  });
});

$(document).on("click", ".ligar", function (){
  var idBanco = $(this).attr("idBanco");
  var folioFiscal = "";
  var maximo = 99999999;
  var bruto = $('#autocomplete-custom-append'+idBanco).val().trim();
  if(bruto.length==16)
  {
    //1802000097323651
    folioFiscal = bruto;
  }
  else
  {
    var splitBruto = bruto.split('|');
    if(splitBruto.length!=3)
    {
      alert("No modifiques lo que se pone en la caja de texto!")
      return;
    }
    folioFiscal = splitBruto[2];
    if(folioFiscal.length!=36)
    {
      alert("No modifiques lo que se pone en la caja de texto")
      return; 
    }  
    maximo = parseFloat(splitBruto[1]);
  }
  
  var maximoDeIdBanco = parseFloat( $('#cantidad'+idBanco).attr("maximo"));
  var maxMinimo = maximoDeIdBanco;
  if(maximo<maximoDeIdBanco)
  {
    maxMinimo = maximo;
  }
  var cantidad = $('#cantidad'+idBanco).val();
  if(cantidad>maxMinimo)
  {
    alert("No puedes ligar mas de $ "+maxMinimo+"     Estas tratando de ligar $ "+cantidad  )
    return;
  }
  var param = {cantidad : cantidad, folioFiscal : folioFiscal, idBanco : idBanco }
  $.ajax({
    url: "/ligar",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaLigadoDeDia();
      }
      if(resp.success==2)
      {
       var i=0;
        var cad="La factura tiene un limite de "+resp.total+" y ya se ha ligado: "+resp.ligado+" lista de mov ligados: ";
        var aver2 = Object.keys(resp.ligados);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+' '+resp.ligados[aver2[i]].Leyenda1+" "+resp.ligados[aver2[i]].Fecha+" "+resp.ligados[aver2[i]].Descripcion;
        }
        alert(cad);
      }
    }
  });
});
$(document).on("click", ".desliga", function (){
  var idLigado = $(this).attr("idLigado");
  var param = {idLigado : idLigado}
  $.ajax({
    url: "/desliga",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaLigadoDeDia();
      }
    }
  });
});



$(document).on("click", ".desligaIngreso", function (){
  var idLigado = $(this).attr("idLigado");
  var param = {idLigado : idLigado}
  $.ajax({
    url: "/desliga",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaLigadoDeDiaIngresos();
      }
    }
  });
});

$(document).on("click", ".cancelarIngresosNew", function (){
  var idBanco = $(this).attr("idBanco");
  var UUID = $(this).attr("UUID");
  var param = {UUID : UUID, idBanco : idBanco}
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/cancelarIngresosNew",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        if(parseInt(idBanco)==0)
        {
          verFacturacionDeIngresos();
        }
        else
        {
          cargaTimbradoDeDia();
        }
        
       /* window.open(
          "/" + resp.pdf,
          '_blank'
        );*/
         $("#loadingCampos").html('');
       
      }
    }
  });
});
$(document).on("click", "#moneda", function (){
  var moneda = $('#moneda').val();
  if(moneda=="MXN")
  {
    $('#tipoDeCambio').val("1");
    $('#mostrarTipoDeCambio').css("display","none");
  }
  else
  {
    $('#tipoDeCambio').val("1");
    $('#mostrarTipoDeCambio').css("display","block");
  }
});
$(document).on("change", "#iva", function (){
  var iva = $("#iva").is(':checked') ? "1" : "0";
  var cantidad = $('#cantidad').val().trim();
   if(cantidad=="")
   {
    cantidad="0";
   }
   var auxS = 0;
  if(iva=="1")
  {
    $("#changeLabel").html("Concepto completo:")
    auxS = parseFloat(cantidad) *0.16;
    auxS = Math.round(auxS * 100) / 100;
  }
  $('#ivaInput').val(auxS)

});
$(document).on("click", "#timbraIngresosNewManual", function (){
  var idBanco = "-2";
  var deVerdad = parseInt($(this).attr("deVerdad"));
  var conceptoAdicional = $('#conceptoAdicional').val().trim();
  if(conceptoAdicional.length>0)
  {
    conceptoAdicional = ' '+conceptoAdicional;
  }
  var moneda = $('#moneda').val();
  var version = $('#version').val();
  var iva = $("#iva").is(':checked') ? "1" : "0";
  var ivaInput = $('#ivaInput').val();
  //var concepto = $('#concepto').val().trim();
  //var concepto = $('#concepto').val().trim();

  var claveConcepto = $('#selectConcepto'+idBanco).val().trim();
var ClaveUnidad = $('#selectConcepto'+idBanco+' option:selected').attr("cvu").trim();
var label = $('#selectConcepto'+idBanco+' option:selected').attr("label2").trim();

  var tipoDeCambio = $('#tipoDeCambio').val();
  var idCliente = $('#selectCliente'+idBanco).val();
  var metodoDePago = $('#metodoDePago'+idBanco).val();
  var NumCtaPago = $('#selectNumCtaPago'+idBanco).val();
  if(idBanco == "-2") 
  {
    NumCtaPago="0000";
  }
  var cantidad = $('#cantidad').val();


  var cadenaExtra = "", i=0;
  if(listaGlobalUUID.length>0){
    for(i=0;i<listaGlobalUUID.length;i++){
      cadenaExtra=cadenaExtra+listaGlobalUUID[i]+'|';      
    }
  }

  var param = {iva: iva, ivaInput : ivaInput, idCliente : idCliente, idBanco : idBanco, metodoDePago : metodoDePago, deVerdad : deVerdad, NumCtaPago : NumCtaPago, mes : "", cuenta : "", importe : cantidad, moneda : moneda, tipoDeCambio : tipoDeCambio, claveConcepto : claveConcepto, version : version, ClaveUnidad:ClaveUnidad,label:label, conceptoAdicional : conceptoAdicional, cadenaExtra : cadenaExtra }
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/timbraIngresosNew",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
         $("#loadingCampos").html('');
      }else{
         $("#loadingCampos").html('');
         alert(resp.error);
      }
    }
  });
});

$(document).on("click", ".timbraIngresosNew", function (){
  var idBanco = parseInt($(this).attr("idBanco"));
  
  var conceptoAdicional = $(this).attr("conceptoAdicional");

  var mes = $(this).attr("mes");
  var cuenta = $(this).attr("cuenta");
  var version = $(this).attr("version");
  

  var idCliente = $('#selectCliente'+idBanco).val();
  var concepto = $('#selectConcepto'+idBanco).val();
  var metodoDePago = $('#metodoDePago'+idBanco).val();
  var NumCtaPago = $('#selectNumCtaPago'+idBanco).val();
  
  var deVerdad = $('#deVerdadSelect').val();
  var cantidad = $('.tdImporte[idBanco="'+idBanco+'"]').attr("importe");
  var moneda = "MXN";//HARDCODE, arreglar despues
  var tipoDeCambio = "1";//HARDCODE, arreglar despues
  var claveConcepto = $('#selectConcepto'+idBanco).val().trim();
  var ClaveUnidad = $('#selectConcepto'+idBanco+' option:selected').attr("cvu").trim();
  var label = $('#selectConcepto'+idBanco+' option:selected').attr("label2").trim();

  //var param = {iva: "0", ivaInput:"0", idCliente : idCliente, idBanco : idBanco, metodoDePago : metodoDePago, deVerdad : deVerdad, NumCtaPago : NumCtaPago, mes : mes, cuenta : cuenta, concepto : concepto, version : version}
  var param = {iva: "0", ivaInput : "0", idCliente : idCliente, idBanco : idBanco, metodoDePago : metodoDePago, deVerdad : 1, NumCtaPago : NumCtaPago, mes : "", cuenta : "", importe : cantidad, moneda : moneda, tipoDeCambio : tipoDeCambio, claveConcepto : claveConcepto, version : version, ClaveUnidad:ClaveUnidad,label:label, conceptoAdicional  : conceptoAdicional, cadenaExtra : "" }
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/timbraIngresosNew",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
       $("#loadingCampos").html('');
      if(resp.success==1)
      {
        cargaTimbradoDeDia();
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
        
      }
      else{
        alert(resp.error);
      }
    }
  });
});

$(document).on("click", ".esTransferenciaEntreCuentasPropias", function (){
  var idBanco = $(this).attr("idBanco");
  var param = {idBanco : idBanco, idBancoPrima : idBanco, CuentaPropia : 1}
    $.ajax({
    url: "/cuentaPropiaMarcar",
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaTimbradoDeDia();
      }
    }
  });
});
$(document).on("change", ".selectCliente", function (){
   var idBanco = $(this).attr("idBanco");
   var idCliente = $('#selectCliente'+idBanco+' option:selected').val(); 
 
   var cadOption = '';
    var param = {idCliente : idCliente}
    $.ajax({
    url: "/NumCtaPagoDeClientes",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, aver2= Object.keys(resp.clientes);
        var cadOption = '', j=0;
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.clientes[aver2[i]].NumCtaPagoList);
          for(j=0;j<aver3.length;j++)
          {
            cadOption=cadOption+'<option value="'+resp.clientes[aver2[i]].NumCtaPagoList[aver3[j]].NumCtaPago+'">'+resp.clientes[aver2[i]].NumCtaPagoList[aver3[j]].NumCtaPago+'</option>';
          }
        }
        $('#selectNumCtaPago'+idBanco).html(cadOption);
      }
    }
  });
});


$(document).on("click", "#crearWHOButton", function (){
  var dimension = "S"+$("#dimensionCrear").val().trim();
  var param = {dimension : dimension}
  $.ajax({
    url: "/revisarMatricula",
    dataType : "json",
    type : "post",
    async : false,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         swal("Matricula Creada");
      }
    }
  });
   

  var tipo = "WHO";//$("#selectTipo").val().trim();
  var Descripcion = $("#dimensionDescripcion").val().trim();
  var look= Descripcion;
  if(Descripcion.length>15)
  {
    look = Descripcion.substring(0,15);
  }
  if(dimension.length>0)
  {
    var BUNITACTUAL = $("#BUNITACTUAL").html();
    var Fondo = $("#f").html();
     var cad = '<SSC><User><Name>AOK</Name></User><SunSystemsContext><BusinessUnit>'+BUNITACTUAL+'</BusinessUnit></SunSystemsContext><Payload>';

     cad=cad+'<Address><AddressCode>'+dimension+'</AddressCode><AddressLine1>'+Descripcion+'</AddressLine1><AddressLine2>'+dimension+'</AddressLine2><LookupCode>'+Fondo+'</LookupCode><ShortHeading>'+dimension+'</ShortHeading><Status>0</Status></Address>';
              
       //cad=cad+'<AnalysisCodes><AnalysisCode>'+dimension+'</AnalysisCode><Name>'+Descripcion+'</Name><LookupCode>'+look+'</LookupCode><ProhibitPosting>0</ProhibitPosting><Status>0</Status><AnalysisCatID><AnlCat_SHead>'+tipo+'</AnlCat_SHead></AnalysisCatID></AnalysisCodes>';
              
            
              cad = cad + '</Payload></SSC>';
              var param = {cad : cad, BUNIT : BUNITACTUAL, component : "Address", method : "CreateOrAmend" }

                $.ajax({
                  url: "/subeSSC",
                  dataType : "json",
                  type : "post",
                  async : false,
                  data : param,
                  beforeSend : function (){
                  },
                  complete : function (){
                    //alert("WHO Creada");
                    var cad = '<SSC><User><Name>AOK</Name></User><SunSystemsContext><BusinessUnit>'+BUNITACTUAL+'</BusinessUnit></SunSystemsContext><Payload>';

              
       cad=cad+'<AnalysisCodes><AnalysisCode>'+dimension+'</AnalysisCode><Name>'+Descripcion+'</Name><LookupCode>'+Fondo+'</LookupCode><ProhibitPosting>0</ProhibitPosting><Status>0</Status><AnalysisCatID><AnlCat_SHead>WHO</AnlCat_SHead></AnalysisCatID></AnalysisCodes>';
              
            
              cad = cad + '</Payload></SSC>';
              var param = {cad : cad, BUNIT : BUNITACTUAL, component : "AnalysisCodes", method : "CreateOrAmend" }

                $.ajax({
                  url: "/subeSSC",
                  dataType : "json",
                  type : "post",
                  async : false,
                  data : param,
                  beforeSend : function (){
                  },
                  complete : function (){
                    alert("WHO Creada");
                  }, 
                  success : function (resp){
                    if(resp.success==1)
                    {
                       swal("Matricula Creada");
                    }
            }
          });
                  }, 
                  success : function (resp){
                    if(resp.success==1)
                    {
                       swal("Matricula Creada");
                    }
            }
          });
           
           
  }

});


$(document).on("click", "#crearWHO", function (){
  var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear Matricula para el nuevo Alumno</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear un WHO<small></small></h2>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                '<input type="text" placeholder="numero de matricula" maxlength="15" style="font-size:20px;" class="form-control soloNumeros" id="dimensionCrear"/>'+
                '</div>'+
                '<div class="x_content">'+
                '<input type="text" placeholder="nombre completo del alumno" maxlength="50" style="font-size:20px;" id="dimensionDescripcion"/>'+
                '</div>'+
                '<div class="x_content">'+
                   '<button type="button" id="crearWHOButton" class="btn btn-round btn-success ">Crear matricula</button>'+
                '</div>'+
                '<div class="x_content" id="cambiaContenido">'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
           '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);


      
});


function cargaTimbradoDeDia()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  var Fecha = $("#selectDiaTimbrado").val();
  var param = {Fecha : Fecha}
  $.ajax({
    url: "/cargaTimbradoDeDia",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad = '', cadCLientes = '' ;
        var aver2 = Object.keys(resp.clientes);
        for(i=0;i<aver2.length;i++)
        {
          cadCLientes = cadCLientes + '<option idCliente="'+resp.clientes[aver2[i]].idCliente+'" rfc="'+resp.clientes[aver2[i]].Rfc+'"  razonSocial="'+resp.clientes[aver2[i]].RazonSocial+'"  Correo="'+resp.clientes[aver2[i]].Correo+'"  value="'+aver2[i]+'">'+resp.clientes[aver2[i]].RazonSocial+'</option>';
        }
        var cadOptionNumCtaPago ='';
        aver2 = Object.keys(resp.NumCtaPago);
        for(i=0;i<aver2.length;i++)
        {
          cadOptionNumCtaPago=cadOptionNumCtaPago+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
       
        aver2 = Object.keys(resp.liga);
        var cadAdicional = '';
        var cadOption = '';
        var cadNumCtaPago = '';
        for(i=0;i<aver2.length;i++)
        {
          var timbrado = parseInt(resp.liga[aver2[i]].Timbrado);
          if(timbrado==0 || timbrado==2)
          {
            cadAdicional = '<td><button type="submit" mes="" cuenta="" idBanco="'+resp.liga[aver2[i]].IdBanco+'" conceptoAdicional=" '+Fecha+'" version="3.3" class="btn btn-success timbraIngresosNew">Timbrar</button><br><button type="submit" idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="btn btn-warning esTransferenciaEntreCuentasPropias">Es T.E.C.P.</button></td><td>Sin folio fiscal</td>';
          }
          else
          {
            cadAdicional = '<td><button type="submit" idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="btn btn-danger cancelarIngresosNew" UUID="'+resp.liga[aver2[i]].UUID+'">Cancelar</button></td><td>'+resp.liga[aver2[i]].UUID+'</td>'; 
          }
          var metodoDePagoSelect = '<select id="metodoDePago'+resp.liga[aver2[i]].IdBanco+'" class="form-control" style="float: left;"><option value="01">Efectivo</option><option value="02">Cheque</option><option value="03">Transferencia</option><option value="04">Tarjeta de crédito</option><option value="05">Monedero electrónico</option><option value="06">Dinero electr&amp;oaacute;nico</option><option value="08">Vales de despensa</option><option value="28">Tarjeta de débito</option><option value="29">Tarjeta de servicio</option><option value="99">Otros</option></select>';
          cadOption = '<select  idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="selectCliente" id="selectCliente'+resp.liga[aver2[i]].IdBanco+'">'+cadCLientes+'</select>';
          var cadConcepto = '<select  idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="selectConcepto" id="selectConcepto'+resp.liga[aver2[i]].IdBanco+'"><option value="94111901" label2="Diezmos y ofrendas" cvu="ACT">Diezmos y ofrendas</option><option value="94111901" label2="Donativo" cvu="ACT">Donativo</option>'+
'<option value="55101528" label2="Venta de material religioso" cvu="D63">Venta de material religioso (libros)</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="C62">Para venta de material religioso que sea distinto a libros</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="XKI">Para venta de material religioso que sea distinto a libros(Cuando sean dos productos o más)</option></select>';
          cadNumCtaPago = '<select id="selectNumCtaPago'+resp.liga[aver2[i]].IdBanco+'">'+cadOptionNumCtaPago+'</select>';
        
          cad = cad + '<tr><td>'+cadOption+'<br><p>Concepto:</p><br>'+cadConcepto+'</td><td>'+metodoDePagoSelect+'</td><td>'+cadNumCtaPago+'</td><td>'+resp.liga[aver2[i]].Nombre+'</td><td class="tdImporte" idBanco="'+resp.liga[aver2[i]].IdBanco+'"  importe="'+resp.liga[aver2[i]].Importe+'" >'+format2(resp.liga[aver2[i]].Importe,'$')+'</td><td>'+resp.liga[aver2[i]].Descripcion+'</td>'+cadAdicional+'</tr>';
        }
        cad = cad + '<tr><td colspan="7"><select id="deVerdadSelect"><option selected value="1">De verdad</option><option value="0">De Prueba</option></select></td></tr>';
     
        $('#tablaTimbradoDia').html(cad);
        $("#loadingCampos").html('');
                      
      }//if
    }
  });
}
function cargaLigadoDeDiaIngresos()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  var Fecha = $("#selectDiaLigadoIngresos").val();
  var param = {Fecha : Fecha}
  $.ajax({
    url: "/cargaLigadoDeDiaIngresos",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad = '',j, cadLigados = '', cadAnadir='', cadSelect='', cadOptions=''; ;
        var cuentasArray = new Array();
        var aver2 = Object.keys(resp.facturas);
        for(i=0;i<aver2.length;i++)
        {
          cuentasArray.push(resp.facturas[aver2[i]].Nombre.toString().trim());
        }
        aver2 = Object.keys(resp.etiquetas);
        cadOptions='<option value="0">Selecciona una etiqueta</option>';
        for(i=0;i<aver2.length;i++)
        {
          cadOptions=cadOptions+'<option value="'+aver2[i]+'">'+resp.etiquetas[aver2[i]].Etiqueta+'</option>';
        }
        aver2 = Object.keys(resp.liga);
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.liga[aver2[i]].LigadoList);
          var ligado = 0;
          cadLigados = '';
          for(j=0;j<aver3.length;j++)
          {
            ligado+=resp.liga[aver2[i]].LigadoList[aver3[j]].AMOUNT;
             cadSelect='<select style="font-size:20px;" class="selectEtiquetaEnElLibroDeIngresos" idLigado="'+aver3[j]+'">'+cadOptions+'</select>';
            cadLigados = cadLigados + '<tr><td><a target="_blank" href="'+resp.liga[aver2[i]].LigadoList[aver3[j]].Ruta+'/'+resp.liga[aver2[i]].LigadoList[aver3[j]].PDF+'">PDF</a></td><td><a target="_blank" class="muestraXML" xml="'+resp.liga[aver2[i]].LigadoList[aver3[j]].Ruta+'/'+resp.liga[aver2[i]].LigadoList[aver3[j]].XML+'">XML</a></td><td>'+format2(resp.liga[aver2[i]].LigadoList[aver3[j]].AMOUNT,'$')+'</td><td><button type="submit"  idLigado="'+aver3[j]+'"  class="btn btn-danger desligaIngreso">Desligar</button></td><td><button type="submit"  idLigado="'+aver3[j]+'"  class="btn btn-warning contabilidadLigado">Contabilidad</button></td><td>'+cadSelect+'</td></tr>';
          }
          cadAnadir = '<tr><td colspan= "3"><input placeholder="Aqui escribe la cantidad a ligar Ingresos" type="text" maximo="'+(parseFloat(resp.liga[aver2[i]].Importe)-ligado)+'" id="cantidad'+aver2[i]+'" class="form-control soloNumeros" style="float: right;" /></td><td colspan= "1"><input type="text" placeholder="Busca tu factura aqui, por rfc, folio, razon social, fecha o cantidad" id="autocomplete-custom-append'+aver2[i]+'" class="form-control" style="float: right;" /><div id="autocomplete-container'+aver2[i]+'" style="position: relative; float: left; width: 400px; margin: 10px;"/></td><td><button type="submit" idBanco="'+aver2[i]+'"  folioFiscal=""  class="btn btn-success ligarIngresos">Ligar</button></td></tr>';
          cad = cad + '<tr><td>'+resp.liga[aver2[i]].Nombre+'</td><td>'+format2(resp.liga[aver2[i]].Importe,'$')+'</td><td>'+format2(ligado,'$')+'</td><td colspan="2">'+resp.liga[aver2[i]].Descripcion+'</td></tr>'+cadLigados+cadAnadir;
        }
        $('#tablaLigadoDiaIngresos').html(cad);
        for(i=0;i<aver2.length;i++)
        {
         $("#autocomplete-custom-append"+aver2[i]).autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'+aver2[i],
               minLength: 4
            }); 
        }
        aver2 = Object.keys(resp.liga);
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.liga[aver2[i]].LigadoList);
          for(j=0;j<aver3.length;j++)
          {
            $('.selectEtiquetaEnElLibroDeIngresos[idLigado="'+aver3[j]+'"]').val(resp.liga[aver2[i]].LigadoList[aver3[j]].IdEtiqueta);
          }
        }
         $("#loadingCampos").html('');
      }//if
    }
  });
}




$(document).on("change", ".selectEtiquetaEnElLibroDeIngresos", function (){
  var idLigado = $(this).attr("idLigado");
  var idEtiqueta = $(this).val();
  var param = {idLigado : idLigado, idEtiqueta : idEtiqueta}
  $.ajax({
    url: "/cambiaEtiquetaDeIngresos",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
      }
    }
  });
});

function cargaLigadoContabilidad(idLigado) {
  var swal_html = '<div class="panel" style="background:aliceblue;font-weight:bold;font-size:20px;"><div class="panel-heading panel-info text-center btn-info"> <b>Diarios Asociados</b> </div> <div class="panel-body"><div class="text-center"><b><table border="1" style="font-weight:bold"><thead><tr><th>Diario</th><th>Linea</th><th>TFWW</th><th></th></tr></thead><tbody>';
    
    var param = {idLigado : idLigado}
    $.ajax({
      url: "/cargaLigadoFacturaContabilidad",  
      dataType : "json",
      type : "post",
      async : true,
      data : param, 
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          var i, aver2 = Object.keys(resp.ligado);
          for(i=0;i<aver2.length;i++){
            swal_html=swal_html+'<tr><td><a class="vesAlDiario" target="_blank" href="javascript:;" diario="'+resp.ligado[aver2[i]].Diario+'">'+resp.ligado[aver2[i]].Diario+'</a></td><td><a class="vesAlDiario" target="_blank" href="javascript:;" diario="'+resp.ligado[aver2[i]].Diario+'">'+resp.ligado[aver2[i]].Linea+'</a></td><td>'+resp.ligado[aver2[i]].TFWW+'</td><td><button type="submit" class="btn btn-danger eliminaLigadoContablidad" idLigadoReal="'+idLigado+'" idLigado="'+resp.ligado[aver2[i]].IdLigadoContabilidad+'">X</button></td></tr>';  
          }
          swal_html=swal_html+'<tr><td><input type="text" class="form-control soloNumeros" id="diarioContabilidad"/></td><td><input type="text" class="form-control soloNumeros" id="lineaContabilidad"/></td><td><input type="text" class="form-control soloNumeros" id="tfwwContabilidad"/></td><td><button type="submit" class="btn btn-success agregaLigadoContablidad" idLigado="'+idLigado+'">Ligar</button></td></tr>';
          swal_html=swal_html+'</tbody></table></b></div></div></div>';
          Swal({title:"", html: swal_html});
        }
      }
    });
}
$(document).on("click", ".eliminaLigadoContablidad", function (){
  var idLigado = $(this).attr("idLigado");
  var idLigadoReal = $(this).attr("idLigadoReal");
  var param = {idLigado : idLigado}
  $.ajax({
    url: "/eliminaLigadoFacturaContabilidad",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        cargaLigadoContabilidad(idLigadoReal);
      }
    }
  });
});
$(document).on("click", ".agregaLigadoContablidad", function (){
  var idLigado = $(this).attr("idLigado");
  var diario = $("#diarioContabilidad").val().trim();
  if(diario==""){
    alert("primero escribe el numero de diario");
    return;
  }
  var linea = $("#lineaContabilidad").val().trim();
  if(linea==""){
    alert("primero escribe el numero de linea");
    return;
  }
  var tfww = $("#tfwwContabilidad").val().trim();
  /*if(tfww==""){
    alert("primero escribe el tfww de la linea");
    return;
  }*/
  if(linea.indexOf("-")!=-1) {//4-15
    var arr = linea.split('-');
    var primer = parseInt(arr[0]);
    var segundo = parseInt(arr[1]);
    var i;
    for(i=primer;i<=segundo;i++){
      var param = {idLigado : idLigado, diario:diario, linea:i, tfww : tfww }
       $.ajax({
        url: "/agregaLigadoFacturaContabilidad",  
        dataType : "json",
        type : "post",
        async : false,
        data : param, 
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
          }
        }
      });
    }
    cargaLigadoContabilidad(idLigado);
  } else {
      var param = {idLigado : idLigado, diario:diario, linea:linea, tfww  : tfww}
    
    $.ajax({
        url: "/agregaLigadoFacturaContabilidad",  
        dataType : "json",
        type : "post",
        async : true,
        data : param, 
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            cargaLigadoContabilidad(idLigado);
          }
        }
      });
  }
 
});
$(document).on("click", ".contabilidadLigado", function (){
  var idLigado = $(this).attr("idLigado");
  cargaLigadoContabilidad(idLigado);
});
$(document).on("change", ".selectEtiquetaEnElLibro", function (){
  var idLigado = $(this).attr("idLigado");
  var idEtiqueta = $(this).val();
  var param = {idLigado : idLigado, idEtiqueta : idEtiqueta}
  $.ajax({
    url: "/cambiaEtiqueta",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
      }
    }
  });
});
function cargaLigadoDeDia()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  var Fecha = $("#selectDiaLigadoGastos").val();
  var cuenta = $("#selectDiaLigadoGastosCuentas :selected").attr("cuenta");
   var debo = $("#traerTodasLasFacturas").is(':checked') ? "1" : "0";
   var param = {Fecha : Fecha, cuenta : cuenta, debo : debo}
  $.ajax({
    url: "/cargaLigadoDeDia",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad = '',j, cadLigados = '', cadAnadir='',cadSelect='', cadOptions='';
        var cuentasArray = new Array();
        var aver2 = Object.keys(resp.facturas);
        for(i=0;i<aver2.length;i++)
        {
          cuentasArray.push(resp.facturas[aver2[i]].Nombre.toString().trim());
        }
        aver2 = Object.keys(resp.etiquetas);
        cadOptions='<option value="0">Selecciona una etiqueta</option>';
        for(i=0;i<aver2.length;i++)
        {
          cadOptions=cadOptions+'<option value="'+aver2[i]+'">'+resp.etiquetas[aver2[i]].Etiqueta+'</option>';
        }
        aver2 = Object.keys(resp.liga);
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.liga[aver2[i]].LigadoList);
          var ligado = 0;
          cadLigados = '';
          for(j=0;j<aver3.length;j++)
          {
            ligado+=resp.liga[aver2[i]].LigadoList[aver3[j]].AMOUNT;
            var clase = "btn-warning";
            if(parseInt(resp.liga[aver2[i]].LigadoList[aver3[j]].Diario) >0 ) {
              clase = "btn-success";
            }
            cadSelect='<select style="font-size:20px;" class="selectEtiquetaEnElLibro" idLigado="'+aver3[j]+'">'+cadOptions+'</select>';
            cadLigados = cadLigados + '<tr><td class="nombreDeCuentas" nombre="'+resp.liga[aver2[i]].Nombre+'"><a target="_blank" href="'+resp.liga[aver2[i]].LigadoList[aver3[j]].Ruta+'/'+resp.liga[aver2[i]].LigadoList[aver3[j]].PDF+'">PDF</a></td><td><a target="_blank" class="muestraXML" xml="'+resp.liga[aver2[i]].LigadoList[aver3[j]].Ruta+'/'+resp.liga[aver2[i]].LigadoList[aver3[j]].XML+'">XML</a></td><td>'+format2(resp.liga[aver2[i]].LigadoList[aver3[j]].AMOUNT,'$')+'</td><td><button type="submit"  idLigado="'+aver3[j]+'"  class="btn btn-danger desliga">Desligar</button></td><td><button type="submit"  idLigado="'+aver3[j]+'"  class="btn '+clase+' contabilidadLigado">Contabilidad</button></td><td>'+cadSelect+'</td></tr>';
          }
          cadAnadir = '<tr><td class="nombreDeCuentas" nombre="'+resp.liga[aver2[i]].Nombre+'" colspan= "3"><input placeholder="Aqui escribe la cantidad a ligar" type="text" maximo="'+(parseFloat(resp.liga[aver2[i]].Importe)-ligado)+'" id="cantidad'+aver2[i]+'" class="form-control soloNumeros" style="float: right;" /></td><td colspan= "1"><input type="text" placeholder="Busca tu factura aqui, por rfc, folio, razon social, fecha o cantidad" id="autocomplete-custom-append'+aver2[i]+'" class="form-control" style="float: right;" /><div id="autocomplete-container'+aver2[i]+'" style="position: relative; float: left; width: 400px; margin: 10px;"/></td><td><button type="submit" idBanco="'+aver2[i]+'"  folioFiscal=""  class="btn btn-success ligar">Ligar</button></td></tr>';
          cad = cad + '<tr><td class="nombreDeCuentas" nombre="'+resp.liga[aver2[i]].Nombre+'">'+resp.liga[aver2[i]].Nombre+'</td><td>'+format2(resp.liga[aver2[i]].Importe,'$')+'</td><td>'+format2(ligado,'$')+'</td><td colspan="2">'+resp.liga[aver2[i]].Descripcion+'</td></tr>'+cadLigados+cadAnadir;
        }
        $('#tablaLigadoDia').html(cad);
        for(i=0;i<aver2.length;i++)
        {
         $("#autocomplete-custom-append"+aver2[i]).autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'+aver2[i],
              minLength : 4
            }); 
        }
        aver2 = Object.keys(resp.liga);
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.liga[aver2[i]].LigadoList);
          for(j=0;j<aver3.length;j++)
          {
            $('.selectEtiquetaEnElLibro[idLigado="'+aver3[j]+'"]').val(resp.liga[aver2[i]].LigadoList[aver3[j]].IdEtiqueta);
          }
        }
         $("#loadingCampos").html('');
      }//if
    }
  });
}
$(document).on("change", "#selectDiaTimbrado", function (){
  cargaTimbradoDeDia();
});
$(document).on("change", "#selectDiaLigadoGastos", function (){
  cargaLigadoDeDia();
});
$(document).on("change", "#selectDiaLigadoIngresos", function (){
  cargaLigadoDeDiaIngresos();
});
$(document).on("change", "#selectMesLigadoGastos", function (){
  actualizaDiaLigadoGastos();
});

$(document).on("change", "#selectMesLigadoIngresos", function (){
  actualizaDiaLigadoIngresos();
});




$(document).on("click", "#ligarIngresos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ligar ingresos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Ligar ingresos</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectMesLigadoIngresos" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectDiaLigadoIngresos" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                    '<div id="loadingCampos"/>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Cantidad</th><th>Ligado</th><th>Descripci&oacute;n</th><th></th></thead>'+
                        '<tbody id="tablaLigadoDiaIngresos"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaMesLigadoIngresos(); 
 });



$(document).on("click", "#conciliacionCuentaBancariaContabilidad", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Conciliacion Edo Cuenta - Contabilidad</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Conciliacion Edo Cuenta - Contabilidad</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectCuenta" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectMesCuenta" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Diario</th><th>Linea</th><th>Fecha</th><th>Descripci&oacute;n Contable</th><th>Descripci&oacute;n Banco</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaConciliacion"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaCuentas(); 
});

$(document).on("change", "#selectMesCuenta", function (){
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  
  var ACNT_CODE = $("#selectCuenta").val();
  var cuentaBanco = $("#selectCuenta option:selected").attr("cuenta");
  var mes = $(this).val();
  var anio = mes.substring(3);
  mes = mes.substring(0,2);
  var period = "20"+anio+"0"+mes;
  var param = {period : period, ACNT_CODE : ACNT_CODE, cuenta : cuentaBanco}
  $.ajax({
    url: "/conciliacionEdoCuenta",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad = '', color='',back='';
        var aver2 = Object.keys(resp.cuentas);
        for(i=0;i<aver2.length;i++)
        {
          back = '#FFF';
          color='#000';
          if(resp.cuentas[aver2[i]].DescripcionBanco.trim()=="")
          {
            back = '#FF0040';
            color='#FFF';
          }
          if(resp.cuentas[aver2[i]].DescripcionConta.trim()=="")
          {
            back = '#4000FF';
            color='#FFF';
          }
          cad=cad+'<tr style="background-color:'+back+';color:'+color+';"><td><a href="javascript:void(0)" class="vesAlDiario" style="color:'+color+';" diario="'+resp.cuentas[aver2[i]].Diario+'">'+resp.cuentas[aver2[i]].Diario+'</a></td><td>'+resp.cuentas[aver2[i]].Linea+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+resp.cuentas[aver2[i]].DescripcionConta+'</td><td idBanco="">'+resp.cuentas[aver2[i]].DescripcionBanco+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Cantidad),'$')+'</td></tr>';
        }
        $("#tablaConciliacion").html(cad);
        $("#loadingCampos").html(''); 
      }
    }
  });
});
$(document).on("change", "#selectCuenta", function (){
  var cuenta = $(this).val();
  var cuentaBanco = $("#selectCuenta option:selected").attr("cuenta");
  if(cuenta!="0")
  {
    actualizaMesCuentas(cuentaBanco);
  }
  else
  {
    $('#selectMesCuenta').html("");
  }
});

$(document).on("click", "#ligarGastos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ligar gastos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Ligar gastos</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectMesLigadoGastos" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectDiaLigadoGastos" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectDiaLigadoGastosCuentas" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<input type="checkbox" id="traerTodasLasFacturas" /> Traerse todas las facturas'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                    '<div id="loadingCampos"/>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Cantidad</th><th>Ligado</th><th>Descripci&oacute;n</th><th></th></thead>'+
                        '<tbody id="tablaLigadoDia"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaMesLigadoGastos(); 
 });




$(document).on("change", "#selectDiaLigadoGastosCuentas", function (){
  cargaLigadoDeDia();
  /*
  var cuenta = $(this).val();
  var todasLosRows = $(".nombreDeCuentas");
  var i;
  for(i=0;i<todasLosRows.length;i++)
  {
    var nombre = $(todasLosRows[i]).attr("nombre");
    if(nombre!=cuenta)
    {
      $(todasLosRows[i]).parent().css("display","none");
    }
    else
    {
      $(todasLosRows[i]).parent().css("display","block"); 
    }
  }*/
});
$(document).on("click", "#pendientesDeLigar", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Pendientes de ligar</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Pendientes de ligar</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectAnioPendienteDeLigar" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div id="loadingCampos"/>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead id="headTablaLibroIngresosEgresos"></thead>'+
                        '<tbody id="tablaLibroIngresosEgresos"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaAnioPendienteDeLigar(); 
 });


$(document).on("click", "#exportaLibroExcelGastosPorCuenta", function (){
  var anio = $("#selectAnio").val();
  var cuenta = $(this).attr("cuenta");
  window.open(
    "/generarExcelLibroPapelTrabajoGastosPorCuenta?anio=" +anio+"&cuenta="+cuenta,
    '_blank'
  );  
});
$(document).on("click", "#exportaLibroExcelPorCuenta", function (){
  var anio = $("#selectAnio").val();
  var cuenta = $(this).attr("cuenta");
  window.open(
    "/generarExcelLibroPapelTrabajoPorCuenta?anio=" +anio+"&cuenta="+cuenta,
    '_blank'
  );  
});



$(document).on("click", "#exportaLibroExcelGastos", function (){
  var anio = $("#selectAnio").val();
  window.open(
    "/generarExcelLibroPapelTrabajoGastos?anio=" +anio,
    '_blank'
  );  
});
$(document).on("click", "#exportaLibroExcel", function (){
  var anio = $("#selectAnio").val();
  window.open(
    "/generarExcelLibroPapelTrabajo?anio=" +anio,
    '_blank'
  );  
});
$(document).on("click", "#libroIngresosEgresos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Libro de ingresos/egresos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Libro de ingresos/egresos</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectAnio" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div id="loadingCampos"/>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<button class="btn btn-success" id="exportaLibroExcel">Exportar papel de trabajo de ingresos a excel</button>'+
                        '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+
                        '<button class="btn btn-success" id="exportaLibroExcelGastos">Exportar papel de trabajo de gastos a excel</button>'+
                        '<table class="table table-hover">'+
                        '<thead id="headTablaLibroIngresosEgresos"></thead>'+
                        '<tbody id="tablaLibroIngresosEgresos"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead id="headTimbrado"></thead>'+
                        '<tbody id="tablaTimbradoLibro"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead id="headLigado"></thead>'+
                        '<tbody id="tablaLigado"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead id="headReporte"></thead>'+
                        '<tbody id="tablaReporte"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                   '<div id="divDetalleLigado"></div></div></div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaAnio(); 
 });

$(document).on("click", "#reporteTECP", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Reporte Transferencias entre cuentas propias</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Reporte TECP</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<br><br>'+
                  '<h2>Selecciona una cuenta para ver sus transferencias entre cuentas propias</h2>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectCuentaTECP" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Fecha</th><th>Importe</th><th>Descripci&oacute;n</th><th>Adicional</th><th>Eliminar</th></thead>'+
                        '<tbody id="tablaTECP"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      $.ajax({
        url: "/listaDeCuentas",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var i, cad='';
            var aver2 = Object.keys(resp.cuentas);
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<option value="'+resp.cuentas[aver2[i]].Nombre+'">'+resp.cuentas[aver2[i]].Completo+'</option>';
            }
            $("#selectCuentaTECP").html(cad);
          }
        }
      });
 });

$(document).on("click", "#timbradoIngresos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Timbrado de ingresos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Timbrado de ingresos</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectMesTimbrado" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<h2>Selecciona una cuenta para timbrar mensualmente</h2>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectCuentaTimbrado" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                  '<h2>Selecciona una fecha para timbrar movimiento por movimiento</h2>'+
                  '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<select id="selectDiaTimbrado" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cliente</th><th>Metodo de pago</th><th>Num Cta Pago</th><th>Cuenta</th><th>Cantidad</th><th>Descripci&oacute;n</th><th>Timbrado</th><th>Factura</th></thead>'+
                        '<tbody id="tablaTimbradoDia"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaMesTimbrado(); 
      $.ajax({
        url: "/listaDeCuentas",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var i, cad='';
            var aver2 = Object.keys(resp.cuentas);
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<option value="'+resp.cuentas[aver2[i]].Nombre+'">'+resp.cuentas[aver2[i]].Completo+'</option>';
            }
            $("#selectCuentaTimbrado").html(cad);
          }
        }
      });
      setTimeout(function(){
 cargaTimbradoDeDia();
},2000);//perdon por el hardcode..jeje es para quitarme a claudia de encima
 });






function actualizaDiaLigadoIngresos() {
  var mes = $("#selectMesLigadoIngresos").val();
  var param = {mes : mes}
  $.ajax({
    url: "/actualizaDiaTimbradoIngresos",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectDiaLigadoIngresos').html(cad);
      }
    }
  });
}
function actualizaDiaLigadoGastos() {
  var mes = $("#selectMesLigadoGastos").val();
  var param = {mes : mes}
  $.ajax({
    url: "/actualizaDiaTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectDiaLigadoGastos').html(cad);
        cargaLigadoDeDia();
      }
    }
  });
}


function actualizaDiaTimbradoLigado() {
  var mes = $("#selectMesTimbradoLigado").val();
  var param = {mes : mes}
  $.ajax({
    url: "/actualizaDiaTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectDiaTimbradoLigado').html(cad);
      }
    }
  });
}

function actualizaDiaTimbrado() {
  var mes = $("#selectMesTimbrado").val();
  var param = {mes : mes}
  $.ajax({
    url: "/actualizaDiaTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectDiaTimbrado').html(cad);

      }
    }
  });
}

function calculaTCEP_por_Cuenta(cuenta)
{
  var param = {cuenta: cuenta}
  $.ajax({
    url: "/TECPporCuenta",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var i, cad = '', cadCLientes = '' ;
         var aver2 = Object.keys(resp.cuentas);
         var granTotal = 0.0;
         var numero = 1;
         var color = "81DAF5";

         for(i=0;i<aver2.length;i++)
         {
            if(numero<3)
            {
              color = "81DAF5";
            }
            else
            {
             color = "F4FA58"; 
            }
            granTotal += parseFloat(resp.cuentas[aver2[i]].Importe);
            var botonNo = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" CuentaPropia="-2" class="btn btn-danger cuentaPropiaMarcar">No son transferencias entre cuentas propias</button>'; 
            
            cad=cad + '<tr style="background-color:#'+color+'" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" ><td>'+resp.cuentas[aver2[i]].Nombre+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Importe),'$')+'</td><td>'+resp.cuentas[aver2[i]].Descripcion+'</td><td>'+resp.cuentas[aver2[i]].Leyenda1+' '+resp.cuentas[aver2[i]].Leyenda2+' </td>';
            if(i%2==0)
            {
              cad=cad + '<td rowspan="2">'+botonNo+'</td>';
            }
            cad=cad+'</tr>';
            if(numero<4)
            {
              numero++;
            }
            else
            {
              numero = 1;
            }



         }
         cad=cad + '<tr><td  colspan="5">Total de trasnferencias entre cuentas propias de la cuenta '+cuenta+': '+format2(parseFloat(granTotal/2),'$')+'</td></tr><tr><td  colspan="5"><button type="submit" id="exportarExcelTECP" cuenta="'+cuenta+'" class="btn btn-success">Exportar a Excel</button></td></tr>';
         $("#tablaTECP").html(cad);
      }
    }
  });
}
$(document).on("click", "#exportarExcelTECP", function (){
  var cuenta = $(this).attr("cuenta");
  window.open(
    "/generarExcelTECP?cuenta=" +cuenta,
    '_blank'
  );  
});
 
$(document).on("change", "#selectCuentaTECP", function (){
  var cuenta = $(this).val();
  calculaTCEP_por_Cuenta(cuenta);
});

$(document).on("change", "#selectCuentaTimbrado", function (){
  var cuenta = $(this).val();
  var mes = $("#selectMesTimbrado").val();
  var param = {cuenta: cuenta, mes : mes}
  $.ajax({
    url: "/pendienteDeTimbrarEnElMes",  
    dataType : "json",
    type : "post",
    async : true,
    data : param, 
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var i, cad = '', cadCLientes = '' ;
        var aver2 = Object.keys(resp.clientes);
        for(i=0;i<aver2.length;i++)
        {
          cadCLientes = cadCLientes + '<option idCliente="'+resp.clientes[aver2[i]].idCliente+'" rfc="'+resp.clientes[aver2[i]].Rfc+'"  razonSocial="'+resp.clientes[aver2[i]].RazonSocial+'"  Correo="'+resp.clientes[aver2[i]].Correo+'"  value="'+aver2[i]+'">'+resp.clientes[aver2[i]].RazonSocial+'</option>';
        }
        var cadOptionNumCtaPago ='';
        aver2 = Object.keys(resp.NumCtaPago);
        for(i=0;i<aver2.length;i++)
        {
          cadOptionNumCtaPago=cadOptionNumCtaPago+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
       
        aver2 = Object.keys(resp.liga);
        var cadAdicional = '';
        var cadOption = '';
        var cadNumCtaPago = '';
        for(i=0;i<aver2.length;i++)
        {
          var timbrado = parseInt(resp.liga[aver2[i]].Timbrado);
          if(timbrado==0)
          {
            cadAdicional = '<td><button type="submit" idBanco="-1" cuenta="'+cuenta+'" mes="'+mes+'" version="3.3" conceptoAdicional=" '+mes+'" class="btn btn-success timbraIngresosNew">Timbrar</button><br><button type="submit" idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="btn btn-warning esTransferenciaEntreCuentasPropias">Es T.E.C.P.</button></td><td>Sin folio fiscal</td>';
          }
          else
          {
            cadAdicional = '<td><button type="submit" idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="btn btn-danger cancelarIngresosNew" UUID="'+resp.liga[aver2[i]].UUID+'">Cancelar</button></td><td>'+resp.liga[aver2[i]].UUID+'</td>'; 
          }
          var metodoDePagoSelect = '<select id="metodoDePago'+resp.liga[aver2[i]].IdBanco+'" class="form-control" style="float: left;"><option value="01">Efectivo</option><option value="02">Cheque</option><option value="03">Transferencia</option><option value="04">Tarjeta de crédito</option><option value="05">Monedero electrónico</option><option value="06">Dinero electr&amp;oaacute;nico</option><option value="08">Vales de despensa</option><option value="28">Tarjeta de débito</option><option value="29">Tarjeta de servicio</option><option value="99">Otros</option></select>';
          cadOption = '<select  idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="selectCliente" id="selectCliente'+resp.liga[aver2[i]].IdBanco+'">'+cadCLientes+'</select>';
          cadNumCtaPago = '<select id="selectNumCtaPago'+resp.liga[aver2[i]].IdBanco+'">'+cadOptionNumCtaPago+'</select>';
         var cadConcepto = '<select  idBanco="'+resp.liga[aver2[i]].IdBanco+'" class="selectConcepto" id="selectConcepto'+resp.liga[aver2[i]].IdBanco+'"><option value="94111901" label2="Diezmos y ofrendas" cvu="ACT">Diezmos y ofrendas</option><option value="94111901" label2="Donativo" cvu="ACT">Donativo</option>'+
'<option value="55101528" label2="Venta de material religioso" cvu="D63">Venta de material religioso (libros)</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="C62">Para venta de material religioso que sea distinto a libros</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="XKI">Para venta de material religioso que sea distinto a libros(Cuando sean dos productos o más)</option></select>';
          cad = cad + '<tr><td>'+cadOption+'<br><p>Concepto:</p>'+cadConcepto+'</td><td>'+metodoDePagoSelect+'</td><td>'+cadNumCtaPago+'</td><td>'+resp.liga[aver2[i]].Nombre+'</td><td class="tdImporte" idBanco="'+resp.liga[aver2[i]].IdBanco+'"  importe="'+resp.liga[aver2[i]].Importe+'">'+format2(resp.liga[aver2[i]].Importe,'$')+'</td><td>'+resp.liga[aver2[i]].Descripcion+'</td>'+cadAdicional+'</tr>';
        }
        cad = cad + '<tr><td colspan="7"><select id="deVerdadSelect"><option selected value="1">De verdad</option><option value="0">De Prueba</option></select></td></tr>';
     
        $('#tablaTimbradoDia').html(cad);
        $("#loadingCampos").html(''); 
      }
    }
  });
});
$(document).on("change", "#selectMesTimbrado", function (){
  actualizaDiaTimbrado();
  setTimeout(function(){
 cargaTimbradoDeDia();
},2000);//perdon por el hardcode..jeje es para quitarme a claudia de encima
});



$(document).on("click", "#eliminarPosiblesDuplicados", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Eliminar Posibles duplicados de Estados de cuenta</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Eliminar Posibles duplicados de Estados de cuenta</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Fecha</th><th>Cantidad</th><th>Descripci&oacute;n</th><th>Referencia</th><th>Si</th><th>No</th></thead>'+
                        '<tbody id="tablaCuentasPropias"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTablaPosiblesDuplicados(); 
 });

$(document).on("click", "#revisarPendientesDeXML", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Pendientes de saber si es cargo  o abono</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Pendientes de saber si es cargo  o abono</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Fecha</th><th>Cantidad</th><th>Descripci&oacute;n</th><th>Referencia</th><th>Si</th><th>No</th></thead>'+
                        '<tbody id="tablaCuentasPropias"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTablaPendientes(); 
 });

$(document).on("click", "#transferenciasCuentasPropias", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Transferencias entre cuentas propias</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Transferencias entre cuentas propias</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                  '<div id="loadingCampos"></div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Fecha</th><th>Cantidad</th><th>Descripci&oacute;n</th><th>Referencia</th><th>Si</th><th>No</th></thead>'+
                        '<tbody id="tablaCuentasPropias"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTablaCuentasPropias(); 
 });



function actualizaMesLigadoIngresos()
{
  $.ajax({
    url: "/actualizaMesTimbradoIngresos",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectMesLigadoIngresos').html(cad);
        //actualizaDiaTimbradoLigado();
        actualizaDiaLigadoIngresos();
      }
    }
  });
}



function actualizaMesCuentas(cuentaBanco)
{
  var param = {cuenta : cuentaBanco}
  $.ajax({
    url: "/actualizaMesCuentas",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='<option value="0">Seleccione un mes</option>';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectMesCuenta').html(cad);
      }
    }
  });
}

function actualizaMesLigadoGastos()
{
  $.ajax({
    url: "/actualizaMesTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectMesLigadoGastos').html(cad);
        cad='';
        aver2 = Object.keys(resp.cuentas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option cuenta="'+resp.cuentas[aver2[i]].Completo+'" value="'+resp.cuentas[aver2[i]].Nombre+'">'+resp.cuentas[aver2[i]].Nombre+'</option>';
        }
        $('#selectDiaLigadoGastosCuentas').html(cad);
        //actualizaDiaTimbradoLigado();
        actualizaDiaLigadoGastos();
      }
    }
  });
}

function actualizaMesTimbradoLigado()
{
  $.ajax({
    url: "/actualizaMesTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectMesTimbradoLigado').html(cad);
        actualizaDiaTimbradoLigado();
      }
    }
  });
}



function actualizaAnioPendienteDeLigar()
{
  $.ajax({
    url: "/actualizaAnioPendienteDeLigar",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">20'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectAnioPendienteDeLigar').html(cad);
        actualizaLibroIngresosEgresosAnioPendienteDeLigar();
      }
    }
  });
}

function actualizaAnio()
{
  $.ajax({
    url: "/actualizaAnio",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectAnio').html(cad);
        actualizaLibroIngresosEgresosAnio();
      }
    }
  });
}


$(document).on("click", ".muestraDetalleDiferenciaDelMes", function (){
  var mes = $(this).attr("mes");
  var param = {mes : mes}
  $.ajax({
    url: "/muestraDetalleDiferenciaDelMes",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==2)
      {
        var i, cad='';
        var swal_html = '<div class="panel" style="background:aliceblue;font-weight:bold;font-size:20px;"><center><div class="panel-heading panel-info text-center btn-info"> <b>Pendientes de ligar</b> </div> <div class="panel-body"><div class="text-center"><b><table border="1" style="font-weight:bold"><thead><tr><th>Cuenta</th><th>Fecha</th><th>Importe del mov bancario</th><th>Descripcion</th><th>Falta de ligar</th></tr></thead><tbody>';
        var aver2 = Object.keys(resp.falta);
        for(i=0;i<aver2.length;i++){
          var cuanto = parseFloat(resp.falta[aver2[i]].Diff);
          if(cuanto > 0.02){
            swal_html=swal_html+'<tr><td>'+resp.falta[aver2[i]].Cuenta+'</td><td>'+resp.falta[aver2[i]].Fecha+'</td><td>$ '+resp.falta[aver2[i]].Importe+'</td><td>'+resp.falta[aver2[i]].Descripcion+'</td><td>$ '+resp.falta[aver2[i]].Diff+'</td></tr>';
          }
        }

          swal_html=swal_html+'</tbody></table></b></div></div></center></div>';
          Swal({title:"", html: swal_html});

 
      }
    }
  });
});


$(document).on("click", "#regresarAnioIngresoEgreso", function (){
  actualizaLibroIngresosEgresosAnio();
});

$(document).on("change", "#selectAnio", function (){
  actualizaLibroIngresosEgresosAnio();
});

$(document).on("change", "#selectAnioPendienteDeLigar", function (){
  actualizaLibroIngresosEgresosAnioPendienteDeLigar();
});


function actualizaLibroIngresosEgresosAnioPendienteDeLigar()
{
  var anio =  $('#selectAnioPendienteDeLigar').val();
  var param = {anio : anio}
  $.ajax({
    url: "/actualizaLibroIngresosEgresosAnioPendienteDeLigar",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.ingresoEgreso);
        var ingreso = 0, egreso = 0;
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Cuenta</th><th>Ingreso</th><th>Ingreso Ligado</th><th>Egreso</th><th>Egreso Ligado</th>');
        for(i=0;i<aver2.length;i++)
        {
          ingreso += resp.ingresoEgreso[aver2[i]].Ingreso;
          egreso += resp.ingresoEgreso[aver2[i]].Egreso;
          cad=cad+'<tr><td>'+resp.ingresoEgreso[aver2[i]].Nombre+'</td><td><a href="javascript:void(0)" class="detalleCuentaMes" status="2" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Ingreso),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaMesPendienteDeLigar" status="2" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].LigadoIngreso),'$')+'</u></a></td><td><a href="javascript:void(0)" status="1" class="detalleCuentaMes" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Egreso),'$')+'</u></a></td><td><a href="javascript:void(0)" status="1" class="detalleCuentaMesPendienteDeLigar" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].LigadoEgreso),'$')+'</u></a></td></tr>';
        }
        cad=cad + '<tr><td></td><td>'+format2(parseFloat(ingreso),'$')+'</td><td>'+format2(parseFloat(egreso),'$')+'</td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
      }
    }
  });
}

function actualizaLibroIngresosEgresosAnio()
{
  var anio =  $('#selectAnio').val();
  var param = {anio : anio}
  $.ajax({
    url: "/actualizaLibroIngresosEgresosAnio",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.ingresoEgreso);
        var ingreso = 0, egreso = 0, ingresoTPropias = 0, egresoTPropias = 0, timbrado = 0, ligadoEgreso = 0;
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Cuenta</th><th>Timbrado Ingreso</th><th>Ingreso</th><th>Transferencias</th><th>Ingreso Neto</th><th>Egreso</th><th>Transferencias</th><th>Egreso Neto</th><th>Ligado de Egresos</th></tr>');
        for(i=0;i<aver2.length;i++)
        {
          ingreso += resp.ingresoEgreso[aver2[i]].Ingreso;
          ingresoTPropias += resp.ingresoEgreso[aver2[i]].IngresoTPropias;
          egreso += resp.ingresoEgreso[aver2[i]].Egreso;
          timbrado += resp.ingresoEgreso[aver2[i]].Timbrado;
          ligadoEgreso += resp.ingresoEgreso[aver2[i]].Ligado;
          egresoTPropias += resp.ingresoEgreso[aver2[i]].EgresoTPropias;
          cad=cad+'<tr><td>'+resp.ingresoEgreso[aver2[i]].Nombre+'</td><td><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Timbrado),'$')+'</u></td><td><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].IngresoTPropias)+parseFloat(resp.ingresoEgreso[aver2[i]].Ingreso),'$')+'</u></td><td><a href="javascript:void(0)" class="detalleCuentaMesTPropias" status="2" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].IngresoTPropias),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaMes" status="2" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Ingreso),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].EgresoTPropias)+parseFloat(resp.ingresoEgreso[aver2[i]].Egreso),'$')+'</u></td><td><a href="javascript:void(0)" status="1" class="detalleCuentaMesTPropias" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].EgresoTPropias),'$')+'</u></a></td><td><a href="javascript:void(0)" status="1" class="detalleCuentaMes" anio="'+anio+'" nombre="'+resp.ingresoEgreso[aver2[i]].Nombre+'" cuenta="'+resp.ingresoEgreso[aver2[i]].Cuenta+'"><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Egreso),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Ligado),'$')+'</u></td></tr>';
        }
        timbrado+=resp.manualTimbrado;
        cad=cad + '<tr><td>TIMBRADO MANUAL:</td><td>'+format2(parseFloat(resp.manualTimbrado),'$')+'</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
        
        cad=cad + '<tr><td></td><td>'+format2(parseFloat(timbrado),'$')+'</td><td>'+format2(parseFloat(ingreso)+parseFloat(ingresoTPropias),'$')+'</td><td>'+format2(parseFloat(ingresoTPropias),'$')+'</td><td>'+format2(parseFloat(ingreso),'$')+'</td><td>'+format2(parseFloat(egreso)+parseFloat(egresoTPropias),'$')+'</td><td>'+format2(parseFloat(egresoTPropias),'$')+'</td><td>'+format2(parseFloat(egreso),'$')+'</td><td>'+format2(parseFloat(ligadoEgreso),'$')+'</td></tr>';
        
        //cad=cad + '<tr><td></td><td>'+format2(parseFloat(ingreso),'$')+'</td><td>'+format2(parseFloat(ingresoTPropias),'$')+'</td><td>'+format2(parseFloat(ingreso)+parseFloat(ingresoTPropias),'$')+'</td><td>'+format2(parseFloat(egreso),'$')+'</td><td>'+format2(parseFloat(egresoTPropias),'$')+'</td><td>'+format2(parseFloat(egreso)+parseFloat(egresoTPropias),'$')+'</td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
        $('#headLigado').html('<tr><th>Mes</th><th>Importe</th><th>Ligado</th><th>Diferencia</th></tr>');
        $('#headReporte').html('<tr><th>Etiqueta</th><th>Importe</th></tr>');
         aver2 = Object.keys(resp.LigadoList);
        cad ='';
        for(i=0;i<aver2.length;i++)
        {
          var dif = resp.LigadoList[aver2[i]].Importe - resp.LigadoList[aver2[i]].Ligado;
          cad=cad+'<tr><td>'+resp.LigadoList[aver2[i]].Mes+'</td><td><u>'+format2(parseFloat(resp.LigadoList[aver2[i]].Importe),'$')+'</u></td><td><u>'+format2(parseFloat(resp.LigadoList[aver2[i]].Ligado),'$')+'</u></td><td><a href="javascript:none;" class="muestraDetalleDiferenciaDelMes" mes="'+resp.LigadoList[aver2[i]].Mes+'">'+format2(dif,'$')+'</a></td></tr>';
        }
        $('#tablaLigado').html(cad);
        aver2 = Object.keys(resp.ReporteList);
        cad ='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<tr><td>'+resp.ReporteList[aver2[i]].Mes+'</td><td style="cursor:pointer;" class="detalleLigado" nombre="'+resp.ReporteList[aver2[i]].Mes+'"><u>'+format2(parseFloat(resp.ReporteList[aver2[i]].Importe),'$')+'</u></td></tr>';
        }
        $('#tablaReporte').html(cad);

      }
    }
  });
}


$(document).on("click", ".bajaCSV", function (){
  var cadCSV = $(this).attr("cad");
  var adicional = $(this).attr("adicional");
  var encodedUri = encodeURI(cadCSV);
  var link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", adicional+".csv");
  link.click(); 
          
});
$(document).on("click", ".detalleLigado", function (){
  var nombre = $(this).attr("nombre");
  $.ajax({
    url: "/detalleLigado",  
    dataType : "json",
    type : "post",
    async : true,
    data : {nombre:nombre},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var cad = '<table class="table table-striped"><thead><tr><th>Fecha</th><th>Cuenta</th><th>Descripcion</th><th>Importe</th><th>Folio fiscal</th></tr></thead><tbody>';
        var i;
        var aver2 = Object.keys(resp.ligado);
        var suma = 0.0;
        var cadCSV = 'data:text/csv;charset=utf-8,Fecha,Cuenta,Descripcion,Importe,Folio fiscal\n';
        
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.ligado[aver2[i]].Importe)).format('$0,0.00');
          cadCSV=cadCSV+resp.ligado[aver2[i]].Fecha+','+resp.ligado[aver2[i]].Cuenta+','+resp.ligado[aver2[i]].Descripcion+','+string+','+resp.ligado[aver2[i]].FOLIO_FISCAL+'\n';
          cad=cad+'<tr><td>'+resp.ligado[aver2[i]].Fecha+'</td><td>'+resp.ligado[aver2[i]].Cuenta+'</td><td>'+resp.ligado[aver2[i]].Descripcion+'</td><td>'+string+'</td><td>'+resp.ligado[aver2[i]].FOLIO_FISCAL+'</td></tr>';
          suma+=resp.ligado[aver2[i]].Importe;
        }
        cad=cad+'<tr><td colspan="4"><h1>Suma: '+suma+'</h1></td><td><button class="btn btn-success bajaCSV" cad="'+cadCSV+'" adicional="etiqueta '+nombre+'">Bajar CSV</button></td></tr>';
        cad=cad+'</tbody></table>';
        console.log(cad);
        $("#divDetalleLigado").html(cad);
      }
    }
  });
 }); 

$(document).on("change", ".selectAbonoCargo", function (){
  var idBanco = $(this).attr("idBanco");
  var status = $(this).attr("status");
  var statusCambiar = $(this).val();
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  var mesanio = $(this).attr("mesanio");
  var propias = $(this).attr("propias");
  var param = {idBanco: idBanco, status : statusCambiar}
  $.ajax({
    url: "/changeIdBanco",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        obtieneDetallesDiaCuentaBancaria(status, nombre, cuenta, mesanio, propias);
      }
    }
  });
});

$(document).on("change", ".selectChangeCuentaPropia", function (){
  var idBanco = $(this).attr("idBanco");
  var status = $(this).attr("status");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  var mesanio = $(this).attr("mesanio");
  var propias = $(this).attr("propias");
  var CuentaPropia = $(this).val();
  var param = {idBanco: idBanco, CuentaPropia : CuentaPropia}
  $.ajax({
    url: "/selectChangeCuentaPropia",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        obtieneDetallesDiaCuentaBancaria(status, nombre, cuenta, mesanio, propias);
      }
    }
  });
});


function obtieneDetallesDiaCuentaBancariaPendienteDeLigar(status, nombre, cuenta, mesanio)
{
 var param = {mesanio : mesanio, status : status, cuenta: cuenta}
  $.ajax({
    url: "/detalleCuentaPorDiaPendienteDeLigar",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Fecha</th><th>Importe</th><th>Descripci&oacute;n</th><th>Leyenda 1</th><th>Leyenda 2</th><th>Referencia</th></tr>');
        
        var i, j, cad='<tr><td colspan="8"><button nombre="'+nombre+'" cuenta="'+cuenta+'" status="'+status+'" mesanio="'+mesanio+'" id="regresarMESAnioIngresoEgreso" type="submit" class="btn btn-success ">Regresar</button></td></tr><tr><td colspan="8"><center>'+nombre+'</center></td></tr>';
        var aver2 = Object.keys(resp.ingresoEgreso);
        var total = 0.0;
        var totalCuentasPropias = 0.0;
        var mesDia = "";
        for(i=0;i<aver2.length;i++)
        {
          var style = '';
          var aver3 = Object.keys(resp.ingresoEgreso[aver2[i]].UUIDList);
        
          if(parseInt(aver3.length)>=1)
          {
            totalCuentasPropias+=parseFloat(resp.ingresoEgreso[aver2[i]].Importe);
            style=' style="background-color:#81DAF5" ';
          }
          else
          {
            total+=parseFloat(resp.ingresoEgreso[aver2[i]].Importe);
          }
          mesDia = resp.ingresoEgreso[aver2[i]].Fecha.substring(3);
          cad=cad+'<tr '+style+'><td>'+resp.ingresoEgreso[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Importe),'$')+'</td><td>'+resp.ingresoEgreso[aver2[i]].Descripcion+'</td><td>'+resp.ingresoEgreso[aver2[i]].Leyenda1+'</td><td>'+resp.ingresoEgreso[aver2[i]].Leyenda2+'</td><td>'+resp.ingresoEgreso[aver2[i]].Referencia+'</td></tr>';
          if(parseInt(aver3.length)>=1)
          {
            for(j=0;j<aver3.length;j++)
            {
              cad=cad+'<tr><td><a target="_blank" class="muestraXML" xml="'+resp.ingresoEgreso[aver2[i]].UUIDList[aver3[j]].Ruta+'/'+resp.ingresoEgreso[aver2[i]].UUIDList[aver3[j]].XML+'">XML</a></td><td>'+format2(resp.ingresoEgreso[aver2[i]].UUIDList[aver3[j]].AMOUNT,'$')+'</td></tr>';
            }
          }
        }
        var palabra = 'Ingreso';
        if(status=="1")
        {
          palabra="Egreso";
        }
        cad=cad+'<tr><td colspan="2"> <input mesDia="'+mesDia+'" type="text" placeholder="dia a dos digitos" class="dia" maxlength="2" /></td><td colspan="2"> <input type="text" placeholder="cantidad" class="cantidadBanco" maxlength="2" /></td><td colspan="4"> <input type="text" placeholder="descripcion" class="descripcionBancoClass" maxlength="2" /></td> <td colspan="2"> <button status="'+status+'" id="agregaNuevoBanco" type="submit" class="btn btn-success ">Agregar</button></td> </tr>';
        
        cad=cad+'<tr><td colspan="6">Total de '+palabra+' de '+nombre+' '+cuenta+' del mes '+mesanio+' </td><td colspan="2">'+format2(parseFloat(total),'$')+'</td></tr>';
         cad=cad+'<tr><td colspan="6">Total de T.Cuentas Propias de '+palabra+' de '+nombre+' '+cuenta+' del mes '+mesanio+' </td><td colspan="2">'+format2(parseFloat(totalCuentasPropias),'$')+'</td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
      }
    }
  });
}


function obtieneDetallesDiaCuentaBancaria(status, nombre, cuenta, mesanio, propias)
{
 var param = {mesanio : mesanio, status : status, cuenta: cuenta}
  $.ajax({
    url: "/detalleCuentaPorDia",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Fecha</th><th>Importe</th><th>Descripci&oacute;n</th><th>Leyenda 1</th><th>Leyenda 2</th><th>T.Cuenta Propia?</th><th>Referencia</th><th>Abono o Cargo?</th><th>Eliminar</th></tr>');
        
        var i, cad='<tr><td colspan="8"><button nombre="'+nombre+'" cuenta="'+cuenta+'" status="'+status+'" mesanio="'+mesanio+'" propias="'+propias+'" id="regresarMESAnioIngresoEgreso" type="submit" class="btn btn-success ">Regresar</button></td></tr><tr><td colspan="8"><center>'+nombre+'</center></td></tr>';
        var aver2 = Object.keys(resp.ingresoEgreso);
        var total = 0.0;
        var totalCuentasPropias = 0.0;
        var mesDia = "";
        for(i=0;i<aver2.length;i++)
        {
          var style = '';
          var option = '<option selected value="0">No</option><option value="1">Si</option><option value="2">NO</option>';
          var optionAbono = '';
          
          if(parseInt(status)==1)//gasto
          {
            optionAbono = optionAbono + '<option selected="selected" value="1">CARGO</option><option value="2">ABONO</option>';
          }
          else
          {
            optionAbono = optionAbono + '<option value="1">CARGO</option><option  selected="selected" value="2">ABONO</option>'; 
          }
          if(parseInt(resp.ingresoEgreso[aver2[i]].CuentaPropia)==1)
          {
            totalCuentasPropias+=parseFloat(resp.ingresoEgreso[aver2[i]].Importe);
            style=' style="background-color:#81DAF5" ';
             option = '<option  value="0">No</option><option selected value="1">Si</option><option value="2">NO</option>';
          }
          else
          {
            total+=parseFloat(resp.ingresoEgreso[aver2[i]].Importe);
          }
          var cadAdicional = '';
          var aver4 = Object.keys(resp.ingresoEgreso[aver2[i]].UUIDList);
          if(parseInt(aver4.length)>=1)
          {
            style=' style="background-color:#7CFF92" ';

            cadAdicional = ' <a href="javascript:;" class="verXML" uuid="'+aver4[0]+'">'+aver4[0]+'</a>';
          }
          mesDia = resp.ingresoEgreso[aver2[i]].Fecha.substring(3);
          cad=cad+'<tr '+style+'><td>'+resp.ingresoEgreso[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.ingresoEgreso[aver2[i]].Importe),'$')+'</td><td>'+resp.ingresoEgreso[aver2[i]].Descripcion+' '+cadAdicional+'</td><td>'+resp.ingresoEgreso[aver2[i]].Leyenda1+'</td><td>'+resp.ingresoEgreso[aver2[i]].Leyenda2+'</td><td><select status="'+status+'" nombre="'+nombre+'" mesanio="'+mesanio+'"  cuenta="'+cuenta+'" idBanco="'+resp.ingresoEgreso[aver2[i]].IdBanco+'" class="selectChangeCuentaPropia" propias="'+propias+'" >'+option+'</select></td><td>'+resp.ingresoEgreso[aver2[i]].Referencia+'</td><td><select propias="'+propias+'"  class="selectAbonoCargo" idBanco="'+resp.ingresoEgreso[aver2[i]].IdBanco+'"  status="'+status+'" nombre="'+nombre+'" mesanio="'+mesanio+'"  cuenta="'+cuenta+'">'+optionAbono+'</select></td><td><img src="static/img/tacha.jpg"  status="'+status+'" nombre="'+nombre+'" mesanio="'+mesanio+'"  cuenta="'+cuenta+'" class="borrarIdBanco" idBanco="'+resp.ingresoEgreso[aver2[i]].IdBanco+'"  width="30px" height="30px" /></td></tr>';
        }
        var palabra = 'Ingreso';
        if(status=="1")
        {
          palabra="Egreso";
        }
        cad=cad+'<tr><td colspan="2"> <input mesDia="'+mesDia+'" type="text" placeholder="dia a dos digitos" class="soloNumeros" style="width: 100%;" id="dia" maxlength="2" /></td><td colspan="2"> <input type="text" style="width: 100%;" placeholder="cantidad" id="cantidadBanco" class="soloNumeros"  /></td><td colspan="4"> <input type="text" placeholder="descripcion" style="width: 100%;" id="descripcionBancoClass" /></td> <td colspan="2"> <button status="'+status+'" id="agregaNuevoBanco" mesanio="'+mesanio+'" propias="'+propias+'"  nombre="'+nombre+'" cuenta="'+cuenta+'" type="submit" class="btn btn-success ">Agregar</button></td> </tr>';
        cad=cad+'<tr><td colspan="6">Total de '+palabra+' de '+nombre+' '+cuenta+' del mes '+mesanio+' </td><td colspan="2">'+format2(parseFloat(total),'$')+'</td></tr>';
         cad=cad+'<tr><td colspan="6">Total de T.Cuentas Propias de '+palabra+' de '+nombre+' '+cuenta+' del mes '+mesanio+' </td><td colspan="2">'+format2(parseFloat(totalCuentasPropias),'$')+'</td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
      }
    }
  });
}

$(document).on("click", "#agregaNuevoBanco", function (){
  var cuenta = $(this).attr("cuenta").trim();
  var nombre = $(this).attr("nombre").trim();
  var mesanio = $(this).attr("mesanio").trim();
  var propias = $(this).attr("propias").trim();
  
  var STATUS = $(this).attr("status").trim();
  var Pesos = $("#cantidadBanco").val().trim();
  
  var FechaMovimiento = $("#dia").val().trim();
  var Descripcion = $("#descripcionBancoClass").val().trim();
  if(Descripcion=="")
  {
    alert("Te falta escribir la descripcion del movimiento");
    return;
  }
  if(Pesos=="")
  {
    alert("Te falta escribir la cantidad en pesos");
    return;
  }
  if(FechaMovimiento.length!=2)
  {
    alert("Te falta escribir el dia a dos digitos, por ejemplo: 01 para el primer dia del mes");
    return;
  }
  var mes = $("#dia").attr("mesDia");
  //FechaMovimiento = FechaMovimiento + "/"+ mes;
  FechaMovimiento = FechaMovimiento + "/"+ mesanio ;
  var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : "", leyenda1: "", leyenda2 : "", Saldo : 0 , Moneda : "MXN"}
  $.ajax({
    url: "/sube1Banco",
    dataType : "json",
    type : "post",
    async : false,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        obtieneDetallesDiaCuentaBancaria(STATUS, nombre, cuenta, mesanio, propias);
        alert("Ya se subio el banco");
      }
    }
  });
});
$(document).on("click", ".borrarIdBanco", function (){
  var idBanco = $(this).attr("idBanco");
  var status = $(this).attr("status");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  var mesanio = $(this).attr("mesanio");
  var param = {idBanco: idBanco}
  $.ajax({
    url: "/borrarIdBanco",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        obtieneDetallesDiaCuentaBancaria(status, nombre, cuenta, mesanio);
      }
      if(resp.success==2)
      {
        alert("No se puede borrar este movimiento porque tiene facturas ligadas a el, primero desliga las facturas que estan ligadas a este movimiento.");
      }
    }
  });
});


$(document).on("click", ".detalleCuentaPorDiaPendienteDeLigar", function (){
  var status = $(this).attr("status");
  var mesanio = $(this).attr("mesanio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  obtieneDetallesDiaCuentaBancariaPendienteDeLigar(status, nombre, cuenta, mesanio);
});

$(document).on("click", ".detalleCuentaPorDia", function (){
  var status = $(this).attr("status");
  var mesanio = $(this).attr("mesanio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  var propias = $(this).attr("propias");
  obtieneDetallesDiaCuentaBancaria(status, nombre, cuenta, mesanio, propias);
});


$(document).on("click", "#regresarMESAnioIngresoEgreso", function (){
  var status = $(this).attr("status");
  var anio = $(this).attr("mesanio").substring(3);
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  var propias = $(this).attr("propias");
  detalleCuentaMesIngresoEgreso(status, anio, cuenta, nombre, propias);
});


function detalleCuentaMesIngresoEgresoPendienteDeLigar(status, anio, cuenta, nombre)
{
   var param = {anio : anio, status : status, cuenta: cuenta}
  $.ajax({
    url: "/detalleCuentaMesPendienteDeLigar",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='<tr><td colspan="2"><button id="regresarAnioIngresoEgreso" type="submit" class="btn btn-success ">Regresar</button></td></tr><tr><td colspan="2"><center>'+nombre+'</center></td></tr>';
        var palabra = 'Ingreso';
        if(status=="1")
        {
          palabra="Egreso";
        }
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Mes</th><th>'+palabra+'</th><th>Ligado</th></tr>');
        var importe = 0.0;
        var importeLigado = 0.0;
        importe += resp.enero;
        importeLigado += resp.eneroLigado;
        importeLigado += resp.febreroLigado;
        importeLigado += resp.marzoLigado;
        importeLigado += resp.abrilLigado;
        importeLigado += resp.mayoLigado;
        importeLigado += resp.junioLigado;
        importeLigado += resp.julioLigado;
        importeLigado += resp.agostoLigado;
        importeLigado += resp.septiembreLigado;
        importeLigado += resp.octubreLigado;
        importeLigado += resp.noviembreLigado;
        importeLigado += resp.diciembreLigado;


        cad=cad+'<tr><td>Enero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="01/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.enero),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="01/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.eneroLigado),'$')+'</u></a></td></tr>';
        importe += resp.febrero;
        cad=cad+'<tr><td>Febrero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="02/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.febrero),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="02/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.febreroLigado),'$')+'</u></a></td></tr>';
         importe += resp.marzo;
        cad=cad+'<tr><td>Marzo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="03/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.marzo),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="03/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.marzoLigado),'$')+'</u></a></td></tr>';
         importe += resp.abril;
        cad=cad+'<tr><td>Abril</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="04/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.abril),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="04/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.abrilLigado),'$')+'</u></a></td></tr>';
         importe += resp.mayo;
        cad=cad+'<tr><td>Mayo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="05/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.mayo),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="05/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.mayoLigado),'$')+'</u></a></td></tr>';
         importe += resp.junio;
        cad=cad+'<tr><td>Junio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="06/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.junio),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="06/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.junioLigado),'$')+'</u></a></td></tr>';
         importe += resp.julio;
        cad=cad+'<tr><td>Julio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="07/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.julio),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="07/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.julioLigado),'$')+'</u></a></td></tr>';
         importe += resp.agosto;
        cad=cad+'<tr><td>Agosto</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="08/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.agosto),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="08/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.agostoLigado),'$')+'</u></a></td></tr>';
         importe += resp.septiembre;
        cad=cad+'<tr><td>Septiembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="09/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.septiembre),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="09/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.septiembreLigado),'$')+'</u></a></td></tr>';
         importe += resp.octubre;
        cad=cad+'<tr><td>Octubre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="10/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.octubre),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="10/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.octubreLigado),'$')+'</u></a></td></tr>';
         importe += resp.noviembre;
        cad=cad+'<tr><td>Noviembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="11/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.noviembre),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="11/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.noviembreLigado),'$')+'</u></a></td></tr>';
         importe += resp.diciembre;
        cad=cad+'<tr><td>Diciembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="12/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.diciembre),'$')+'</u></a></td><td><a href="javascript:void(0)" class="detalleCuentaPorDiaPendienteDeLigar" status="'+status+'" mesanio="01/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.diciembreLigado),'$')+'</u></a></td></tr>';
        cad=cad + '<tr><td>TOTAL:</td><td>'+format2(parseFloat(importe),'$')+'</td><td>'+format2(parseFloat(importeLigado),'$')+'</td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
      }
    }
  });
}




function detalleCuentaMesIngresoEgreso(status, anio, cuenta, nombre, propias)
{
  
   var param = {anio : anio, status : status, cuenta: cuenta, propias : propias}
  $.ajax({
    url: "/detalleCuentaMes",  
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='<tr><td colspan="2"><button id="regresarAnioIngresoEgreso" type="submit" class="btn btn-success ">Regresar</button></td></tr><tr><td colspan="2"><center>'+nombre+'</center></td></tr>';
        if(status=="2")
        {
          cad='<tr><td colspan="3"><button id="regresarAnioIngresoEgreso" type="submit" class="btn btn-success ">Regresar</button></td></tr><tr><td colspan="2"><center>'+nombre+'</center></td><td>Timbrado de ingreso</td></tr>';
        }
        var palabra = 'Ingreso';
        if(status=="1")
        {
          palabra="Egreso";
        }
        $('#headTablaLibroIngresosEgresos').html('<tr><th>Mes</th><th>'+palabra+'</th></tr>');
        var importe = 0.0;
        var importeTimbrado = 0.0;
        importe += resp.enero;

        importeTimbrado+=resp.eneroTimbrado;
        importeTimbrado+=resp.febreroTimbrado;
        importeTimbrado+=resp.marzoTimbrado;
        importeTimbrado+=resp.abrilTimbrado;
        importeTimbrado+=resp.mayoTimbrado;
        importeTimbrado+=resp.junioTimbrado;
        importeTimbrado+=resp.julioTimbrado;
        importeTimbrado+=resp.agostoTimbrado;
        importeTimbrado+=resp.septiembreTimbrado;
        importeTimbrado+=resp.octubreTimbrado;
        importeTimbrado+=resp.noviembreTimbrado;
        importeTimbrado+=resp.diciembreTimbrado;
        if(status=="2")
        {
cad=cad+'<tr><td>Enero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="01/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.enero),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.eneroTimbrado),'$')+'</u></td></tr>';
        importe += resp.febrero;
        cad=cad+'<tr><td>Febrero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="02/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.febrero),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.febreroTimbrado),'$')+'</u></td></tr>';
         importe += resp.marzo;
        cad=cad+'<tr><td>Marzo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="03/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.marzo),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.marzoTimbrado),'$')+'</u></td></tr>';
         importe += resp.abril;
        cad=cad+'<tr><td>Abril</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="04/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.abril),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.abrilTimbrado),'$')+'</u></td></tr>';
         importe += resp.mayo;
        cad=cad+'<tr><td>Mayo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="05/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.mayo),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.mayoTimbrado),'$')+'</u></td></tr>';
         importe += resp.junio;
        cad=cad+'<tr><td>Junio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="06/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.junio),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.junioTimbrado),'$')+'</u></td></tr>';
         importe += resp.julio;
        cad=cad+'<tr><td>Julio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="07/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.julio),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.julioTimbrado),'$')+'</u></td></tr>';
         importe += resp.agosto;
        cad=cad+'<tr><td>Agosto</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="08/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.agosto),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.agostoTimbrado),'$')+'</u></td></tr>';
         importe += resp.septiembre;
        cad=cad+'<tr><td>Septiembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="09/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.septiembre),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.septiembreTimbrado),'$')+'</u></td></tr>';
         importe += resp.octubre;
        cad=cad+'<tr><td>Octubre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="10/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.octubre),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.octubreTimbrado),'$')+'</u></td></tr>';
         importe += resp.noviembre;
        cad=cad+'<tr><td>Noviembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="11/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.noviembre),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.noviembreTimbrado),'$')+'</u></td></tr>';
         importe += resp.diciembre;
        cad=cad+'<tr><td>Diciembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="12/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.diciembre),'$')+'</u></a></td><td><u>'+format2(parseFloat(resp.diciembreTimbrado),'$')+'</u></td></tr>';

        cad=cad + '<tr><td>TOTAL:</td><td>'+format2(parseFloat(importe),'$')+'</td><td>'+format2(parseFloat(importeTimbrado),'$')+'</td></tr>';

        
        }
        else
        {
        cad=cad+'<tr><td>Enero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="01/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.enero),'$')+'</u></a></td></tr>';
        importe += resp.febrero;
        cad=cad+'<tr><td>Febrero</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="02/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.febrero),'$')+'</u></a></td></tr>';
         importe += resp.marzo;
        cad=cad+'<tr><td>Marzo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="03/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.marzo),'$')+'</u></a></td></tr>';
         importe += resp.abril;
        cad=cad+'<tr><td>Abril</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="04/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.abril),'$')+'</u></a></td></tr>';
         importe += resp.mayo;
        cad=cad+'<tr><td>Mayo</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="05/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.mayo),'$')+'</u></a></td></tr>';
         importe += resp.junio;
        cad=cad+'<tr><td>Junio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="06/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.junio),'$')+'</u></a></td></tr>';
         importe += resp.julio;
        cad=cad+'<tr><td>Julio</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="07/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.julio),'$')+'</u></a></td></tr>';
         importe += resp.agosto;
        cad=cad+'<tr><td>Agosto</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="08/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.agosto),'$')+'</u></a></td></tr>';
         importe += resp.septiembre;
        cad=cad+'<tr><td>Septiembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="09/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.septiembre),'$')+'</u></a></td></tr>';
         importe += resp.octubre;
        cad=cad+'<tr><td>Octubre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="10/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.octubre),'$')+'</u></a></td></tr>';
         importe += resp.noviembre;
        cad=cad+'<tr><td>Noviembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="11/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.noviembre),'$')+'</u></a></td></tr>';
         importe += resp.diciembre;
        cad=cad+'<tr><td>Diciembre</td><td><a href="javascript:void(0)" class="detalleCuentaPorDia" propias="'+propias+'" status="'+status+'" mesanio="12/'+anio+'" nombre="'+nombre+'" cuenta="'+cuenta+'"><u>'+format2(parseFloat(resp.diciembre),'$')+'</u></a></td></tr>';

        cad=cad + '<tr><td>TOTAL:</td><td>'+format2(parseFloat(importe),'$')+'</td></tr>';

          
        }
        cad=cad+'<tr><td><button class="btn btn-success" cuenta="'+cuenta+'" id="exportaLibroExcelPorCuenta">Exportar papel de trabajo de ingresos a excel</button></td><td><button class="btn btn-success" id="exportaLibroExcelGastosPorCuenta" cuenta="'+cuenta+'">Exportar papel de trabajo de gastos a excel</button></td></tr>';
        $('#tablaLibroIngresosEgresos').html(cad);
      }
    }
  });
}



$(document).on("click", ".detalleCuentaMesTPropias", function (){
  var status = $(this).attr("status");
  var anio = $(this).attr("anio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  detalleCuentaMesIngresoEgreso(status, anio, cuenta, nombre, 1);
});

$(document).on("click", ".detalleCuentaMesPendienteDeLigar", function (){
  var status = $(this).attr("status");
  var anio = $(this).attr("anio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  detalleCuentaMesIngresoEgresoPendienteDeLigar(status, anio, cuenta, nombre);
});

$(document).on("click", ".detalleCuentaMes", function (){
  var status = $(this).attr("status");
  var anio = $(this).attr("anio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).attr("nombre");
  detalleCuentaMesIngresoEgreso(status, anio, cuenta, nombre, 0);
});

function actualizaMesTimbrado()
{
  $.ajax({
    url: "/actualizaMesTimbrado",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='';
        var aver2 = Object.keys(resp.fechas);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.fechas[aver2[i]].Nombre+'">'+resp.fechas[aver2[i]].Nombre+'</option>';
        }
        $('#selectMesTimbrado').html(cad);
        actualizaDiaTimbrado();
      }
    }
  });
}



function actualizaTablaPosiblesDuplicados()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
   $.ajax({
        url: "/posiblesDuplicados",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              var botonSi = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" STATUS="2" class="btn btn-success abonoCargoMarcar">ABONO</button>';
              var botonNo = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" STATUS="1" class="btn btn-danger abonoCargoMarcar">CARGO</button>';
              var agregarBoton = '<td>'+botonSi+'</td><td>'+botonNo+'</td>';
              
                cad=cad + '<tr concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" ><td>'+resp.cuentas[aver2[i]].Nombre+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Importe),'$')+'</td><td>'+resp.cuentas[aver2[i]].Descripcion+'</td><td>'+resp.cuentas[aver2[i]].Referencia+'</td>'+agregarBoton+'</tr>';
            
              
             }     
           $('#tablaCuentasPropias').html(cad);
           $("#loadingCampos").html('');
          }
        }
      });
}

function actualizaTablaPendientes()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
   $.ajax({
        url: "/pendientesCargoAbono",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              var botonSi = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" STATUS="2" class="btn btn-success abonoCargoMarcar">ABONO</button>';
              var botonNo = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" STATUS="1" class="btn btn-danger abonoCargoMarcar">CARGO</button>';
              var agregarBoton = '<td>'+botonSi+'</td><td>'+botonNo+'</td>';
              
                cad=cad + '<tr concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" ><td>'+resp.cuentas[aver2[i]].Nombre+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Importe),'$')+'</td><td>'+resp.cuentas[aver2[i]].Descripcion+'</td><td>'+resp.cuentas[aver2[i]].Referencia+'</td>'+agregarBoton+'</tr>';
            
              
             }     
           $('#tablaCuentasPropias').html(cad);
           $("#loadingCampos").html('');
          }
        }
      });
}

function actualizaTablaCuentasPropias()
{
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
   $.ajax({
        url: "/transferenciasCuentasPropias",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              var botonSi = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" CuentaPropia="1" class="btn btn-success cuentaPropiaMarcar">Si</button>';
              var botonNo = '<button type="submit" concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" CuentaPropia="-1" class="btn btn-danger cuentaPropiaMarcar">No</button>';
              var agregarBoton = '<td rowspan="2">'+botonSi+'</td><td rowspan="2">'+botonNo+'</td>';
              if(i%2==0)
              {
                cad=cad + '<tr concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" ><td>'+resp.cuentas[aver2[i]].Nombre+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Importe),'$')+'</td><td>'+resp.cuentas[aver2[i]].Descripcion+'</td><td>'+resp.cuentas[aver2[i]].Referencia+'</td>'+agregarBoton+'</tr>';
              }
              else
              {
                cad=cad + '<tr concentrado="'+resp.cuentas[aver2[i]].Concentrado+'" ><td>'+resp.cuentas[aver2[i]].Nombre+'</td><td>'+resp.cuentas[aver2[i]].Fecha+'</td><td>'+format2(parseFloat(resp.cuentas[aver2[i]].Importe),'$')+'</td><td>'+resp.cuentas[aver2[i]].Descripcion+'</td><td>'+resp.cuentas[aver2[i]].Referencia+'</td></tr>';
              }
             }     
           $('#tablaCuentasPropias').html(cad);
           $("#loadingCampos").html('');
          }
        }
      });
}



$(document).on("click", "#nombresCuentas", function (){

    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Nombres de cuentas bancarias</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Nombre de cuentas bancarias</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Nombre</th><th>Guardar</th></thead>'+
                        '<tbody id="tablaNombresCuentas"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTablaNombresCuentas(); 
 });





function actualizaCuentas()
{
   $.ajax({
        url: "/actualizaCuentas",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var i, cad= '<option value="0">Selecciona una opcion</option>';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad + '<option cuenta="'+resp.cuentas[aver2[i]].Cuenta+'" value="'+resp.cuentas[aver2[i]].ACNT_CODE+'">'+resp.cuentas[aver2[i]].Nombre+'</option>';
             }     
           $('#selectCuenta').html(cad);
          }
        }
      });
}

function actualizaTablaNombresCuentas()
{
   $.ajax({
        url: "/nombresCuentas",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad + '<tr><td>'+resp.cuentas[aver2[i]].Cuenta+'</td><td><input type="text" cuenta="'+resp.cuentas[aver2[i]].Cuenta+'" class="form-control nombre" value="'+resp.cuentas[aver2[i]].Nombre+'"/></td><td><input type="text" cuenta="'+resp.cuentas[aver2[i]].Cuenta+'" class="form-control ACNT_CODE" value="'+resp.cuentas[aver2[i]].ACNT_CODE+'"/><td><button type="submit" cuenta="'+resp.cuentas[aver2[i]].Cuenta+'"   class="btn btn-success nombreCuentaGuardar">Guardar</button></td></tr>';
             }     
           $('#tablaNombresCuentas').html(cad);
          }
        }
      });
}



$(document).on("change", "#cambiaTFWWALaBrava", function (){
  var fileName = $('#cambiaTFWWALaBrava').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLSubeTFWWALaBrava(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});

$(document).on("change", "#cambiaCuentasALaBrava", function (){
  var fileName = $('#cambiaCuentasALaBrava').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLSubeCuentasALaBrava(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});


$(document).on("change", "#subeXML", function (){
  var fileName = $('#subeXML').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'xml' || extension == 'XML')
    {
      readURLSubeXML(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"xml\" o \"XML\"");
  }
});

$(document).on("change", "#subeBancos", function (){
  var fileName = $('#subeBancos').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLScotiabank(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});
$(document).on("change", "#subeBancosSantander", function (){
  var fileName = $('#subeBancosSantander').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLSantander(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});
$(document).on("change", "#subeBancosBancomer", function (){
  var fileName = $('#subeBancosBancomer').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLBancomer(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});


$(document).on("change", "#subeBancosTipoDeCambio", function (){
  var fileName = $('#subeBancosTipoDeCambio').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'txt' )
  {
   var archivo = $('#subeBancosTipoDeCambio').val();
   var filename2 = $('#subeBancosTipoDeCambio').val().split('\\').pop();
  var param = {archivo : filename2}
   $.ajax({
        url: "/procesaArchivoTipoDeCambio",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==2)
          {
            alert("Hubo un error por ahi, perdon ");
          }
          if(resp.success==1)
          {
            alert("Listo, se subieron los tipos de cambio ");
          }
        }
      });
  }
  else
  {
    alert('El formato de archivo permitido es csv o txt.');
  }
});
/*
$(document).on("change", "#subeBancos", function (){
  var fileName = $('#subeBancos').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'txt' )
  {
   var archivo = $('#subeBancos').val();
   var filename2 = $('#subeBancos').val().split('\\').pop();
  var param = {archivo : filename2}
   $.ajax({
        url: "/procesaArchivo",  
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==2)
          {
            alert("POR FAVOR, valida bien tu archivo, se encontraron los siguientes errores: "+resp.errores+" Errores de Fecha: "+resp.fecha+"   exitosos: "+resp.exitosos);
          }
          if(resp.success==1)
          {
            alert("Movimientos registrados: "+resp.exitosos+" Errores: "+resp.errores+" Errores de Fecha: "+resp.fecha);
          }
        }
      });
  }
  else
  {
    alert('El formato de archivo permitido es csv o txt.');
  }
});
*/
$(document).on("click", "#subirInfoBancosTipoDeCambio", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subir Tipo de cambio con CSV</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Subir Tipo de cambio con CSV<small></small></h2>'+
                  '<h4>Instrucciones: Selecciona tu archivo CSV conforme al formato de la pagina del SAT. Tus archivos CSV deben de estar en la carpeta:   C:/csv/</h5>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                       '<p><label for="subeBancosTipoDeCambio">Selecciona el archivo CSV Formato Scotiabank:</label>'+
                          '<input type="file" name="subeBancosTipoDeCambio" id="subeBancosTipoDeCambio"/></p>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 //     actualizaTablaArchivosBanco(); 
 });



$(document).on("click", "#generarPDFconXML", function (){

    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Generar PDF con XML</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Generar PDF con XML timbrado<small></small></h2>'+
                  '<h4>Instrucciones: Selecciona tu archivo XML timbrado para generar el pdf</h5>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                       '<p><label for="subeXML">Selecciona el archivo XML CFDI:</label>'+
                          '<input type="file" name="subeXML" id="subeXML"/></p>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);

 });

$(document).on("click", "#subirInfoBancos", function (){

    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subir Movimientos bancarios</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Subir Movimientos Bancarios<small></small></h2>'+
                  '<h4>Instrucciones: Selecciona tu archivo CSV conforme al formato. Tus archivos CSV deben de estar en la carpeta:   C:/csv/</h5>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                       '<p><label for="subeBancos">Selecciona el archivo CSV Formato Scotiabank:</label>'+
                          '<input type="file" name="subeBancos" id="subeBancos"/></p>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<hr><hr>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                       '<p><label for="subeBancos">Selecciona el archivo CSV Formato Bancomer:</label>'+
                          '<input type="file" name="subeBancosBancomer" id="subeBancosBancomer"/></p>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<hr><hr>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                       '<p><label for="subeBancos">Selecciona el archivo CSV Formato Santander:</label>'+
                          '<input type="file" name="subeBancosSantander" id="subeBancosSantander"/></p>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 //     actualizaTablaArchivosBanco(); 
 });

function actualizaTablaArchivosBanco()
{
   $.ajax({
        url: "/obtenArchivosBanco",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.archivos);
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              cad=cad + '<tr><td>'+resp.archivos[aver2[i]].Nombre+'</td><td><button type="submit" archivo="'+resp.archivos[aver2[i]].Completo+'"   class="btn btn-success procesaArchivo">Procesar</button></td></tr>';
             }     
           $('#tablaArchivos').html(cad);
          }
        }
      });
}
$(document).on("click", "#manuntencionConceptos", function (){

    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Conceptos de Manuntenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Conceptos de Manuntenci&oacute;n <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br><br>'+
                   '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Concepto:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="email" name="Concepto" maxlength="50"  id="Concepto" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoConceptoSAT">Tipo de concepto:</label>'+
                          '<select id="TipoConceptoSAT" class="form-control" required="" >'+
                          '<option value="1">Percepci&oacute;n</option>'+
                          '<option value="2">Deducci&oacute;n</option>'+
                          '<option value="3">Otro Pago</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoSAT">Cat&aacute;lago SAT:</label>'+
                        '<select id="TipoSAT" class="form-control" required="" >'+
                          '<option value="001">Sueldos, Salarios Rayas y Jornales</option>'+
                          '<option value="002">Gratificaci&oacute;n Anual (Aguinaldo)</option>'+
                          '<option value="003">Participaci&oacute;n de los Trabajadores en las Utilidades PTU</option>'+
                          '<option value="004">Reembolso de Gastos M&eacute;dicos Dentales y Hospitalarios</option>'+
                          '<option value="005">Fondo de ahorro</option>'+
                          '<option value="006">Caja de ahorro</option>'+
                          '<option value="009">Contribuciones a Cargo del Trabajador Pagadas por el Patr&oacite;n</option>'+
                          '<option value="010">Premios por puntualidad</option>'+
                          '<option value="011">Prima de seguro de vida</option>'+
                          '<option value="012">Seguro de Gastos M&eacute;dicos Mayores</option>'+
                          '<option value="013">Cuotas Sindicales Pagadas por el Patr&oacute;n</option>'+
                          '<option value="014">Subsidios por incapacidad</option>'+
                          '<option value="015">Becas para trabajadores y/o hijos</option>'+
                          '<option value="019">Horas extra</option>'+
                          '<option value="020">Prima dominical</option>'+
                          '<option value="021">Prima vacacional</option>'+
                          '<option value="022">Prima por antiguedad</option>'+
                          '<option value="023">Pagos por separaci&oacute;n</option>'+
                          '<option value="024">Seguro de retiro</option>'+
                          '<option value="025">Indemnizaciones</option>'+
                          '<option value="026">Reembolso por funeral</option>'+
                          '<option value="027">Cuotas de seguridad social pagadas por el patr&oacute;n</option>'+
                          '<option value="028">Comisiones</option>'+
                          '<option value="029">Vales de despensa</option>'+
                          '<option value="030">Vales de restaurante</option>'+
                          '<option value="031">Vales de gasolina</option>'+
                          '<option value="032">Vales de ropa</option>'+
                          '<option value="033">Ayuda para renta</option>'+
                          '<option value="034">Ayuda para art&iacute;culos escolares</option>'+
                          '<option value="035">Ayuda para anteojos</option>'+
                          '<option value="036">Ayuda para transporte</option>'+
                          '<option value="037">Ayuda para gastos de funeral</option>'+
                          '<option value="038">Otros ingresos por salarios</option>'+
                          '<option value="039">Jubilaciones, pensiones o haberes de retiro</option>'+
                          '<option value="044">Jubilaciones, pensiones o haberes de retiro en parcialidades</option>'+
                          '<option value="045">Ingresos en acciones o títulos valor que representan bienes</option>'+
                          '<option value="046">Ingresos asimilados a salarios</option>'+
                          '<option value="047">Alimentaci&oacute;n</option>'+
                          '<option value="048">Habitación</option>'+
                          '<option value="049">Premios por asistencia</option>'+
                          '<option value="050">Vi&aacute;ticos</option>'+
                        '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="GravadoExcento">Gravado o excento?</label>'+
                        '<select id="GravadoExcento" class="form-control" required="" >'+
                          '<option value="1">Gravado</option>'+
                          '<option value="2">Exento</option>'+
                        '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="nuevoConceptoNomina"  class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                     '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Tipo</th><th>Cat. SAT</th><th>Concepto</th><th>Gravado/Excento</th><th>Eliminar</th></thead>'+
                        '<tbody id="tablaConceptosNomina"></tbody>'+
                      '</table>'+
                      '</div>'+
                    '</div>'+
                  '<br><br>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",  
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
             var aver2 = Object.keys(resp.cuentas);
             var cuentasArray = new Array();
             var i, cad= '';
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.cuentas[aver2[i]]);
              var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
              cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
            }     
            $('#autocomplete-custom-append').autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container'
            }); 
            actualizaTablaConceptosDeNomina();
          }
        }
      });
 });
$(document).on("click", ".eliminaConceptoNomina", function (){
  var idRegistro = $(this).attr("idRegistro");
  var param = {idRegistro : idRegistro};
  $.ajax({
    url: "/eliminaConceptoNomina",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaTablaConceptosDeNomina();
      }
      if(resp.success==0)
      {
        alert("Hubo un error!");
      }
    }
  });
  });

function actualizaTablaConceptosDeNomina()
{
  $.ajax({
    url: "/actualizaTablaConceptosDeNomina",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad= '';
        var aver2 = Object.keys(resp.conceptos);
        for(i=0;i<aver2.length;i++)
        {
          var palabra = '';
          var gravExc = '';
          if(parseInt(resp.conceptos[aver2[i]].GravadoExcento)==1)
          {
            gravExc = "Gravado";
          }
          else
          {
            gravExc = "Exento";
          }
          var tipoPalabra = dameDescripcionDeTipoSAT(resp.conceptos[aver2[i]].Tipo,resp.conceptos[aver2[i]].TipoSAT);
          if(parseInt(resp.conceptos[aver2[i]].Tipo)==1)
          {
            palabra = 'Percepci&oacute;n'; 
          }
          else
          {
            if(parseInt(resp.conceptos[aver2[i]].Tipo)==2)
            {
              palabra = 'Deducci&oacute;n';  
            }
            else
            {
              palabra = 'Otro Pago';
            }
          }
          cad=cad+'<tr><td>'+resp.conceptos[aver2[i]].ACNT_CODE+'</td>\
          <td>'+palabra+'</td>\
          <td>'+tipoPalabra+'</td>\
          <td>'+resp.conceptos[aver2[i]].Concepto+'</td>\
          <td>'+gravExc+'</td><td><button type="submit"  idRegistro="'+resp.conceptos[aver2[i]].IdRegistro+'"  class="btn btn-danger eliminaConceptoNomina">Eliminar</button></td></tr>';
        }
        $("#tablaConceptosNomina").html(cad);
      }
    }
  });
}
function dameDescripcionDeTipoSAT(tipo, TipoSAT)
{
  if(parseInt(tipo)==1)//percepciones
  {
    switch(parseInt(TipoSAT))
    {
      case 1:
        return "Sueldos, Salarios Rayas y Jornales";
      break;
      case 2:
        return "Gratificaci&oacute;n Anual (Aguinaldo)";
      break;
      case 3:
        return "Participaci&oacute;n de los Trabajadores en las Utilidades PTU";
      break;
      case 4:return "Reembolso de Gastos M&eacute;dicos Dentales y Hospitalarios";break;
      case 5:return "Fondo de ahorro";break;
      case 6:return "Caja de ahorro";break;
      case 9:return "Contribuciones a Cargo del Trabajador Pagadas por el Patr&oacite;n";break;
      case 10:return "Premios por puntualidad";break;
      case 11:return "Prima de seguro de vida";break;
      case 12:return "Seguro de Gastos M&eacute;dicos Mayores";break;
      case 13:return "Cuotas Sindicales Pagadas por el Patr&oacute;n";break;
      case 14:return "Subsidios por incapacidad";break;
      case 15:return "Becas para trabajadores y/o hijos";break;
      case 19:return "Horas extra";break;
      case 20:return "Prima dominical";break;
      case 21:return "Prima vacacional";break;
      case 22:return "Prima por antiguedad";break;
      case 23:return "Pagos por separaci&oacute;n";break;
      case 24:return "Seguro de retiro";break;
      case 25:return "Indemnizaciones";break;
      case 26:return "Reembolso por funeral";break;
      case 27:return "Cuotas de seguridad social pagadas por el patr&oacute;n";break;
      case 28:return "Comisiones";break;
      case 29:return "Vales de despensa";break;
      case 30:return "Vales de restaurante";break;
      case 31:return "Vales de gasolina";break;
      case 32:return "Vales de ropa";break;
      case 33:return "Ayuda para renta";break;
      case 34:return "Ayuda para art&iacute;culos escolares";break;
      case 35:return "Ayuda para anteojos";break;
      case 36:return "Ayuda para transporte";break;
      case 37:return "Ayuda para gastos de funeral";break;
      case 38:return "Otros ingresos por salarios";break;
      case 39:return "Jubilaciones, pensiones o haberes de retiro";break;
      case 44:return "Jubilaciones, pensiones o haberes de retiro en parcialidades";break;
      case 45:return "Ingresos en acciones o títulos valor que representan bienes";break;
      case 46:return "Ingresos asimilados a salarios";break;
      case 47:return "Alimentaci&oacute;n";break;
      case 48:return "Habitaci&oacute;n";break;
      case 49:return "Premios por asistencia";break;
      case 50:return "Vi&aacute;ticos";break;
    }
  }
  else//deducciones
  {
    if(parseInt(tipo)==2)//deducciones
    {
      switch(parseInt(TipoSAT))
      {
        case 1:return "Seguridad social";break;
        case 2:return "ISR";break;
        case 3:return "Aportaciones a retiro, cesant&iacute;a en edad avanzada y vejez";break;
        case 4:return "Otros";break;
        case 5:return "Aportaciones a Fondo de vivienda";break;
        case 6:return "Descuento por incapacidad";break;
        case 7:return "Pensi&oacute;n alimenticia";break;
        case 8:return "Renta";break;
        case 9:return "Pr&eacute;stamos provenientes del Fondo Nacional de la Vivienda para los Trabajadores";break;
        case 10:return "Pago por cr&eacute;dito de vivienda";break;
        case 11:return "Pago de abonos INFONACOT";break;
        case 12:return "Anticipo de salarios";break;
        case 13:return "Pagos hechos con exceso al trabajador";break;
        case 14:return "Errores";break;
        case 15:return "P&eacute;rdidas";break;
        case 16:return "Aver&iacute;as";break;
        case 17:return "Adquisici&oacute;n de artículos producidos por la empresa o establecimiento";break;
        case 18:return "Cuotas para la constituci&oacute;n y fomento de sociedades cooperativas y de cajas de ahorro";break;
        case 19:return "Cuotas sindicales";break;
        case 20:return "Ausencia (Ausentismo)";break;
        case 21:return "Cuotas obrero patronales";break;
        case 22:return "Impuestos Locales";break;
        case 23:return "Aportaciones voluntarias";break;
        case 24:return "Ajuste en Gratificación Anual (Aguinaldo) Exento";break;
        case 25:return "Ajuste en Gratificación Anual (Aguinaldo) Gravado";break;
        case 26:return "Ajuste en Participación de los Trabajadores en las Utilidades PTU Exento";break;
        case 27:return "Ajuste en Participación de los Trabajadores en las Utilidades PTU Gravado";break;
        case 28:return "Ajuste en Reembolso de Gastos Médicos Dentales y Hospitalarios Exento";break;
        case 29:return "Ajuste en Fondo de ahorro Exento";break;
        case 30:return "Ajuste en Caja de ahorro Exento";break;
        case 31:return "Ajuste en Contribuciones a Cargo del Trabajador Pagadas por el Patrón Exento";break;
        case 32:return "Ajuste en Premios por puntualidad Gravado";break;
        case 33:return "Ajuste en Prima de Seguro de vida Exento";break;
        case 34:return "Ajuste en Seguro de Gastos Médicos Mayores Exento";break;
        case 35:return "Ajuste en Cuotas Sindicales Pagadas por el Patrón Exento";break;
        case 36:return "Ajuste en Subsidios por incapacidad Exento";break;
        case 37:return "Ajuste en Becas para trabajadores y/o hijos Exento";break;
        case 38:return "Ajuste en Horas extra Exento";break;
        case 39:return "Ajuste en Horas extra Gravado";break;
        case 40:return "Ajuste en Prima dominical Exento";break;
        case 41:return "Ajuste en Prima dominical Gravado";break;
        case 42:return "Ajuste en Prima vacacional Exento";break;
        case 43:return "Ajuste en Prima vacacional Gravado";break;
        case 44:return "Ajuste en Prima por antigüedad Exento";break;
        case 45:return "Ajuste en Prima por antigüedad Gravado";break;
        case 46:return "Ajuste en Pagos por separación Exento";break;
        case 47:return "Ajuste en Pagos por separación Gravado";break;
        case 48:return "Ajuste en Seguro de retiro Exento";break;
        case 49:return "Ajuste en Indemnizaciones Exento";break;
        case 50:return "Ajuste en Indemnizaciones Gravado";break;
        case 51:return "Ajuste en Reembolso por funeral Exento";break;
        case 52:return "Ajuste en Cuotas de seguridad social pagadas por el patrón Exento";break;
        case 53:return "Ajuste en Comisiones Gravado";break;
        case 54:return "Ajuste en Vales de despensa Exento";break;
        case 55:return "Ajuste en Vales de restaurante Exento";break;
        case 56:return "Ajuste en Vales de gasolina Exento";break;
        case 57:return "Ajuste en Vales de ropa Exento";break;
        case 58:return "Ajuste en Ayuda para renta Exento";break;
        case 59:return "Ajuste en Ayuda para artículos escolares Exento";break;
        case 60:return "Ajuste en Ayuda para anteojos Exento";break;
        case 61:return "Ajuste en Ayuda para transporte Exento";break;
        case 62:return "Ajuste en Ayuda para gastos de funeral Exento";break;
        case 63:return "Ajuste en Otros ingresos por salarios Exento";break;
        case 64:return "Ajuste en Otros ingresos por salarios Gravado";break;
        case 65:return "Ajuste en Jubilaciones, pensiones o haberes de retiro Exento";break;
        case 66:return "Ajuste en Jubilaciones, pensiones o haberes de retiro Gravado";break;
        case 67:return "Ajuste en Pagos por separación Acumulable";break;
        case 68:return "Ajuste en Pagos por separación No acumulable";break;
        case 69:return "Ajuste en Jubilaciones, pensiones o haberes de retiro Acumulable";break;
        case 70:return "Ajuste en Jubilaciones, pensiones o haberes de retiro No acumulable";break;
        case 71:return "Ajuste en Subsidio para el empleo (efectivamente entregado al trabajador)";break;
        case 72:return "Ajuste en Ingresos en acciones o títulos valor que representan bienes Exento";break;
        case 73:return "Ajuste en Ingresos en acciones o títulos valor que representan bienes Gravado";break;
        case 74:return "Ajuste en Alimentaci&oacute;n Exento";break;
        case 75:return "Ajuste en Alimentaci&oacute;n Gravado";break;
        case 76:return "Ajuste en Habitaci&oacute;n Exento";break;
        case 77:return "Ajuste en Habitaci&oacute;n Gravado";break;
        case 78:return "Ajuste en Premios por asistencia";break;
        case 79:return "Ajuste en Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados.";break;
        case 80:return "Ajuste en Vi&aacute;ticos gravados";break;
        case 81:return "Ajuste en Vi&aacute;ticos (entregados al trabajador)";break;
        case 82:return "Ajuste en Fondo de ahorro Gravado";break;
        case 83:return "Ajuste en Caja de ahorro Gravado";break;
        case 84:return "Ajuste en Prima de Seguro de vida Gravado";break;
        case 85:return "Ajuste en Seguro de Gastos Médicos Mayores Gravado";break;
        case 86:return "Ajuste en Subsidios por incapacidad Gravado";break;
        case 87:return "Ajuste en Becas para trabajadores y/o hijos Gravado";break;
        case 88:return "Ajuste en Seguro de retiro Gravado";break;
        case 89:return "Ajuste en Vales de despensa Gravado";break;
        case 90:return "Ajuste en Vales de restaurante Gravado";break;          
        case 91:return "Ajuste en Vales de gasolina Gravado";break;          
        case 92:return "Ajuste en Vales de ropa Gravado";break;          
        case 93:return "Ajuste en Ayuda para renta Gravado";break;          
        case 94:return "Ajuste en Ayuda para artículos escolares Gravado";break;          
        case 95:return "Ajuste en Ayuda para anteojos Gravado";break;          
        case 96:return "Ajuste en Ayuda para transporte Gravado";break;          
        case 97:return "Ajuste en Ayuda para gastos de funeral Gravado";break;          
        case 98:return "Ajuste a ingresos asimilados a salarios gravados";break;          
        case 99:return "Ajuste a ingresos por sueldos y salarios gravados";break;          
        case 100:return "Ajuste en Vi&aacute;ticos exentos";break;          
      }
    }
    else
    {
      //otros pagos
      switch(parseInt(TipoSAT))
      {
        case 1:return "Reintegro de ISR pagado en exceso (siempre que no haya sido enterado al SAT).";break;
        case 2:return "Subsidio para el empleo (efectivamente entregado al trabajador).";break;
        case 3:return "Viáticos (entregados al trabajador).";break;
        case 4:return "Aplicación de saldo a favor por compensación anual.";break;
        case 999:return "Pagos distintos a los listados y que no deben considerarse como ingreso por sueldos, salarios o ingresos asimilados.";break;
      }
    }
  }
  return "";
}

$(document).on("keyup", "#CuentaBancaria", function (){
  var cuantos = $(this).val().trim().length;
  if(cuantos==10)
  {
    $("#CuentaBancariaMensaje").html("Celular");
    return;
  }
  if(cuantos==11)
  {
    $("#CuentaBancariaMensaje").html("Cuenta Bancaria");
    return;
  }
  if(cuantos==15 || cuantos == 16)
  {
    $("#CuentaBancariaMensaje").html("Tarjeta bancaria");
    return;
  }
  if(cuantos==18)
  {
    $("#CuentaBancariaMensaje").html("CLABE");
    return;
  }
   $("#CuentaBancariaMensaje").html("No se ha detectado un valor, no lo guardes asi, debe de ser un celular a 10 dígitos, o una cuenta bancaria a 11 dígitos, o una tarjeta a 16 ó 15 dígitos, o la CLABE a 18 dígitos.");
});
$(document).on("click", "#descargarConcentradoEmpleados", function (){
    window.open(
      "/descargarConcentradoEmpleados",
      '_blank'
    );
});

$(document).on("change", "#selectCampo", function (){
  cargaERDatosPersonas();
});
$(document).on("click", "#datosPersonasManuntencion", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Datos de persona para timbrar manuntenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Datos de persona para timbrar manuntenci&oacute;n <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                 '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="descargarConcentradoEmpleados"  class="btn btn-success">Descargar concentrado de empleados</button>'+
                      '</div>'+
                  '</div>';
  var USUARIOACTUAL = $("#USUARIOACTUAL").html();
  if(USUARIOACTUAL=="MPJ")
  {
    cad=cad+ '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<select id="selectCampo" style="font-size:16px;">'+
                        '<option value="M41">Baja Nte</option>'+
                        '<option value="M4R">Baja Sur</option>'+
                        '<option value="MK1">Chihuahua</option>'+
                        '<option value="MG1">Golfo</option>'+
                        '<option value="MM1">Noreste</option>'+
                        '<option value="MUR">Noroccidental</option>'+
                        '<option value="MP1">Norte de Tamaulipas</option>'+
                        '<option value="MU1">Occidente</option>'+
                        '<option value="MS1">Sinaloa</option>'+
                        '<option value="MN1">Sonora</option>'+
                        '<option value="MR1">Regiomontana</option>'+
                        '<option value="M11">Union</option>'+
                        '<option value="FOP">FOP</option>'+
                        '</select>'+
                      '</div>'+
                  '</div><br><br>';
  }
                  cad = cad+'<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="selectPersonaManuntencion">Persona:</label>'+
                          '<select id="selectPersonaManuntencion" class="form-control" required="" >'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div id="noSeVe" style="display:none;">'+
                    '<div class="ln-solid"></div>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="manutencionLabel">Pcent Manutencion:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="PCENT_Manutencion"   id="PCENT_Manutencion" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="posgradoLabel">Pcent Posgrado:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="PCENT_Posgrado"   id="PCENT_Posgrado" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="ministerialLabel">Pcent Ministerial:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="PCENT_Ministerial"   id="PCENT_Ministerial" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="pulpitoLabel">Pcent Pulpito:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="PCENT_Pulpito"   id="PCENT_Pulpito" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="extraordinariaLabel">Pcent Extraordinaria:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="PCENT_Extraordinaria"   id="PCENT_Extraordinaria" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;" id="rentaLabel">Ayuda de renta (ejemplo: 4500):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="ayuda_renta"   id="ayuda_renta" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                     '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Unidades de seguro M&D (ejemplo: 2):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="unidades_seguro"   id="unidades_seguro" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Funcion de sunplus: </label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="proyecto" id="proyecto" class="form-control col-md-10 " style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="ln-solid"></div>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Correo:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="email" name="correo" maxlength="150"  id="correo" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3">Nombre:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="nombre" maxlength="150" id="nombre" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">RFC:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="rfc" maxlength="15"  id="rfc" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">CURP:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="curp" maxlength="20"  id="curp" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">N&uacute;mero de empleado: (3 cifras)</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="numEmpleado" maxlength="3"  id="numEmpleado" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_Pais">Pais:</label>'+
                          '<select id="c_Pais" class="form-control" required="" >'+
                          '<option value="MEX">M&eacute;xico</option>'+
                          '<option value="USA">Estados Unidos</option>'+
                          '<option value="CAN">C&aacute;nada</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_Estado">Estado:</label>'+
                          '<select id="c_Estado" class="form-control" required="" >'+
                          '<option value="AGU">Aguascalientes</option>'+
                          '<option value="BCN">Baja Norte</option>'+
                          '<option value="BCS">Baja Sur</option>'+
                          '<option value="CAM">Campeche</option>'+
                          '<option value="CHP">Chiapas</option>'+
                          '<option value="CHH">Chihuahua</option>'+
                          '<option value="COA">Coahuila</option>'+
                          '<option value="COL">Colima</option>'+
                          '<option value="DIF">Ciudad de M&eacute;xico</option>'+
                          '<option value="DUR">Durango</option>'+
                          '<option value="GUA">Guanajuato</option>'+
                          '<option value="GRO">Guerrero</option>'+
                          '<option value="HID">Hidalgo</option>'+
                          '<option value="JAL">Jalisco</option>'+
                          '<option value="MEX">M&eacute;xico</option>'+
                          '<option value="MIC">Michoac&aacute;n</option>'+
                          '<option value="MOR">Morelos</option>'+
                          '<option value="NAY">Nayarit</option>'+
                          '<option value="NLE">Nuevo Le&oacute;n</option>'+
                          '<option value="OAX">Oaxaca</option>'+
                          '<option value="PUE">Puebla</option>'+
                          '<option value="QUE">Quer&eacute;taro</option>'+
                          '<option value="ROO">Quintana Roo</option>'+
                          '<option value="SLP">San Luis Potos&iacute;</option>'+
                          '<option value="SIN">Sinaloa</option>'+
                          '<option value="SON">Sonora</option>'+
                          '<option value="TAB">Tabasco</option>'+
                          '<option value="TAM">Tamaulipas</option>'+
                          '<option value="TLA">Tlaxcala</option>'+
                          '<option value="VER">Veracruz</option>'+
                          '<option value="YUC">Yucat&aacute;n</option>'+
                          '<option value="ZAC">Zacatecas</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoContrato">Tipo de contrato:</label>'+
                          '<select id="TipoContrato" class="form-control" required="" >'+
                          '<option value="01">Contrato de trabajo por tiempo indeterminado</option>'+
                          '<option value="02">Contrato de trabajo para obra determinada</option>'+
                          '<option value="03">Contrato de trabajo por tiempo determinado</option>'+
                          '<option value="04">Contrato de trabajo por temporada</option>'+
                          '<option value="05">Contrato de trabajo sujeto a prueba</option>'+
                          '<option value="06">Contrato de trabajo con capacitación inicial</option>'+
                          '<option value="07">Modalidad de contratación por pago de hora laborada</option>'+
                          '<option value="08">Modalidad de trabajo por comisi&oacute;n laboral</option>'+
                          '<option value="09">Modalidades de contratación donde no existe relación de trabajo</option>'+
                          '<option value="10">Jubilaci&oacute;n, pensi&oacute;n, retiro.</option>'+
                          '<option value="99">Otro contrato</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoJornada">Tipo de jornada:</label>'+
                          '<select id="TipoJornada" class="form-control" required="" >'+
                          '<option value="01">Diurna</option>'+
                          '<option value="02">Nocturna</option>'+
                          '<option value="03">Mixta</option>'+
                          '<option value="04">Por hora</option>'+
                          '<option value="05">Reducida</option>'+
                          '<option value="06">Continuada</option>'+
                          '<option value="07">Partida</option>'+
                          '<option value="08">Por turnos</option>'+
                          '<option value="99">Otra Jornada</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">N&uacute;mero de seguridad social:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="NumSeguridadSocial" maxlength="15"  id="NumSeguridadSocial" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Fecha de inicio de relacion laboral:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="FechaInicioRelLaboral" placeholder="Fecha de inicio" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="RiesgoPuesto">Riesgo de puesto:</label>'+
                          '<select id="RiesgoPuesto" class="form-control" required="" >'+
                          '<option value="">Seleccione una opción</option>'+
                          '<option value="1">Clase I</option>'+
                          '<option value="2">Clase II</option>'+
                          '<option value="3">Clase III</option>'+
                          '<option value="4">Clase IV</option>'+
                          '<option value="5">Clase V</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="PeriodicidadPago">Periodicidad de pago:</label>'+
                          '<select id="PeriodicidadPago" class="form-control" required="" >'+
                          '<option value="01">Diario</option>'+
                          '<option value="02">Semanal</option>'+
                          '<option value="03">Catorcenal</option>'+
                          '<option value="04">Quincenal</option>'+
                          '<option value="05">Mensual</option>'+
                          '<option value="06">Bimestral</option>'+
                          '<option value="07">Unidad obra</option>'+
                          '<option value="08">Comisi&oacute;n</option>'+
                          '<option value="09">Precio alzado</option>'+
                          '<option value="10">Decenal</option>'+
                          '<option value="99">Otra Periodicidad</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="Departamento">Departamento:</label>'+
                          '<select id="Departamento" class="form-control" required="" >'+
                          '<option value="MINISTROS DE CULTO">MINISTROS DE CULTO</option>'+
                          '<option value="ASOCIADOS RELIGIOSOS">ASOCIADOS RELIGIOSOS</option>'+
                          '<option value="TRABAJADORES">TRABAJADORES</option>'+
                          '<option value="EMERITOS">EMERITOS</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoRegimen">Tipo de Regimen:</label>'+
                          '<select id="TipoRegimen" class="form-control" required="" >'+
                          '<option value="02">Sueldos</option>'+
                          '<option value="03">Jubilados</option>'+
                          '<option value="04">Pensionados</option>'+
                          '<option value="05">Asimilados Miembros Sociedades Cooperativas Produccion</option>'+
                          '<option value="06">Asimilados Integrantes Sociedades Asociaciones Civiles</option>'+
                          '<option value="07">Asimilados Miembros consejos</option>'+
                          '<option value="08">Asimilados comisionistas</option>'+
                          '<option value="09">Asimilados Honorarios</option>'+
                          '<option value="10">Asimilados acciones</option>'+
                          '<option value="11">Asimilados otros</option>'+
                          '<option value="99">Otro Regimen</option>'+
                          '</select></p>'+
                    '</div>'+
                     '<br><br>'+
                    '<div class="form-group">'+
                    '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Cuenta bancaria:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="CuentaBancaria" maxlength="18"  id="CuentaBancaria" class="form-control col-md-10" style="float: right;" />'+
                        '</div>'+
                        '<label id="CuentaBancariaMensaje" class="control-label col-md-12 col-sm-12 col-xs-12" style="float:left;"></label>'+
                    '</div>'+
                     '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_Banco">Banco donde se le deposita:</label>'+
                          '<select id="c_Banco" class="form-control" required="" >'+
                          '<option value="002">BANAMEX</option>'+
                          '<option value="006">BANCOMEXT</option>'+
                          '<option value="009">BANOBRAS</option>'+
                          '<option value="012">BBVA BANCOMER</option>'+
                          '<option value="014">SANTANDER</option>'+
                          '<option value="019">BANJERCITO</option>'+
                          '<option value="021">HSBC</option>'+
                          '<option value="030">BAJIO</option>'+
                          '<option value="032">IXE</option>'+
                          '<option value="036">INBURSA</option>'+
                          '<option value="037">INTERACCIONES</option>'+
                          '<option value="042">MIFEL</option>'+
                          '<option value="044">SCOTIABANK</option>'+
                          '<option value="058">BANREGIO</option>'+
                          '<option value="059">INVEX</option>'+
                          '<option value="060">BANSI</option>'+
                          '<option value="062">AFIRME</option>'+
                          '<option value="072">BANORTE</option>'+
                          '<option value="137">BANCOPPEL</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Salario diario integrado:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="SDI"  id="SDI" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="nuevoOModificaManuntencionPersona"  class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                    '</div>'+//div no se ve
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
  cargaERDatosPersonas();      
 });

function cargaERDatosPersonas() {
  var BUNITACTUAL = $("#BUNITACTUAL").html();
  var USUARIOACTUAL = $("#USUARIOACTUAL").html();
      if(USUARIOACTUAL=="MPJ")
      {
        BUNITACTUAL = $("#selectCampo").val();
      }
      var param = {BUNIT : BUNITACTUAL};
      $.ajax({
        url: "/cargaER",
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var i, cad= '';
            var aver2 = Object.keys(resp.personas);
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<option value="'+resp.personas[aver2[i]].ANL_CODE+'">'+resp.personas[aver2[i]].NAME+'</option>';
            }
            $("#selectPersonaManuntencion").html(cad);
          }
        }
      });
      
       $('#FechaInicioRelLaboral').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1",
          locale: {
              format: 'DD/MM/YYYY'
          }

        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });

       $('#FechaInicioRelLaboral').on('apply.daterangepicker', function(ev, picker) {
        console.log(picker.startDate.format('DD/MM/YYYY'));
        console.log(picker.endDate.format('DD/MM/YYYY'));
        var hola = picker.endDate.format('DD/MM/YYYY');
        $('#FechaInicioRelLaboral').val(hola);
      });
}
$(document).on("change", "#Departamento", function (){
  var depa = $(this).val();
  if(depa=="EMERITOS")
  {
    $("#manutencionLabel").html("Pensi&oacute;n:");
    $("#posgradoLabel").html("Bono condicional:");
    $("#ministerialLabel").html("Ayuda de renta:");
    $("#pulpitoLabel").html("Bono de conyugue:");
    $("#extraordinariaLabel").html("Bono de navidad:");
    $("#rentaLabel").html("Seguro de sobreviviente:");
  }
  else
  {
    $("#manutencionLabel").html("Pcent Manutenci&oacute;n:");
    $("#posgradoLabel").html("Pcent Posgrado:");
    $("#ministerialLabel").html("Pcent Ministerial:");
    $("#pulpitoLabel").html("Pcent pulpito:");
    $("#extraordinariaLabel").html("Pcent Extraordinaria:");
    $("#rentaLabel").html("Ayuda de renta (ejemplo: 4500):"); 
  }

  });
  $(document).on("click", "#nuevoOModificaManuntencionPersona", function (){
    var PCENT_Manutencion = $("#PCENT_Manutencion").val().trim();
    if(PCENT_Manutencion=="")
    {
        alert("Te falta de indicar el PCENT_Manutencion, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var PCENT_Posgrado = $("#PCENT_Posgrado").val().trim();
    if(PCENT_Posgrado=="")
    {
        alert("Te falta de indicar el PCENT_Posgrado, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var PCENT_Ministerial = $("#PCENT_Ministerial").val().trim();
    if(PCENT_Ministerial=="")
    {
        alert("Te falta de indicar el PCENT_Ministerial, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var PCENT_Pulpito = $("#PCENT_Pulpito").val().trim();
    if(PCENT_Pulpito=="")
    {
        alert("Te falta de indicar el PCENT_Pulpito, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var PCENT_Extraordinaria = $("#PCENT_Extraordinaria").val().trim();
    if(PCENT_Extraordinaria=="")
    {
        alert("Te falta de indicar el PCENT_Extraordinaria, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var ayuda_renta = $("#ayuda_renta").val().trim();
    if(ayuda_renta=="")
    {
        alert("Te falta de indicar el ayuda_renta, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var unidades_seguro = $("#unidades_seguro").val().trim();
    if(unidades_seguro=="")
    {
        alert("Te falta de indicar el unidades_seguro, puedes ponerle 0 si no sabes que onda");
        return;
    }
    var proyecto = $("#proyecto").val().trim();
    if(proyecto=="")
    {
        alert("Te falta de indicar la funcion, puedes ponerle SUOPERA01 si no sabes que onda");
        return;
    }


    var er = $("#selectPersonaManuntencion").val();
    var TipoRegimen = $("#TipoRegimen").val();
    var TipoRegimenInt = parseInt($("#TipoRegimen").val());

    var c_Banco = $("#c_Banco").val();
    var CuentaBancaria = $("#CuentaBancaria").val().trim();
    if(CuentaBancaria=="")
    {
        alert("Te falta de indicar la CuentaBancaria");
        return;
    }
    var CuentaBancariaCaracteres = CuentaBancaria.length;
    if(CuentaBancariaCaracteres==11 || CuentaBancariaCaracteres==10 || CuentaBancariaCaracteres==15 ||CuentaBancariaCaracteres==16 || CuentaBancariaCaracteres==18)
    {
      // ok.. be happy
    }
    else
    {
      alert("El valor de cuenta bancaria debe de ser un celular, cuenta bancaria, CLABE o Tarjeta");
      return;
    }

    
    var Departamento = $("#Departamento").val();
    var PeriodicidadPago = $("#PeriodicidadPago").val();
    var RiesgoPuesto = $("#RiesgoPuesto").val();
     var TipoContratoInt = parseInt($("#TipoContrato").val());

    if(TipoContratoInt<=8)
    {
      if(RiesgoPuesto=="")
      {
        alert("Te falta de indicar el Riesgo puesto para ese tipo de contrato");
        return;
      }
    }
    var TipoJornada = $("#TipoJornada").val();
    var TipoContrato = $("#TipoContrato").val();

   
     if (TipoContratoInt >= 1 && TipoContratoInt <= 8) {
            if (TipoRegimenInt==2 || TipoRegimenInt==3 || TipoRegimenInt==4) {
                // dont warry, be happy
            } else {
                alert("NOM177; El atributo Nomina.Receptor.TipoRegimen no es 02, 03 ó 04. Para el TipoContrato 01-08 el TipoRegimen debe de ser 02, 03 o 04");
                return ;
            }
        }
    var SDI = $("#SDI").val();
    if(TipoContratoInt<=8)
    {
      if(SDI=="")
      {
        alert("Te falta de indicar el salario diario integrado");
        return;
      }
    }
    
    
    
    var FechaInicioRelLaboral = $("#FechaInicioRelLaboral").val();
    if(TipoContratoInt<=8)
    {
      if(FechaInicioRelLaboral=="")
      {
        alert("Te falta de indicar la fecha de inicio de relacion laboral");
        return;
      }
    }

    var anio = FechaInicioRelLaboral.substring(6,10);
    var mes = FechaInicioRelLaboral.substring(3,5);
    var dia = FechaInicioRelLaboral.substring(0,2);
    FechaInicioRelLaboral = dia+"/"+mes+"/"+anio; // anio+"-"+mes+"-"+dia;
   console.log(FechaInicioRelLaboral);
   
    var NumEmpleado = $("#numEmpleado").val();
    if(NumEmpleado=="")
    {
      alert("Te falta de indicar el numero de empleado, recuerda que es de tres cifras, por ejemplo: 001");
      return;
    }
    var CURP = $("#curp").val();
    if(CURP=="")
    {
      alert("Te falta de indicar el CURP");
      return;
    }
    var RFC = $("#rfc").val();
    if(RFC=="")
    {
      alert("Te falta de indicar el RFC");
      return;
    }
    var Nombre = $("#nombre").val();
    if(Nombre=="")
    {
      alert("Te falta de indicar el nombre");
      return;
    }
    var Correo = $("#correo").val();
    if(Correo=="")
    {
      alert("Te falta de indicar el correo");
      return;
    }
    var NumSeguridadSocial = $("#NumSeguridadSocial").val();
    if(NumSeguridadSocial=="")
    {
      alert("Te falta de indicar el numero de seguridad social, no es obligatorio, se grabara como quiera");
    }
    var c_Pais = $("#c_Pais").val();
    var c_Estado = $("#c_Estado").val();
    var BUNITViejito = $("#BUNITACTUAL").html();
    var USUARIOACTUAL = $("#USUARIOACTUAL").html();
    if(USUARIOACTUAL=="MPJ")
    {
      BUNITViejito = $("#selectCampo").val();
    }
  
    var param = {BUNITViejito : BUNITViejito, CuentaBancaria: CuentaBancaria, er: er, c_Banco : c_Banco, TipoRegimen: TipoRegimen, Departamento: Departamento, PeriodicidadPago: PeriodicidadPago, RiesgoPuesto: RiesgoPuesto, TipoJornada : TipoJornada, TipoContrato : TipoContrato , FechaInicioRelLaboral : FechaInicioRelLaboral, NumSeguridadSocial : NumSeguridadSocial, NumEmpleado : NumEmpleado, CURP : CURP, RFC : RFC, Nombre : Nombre, Correo : Correo, SDI : SDI, c_Estado : c_Estado, c_Pais : c_Pais, PCENT_Manutencion:PCENT_Manutencion, PCENT_Posgrado : PCENT_Posgrado, PCENT_Ministerial:PCENT_Ministerial, PCENT_Pulpito : PCENT_Pulpito , PCENT_Extraordinaria : PCENT_Extraordinaria, unidades_seguro : unidades_seguro, ayuda_renta : ayuda_renta, proyecto: proyecto};
       $.ajax({
        url: "/nuevoOModificaManuntencionPersona",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Se guardo la informacion correctamente");
            //actualizaTablaDeLineasInforme();
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
    
  });


$(document).on("change", "#selectPersonaManuntencion", function (){
  var ERSeleccionado = $(this).val();
  var BUNITViejito = $("#BUNITACTUAL").html();
    var USUARIOACTUAL = $("#USUARIOACTUAL").html();
    if(USUARIOACTUAL=="MPJ")
    {
      BUNITViejito = $("#selectCampo").val();
    }
   var param = {ER: ERSeleccionado, BUNITViejito : BUNITViejito};
       $.ajax({
        url: "/cargaInfoManuntencionPersona",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){

          if(resp.success==1)
          {
            $("#PCENT_Manutencion").val(resp.PCENT_Manutencion);
            $("#PCENT_Posgrado").val(resp.PCENT_Posgrado);
            $("#PCENT_Ministerial").val(resp.PCENT_Ministerial);
            $("#PCENT_Pulpito").val(resp.PCENT_Pulpito);
            $("#PCENT_Extraordinaria").val(resp.PCENT_Extraordinaria);
            $("#ayuda_renta").val(resp.ayuda_renta);
            $("#unidades_seguro").val(resp.unidades_seguro);
            $("#proyecto").val(resp.proyecto);
            $("#CuentaBancaria").val(resp.CuentaBancaria);
           $("#rfc").val(resp.rfc);
           $("#correo").val(resp.correo);
           $("#c_Estado").val(resp.c_Estado);
           $("#c_Pais").val(resp.c_Pais);
           $("#nombre").val(resp.nombre);
           $("#curp").val(resp.curp);
           $("#numEmpleado").val(resp.numEmpleado);
           $("#TipoContrato").val(resp.TipoContrato);
           $("#TipoJornada").val(resp.TipoJornada);
           $("#NumSeguridadSocial").val(resp.NumSeguridadSocial);
           var FechaInicioRelLaboral = resp.FechaInicioRelLaboral
           var anio = FechaInicioRelLaboral.substring(0,4);
           var mes = FechaInicioRelLaboral.substring(5,7);
           var dia = FechaInicioRelLaboral.substring(8,10);
//           FechaInicioRelLaboral = dia +"/"+mes+"/"+anio;
           console.log(FechaInicioRelLaboral);
           $("#FechaInicioRelLaboral").val(FechaInicioRelLaboral);
           $("#FechaInicioRelLaboralManual").val(FechaInicioRelLaboral);
           $("#RiesgoPuesto").val(resp.RiesgoPuesto);
           $("#PeriodicidadPago").val(resp.PeriodicidadPago);
           $("#Departamento").val(resp.Departamento);
           $("#TipoRegimen").val(resp.TipoRegimen);
           $("#c_Banco").val(resp.c_Banco);
           $("#SDI").val(resp.SDI);
           $("#noSeVe").css("display","block");
          }
          if(resp.success==2)
          {
            //todavia no hay registros de esa persona
             $("#rfc").val("");
             $("#correo").val("");
             $("#nombre").val("");
             $("#curp").val("");
             $("#SDI").val("");
             $("#numEmpleado").val("");
             //$("#TipoContrato").val(resp.TipoContrato);
             //$("#TipoJornada").val(resp.TipoJornada);
             $("#NumSeguridadSocial").val("");
             $("#CuentaBancaria").val("");
            
             $("#FechaInicioRelLaboral").val("");
             //$("#RiesgoPuesto").val(resp.RiesgoPuesto);
             //$("#PeriodicidadPago").val(resp.PeriodicidadPago);
             //$("#Departamento").val(resp.Departamento);
             //$("#TipoRegimen").val(resp.TipoRegimen);
            $("#noSeVe").css("display","block");
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });
  
});
$(document).on("click", "#asignarDimension", function (){

    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Tipo de dimensiones</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Tipo de dimensiones <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<p><label for="TipoDondeEstaranLasDimensiones">Tipo:</label>'+
                          '<select id="TipoDondeEstaranLasDimensiones" class="form-control" required="" >'+
                          '<option value="0">Seleccione una opci&oacute;n</option>'+
                          '<option value="901">Dimensiones para diarios</option>'+
                          '<option value="204">Dimensiones para activos</option>'+
                          '<option value="152">Dimensiones para cuentas</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="entry1">Dimensi&oacute;n 1:</label>'+
                          '<select id="entry1" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry2">Dimensi&oacute;n 2:</label>'+
                          '<select id="entry2" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry3">Dimensi&oacute;n 3:</label>'+
                          '<select id="entry3" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry4">Dimensi&oacute;n 4:</label>'+
                          '<select id="entry4" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry5">Dimensi&oacute;n 5:</label>'+
                          '<select id="entry5" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry6">Dimensi&oacute;n 6:</label>'+
                          '<select id="entry6" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry7">Dimensi&oacute;n 7:</label>'+
                          '<select id="entry7" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry8">Dimensi&oacute;n 8:</label>'+
                          '<select id="entry8" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry9">Dimensi&oacute;n 9:</label>'+
                          '<select id="entry9" class="form-control" required="" ></select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="entry10">Dimensi&oacute;n 10:</label>'+
                          '<select id="entry10" class="form-control" required="" ></select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarClasificacionDimensiones" ANL_CAT_ID="-1" class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaClasificacionDimensiones();
 });





$(document).on("click", "#corregirDiferenciasEntreAMT_Y_OTHAMT", function (){
  $.ajax({
      url: "/corrigeDiariosDiferencias",
      dataType : "json",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
          if(resp.success==1)
          {
            alert("Ya se corrigieron las diferencias");
            tablaDiariosDiferencias();
          }
        }
      });
});

function tablaImpuestos()
{
  $.ajax({
      url: "/tablaImpuestos",
      dataType : "json",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
          if(resp.success==1)
          {
            var i, j;
            var cad = '';
            var palabra = '';
            var aver2 = Object.keys(resp.impuestos);
            for(i=0;i<aver2.length;i++)
            {
              var aver3 = Object.keys(resp.impuestos[aver2[i]].ImpuestosList);
              if(parseInt(aver2[i])==1)
              {
                palabra="Gastos";
              }
              else
              {
                palabra="Ingreso";
              }
              for(j=0;j<aver3.length;j++)
              {
                cad=cad+'<tr class="detalleImpuesto" style="cursor:pointer;" anio="'+resp.anio+'" rfc="'+resp.rfc+'" impuesto="'+aver3[j]+'"><td>'+aver3[j]+'</td><td>'+resp.impuestos[aver2[i]].ImpuestosList[aver3[j]].Importe+'</td><td>'+palabra+'</td></tr>';
              }
            }
            $("#tablaImpuestos").html(cad);
          }
        }
      });
}

$(document).on("click", ".detalleImpuesto", function (){
    var impuesto = $(this).attr("impuesto");
    var anio = $(this).attr("anio");
    var rfc = $(this).attr("rfc");
    var param = {impuesto : impuesto, anio : anio, rfc : rfc}
    $.ajax({
      url: "/tablaImpuestosDetalle",
      dataType : "json",
      type : "post",
      data : param,
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
          if(resp.success==1)
          {
          }
        }
      });
  });

$(document).on("click", "#impuestos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Impuestos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Tabla impuestos</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Impuesto</th><th>Importe</th><th>Tipo</th></thead>'+
                        '<tbody id="tablaImpuestos"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      tablaImpuestos();
 });


$(document).on("click", "#diferenciaEntreCantidades", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diferencia entre cantidades</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Diferencia entre cantidades <small>AMOUNT vs OTHER_AMOUNT</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="corregirDiferenciasEntreAMT_Y_OTHAMT" class="btn btn-success">Corregir</button>'+
                      '</div>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Diario-Linea</th><th>Cuenta</th><th>Descripci&oacute;n</th><th>Referencia</th><th>Fecha</th><th>Periodo</th><th>Cantidad</th><th>Otra Cantidad</th></thead>'+
                        '<tbody id="tablaDiariosDiferencias"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      tablaDiariosDiferencias();
 });
function tablaDiariosDiferencias()
{
    $.ajax({
      url: "/tablaDiariosDiferencias",
      dataType : "json",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
          if(resp.success==1)
          {
            var i;
            var cad='';
            var aver2 = Object.keys(resp.diferencias);
            for(i=0;i<aver2.length;i++)
            {
              cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diferencias[aver2[i]].Diario+'">'+resp.diferencias[aver2[i]].Diario+'-'+resp.diferencias[aver2[i]].Linea+'</a></td>'+
              '<td>'+resp.diferencias[aver2[i]].ACNT_CODE+'</td>'+
              '<td>'+resp.diferencias[aver2[i]].DESCRIPTN+'</td>'+
              '<td>'+resp.diferencias[aver2[i]].TREFERENCE+'</td>'+
              '<td>'+resp.diferencias[aver2[i]].TRANS_DATETIME+'</td>'+
              '<td>'+resp.diferencias[aver2[i]].PERIOD+'</td>'+
              '<td>'+format3(resp.diferencias[aver2[i]].AMOUNT,'$')+'</td>'+
              '<td>'+format3(resp.diferencias[aver2[i]].OTH_AMOUNT,'$')+'</td></tr>';
            }
            $("#tablaDiariosDiferencias").html(cad);
          } 
        }
      });
}





$(document).on("click", "#buscarPorReferencia", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver diarios por cantidad</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios por referencia</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Escribe la referencia:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="referencia"  id="referencia" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="buscarDiarioReferenciaButton" class="btn btn-success">Buscar</button>'+
                      '</div>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Diario</th><th>Linea</th><th>Cantidad</th><th>D_C</th><th>Fecha</th><th>Periodo</th><th>Descripci&oacute;n</th><th>Referencia</th></thead>'+
                        '<tbody id="tablaDiariosPorCantidad"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });


$(document).on("click", "#buscarPorCantidadSuma", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver diarios por cantidad</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios por cantidad</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Escribe la cantidad en numero:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="cantidad"  id="cantidad" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="buscarPorCantidadSumaButton" class="btn btn-success">Buscar</button>'+
                      '</div>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Diario</th><th>Linea</th><th>Cantidad</th><th>D_C</th><th>Fecha</th><th>Periodo</th><th>Descripci&oacute;n</th><th>Referencia</th></thead>'+
                        '<tbody id="tablaDiariosPorCantidad"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });


$(document).on("click", "#buscarPorCantidad", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver diarios por cantidad</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios por cantidad</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Escribe la cantidad en numero:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="cantidad"  id="cantidad" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="buscarDiarioCantidadButton" class="btn btn-success">Buscar</button>'+
                      '</div>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Diario</th><th>Linea</th><th>Cantidad</th><th>D_C</th><th>Fecha</th><th>Periodo</th><th>Descripci&oacute;n</th><th>Referencia</th></thead>'+
                        '<tbody id="tablaDiariosPorCantidad"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });


$(document).on("click", ".cargarDeCarpetaXMLBancosDetalleSPEI", function (){
  var status = $(this).attr("status");
  var param = {status : status};
  $.ajax({
    url: "/cargarDeCarpetaXMLBancosDetalleSPEI",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("Exitosos: "+resp.cuantosRegistros+"   ERRORES: "+resp.cuantosErrores+" Archivos procesados: "+resp.archivosProcesados+" CuantosNoSeEncontro idBanco: "+resp.cuantosNoEncontre);
      }
    }
  });
});



$(document).on("click", ".cargarDeCarpetaTXTBancosBanorte", function (){
  $.ajax({
    url: "/cargarDeCarpetaTXTBancosBanorte",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("Exitosos: "+resp.cuantosRegistros+"   Cuantos ya existian: "+resp.cuantosYaExistian+"   ERRORES: "+resp.cuantosErrores+" Archivos procesados: "+resp.archivosProcesados);
      }
    }
  });
});

$(document).on("click", ".cargarDeCarpetaTXTBancos", function (){
  $.ajax({
    url: "/cargarDeCarpetaTXTBancos",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("Exitosos: "+resp.cuantosRegistros+"   Cuantos ya existian: "+resp.cuantosYaExistian+"   ERRORES: "+resp.cuantosErrores+" Archivos procesados: "+resp.archivosProcesados);
      }
    }
  });
});

$(document).on("click", ".cargarDeCarpetaXMLBancos", function (){
  var status = $(this).attr("status");
  var param = {status : status};
  $.ajax({
    url: "/cargarDeCarpetaXMLBancos",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("Exitosos: "+resp.cuantosRegistros+"   ERRORES: "+resp.cuantosErrores+" Archivos procesados: "+resp.archivosProcesados);
      }
    }
  });
});

$(document).on("change", "#archivoXML", function (){
 var fileName = $('#archivoXML').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'xml' || extension == 'XML' )
  {
     var files = document.getElementById('archivoXML').files;
    if (!files.length) {
      alert('Please select a file!');
      return;
    }

    var file = files[0];
    var start =  0;
    var stop = file.size - 1;

    var reader = new FileReader();

    // If we use onloadend, we need to check the readyState.
    reader.onloadend = function(evt) {
      if (evt.target.readyState == FileReader.DONE) { // DONE == 2
        //document.getElementById('byte_content').textContent = 
        //alert(evt.target.result);
        var param = {xml: evt.target.result};
         $.ajax({
          url: "/xml2sql",
          dataType : "json",
          type : "post",
          async : true,
          data : param,
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
              if(resp.success==1)
              {
                alert("Exitosos: "+resp.cuantosRegistros+"   ERRORES: "+resp.cuantosErrores);
              }
            }
          });
      }
    };

    var blob = file.slice(start, stop + 1);
    reader.readAsBinaryString(blob);
  }
  else
  {
    alert("Solo se permiten archivos XML")
  }



   

/*


  var fileName = $('#archivoXML').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'xml' || extension == 'XML' )
  {
    var tipo = $('#selectTipoXML').val();
     var r = new FileReader();
      r.onload = function(e) { 
      //  var contents = e.target.result;
      //  var xmlDoc = $.parseXML( contents ),
       // var $xml = $( xmlDoc );
       // var $title = $xml.find( "title" );
       alert("C:"+contents);

      };
      var texto = r.readAsText($('#archivoXML')[0].files[0]);
      alert("T:"+texto);
  }
  else
  {
    alert("Solo se permiten archivos XML")
  }
  */
});


$(document).on("click", "#generarCSVconXMLDetalleSPEI", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Arreglar XML Detalle SPEI</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Arreglar XML Detalle SPEI<small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<div id="loadingCampos"/>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Archivo XML:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="archivoXMLDetalleSPEI"  id="archivoXMLDetalleSPEI" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                        '<div class="row">'+
                          '<div class="form-group">'+
                           '<label class="control-label col-md-3 col-sm-3 col-xs-3">Cargar sin saber si es de abonos o cargos:</label>'+
                            '<div class="col-md-6 col-sm-6 col-xs-6">'+
                              '<button type="submit" status="-1"  class="btn btn-success cargarDeCarpetaXMLBancosDetalleSPEI">Cargar de C:/work/src/sevenplus/static/bancos/xml</button>'+
                            '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });



$(document).on("click", "#generarCSVconTXT", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subir movimientos con TXT</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Subir movimientos con TXT<small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<div id="loadingCampos"/>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="font-size:20px">Archivo TXT Formato Banorte:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="txtBanorte"  id="txtBanorte" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                      '</div>'+
                      '<br><br><hr><br><br>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="font-size:20px">Archivo TXT Formato Scotiabank:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="txtScotiabank"  id="txtScotiabank" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                      '</div>'+
                      '<br><br><hr><br><br>'+
                      '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });


$(document).on("click", "#subirTicketEmpresarial", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subir ticket empresarial</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Subir ticket empresarial<small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<div id="loadingCampos"/>'+
                      '</div><br><hr><br>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Archivo CSV tarjetas empresariales:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="ticketCSV"  id="ticketCSV" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                      '</div>'+
                      '<br><hr><br>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Archivo XML:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="ticket"  id="ticket" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });

$(document).on("click", "#generarCSVconXML", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Generar CSV con XML</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Generar CSV con XML<small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<div id="loadingCampos"/>'+
                      '<div class="form-group">'+
                        '<select id="selectTipoXML" class="col-md-12 col-sm-12 col-xs-12" style="font-size:20px;">'+
                          '<option value="ABONO">Es XML de ABONOS</option>'+
                          '<option value="CARGO">Es XML de GASTOS</option>'+
                          '<option value="2">De los 2</option>'+
                        '</select>'+
                      '</div>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Archivo XML:</label><span class="required">*</span>'+
                        '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="file" name="archivoXML"  id="archivoXML" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                        '<div class="row">'+
                          '<div class="form-group">'+
                           '<label class="control-label col-md-3 col-sm-3 col-xs-3">Cargar sin saber si es de abonos o cargos:</label>'+
                            '<div class="col-md-6 col-sm-6 col-xs-6">'+
                              '<button type="submit" status="-1"  class="btn btn-success cargarDeCarpetaXMLBancos">Cargar de C:/work/src/sevenplus/static/bancos/xml</button>'+
                            '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });

$(document).on("click", "#buscarRFCPorConceptos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Buscar RFC por conceptos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Buscar RFC por conceptos<small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<div id="loadingCampos"/>'+
                       '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Escribe nombre de la nueva etiqueta:</label>'+
                         '<div class="col-md-9 col-sm-9 col-xs-9">'+
                          '<input type="text" name="etiqueta" id="etiqueta" class="form-control col-md-9" style="float: right;" />'+
                         '</div>'+
                      '</div>'+
                       '<div class="form-group">'+
                        '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                          '<button type="submit" id="nuevaEtiqueta"  class="btn btn-success">Nueva etiqueta</button>'+
                        '</div>'+
                      '</div>'+
                       '<table class="table table-hover">'+
                        '<thead><tr><th>Etiqueta</th><th>Palabras</th></thead>'+
                        '<tbody id="tablaEtiquetas"></tbody>'+
                      '</table>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Selecciona la etiqueta a buscar:</label><span class="required">*</span>'+
                        '<select style="font-size:20px;" class="col-md-9 col-sm-9 col-xs-9" id="selectEtiqueta"></select>'+
                      '</div>'+
                      '<div class="form-group">'+
                        '<label class="control-label col-md-3 col-sm-3 col-xs-3">Filtrar por metodo de pago:</label><span class="required">*</span>'+
                        '<select style="font-size:20px;" class="col-md-9 col-sm-9 col-xs-9" id="selectMetodoDePago">'+
                          '<option value="01|02|03|04|05|06|07|08|28|29|98|99|Desconocido|no|a|n">Todos</option>'+
                          '<option value="02|03|04|05|06|07|08|28|29">Los electronicos (transferencias, cheque, tarjetas electronicas, vales y monederos)</option>'+
                          '<option value="01|99">Efectivo (Efectivo y otros)</option>'+
                        '</select>'+
                      '</div>'+
                      '<div class="form-group">'+
                        '<div class="col-md-12 col-sm-12 col-xs-12">'+
                          '<select id="selectUnidad" style="font-size:20px;"><option value="S">Unidad S</option><option value="C">Unidad C</option><option value="D">Unidad D</option><option value="E">Unidad E</option><option value="F">Unidad F</option></select>'+
                        '</div>'+
                      '</div>'+
                      '<div class="form-group">'+
                        '<div class="col-md-12 col-sm-12 col-xs-12">'+
                          '<select id="selectAnio" style="font-size:20px;"><option value="2015">2015</option><option value="2016" selected>2016</option><option value="2017">2017</option><option value="2018">2018</option></select>'+
                        '</div>'+
                      '</div>'+
                      '<div class="form-group">'+
                        '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                          '<button type="submit" id="buscarRFCPorConceptosBoton"  class="btn btn-success">Buscar</button>'+
                        '</div>'+
                         '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                          '<button type="submit" id="generarExcelParaDeclaracion"  class="btn btn-success">Generar Excel</button>'+
                        '</div>'+
                      '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>RFC</th><th>Razon Social</th><th>Total</th><th>SubTotal</th><th>Imp. Retenidos</th><th>Imp Trasladados</th></thead>'+
                        '<tbody id="tablaRFCConceptos"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaEtiquetas();
 });

function actualizaEtiquetas () {
   $.ajax({
        url: "/dameEtiquetas",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var i = 0, aver2 = Object.keys(resp.etiquetas), cad = '';
            var cadT = '';
            for(i=0;i<aver2.length;i++)
            {
              var cadEtiqueta = '<input type="text" placeholder="palabra" id="palabra'+aver2[i]+'" /><button type="button" idEtiqueta="'+aver2[i]+'" class="btn btn-round btn-success nuevaPalabraEtiqueta"><b>+</b></button> <br>';
              var aver3 = Object.keys(resp.etiquetas[aver2[i]].PalabrasList);
              for(j=0;j<aver3.length;j++)
              {
                cadEtiqueta=cadEtiqueta+resp.etiquetas[aver2[i]].PalabrasList[aver3[j]].Palabra+'<button type="button" IdLigadoRFC="'+resp.etiquetas[aver2[i]].PalabrasList[aver3[j]].IdLigadoRFC+'" class="btn btn-round btn-danger eliminarPalabra"><b>-</b></button><br>';
              }
              cadT = cadT + '<tr><td>'+resp.etiquetas[aver2[i]].Etiqueta+'</td><td>'+cadEtiqueta+'</td></tr>';
              cad = cad + '<option value="'+aver2[i]+'">'+resp.etiquetas[aver2[i]].Etiqueta+'</option>';
            }
            cad = cad + '<option value="-3">Complemento: Donatarias</option>';
            cad = cad + '<option value="-4">Retenciones que tienen IVA </option>';
            cad = cad + '<option value="-5">Retenciones que tienen ISR </option>';
            $('#selectEtiqueta').html(cad);
            $('#tablaEtiquetas').html(cadT);
          }
        }
      });
}


$(document).on("click", "#nuevaEtiqueta", function (){
  var etiqueta = $("#etiqueta").val().trim();
  if(etiqueta=="")
  {
    alert("Te falta escribir la etiqueta");
    return;
  }
  var param = {etiqueta : etiqueta}
   $.ajax({
    url: "/nuevaEtiqueta",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaEtiquetas();
      }
    }
  });
});
$(document).on("click", ".muestraDetalleRFC", function (){
  var rfc = $(this).attr("rfc");
  $('.espacioTabla').css("display","none");
  $('.espacioTabla[rfc="'+rfc+'"]').css("display","block");
});


$(document).on("click", ".muestraPDF", function (){
  var uuid = $(this).attr("uuid");
  var pdf = $(this).attr("pdf");
  window.open(
          "/" +pdf,
          '_blank'
        );
  /*
  var param = {uuid : uuid, pdf: pdf};
  $.ajax({
    url: "/regeneraXMLDeIngresos",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        
        window.open(
          "/" +resp.pdf,
          '_blank'
        );
      }
    }
  });
  */
});

$(document).on("click", ".verXML", function (){
  var uuid = $(this).attr("uuid");
  $.ajax({
    url: "/dameXML",
    dataType : "json",
    type : "post",
    data: {uuid : uuid},
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp2){
      if(resp2.success==1)
      {
var param = {xml : resp2.xml};
  $.ajax({
    url: "/abrirXML",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         window.open(
          "/" + resp.xml,
          '_blank'
        );
      }
    }
  });
      }
    }
  });
  

  

});


$(document).on("click", ".muestraXML", function (){
  var xml = $(this).attr("xml");
  var param = {xml : xml};
  $.ajax({
    url: "/abrirXML",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         window.open(
          "/" + resp.xml,
          '_blank'
        );
      }
    }
  });
});

$(document).on("click", ".eliminarRFCDeLaLista", function (){
  var rfc = $(this).attr("rfc");
  var total = parseFloat($('tr.normalTr[rfc="'+rfc+'"]').attr("total"));
  var subtotal = parseFloat($('tr.normalTr[rfc="'+rfc+'"]').attr("subtotal"));
  var impRetenidos = parseFloat($('tr.normalTr[rfc="'+rfc+'"]').attr("impRetenidos"));
  var impTrasladados = parseFloat($('tr.normalTr[rfc="'+rfc+'"]').attr("impTrasladados"));
  
  var cantidad = parseFloat($('#total').attr("cantidad"));
  cantidad = cantidad - total;
  cantidad = Math.round(cantidad * 100) / 100;
  $('#total').attr("cantidad", cantidad);
  $('#total').html("Total: "+format2(cantidad,'$'));
  var cantidad = parseFloat($('#subtotal').attr("cantidad"));
  cantidad = cantidad - subtotal;
  cantidad = Math.round(cantidad * 100) / 100;
  $('#subtotal').attr("cantidad", cantidad);
  $('#subtotal').html("Subtotal: "+format2(cantidad,'$'));
  var cantidad = parseFloat($('#impRetenidos').attr("cantidad"));
  cantidad = cantidad - impRetenidos;
  cantidad = Math.round(cantidad * 100) / 100;
  $('#impRetenidos').attr("cantidad", cantidad);
  $('#impRetenidos').html("Imp. retenidos: "+format2(cantidad,'$'));
var cantidad = parseFloat($('#impTrasladados').attr("cantidad"));
  cantidad = cantidad - impTrasladados;
  cantidad = Math.round(cantidad * 100) / 100;
  $('#impTrasladados').attr("cantidad", cantidad);
  $('#impTrasladados').html("Imp. Trasladados: "+format2(cantidad,'$'));


  $('tr.normalTr[rfc="'+rfc+'"]').remove();
  $('tr.espacioTabla[rfc="'+rfc+'"]').remove();

});



$(document).on("click", "#generarExcelParaDeclaracion", function (){
  var idEtiqueta = $('#selectEtiqueta').val();
  var selectUnidad = $('#selectUnidad').val().trim();
  var anio = $('#selectAnio').val().trim();
  var metodoDePago = $('#selectMetodoDePago').val().trim();
  
 // if(idEtiqueta=="-4" || idEtiqueta=="-5")
  //{
    window.open(
      "/generarExcelParaDeclaracion?idEtiqueta=" + idEtiqueta+"&unidad="+selectUnidad+"&anio="+anio+"&metodoDePago="+metodoDePago,
      '_blank'
    );  
  //}
  //else
 // {
   // alert("Por el momento esta opcion es para las retenciones");
 // }
});

$(document).on("click", "#buscarRFCPorConceptosBoton", function (){
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  var idEtiqueta = $('#selectEtiqueta').val();
  var selectUnidad = $('#selectUnidad').val().trim();
  var anio = $('#selectAnio').val().trim();
  var metodoDePago = $('#selectMetodoDePago').val().trim();
  
  var param = {idEtiqueta : idEtiqueta, unidad : selectUnidad, anio : anio, metodoDePago : metodoDePago};
  $.ajax({
    url: "/buscarRFCPorConceptos",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad='', j=0;
        var aver2 = Object.keys(resp.rfc);
        var total = 0.0;
        for(i=0;i<aver2.length;i++)
        {
          total+=resp.rfc[aver2[i]].Total;
          cad=cad+'<tr class="normalTr" rfc="'+aver2[i]+'" total="'+resp.rfc[aver2[i]].Total+'" subtotal="'+resp.rfc[aver2[i]].SubTotal+'" impRetenidos="'+resp.rfc[aver2[i]].TotalImpuestosRetenidos+'" impTrasladados="'+resp.rfc[aver2[i]].TotalImpuestosTrasladados+'"><td><a href="javascript:void(0)" rfc="'+aver2[i]+'" class="muestraDetalleRFC">'+aver2[i]+'</a></td><td>'+resp.rfc[aver2[i]].RazonSocial+'</td><td>'+format2(resp.rfc[aver2[i]].Total,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].SubTotal,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].TotalImpuestosRetenidos,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].TotalImpuestosTrasladados,'$')+'</td><td><button type="button" rfc="'+aver2[i]+'" class="btn btn-round btn-danger eliminarRFCDeLaLista"><b>-</b></button></td></tr>';
          var aver3 = Object.keys(resp.rfc[aver2[i]].CFDIDatosList);
          var cadJ = '<table style="width:100%;"><tbody>';
          for(j=0;j<aver3.length;j++)
          {
            cadJ=cadJ+'<tr><td><a class="muestraXML" xml="'+resp.rfc[aver2[i]].CFDIDatosList[aver3[j]].XML+'" >XML</a></td><td>'+format2(resp.rfc[aver2[i]].CFDIDatosList[aver3[j]].Total,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].CFDIDatosList[aver3[j]].SubTotal,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].CFDIDatosList[aver3[j]].TotalImpuestosRetenidos,'$')+'</td><td>'+format2(resp.rfc[aver2[i]].CFDIDatosList[aver3[j]].TotalImpuestosTrasladados,'$')+'</td></tr>';
          } 
          cadJ=cadJ+'</tbody></table>';
          cad=cad+'<tr class="espacioTabla" style="width:100%;" rfc="'+aver2[i]+'"><td colspan="6">'+cadJ+'</td></tr>';
        }
        cad=cad+'<tr><td></td><td></td><td id="total" cantidad="'+resp.total+'">Total: '+format2(resp.total,'$')+'</td><td id="subtotal" cantidad="'+resp.subTotal+'">Subtotal: '+format2(resp.subTotal,'$')+'</td><td id="impRetenidos" cantidad="'+resp.impRetenidos+'">Imp. Retenidos: '+format2(resp.impRetenidos,'$')+'</td><td id="impTrasladados" cantidad="'+resp.impTrasladados+'">Imp. Trasladados: '+format2(resp.impTrasladados,'$')+'</td></tr>';
      
        $('#tablaRFCConceptos').html(cad);
        $("#loadingCampos").html('');
      }
    }
  });
});


$(document).on("click", "#verDepositosNoIdentificados", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver dep&oacute;sitos no identificados</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios reversiados</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                    '<select id="verSoloDeColor"><option value="0">Ver todos</option>'+
                      '<option value="1">Debitos con contra partida</option>'+
                      '<option value="2">Debitos sin creditos</option>'+
                    '</select>'+
                      '<br><br>'+
                      '<table style="font-size:16px;" class="table table-hover">'+
                        '<thead><tr><th>Diario D</th><th>Linea D</th><th>Cantidad</th><th>Descripci&oacute;n</th><th>Referencia</th><th>Periodo D</th><th>Fecha</th><th>Diario C</th><th>Linea C</th><th>Periodo C</th></thead>'+
                        '<tbody id="tablaNoIdentificados"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeDepositosNoIdentificados();
 });

   
  function configInicialDeDepositosNoIdentificados()
  {
     $.ajax({
        url: "/configInicialDeDepositosNoIdentificados",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
          if(resp.success==1)
          {
            var sumaDeRojos = 0.0;
            var sumaDeAzules = 0.0;
              var aver2 = Object.keys(resp.diariosReversiados);
             var cad = '',color = '', back = '', classTR='';
             var sumaPeriodoActual = 0.0;
             var periodoAnterior = 0;
             var first = true;
             var i, j;
            for(i=0;i<aver2.length;i++)
            {
               var PERIODI = parseInt(resp.diariosReversiados[aver2[i]]["Periodo"]);
               for(j=i+1;j<aver2.length;j++)
              {
                var PERIODJ = parseInt(resp.diariosReversiados[aver2[j]]["Periodo"]);
                if(PERIODI>PERIODJ)
                {
                  var auxaux = resp.diariosReversiados[aver2[i]];
                  resp.diariosReversiados[aver2[i]] = resp.diariosReversiados[aver2[j]];
                  resp.diariosReversiados[aver2[j]] = auxaux;
                }
              }
             
            }
            for(i=0;i<aver2.length;i++)
            {
              var diario = resp.diariosReversiados[aver2[i]]["Diario"];
              var linea = resp.diariosReversiados[aver2[i]]["Linea"];
              var PERIOD = resp.diariosReversiados[aver2[i]]["Periodo"];
              if(first)
              {
                first=false;
                periodoAnterior=PERIOD;
              }
              if(periodoAnterior!=PERIOD && parseInt(resp.diariosReversiados[aver2[i]].DiarioC)==-1)
              {
                 cad = cad + '<tr><td colspan="10">Suma del  periodo: '+format2(sumaPeriodoActual,'$') +'</td></tr>';
                sumaPeriodoActual=0.0;
              }



              var cantidad = parseFloat(resp.diariosReversiados[aver2[i]].Cantidad);
               back = '#FFF';
              color='#000';
              if(parseInt(resp.diariosReversiados[aver2[i]].DiarioC)==-1)
              {
                back = '#FF0040';
                color='#FFF';
                sumaDeRojos+=cantidad;
                sumaPeriodoActual+=cantidad;
                classTR = 'rojo';
              }
              else
              {
                  sumaDeAzules+=cantidad;
                  back = '#4000FF';
                  color='#FFF';
                  classTR = 'azul';
                  
              }
                   if(classTR=="rojo")
                   {
                       cad=cad+'<tr class="'+classTR+'" style="background-color:'+back+';color:'+color+';"><td><a class="vesAlDiario" style="color:'+color+';" href="javascript:void(0)" diario="'+diario+'">'+diario+'</a></td><td>'+linea+'</td><td>'+format2(parseFloat(resp.diariosReversiados[aver2[i]].Cantidad),'$')+'</td><td>'+resp.diariosReversiados[aver2[i]].DescripcionConta+'</td><td>'+resp.diariosReversiados[aver2[i]].Referencia+'</td><td>'+PERIOD+'</td><td>'+resp.diariosReversiados[aver2[i]].Fecha+'</td><td><a class="vesAlDiario" style="color:'+color+';" href="javascript:void(0)" diario="'+resp.diariosReversiados[aver2[i]].DiarioC+'">'+resp.diariosReversiados[aver2[i]].DiarioC+'</a></td><td>'+resp.diariosReversiados[aver2[i]].LineaC+'</td><td>'+resp.diariosReversiados[aver2[i]].PeriodoC+'</td></tr>';
                   }
                periodoAnterior=PERIOD;

             
            }
             cad = cad + '<tr><td colspan="10">Suma del  periodo: '+format2(sumaPeriodoActual,'$') +'</td></tr>';
               
            cad = cad + '<tr><td colspan="10">Suma Total: '+format2(sumaDeRojos,'$') +'</td></tr>';
                
            /*cad = cad + '<tr><td colspan="4">Suma de rojos: '+format2(sumaDeRojos,'$') +'</td><td colspan="6">Suma de azules: '+format2(sumaDeAzules,'$') +'</td></tr>';*/
            $("#tablaNoIdentificados").html(cad);
          }//if success        
        }
    });
  }
  
  $(document).on("change", "#verSoloDeColor", function (){
    var opcion = parseInt($(this).val());
    $("tr").css("display","block");
    if(opcion==1)
    {
      $(".rojo").css("display","none");
    }
    if(opcion==2)
    {
      $(".azul").css("display","none");
    }
    });
  



$(document).on("click", "#contabilizarFOBONO", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Contabilizar FOBONO</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver timbrado de campos</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="x_content">'+
                      '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">INTERES ANUAL DEL FOBONO:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" value="453265.30" id="fobonoINTERES" class="form-control col-md-10 soloNumeros" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">CAPITAL A DIC 2018 DEL FOBONO:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" value="9116954.69" id="fobonoCAPITAL" class="form-control col-md-10 soloNumeros" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">INTERES ANUAL DEL FOBONO</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<button type="button" id="prepolizaFOBONO_INTERES" class="btn btn-success">Generar prepoliza</button><div id="oculto"></div>'+
                       '</div>'+
                    '</div>'+                          
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Persona</th><th>ER</th><th>Cuenta</th><th>Campo</th><th>D_C</th><th>Interes</th><th>Proyecto</th><th>Detalle</th><th>Informativo</th></thead>'+
                        '<tbody id="prepolizaFOBONO"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });
var sumaCreditos = 0, sumaDebitos = 0;
$(document).on("click", "#prepolizaFOBONO_INTERES", function (){
  var interes = $("#fobonoINTERES").val();
  var capital = $("#fobonoCAPITAL").val();
  var anio = "2018";
  $("#oculto").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
        
  $.ajax({
    url: "/prepolizaFOBONO_INTERES",
    dataType : "json",
    type : "post",
    async : true,
    data : {interes : interes, anio : anio, capital : capital},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      if(resp.success==1)
      {
        var i;
        var aver2 = Object.keys(resp.FOBONO);
        var cad = '';
        var totalesCapital = 0.0;
        var totalesInteres = 0.0;
        //'<thead><tr><th>Persona</th><th>ER</th><th>Cuenta</th><th>Campo</th><th>D_C</th><th>Interes</th><th>Proyecto</th><th>Detalle</th><th>Capital</th></thead>'+
                     
var cadSSC='';
var TREFERENCE = "INTERES "+anio;
var PERIOD = anio+'012';
var TRANS_DATETIMEForSSC = '3112'+anio;
var cadDebito = '';
sumaCreditos = 0;
sumaDebitos = 0;
var cuantos = 0;
        for(i=0;i<aver2.length;i++)
        {
          var desc = "INTERES "+anio+" "+resp.FOBONO[aver2[i]].Persona;
          if(desc.length>50)
          {
            desc=desc.substring(0,50);
          }
          var interes = resp.FOBONO[aver2[i]].Interes;
          //hardcode maximus, perdon al que lo lea, pero tenemos problemas con los centavos, al ultimo pelao le sumo 2 centavos para que cuadre
          if(i==aver2.length-1)
          {
           // interes=interes+0.02000000;
          }
         // interes = Number(Math.round(interes+'e2')+'e-2').toFixed(2); 
if(interes>1.000)
{
  cuantos++;
          cadSSC=cadSSC+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+resp.FOBONO[aver2[i]].ACCNT_CODE.trim()+"|||10|||"+resp.FOBONO[aver2[i]].Campo.trim()+"|"+resp.FOBONO[aver2[i]].ER.trim()+"|IN|"+resp.FOBONO[aver2[i]].Proyecto.trim()+"|PINTFO01|"+desc+"|"+interes+"|C|";
          console.log("INTERES:" + interes);
          sumaCreditos+=interes;
        
          totalesCapital+=resp.FOBONO[aver2[i]].Capital;
          totalesInteres+=interes;
          cad=cad+'<tr><td>'+resp.FOBONO[aver2[i]].Persona+'</td><td>'+resp.FOBONO[aver2[i]].ER+'</td><td>'+resp.FOBONO[aver2[i]].ACCNT_CODE+'</td><td>'+resp.FOBONO[aver2[i]].Campo+'</td><td>C</td><td>'+format2(interes,'$')+'</td><td>'+resp.FOBONO[aver2[i]].Proyecto+'</td><td>PINTFO01</td><td>Capiptal: '+format2(resp.FOBONO[aver2[i]].Capital,'$')+'</td></tr>';
 
}
         }
        //totalesInteres = Number(Math.round(totalesInteres+'e2')+'e-2').toFixed(2); 
        //totalesInteres = parseFloat(Math.round(totalesInteres * 100) / 100).toFixed(2);

        totalesInteres = Math.round(totalesInteres * 100) / 100 ;
       // totalesInteres=totalesInteres+0.02;
        cadDebito=cadDebito+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|453110|||10|||*|*|*|*|*|DISTRIBUCION INTERESES FOBONO 2018|"+totalesInteres+"|D|";
        sumaDebitos += totalesInteres;
        console.log(sumaCreditos);
        console.log(sumaDebitos);
        var n = cuantos+1;
        console.log("aver2: "+aver2.length);
        var cadGeneral = '||'+n+'|M11|JV|'+cadDebito+cadSSC;
        
        $("#oculto").html('<button type="button" id="contabilizarAlgo" class="btn btn-warning" cad="'+cadGeneral+'">Contabilizar</button>');
        cad=cad+'<tr><td>DEBITO</td><td></td><td>453110</td><td>*</td><td>D</td><td>'+format2(totalesInteres,'$')+'</td><td>*</td><td>'+format2(totalesCapital,'$')+'</td></tr>';
        //cad=cad+'<tr><td colspan="3">Totales:</td><td>'+format2(totalesCapital,'$')+'</td><td>'+format2(totalesInteres,'$')+'</td></tr>';
        $("#prepolizaFOBONO").html(cad);
        alert("Interes x cada 1000 pesos: "+resp.interesPorMil);//    NUMERO DE PERSONAS: "+aver2.length/2
      }
    }
  });
});


$(document).on("click", "#contabilizaCosa", function (){
  var cad = $(this).attr("cad");
   var BUNIT = $("#delCampo").val();
 
 $.ajax({
        url: "/dameHash",
        dataType : "json",
        type : "post",
        async : true,
        data : {},
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp) {
          var hash = resp.hash;
          var u = $("#USUARIOACTUAL").html();
          var USUARIOACTUAL = $("#USUARIOACTUAL").html();
          
          window.open(
            "/generarDiario?hash="+hash+"&source="+u+"&diario="+cad+"&libro=A&db=SunSystemsData&BUNITViejito="+BUNIT+"&pass=",
            '_blank'
          );
        }
      });
     
});



$(document).on("click", "#calcularSaludEIncapacidadA_Campos", function (){
  var BUNIT = $("#delCampo").val();
  var periodo = $("#delPeriodo").val();
  $.ajax({
    url: "/dameCalculoDeSaludEIncapacidad",
    dataType : "json",
    type : "post",
    async : true,
    data : {BUNIT : BUNIT, periodo : periodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var aver2 = Object.keys(resp.gente);
      var i , cad='';
      var cadSSC = '';
      var TREFERENCE = "S.I. "+periodo;
      var PERIOD = periodo;
      var anio = periodo.substring(0,4);
      var mes  = periodo.substring(5);
      var TRANS_DATETIMEForSSC = '01'+mes+anio;
      var total = 0;
      for(i=0;i<aver2.length;i++)
      {
          cadSSC=cadSSC+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|338INCAP01|||10||||"+resp.gente[aver2[i]].ER.trim()+"|OUT|||"+resp.gente[aver2[i]].DESCRIPTN+"|"+resp.gente[aver2[i]].AMOUNT+"|D|";
        total+=parseFloat(resp.gente[aver2[i]].AMOUNT);
        var string = numeral(parseFloat(resp.gente[aver2[i]].AMOUNT)).format('$0,0.00');
        cad=cad+'<tr><td>338INCAP01</td><td>'+aver2[i]+'</td><td>'+resp.gente[aver2[i]].DESCRIPTN+'</td><td>'+string+'</td></tr>';
      }
      for(i=0;i<aver2.length;i++)
      {
        resp.gente[aver2[i]].AMOUNT = parseFloat(resp.gente[aver2[i]].AMOUNT) *3;
          cadSSC=cadSSC+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|815510|UFTF|NF|10|"+resp.gente[aver2[i]].FNCT+"|32A||"+resp.gente[aver2[i]].ER.trim()+"||||"+resp.gente[aver2[i]].DESCRIPTN+"|"+resp.gente[aver2[i]].AMOUNT+"|D|";
        total+=parseFloat(resp.gente[aver2[i]].AMOUNT);
        var string = numeral(parseFloat(resp.gente[aver2[i]].AMOUNT)).format('$0,0.00');
        cad=cad+'<tr><td>815510</td><td>'+aver2[i]+'</td><td>'+resp.gente[aver2[i]].DESCRIPTN+'</td><td>'+string+'</td></tr>';
      }
      var string = numeral(total).format('$0,0.00');
      var n = (aver2.length*2)+1;
      var cadGeneral = '||'+n+'|'+BUNIT+'|JV|'+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|AGM111|||10|||||Y|||"+TREFERENCE+"|"+total+"|C|"+cadSSC;

      var cadHead = '<tr><td>AGM111</td><td><button id="contabilizaCosa" cad="'+cadGeneral+'" class="btn btn-warning">Contabilizar</buton></td><td>Uni&oacute;n Mexicana del Norte</td><td>'+string+'</td></tr>'+cad;
      $("#tablaSaludCampos").html(cadHead);
      
     
        
      
     }
   });
});



$(document).on("click", "#calcularFOBONO_Campos", function (){
  var BUNIT = $("#delCampo").val();
  var periodo = $("#delPeriodo").val();
  $.ajax({
    url: "/dameCalculoDelFobono",
    dataType : "json",
    type : "post",
    async : true,
    data : {BUNIT : BUNIT, periodo : periodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var aver2 = Object.keys(resp.gente);
      var i , cad='';
      var cadSSC = '';
      var TREFERENCE = "FOBONO "+periodo;
      var PERIOD = periodo;
      var anio = periodo.substring(0,4);
      var mes  = periodo.substring(5);
      var TRANS_DATETIMEForSSC = '01'+mes+anio;
      var total = 0;
      for(i=0;i<aver2.length;i++)
      {
          cadSSC=cadSSC+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|368AFROU01|||10||||"+resp.gente[aver2[i]].ER.trim()+"|OUT|||"+resp.gente[aver2[i]].DESCRIPTN+"|"+resp.gente[aver2[i]].AMOUNT+"|D|";
        total+=parseFloat(resp.gente[aver2[i]].AMOUNT);
        var string = numeral(parseFloat(resp.gente[aver2[i]].AMOUNT)).format('$0,0.00');
        cad=cad+'<tr><td>368AFROU01</td><td>'+aver2[i]+'</td><td>'+resp.gente[aver2[i]].DESCRIPTN+'</td><td>'+string+'</td></tr>';
      }
      for(i=0;i<aver2.length;i++)
      {
          cadSSC=cadSSC+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|818160|UFTF||10|"+resp.gente[aver2[i]].FNCT+"|32A||"+resp.gente[aver2[i]].ER.trim()+"||||"+resp.gente[aver2[i]].DESCRIPTN+"|"+resp.gente[aver2[i]].AMOUNT+"|D|";
        total+=parseFloat(resp.gente[aver2[i]].AMOUNT);
        var string = numeral(parseFloat(resp.gente[aver2[i]].AMOUNT)).format('$0,0.00');
        cad=cad+'<tr><td>818160</td><td>'+aver2[i]+'</td><td>'+resp.gente[aver2[i]].DESCRIPTN+'</td><td>'+string+'</td></tr>';
      }
      var string = numeral(total).format('$0,0.00');
      var n = (aver2.length*2)+1;
      var cadGeneral = '||'+n+'|'+BUNIT+'|JV|'+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|AGM111|||10|||||Y|||"+TREFERENCE+"|"+total+"|C|"+cadSSC;

      var cadHead = '<tr><td>AGM111</td><td><button id="contabilizaCosa" cad="'+cadGeneral+'" class="btn btn-warning">Contabilizar</buton></td><td>Uni&oacute;n Mexicana del Norte</td><td>'+string+'</td></tr>'+cad;
      $("#tablaFobonoCampos").html(cadHead);
      
     
        
      
     }
   });
});




$(document).on("click", "#contabilizarSaludEIncapacidadaCampos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Contabilizar SALUD e INCAPACIDAD a Campos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Elige campo y periodo</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="x_content">'+
                     '<div class="form-group">'+
                      '<p><label for="delCampo">Campo:</label>'+
                          '<select id="delCampo" class="form-control" required="" >'+
                          '<option value="M41">Baja Norte</option>'+
                          '<option value="M4R">Baja Sur</option>'+
                          '<option value="MK1">Chihuahua</option>'+
                          '<option value="MG1">Golfo</option>'+
                          '<option value="MM1">Noreste</option>'+
                          '<option value="MUR">Noroccidental</option>'+
                          '<option value="MP1">Norte de Tamaulipas</option>'+
                          '<option value="MU1">Occidente</option>'+
                          '<option value="MS1">Sinaloa</option>'+
                          '<option value="MN1">Sonora</option>'+
                          '<option value="MR1">Regiomontana</option>'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<button class="btn btn-success" id="calcularSaludEIncapacidadA_Campos">Calcular</button>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>ER</th><th>Persona</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaSaludCampos"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configFOBOBO_Campos();
 });



$(document).on("click", "#contabilizarFOBONOaCampos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Contabilizar FOBONO a Campos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Elige campo y periodo</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="x_content">'+
                     '<div class="form-group">'+
                      '<p><label for="delCampo">Campo:</label>'+
                          '<select id="delCampo" class="form-control" required="" >'+
                          '<option value="M41">Baja Norte</option>'+
                          '<option value="M4R">Baja Sur</option>'+
                          '<option value="MK1">Chihuahua</option>'+
                          '<option value="MG1">Golfo</option>'+
                          '<option value="MM1">Noreste</option>'+
                          '<option value="MUR">Noroccidental</option>'+
                          '<option value="MP1">Norte de Tamaulipas</option>'+
                          '<option value="MU1">Occidente</option>'+
                          '<option value="MS1">Sinaloa</option>'+
                          '<option value="MN1">Sonora</option>'+
                          '<option value="MR1">Regiomontana</option>'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<button class="btn btn-success" id="calcularFOBONO_Campos">Calcular</button>'+
                    '</div>'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>ER</th><th>Persona</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaFobonoCampos"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configFOBOBO_Campos();
 });


$(document).on("click", "#verTimbradoDeNominaCampos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver como han estado timbrando los campos la manutenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver timbrado de campos</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Campo</th><th>Periodo</th><th>Total timbrado</th></thead>'+
                        '<tbody id="tablaTimbradoDeCamposNomina"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialTimbradoNominaDeCampos();
 });
function configFOBOBO_Campos() {
  $.ajax({
    url: "/damePeriodos",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var aver2 = Object.keys(resp.periodos);
      var i;
      var cad = '';//'<select style="font-size:16px;" id="selectPeriodos">'
      for(i=0;i<aver2.length;i++)
      {
        cad = cad + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
      }
      $("#delPeriodo").html(cad);
    }
  });
}
function configInicialTimbradoNominaDeCampos()
{
  $.ajax({
    url: "/configInicialTimbradoNominaDeCampos",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      if(resp.success==1)
      {
        var cuentasArray = new Array();
        var aver2 = Object.keys(resp.facturas);
        var cad = '';
        for(i=0;i<aver2.length;i++)
        {
          var aa = '<a href="javascript:void(0)" class="vesAlISR2" periodo="'+resp.facturas[aver2[i]].Periodo+'" BUNIT="'+resp.facturas[aver2[i]].BUNIT+'">';
          cad = cad + '<tr><td>'+aa+resp.facturas[aver2[i]].BUNIT+'</a></td><td>'+aa+resp.facturas[aver2[i]].Periodo+'</a></td><td>'+aa+format2(parseFloat(resp.facturas[aver2[i]].Cuanto),'$')+'</a></td></tr>';
        }
        $("#tablaTimbradoDeCamposNomina").html(cad);
      }
    }
  });
}


$(document).on("click", "#facturaLigadaEnSuTotalidad", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver donde se ligo la factura</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver donde se ligo la factura</h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Busca la factura por folio fiscal, o cantidad, o fecha , o rfc, o razon social:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="autocomplete-custom-append_VERFACTURAS" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container_VERFACTURAS" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="buscarFacturasYaLigadas" idCedula="-1" class="btn btn-success">Ver donde se ligo</button>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta Bancaria</th><th>Fecha factura</th><th>RFC</th><th>Razon Social</th><th>Total factura</th><th>Ligado</th><th>Importe banco</th><th>Unidad de negocio</th><th>Fecha banco</th><th>Descripcion banco</th></thead>'+
                        '<tbody id="tablaFacturasLigadas"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeVerFactura();
 });
function configInicialDeVerFactura()
{
  $.ajax({
    url: "/configInicialDeVerFactura",
    dataType : "json",
    type : "post",
   // data: param, 
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp) {
      if(resp.success==1)
      {
        var cuentasArray = new Array();
        var aver2 = Object.keys(resp.facturas);
        for(i=0;i<aver2.length;i++)
        {
          cuentasArray.push(resp.facturas[aver2[i]].Nombre.toString().trim());
        }
        $("#autocomplete-custom-append_VERFACTURAS").autocomplete({
              lookup: cuentasArray,
              appendTo: '#autocomplete-container_VERFACTURAS'
        }); 
      }
    }
  });
}

$(document).on("click", "#buscarFacturasYaLigadas", function (){
  var todo = $("#autocomplete-custom-append_VERFACTURAS").val().trim();
  if(todo.split("|").length==0)
  {
    alert("no has seleccionado una factura");
  }
  else
  {
    var folioFiscal = todo.split("|")[2];
    $.ajax({
      url: "/verDondeSeLigo",
      dataType : "json",
      type : "post",
      data: {folioFiscal : folioFiscal}, 
      async : true,
      beforeSend : function (){
  //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
      },
      complete : function (){
      }, 
      success : function (resp) {
        if(resp.success==1)
        {
          var i;
          var cad = '';
          var aver2 = Object.keys(resp.ligado);
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.ligado[aver2[i]].NombreCuenta+'</td><td>'+resp.ligado[aver2[i]].FechaFactura+'</td><td>'+resp.ligado[aver2[i]].Rfc+'</td><td>'+resp.ligado[aver2[i]].Razon+'</td><td>'+format2(resp.ligado[aver2[i]].TotalFactura,'$')+'</td><td>'+format2(resp.ligado[aver2[i]].Ligado,'$')+'</td><td>'+format2(resp.ligado[aver2[i]].ImporteBanco,'$')+'</td><td>'+resp.ligado[aver2[i]].BUNIT+'</td><td>'+resp.ligado[aver2[i]].FechaBanco+'</td><td>'+resp.ligado[aver2[i]].DescripcionBanco+'</td></tr>';
          }
          $("#tablaFacturasLigadas").html(cad);
        }
      }
    });

    
  }
});
$(document).on("click", "#verTimbresUsados", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver timbres usados</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small id="todosLosRFC">Timbres Usados</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>RFC</th><th>Razon Social</th><th>Timbres</th><th>Pesos</th></thead>'+
                        '<tbody id="tablaTimbresUsados"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeTimbresUsados();
 });

$(document).on("click", "#todosLosRFC", function (){
   $.ajax({
        url: "/configInicialDeTimbresUsadosTODOS",
        dataType : "json",
        type : "post",
       // data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp) {
          if(resp.success==1)
          {
            var valorPorTimbre = 1.1252;
            var aver2 = Object.keys(resp.mov);
            var cad = '';
            var total = 0.0;
            var totalTimbres = 0;
            for (i=0;i<aver2.length; i++) {
              totalTimbres+=parseInt(resp.mov[aver2[i]].Mov);
              var uno = parseFloat(parseInt(resp.mov[aver2[i]].Mov)*valorPorTimbre);
              total+=uno;
              cad = cad + '<tr><td>'+aver2[i]+'</td><td>'+resp.mov[aver2[i]].RazonSocial+'</td><td>'+resp.mov[aver2[i]].Mov+'</td><td>'+format2(uno,'$')+'</td></tr>';
            }
            cad = cad + '<tr><td>Timbres totales: 5000</td><td>Timbres disponibles: '+(5000-totalTimbres)+'</td><td>Timbres usados: '+totalTimbres+'</td><td>Usado: '+format2(total,'$')+'  de $5,626</td></tr>';
           

            $("#tablaTimbresUsados").html(cad);
          }
        }
    });
});
$(document).on("click", ".veCampos", function (){
  var tabla = $(this).attr("tabla");
  var param = {tabla : tabla}
  $.ajax({
    url: "/dameCamposDeLaTabla",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      if(resp.success==1)
      {
        $("#tablaSeleccionada").html(tabla);
        var aver2 = Object.keys(resp.columnas);
        var i=0,j=0;cad='',aux;
        for(i=0;i<aver2.length;i++)
        {
          for(j=i+1;j<aver2.length;j++)
          {
            if(parseInt(aver2[i])>parseInt(aver2[j]))
            {
              var aux = resp.columnas[aver2[i]];
              resp.columnas[aver2[i]] = resp.columnas[aver2[j]];
              resp.columnas[aver2[j]] = aux;
            }
          }
        }
        for(i=0;i<aver2.length;i++)
        {
          cad = cad + '<tr><td><input type="checkbox" value="'+resp.columnas[aver2[i]].COLUMN_NAME+'" name="camposTabla"></td><td>'+resp.columnas[aver2[i]].COLUMN_NAME+'</td><td>=</td><td><input type="text" columna="'+resp.columnas[aver2[i]].COLUMN_NAME+'" class="form-control col-md-2 inputValor"  /></td></tr>';
        }
        $("#tablaQA").html(cad);
      }
    }
  });
});
$(document).on("click", "#generarExcelTablaCustom", function (){
  var cuak = $('input[type="checkbox"]:checked');
  var n = cuak.length;
  var tabla = $("#tablaSeleccionada").html();
  if(n==0)
  {
    alert("Primero debes de seleccionar al menos un campo");
    return;
  }
  var i = 0;
  var cad = '';
  var first = true;
  for(i=0;i<n;i++)
  {
    var valor = $('.inputValor[columna="'+cuak[i].value+'"]').val();
    if(first)
    {
      first=false;
      cad = cuak[i].value+'|=|'+valor;
    }
    else
    {
      cad=cad+'|'+cuak[i].value+'|=|'+valor;
    }
  }
  var param = {tabla : tabla, campos : cad}
  window.open(
    "/generarExcelTabla?tabla=" + tabla+"&campos="+cad,
    '_blank'
  );
});

$(document).on("click", "#generarExcelTabla", function (){
  var cuak = $('input[type="checkbox"]:checked');
  var n = cuak.length;
  var tabla = $("#tablaSeleccionada").html();
  if(n==0)
  {
    //alert("Primero debes de seleccionar al menos un campo");
    //return;
  }
  var i = 0;
  var cad = '';
  var first = true;
  for(i=0;i<n;i++)
  {
    if(first)
    {
      first=false;
      cad = cuak[i].value;
    }
    else
    {
      cad=cad+'|'+cuak[i].value;
    }
  }
  var param = {tabla : tabla, campos : cad}
  window.open(
    "/generarExcelTabla?tabla=" + tabla+"&campos="+cad,
    '_blank'
  );
  /*
  $.ajax({
    url: "/generarExcelTabla",
    dataType : "json",
    type : "post",
    data: param, 
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      if(resp.success==1)
      {

      }
    }
  });
  */
});
$(document).on("click", "#qa", function (){
  var bunit = $("#BUNITACTUAL").html();
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Query &amp;&amp; Analisys</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Query &amp;&amp;<small>Analisys</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div id="tablaSeleccionada" style="display:none;"></div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Tabla</th><th>Referencia</th></thead>'+
                        '<tbody id="tablaDiariosReversiados">'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_ACNT">'+bunit+'_ACNT</td><td class="veCampos" tabla="'+bunit+'_ACNT">Cuentas</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_ADDR">'+bunit+'_ADDR</td><td class="veCampos" tabla="'+bunit+'_ADDR">Direcciones</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_ANL_CAT">'+bunit+'_ANL_CAT</td><td class="veCampos" tabla="'+bunit+'_ANL_CAT">Cat. Dimensiones</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_ANL_CODE">'+bunit+'_ANL_CODE</td><td class="veCampos" tabla="'+bunit+'_ANL_CODE">Cod. Dimensiones</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_ASSET">'+bunit+'_ASSET</td><td class="veCampos" tabla="'+bunit+'_ASSET">Activos fijos</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_A_SALFLDG">'+bunit+'_A_SALFLDG</td><td class="veCampos" tabla="'+bunit+'_A_SALFLDG">Libro mayor</td></tr>'+
                        '<tr><td class="veCampos" tabla="'+bunit+'_B_SALFLDG">'+bunit+'_B_SALFLDG</td><td class="veCampos" tabla="'+bunit+'_B_SALFLDG">Presupuesto</td></tr>'+
                        '</tbody>'+
                      '</table>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="generarExcelTabla" class="btn btn-success">Generar Excel con toda la informaci&oacute;n</button>'+
                      '</div>'+
                      '<div class="col-md-3 col-sm-3 col-xs-3 col-md-offset-3">'+
                        '<button type="submit" id="generarExcelTablaCustom" class="btn btn-success">Generar Excel con las reglas seleccionadas</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Incluir</th><th>Campo</th><th>Regla</th><th>Input</th></thead>'+
                        '<tbody id="tablaQA">'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });
$(document).on("click", "#verDiariosReverseados", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver diarios reverseados</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios reversiados</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Diario</th><th>Referencia</th><th>Periodo</th></thead>'+
                        '<tbody id="tablaDiariosReversiados"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeDiariosReversiados();
 });
$(document).on("click", "#crearConceptos", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear conceptos de c&eacute;dula</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear conceptos para c&eacute;dulas<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige cedula:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="cedulasSelectConceptos"></select>'+
                       '</div>'+
                    '</div>'+
                   '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombreConcepto" id="nombreConcepto" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarConceptoCedula" idCedula="-1" class="btn btn-success">Guardar concepto</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>C&eacute;dulas</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th><th>Nombre</th></thead>'+
                        '<tbody id="tablaCedulaConceptos"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeCedulasConceptos();
 });
$(document).on("click", "#verCedula", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ver c&eacute;dula</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Ver c&eacute;dulas<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige cedula:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="cedulasSelectVer"></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="verCedulaButton" idCedula="-1" class="btn btn-success">Generar C&eacute;dula</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-4 col-sm-4 col-xs-4">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>C&eacute;dulas</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Nombre</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaConcentradoCedula"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
                '<div class="col-md-4 col-sm-4 col-xs-4">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Cuentas</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Nombre</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaConcentradoCuenta"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
                '<div class="col-md-4 col-sm-4 col-xs-4">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Ver <small>Diarios</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Nombre</th><th>Cantidad</th></thead>'+
                        '<tbody id="tablaConcentradoDiarios"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeCedulasParaVer();
 });


var lineaEnLaQueVoy=1;
var lineasTotalesDelDiario = 1;
var lineaGlobal = 1;
var referenciaActual="";
var debitosReferencia=0;
var creditosReferencia=0;
var cuentaAnterior="";
$(document).on('keydown', '#referencia', function(ev) {
    if(ev.which === 13) {
        var auxId = parseInt($("#tipoDeDiarioSelectDeCaptura").val());
        if(auxId==-1){return false;}
        empiezaReferencia();
        return false;
    }
});

function empiezaReferencia()
{
  referenciaActual = $("#referencia").val().trim();
  if(referenciaActual=="")
  {

  }
  else
  {
    $("#referencia").attr("disabled","disabled");
    $("#tipoDeDiarioSelectDeCaptura").attr("disabled","disabled");
    $("#infoLabel").html("D&eacute;bitos: "+format2(debitosReferencia,"$")+" Cr&eacute;ditos: "+format2(creditosReferencia,"$")+" Linea: "+lineaEnLaQueVoy+" de "+lineasTotalesDelDiario);
    idTipoDeDiarioGlobal=$("#tipoDeDiarioSelectDeCaptura").val();
    
    ponLineaSegunTipoDeDiario(idTipoDeDiarioGlobal , lineaEnLaQueVoy);
  }
}
function ponDimensionesSegunCuenta()
{
  var cuenta = $("#autocomplete-custom-append").val().trim();
  if(cuenta.indexOf('|')>-1)
  {
    cuenta = cuenta.split('|')[0];
  }
  if(cuenta=="")
  {
    return;
  }
  if(cuenta==cuentaAnterior)
  {
    return;
  }
  var param = {cuenta : cuenta};
  $.ajax({
    url: "/dameDimensionesDisponiblesSegunLaCuenta",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        if(resp.status!=0)
        {
          alert("En la cuenta "+cuenta+" no se permite contabilizar.");
          $("#autocomplete-custom-append").val("");
          return;
        }
        cuentaAnterior=cuenta;
        $("#divD0").css("display","none");
        $("#divD1").css("display","none");
        $("#divD2").css("display","none");
        $("#divD3").css("display","none");
        $("#divD4").css("display","none");
        $("#divD5").css("display","none");
        $("#divD6").css("display","none");
        $("#divD7").css("display","none");
        $("#divD8").css("display","none");
        $("#divD9").css("display","none");
       /* $("#ANAL_T0").val("");
        $("#ANAL_T1").val("");
        $("#ANAL_T2").val("");
        $("#ANAL_T3").val("");
        $("#ANAL_T4").val("");
        $("#ANAL_T5").val("");
        $("#ANAL_T6").val("");
        $("#ANAL_T7").val("");
        $("#ANAL_T8").val("");
        $("#ANAL_T9").val("");*/
        var limite = resp.tipoDimension;
        //1 obligatorio
        //2 opcional
        //3 prohibido (ninguno!)
        //4 todos!
        var prohibido=3;
        if(resp.D0<=limite && limite != prohibido)
        {
          $("#divD0").css("display","block");
        }
        $("#ANAL_T0").attr("status",resp.D0);
        if(resp.D1<=limite && limite != prohibido)
        {
          $("#divD1").css("display","block");
        }
        $("#ANAL_T1").attr("status",resp.D1);
        if(resp.D2<=limite && limite != prohibido)
        {
          $("#divD2").css("display","block");          
        }
        $("#ANAL_T2").attr("status",resp.D2);
        if(resp.D3<=limite && limite != prohibido)
        {
          $("#divD3").css("display","block");
        }
        $("#ANAL_T3").attr("status",resp.D3);
        if(resp.D4<=limite && limite != prohibido)
        {
          $("#divD4").css("display","block");
        }
        $("#ANAL_T4").attr("status",resp.D4);
        if(resp.D5<=limite && limite != prohibido)
        {
          $("#divD5").css("display","block");
        }
        $("#ANAL_T5").attr("status",resp.D5);
        if(resp.D6<=limite && limite != prohibido)
        {
          $("#divD6").css("display","block");
        }
        $("#ANAL_T6").attr("status",resp.D6);
        if(resp.D7<=limite && limite != prohibido)
        {
          $("#divD7").css("display","block");
        }
        $("#ANAL_T7").attr("status",resp.D7);
        if(resp.D8<=limite && limite != prohibido)
        {
          $("#divD8").css("display","block");
        }
        $("#ANAL_T8").attr("status",resp.D8);
        if(resp.D9<=limite && limite != prohibido)
        {
          $("#divD9").css("display","block");
        }
        $("#ANAL_T9").attr("status",resp.D9);

        
      }
      if(resp.success==0)
      {
        //esa cuenta no existe!
      }
    }
  });
}


$(document).on("click", "#nuevaLinea", function (){
  grabaLineaActual(1);
});

$(document).on("click", "#ok", function (){
  grabaLineaActual(0);
});
var idTipoDeDiarioGlobal;


$(document).on("click", "#nuevaReferencia", function (){
  grabaLineaActual(3);
});
$(document).on("click", "#contabilizar", function (){
  $("body").css("cursor","wait");
  grabaLineaActual(2);
});


function grabaLineaActual(queHagoAlFinal)
{
  //primero validamos
  $("#autocomplete-custom-append").css("background-color","#FFFFFF");
  $("#fechaTrans").css("background-color","#FFFFFF");
  $("#descripcion").css("background-color","#FFFFFF");

  $("#ANAL_T0").css("background-color","#FFFFFF");
  $("#ANAL_T1").css("background-color","#FFFFFF");
  $("#ANAL_T2").css("background-color","#FFFFFF");
  $("#ANAL_T3").css("background-color","#FFFFFF");
  $("#ANAL_T4").css("background-color","#FFFFFF");
  $("#ANAL_T5").css("background-color","#FFFFFF");
  $("#ANAL_T6").css("background-color","#FFFFFF");
  $("#ANAL_T7").css("background-color","#FFFFFF");
  $("#ANAL_T8").css("background-color","#FFFFFF");
  $("#ANAL_T9").css("background-color","#FFFFFF");
 
  

  var cuenta = $("#autocomplete-custom-append").val().trim();
  if(cuenta=="")
  {
    $("#autocomplete-custom-append").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  var fechaTrans = $("#fechaTrans").val().trim();
  if(fechaTrans=="")
  {
    $("#fechaTrans").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  var descripcion = $("#descripcion").val().trim();
  if(descripcion=="")
  {
    $("#descripcion").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  var S0 = parseInt($("#ANAL_T0").attr("status"));
  var S1 = parseInt($("#ANAL_T1").attr("status"));
  var S2 = parseInt($("#ANAL_T2").attr("status"));
  var S3 = parseInt($("#ANAL_T3").attr("status"));
  var S4 = parseInt($("#ANAL_T4").attr("status"));
  var S5 = parseInt($("#ANAL_T5").attr("status"));
  var S6 = parseInt($("#ANAL_T6").attr("status"));
  var S7 = parseInt($("#ANAL_T7").attr("status"));
  var S8 = parseInt($("#ANAL_T8").attr("status"));
  var S9 = parseInt($("#ANAL_T9").attr("status"));
  var ANAL_T0 = $("#ANAL_T0").val().trim();
  var ANAL_T1 = $("#ANAL_T1").val().trim();
  var ANAL_T2 = $("#ANAL_T2").val().trim();
  var ANAL_T3 = $("#ANAL_T3").val().trim();
  var ANAL_T4 = $("#ANAL_T4").val().trim();
  var ANAL_T5 = $("#ANAL_T5").val().trim();
  var ANAL_T6 = $("#ANAL_T6").val().trim();
  var ANAL_T7 = $("#ANAL_T7").val().trim();
  var ANAL_T8 = $("#ANAL_T8").val().trim();
  var ANAL_T9 = $("#ANAL_T9").val().trim();
  var obligatorio=1;
  if(S0==obligatorio && ANAL_T0=="")
  {
    $("#ANAL_T0").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S1==obligatorio && ANAL_T1=="")
  {
    $("#ANAL_T1").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S2==obligatorio && ANAL_T2=="")
  {
    $("#ANAL_T2").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S3==obligatorio && ANAL_T3=="")
  {
    $("#ANAL_T3").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S4==obligatorio && ANAL_T4=="")
  {
    $("#ANAL_T4").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S5==obligatorio && ANAL_T5=="")
  {
    $("#ANAL_T5").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S6==obligatorio && ANAL_T6=="")
  {
    $("#ANAL_T6").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S7==obligatorio && ANAL_T7=="")
  {
    $("#ANAL_T7").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S8==obligatorio && ANAL_T8=="")
  {
    $("#ANAL_T8").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(S9==obligatorio && ANAL_T9=="")
  {
    $("#ANAL_T9").css("background-color","#FFFC00");
    $("body").css("cursor","default");
    return;
  }
  if(ANAL_T0.indexOf('|')>-1)
  {
    ANAL_T0 = ANAL_T0.split('|')[0];
  }
  if(ANAL_T1.indexOf('|')>-1)
  {
    ANAL_T1 = ANAL_T1.split('|')[0];
  }
  if(ANAL_T2.indexOf('|')>-1)
  {
    ANAL_T2 = ANAL_T2.split('|')[0];
  }
  if(ANAL_T3.indexOf('|')>-1)
  {
    ANAL_T3 = ANAL_T3.split('|')[0];
  }
  if(ANAL_T4.indexOf('|')>-1)
  {
    ANAL_T4 = ANAL_T4.split('|')[0];
  }
  if(ANAL_T5.indexOf('|')>-1)
  {
    ANAL_T5 = ANAL_T5.split('|')[0];
  }
  if(ANAL_T6.indexOf('|')>-1)
  {
    ANAL_T6 = ANAL_T6.split('|')[0];
  }
  if(ANAL_T7.indexOf('|')>-1)
  {
    ANAL_T7 = ANAL_T7.split('|')[0];
  }
  if(ANAL_T8.indexOf('|')>-1)
  {
    ANAL_T8 = ANAL_T8.split('|')[0];
  }
  if(ANAL_T9.indexOf('|')>-1)
  {
    ANAL_T9 = ANAL_T9.split('|')[0];
  }

  var cantidad = Math.abs(parseFloat($("#cantidad").val().trim().replace("$","")));
  var D_C = $("#tipoDC").val();
  var param = {
    timestamp : timestampActual,
    lineaG : lineaGlobal,
    lineaT : lineaEnLaQueVoy,
    ref : referenciaActual,
    ACNT_CODE : cuenta,
    fecha : fechaTrans,
    descripcion : descripcion,
    D_C : D_C,
    AMOUNT : cantidad,
    ANAL_T0 : ANAL_T0,
    ANAL_T1 : ANAL_T1,
    ANAL_T2 : ANAL_T2,
    ANAL_T3 : ANAL_T3,
    ANAL_T4 : ANAL_T4,
    ANAL_T5 : ANAL_T5,
    ANAL_T6 : ANAL_T6,
    ANAL_T7 : ANAL_T7,
    ANAL_T8 : ANAL_T8,
    ANAL_T9 : ANAL_T9,
    idTipoDeDiario : idTipoDeDiarioGlobal
  };
  $.ajax({
    url: "/guardaLineaEnTemporalesDiario",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        debitosReferencia=resp.debitos;
        creditosReferencia=resp.creditos;
        if(queHagoAlFinal==3)//nueva referencia
        {
          lineaGlobal++;
          lineaEnLaQueVoy=1;
          lineasTotalesDelDiario=1;
          referenciaActual="";
          debitosReferencia=0;
          creditosReferencia=0;
          cuentaAnterior="";
          $("#divDescr").css("display","none");
          $("#divCantidad").css("display","none");
          $("#cantidad").val("");
          $("#divD_C").css("display","none");
          $("#botonesDeLineas").css("display","none");
          $("#divCuenta").css("display","none");
          $("#divFecha").css("display","none");
          $("#divD0").css("display","none");
          $("#divD1").css("display","none");
          $("#divD2").css("display","none");
          $("#divD3").css("display","none");
          $("#divD4").css("display","none");
          $("#divD5").css("display","none");
          $("#divD6").css("display","none");
          $("#divD7").css("display","none");
          $("#divD8").css("display","none");
          $("#divD9").css("display","none");
       
          //ponLineaSegunTipoDeDiario(idTipoDeDiarioGlobal, lineaEnLaQueVoy);
          $("#referencia").removeAttr("disabled");
          $("#referencia").select();
        }
        if(queHagoAlFinal==1)
        {
          lineaGlobal++;
          lineaEnLaQueVoy++;
          lineasTotalesDelDiario++;
          ponLineaSegunTipoDeDiario(idTipoDeDiarioGlobal, lineaEnLaQueVoy);
        }
        $("#infoLabel").html("D&eacute;bitos: "+format2(debitosReferencia,"$")+" Cr&eacute;ditos: "+format2(creditosReferencia,"$")+"  Linea: "+lineaEnLaQueVoy+" de "+lineasTotalesDelDiario);
        if(queHagoAlFinal==2)//coontabiliza
        {
          var param = {
            timestamp : timestampActual,
            idTipoDeDiario : idTipoDeDiarioGlobal
          };
          $.ajax({
            url: "/contabilizaPorTimeStamp",
            dataType : "json",
            type : "post",
            data: param,
            async : true,
            beforeSend : function (){
            },
            complete : function (){
            }, 
            success : function (resp){
              $("body").css("cursor","default");
              if(resp.success==1)
              {   
                window.open(
                  "/generarDiario?libro=A&diario=" + resp.diario,
                  '_blank'
                );
                empiezaCapturaDeDiarios();
              }
              if(resp.success==2)
              {   
                alert("Los debitos suman: "+resp.debitos+" , los creditos suman: "+resp.creditos);
              }
              if(resp.success==0)
              {   
                alert("Hubo un error! perdon");
              }
            }
          });
        }
      }
    }
  });
}
function actualizaActivosFijos()
{
  $.ajax({
    url: "/dameActivosFijos",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i;
        var cad='';
        var aver2 = Object.keys(resp.activos);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<tr><td>'+resp.activos[aver2[i]]["ASSET_CODE"]+'</td><td>'+resp.activos[aver2[i]]["DESCR"]+'</td><td>'+resp.activos[aver2[i]]["STATUS"]+'</td><td>'+resp.activos[aver2[i]]["ASSET_STATUS"]+'</td><td>'+resp.activos[aver2[i]]["START_PERIOD"]+'</td><td>'+resp.activos[aver2[i]]["END_PERIOD"]+'</td><td>'+resp.activos[aver2[i]]["ULTIMO_PERIOD"]+'</td><td>'+resp.activos[aver2[i]]["DISPOSAL_PERIOD"]+'</td><td>'+resp.activos[aver2[i]]["DISPOSED"]+'</td><td>'+format2(resp.activos[aver2[i]]["BASE_GROSS"],"$")+'</td><td>'+format2(resp.activos[aver2[i]]["BASE_DEP"],"$")+'</td><td>'+format2(resp.activos[aver2[i]]["BASE_NET"],"$")+'</td><td>'+resp.activos[aver2[i]]["BASE_PCENT"]+'</td><td>'+format2(resp.activos[aver2[i]]["TXN_GROSS"],"$")+'</td><td>'+format2(resp.activos[aver2[i]]["TXN_DEP"],"$")+'</td><td>'+format2(resp.activos[aver2[i]]["TXN_NET"],"$")+'</td><td>'+resp.activos[aver2[i]]["TXN_PCENT"]+'</td></tr>';
        } 
        $("#tablaActivosFijosDepre").html(cad);
      }
    }
  });
}
function ponLineaSegunTipoDeDiario(idTipoDeDiario, linea)
{
  var param = {
    idTipoDeDiario : idTipoDeDiario,
    linea : linea
  };
  $.ajax({
    url: "/dameLineaDelTipoDeDiario",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==0)
      {
        $("#divDescr").css("display","block");
        $("#divCantidad").css("display","block");
        $("#divD_C").css("display","block");
        $("#botonesDeLineas").css("display","block");
        $("#divCuenta").css("display","block");
        ponDimensionesSegunCuenta();
        $("#divFecha").css("display","block");
        if(linea==1)
        {
          $("#fechaTrans").click();
        }
        
                
      }
      if(resp.success==1)
      {
        $("#divDescr").css("display","block");
        if(resp.DESCRIPTN!="..")
        {
          $("#descripcion").val(resp.DESCRIPTN);  
        }
        

        $("#divCantidad").css("display","block");


        
        $("#divD_C").css("display","block");
        $("#botonesDeLineas").css("display","block");
        $("#tipoDC").val(resp.D_C);

        $("#divCuenta").css("display","block");
        $("#autocomplete-custom-append").val(resp.cuenta);
        ponDimensionesSegunCuenta();
        if(resp.D0!="..")
        {
          $("#ANAL_T0").val(resp.D0);
        }
        if(resp.D1!="..")
        {
          $("#ANAL_T1").val(resp.D1);
        }
        if(resp.D2!="..")
        {
          $("#ANAL_T2").val(resp.D2);
        }
        if(resp.D3!="..")
        {
          $("#ANAL_T3").val(resp.D3);
        }
        if(resp.D4!="..")
        {
          $("#ANAL_T4").val(resp.D4);
        }
        if(resp.D5!="..")
        {
          $("#ANAL_T5").val(resp.D5);
        }
        if(resp.D6!="..")
        {
          $("#ANAL_T6").val(resp.D6);
        }
        if(resp.D7!="..")
        {
          $("#ANAL_T7").val(resp.D7);
        }
        if(resp.D8!="..")
        {
          $("#ANAL_T8").val(resp.D8);
        }
        if(resp.D9!="..")
        {
          $("#ANAL_T9").val(resp.D9);
        }
        $("#divFecha").css("display","block");
        if(linea==1)
        {
          $("#fechaTrans").click();
        }
      }
    }
  });
}
var timestampActual;
function empiezaCapturaDeDiarios()
{
 
  lineaEnLaQueVoy=1;
  lineasTotalesDelDiario=1;
  referenciaActual="";
  debitosReferencia=0;
  creditosReferencia=0;
  cuentaAnterior="";
  lineaGlobal = 1;
idTipoDeDiarioGlobal=-1;
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Capturar Diario</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Captura de diario<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de diario:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDeDiarioSelectDeCaptura"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Referencia:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="referencia" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-9 col-sm-9 col-xs-9 col-md-offset-6">'+
                        '<button type="button" id="ok" class="btn btn-success">OK</button>'+
                        '<button type="button" id="nuevaLinea" class="btn btn-success">Nueva linea</button>'+
                        '<button type="button" id="nuevaReferencia" class="btn btn-success">Nueva referencia</button>'+
                        '<button type="button" id="contabilizar" class="btn btn-success">Contabilizar</button>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-9 col-sm-9 col-xs-12" id="infoLabel"></label>'+
                    '</div>'+
                    '<div class="form-group" style="display:none;" id="botonesDeLineas">'+
                      '<a class="btn btn-app" id="primeraLinea"><i class="fa fa-backward"></i> Primera linea</a>'+
                      '<a class="btn btn-app" id="anteriorLinea"><i class="fa fa-step-backward"></i> Linea Anterior</a>'+
                      '<a class="btn btn-app" id="siguienteLinea"><i class="fa fa-play"></i> Siguiente linea</a>'+
                      '<a class="btn btn-app" id="ultimaLinea"><i class="fa fa-forward"></i> &Uacute;ltima linea</a>'+
                    '</div>'+
                    '<br><br>'+ 
                    '<div class="form-group" style="display:none;" id="divFecha">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Fecha de la transacci&oacute;n:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="fechaTrans" placeholder="Fecha de transaccion" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group" style="display:none;" id="divCuenta">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" style="display:none;" id="divDescr">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Descripci&oacute;n:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="descripcion" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" style="display:none;" id="divCantidad">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cantidad:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="cantidad" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group" style="display:none;" id="divD_C">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de movimiento:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDC"><option value="D">D&eacute;bito</option><option value="C">Cr&eacute;dito</option></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '</div>'+
                     '<div class="clearfix"></div>'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="x_panel">'+
                          '<div class="x_content">'+
                          '<div class="form-group" style="display:none;" id="divD0">'+
                            '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T0_LABEL">D0:</label>'+
                            '<div class="col-md-4 col-sm-4 col-xs-4">'+
                              '<input type="text" id="ANAL_T0" class="form-control col-md-10" style="float: left;" />'+
                              '<div id="ANAL_T0-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                             '</div>'+
                          '</div>'+
                          '<div class="form-group" style="display:none;" id="divD1">'+
                            '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T1_LABEL">D1:</label>'+
                            '<div class="col-md-4 col-sm-4 col-xs-4">'+
                              '<input type="text" id="ANAL_T1" class="form-control col-md-10" style="float: left;" />'+
                              '<div id="ANAL_T1-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                             '</div>'+
                          '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                       '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="x_panel">'+
                          '<div class="x_content">'+
                            '<div class="form-group"  style="display:none;" id="divD2">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-22" id="ANAL_T2_LABEL">D2:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                       '<input type="text" id="ANAL_T2" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T2-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group"  style="display:none;" id="divD3">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T3_LABEL">D3:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T3" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T3-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="x_panel">'+
                          '<div class="x_content">'+
                                '<div class="form-group"  style="display:none;" id="divD4">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T4_LABEL">D4:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T4" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T4-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group"  style="display:none;" id="divD5">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T5_LABEL">D5:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T5" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T5-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="x_panel">'+
                          '<div class="x_content">'+
                               '<div class="form-group"  style="display:none;" id="divD6">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T6_LABEL">D6:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T6" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T6-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group"  style="display:none;" id="divD7">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T7_LABEL">D7:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T7" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T7-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="x_panel">'+
                          '<div class="x_content">'+
                               '<div class="form-group"  style="display:none;" id="divD8">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T8_LABEL">D8:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T8" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T8-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group"  style="display:none;" id="divD9">'+
                      '<label class="control-label col-md-2 col-sm-2 col-xs-2" id="ANAL_T9_LABEL">D9:</label>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="ANAL_T9" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T9-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                          '</div>'+
                        '</div>'+
                      '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Lineas <small>del diario</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th></th><th>Cuenta</th><th>Tipo</th><th>Descripci&oacute;n</th><th id="tdD0">D0</th><th id="tdD1">D1</th><th id="tdD2">D2</th><th id="tdD3">D3</th><th id="tdD4">D4</th><th id="tdD5">D5</th><th id="tdD6">D6</th><th id="tdD7">D7</th><th id="tdD8">D8</th><th id="tdD9">D9</th><th>Facturar</th><th>Cliente</th><th>Servicio</th><th>Concepto</th><th>Editar</th></thead>'+
                        '<tbody id="tablaLineasDelDiario"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);

      $("#cantidad").maskMoney({thousands:'', decimal:'.', allowZero:true, prefix: '$ '});
      $('#fechaTrans').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
      $("#referencia").focusout(function(){
         var auxId = parseInt($("#tipoDeDiarioSelectDeCaptura").val());
         if(auxId==-1){return false;}
          empiezaReferencia();
      });

      $("#autocomplete-custom-append").focusout(function(){
          ponDimensionesSegunCuenta();
      });

     $("#autocomplete-custom-append").keydown(function(ev){
       if(ev.which === 13) {
        ponDimensionesSegunCuenta();
        return false;
        }
      });

      configInicialDeLineasDeCapturaDeDiario();
}
$(document).on("click", "#diariosRetenidos", function (){
  var cad = '<div class="">'+
  '<div class="page-title">'+
    '<div class="title_left">'+
      '<h3>Diarios Retenidos</h3>'+
    '</div>'+
  '</div>'+
  '<div class="clearfix"></div>'+
  '<div class="row">'+
    '<div class="col-md-12 col-sm-12 col-xs-12">'+
      '<div class="x_panel">'+
        '<div class="x_title">'+
          '<h2>Diarios retenidos<small></small></h2>'+
          '<ul class="nav navbar-right panel_toolbox">'+
            '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
            '</li>'+
            '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
            '</li>'+
          '</ul>'+
          '<div class="clearfix"></div>'+
        '</div>'+
        '<div class="clearfix"></div>'+
        '<div class="col-md-12 col-sm-12 col-xs-12">'+
          '<div class="x_panel">'+
            '<div class="x_title">'+
              '<h2>Diarios <small>retenidos</small></h2>'+
              '<div class="clearfix"></div>'+
            '</div>'+
            '<div class="x_content">'+
              '<table class="table table-hover">'+
                '<thead><tr><th>Fecha</th><th>Tipo de diario</th><th>Quien</th><th>Numeros de lineas</th><th>Ver</th></thead>'+
                '<tbody id="tablaDiariosRetenidos"></tbody>'+
              '</table>'+
            '</div>'+
          '</div>'+
        '</div>'+
      '</div>'+
    '</div>'+
  '</div>'+
'</div>';     
$("#mainContent").html(cad);
actualizaDiariosRetenidos();
});
$(document).on("click", "#capturaDeDiarios", function (){
  empiezaCapturaDeDiarios();
 });
$(document).on("click", "#lineasTiposDeDiario", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear lineas de Tipos de Diario</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear lineas de tipos de diario<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de diario:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDeDiarioSelect"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Linea:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="lineaDelTipoDeDiario" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Debo facturar</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<div id="gender" class="btn-group" data-toggle="buttons">'+
                          '<label class="btn btn-default" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="gender" value="1" data-parsley-multiple="gender" data-parsley-id="12"> &nbsp; Si &nbsp;'+
                          '</label>'+
                          '<label class="btn btn-default active" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="gender" value="0" data-parsley-multiple="gender"> No'+
                          '</label>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Servicio:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="servicio" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cliente:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="cliente" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Concepto:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="concepto" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Descripci&oacute;n:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="descripcion" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de movimiento:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDC"><option value="D">D&eacute;bito</option><option value="C">Cr&eacute;dito</option></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T0_LABEL">D0:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T0" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T0-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T1_LABEL">D1:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T1" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T1-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T2_LABEL">D2:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                       '<input type="text" id="ANAL_T2" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T2-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T3_LABEL">D3:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T3" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T3-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T4_LABEL">D4:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T4" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T4-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T5_LABEL">D5:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T5" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T5-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T6_LABEL">D6:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T6" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T6-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T7_LABEL">D7:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T7" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T7-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T8_LABEL">D8:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T8" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T8-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T9_LABEL">D9:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T9" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T9-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevaLineaDelTipoDeDiario" idTipoDeDiario="-1" class="btn btn-success">Guardar nueva linea</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Crear <small>Lineas de tipo de diario</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th></th><th>Cuenta</th><th>Tipo</th><th>Descripci&oacute;n</th><th id="tdD0">D0</th><th id="tdD1">D1</th><th id="tdD2">D2</th><th id="tdD3">D3</th><th id="tdD4">D4</th><th id="tdD5">D5</th><th id="tdD6">D6</th><th id="tdD7">D7</th><th id="tdD8">D8</th><th id="tdD9">D9</th><th>Facturar</th><th>Cliente</th><th>Servicio</th><th>Concepto</th><th>Editar</th></thead>'+
                        '<tbody id="tablaLineaTiposDeDiario"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      //configInicialDeLineasDeCedulas();
      configInicialDeLineasDeTiposDeDiario();
 });


$(document).on("click", "#lineasDeConceptosInformes", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear lineas de conceptos de informes</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear lineas de conceptos de informes<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige concepto:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="conceptoInformeSelect"></select>'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige Linea:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="lineaInformeDiezmoSelect"></select>'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevaLineaInforme" IdDiezmoConcepto="-1" class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Es suma:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<div id="gender" class="btn-group" data-toggle="buttons">'+
                          '<label class="btn btn-default" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="essuma" value="1" data-parsley-multiple="essuma" data-parsley-id="12"> &nbsp; Si &nbsp;'+
                          '</label>'+
                          '<label class="btn btn-default active" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="essuma" value="0" checked data-parsley-multiple="essuma"> No'+
                          '</label>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Aparece en el portal del usuario:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<div id="gender" class="btn-group" data-toggle="buttons">'+
                          '<label class="btn btn-default" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="aparece" value="1" data-parsley-multiple="aparece" data-parsley-id="12"> &nbsp; Si &nbsp;'+
                          '</label>'+
                          '<label class="btn btn-default active" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="aparece" value="0" checked data-parsley-multiple="aparece"> No'+
                          '</label>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Debo facturar</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<div id="gender" class="btn-group" data-toggle="buttons">'+
                          '<label class="btn btn-default" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="gender" value="1" data-parsley-multiple="gender" data-parsley-id="12"> &nbsp; Si &nbsp;'+
                          '</label>'+
                          '<label class="btn btn-default active" data-toggle-class="btn-primary" data-toggle-passive-class="btn-default">'+
                            '<input type="radio" name="gender" value="0" checked data-parsley-multiple="gender"> No'+
                          '</label>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Descripci&oacute;n:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="descripcion" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Referencia:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="referencia" maxlength="15" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">RFC:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="rfc" class="form-control col-md-10" style="float: left;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Tipo:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                      '<select  class="form-control col-md-10" id="tipo"><option value="2">Ingreso</option><option value="1">Egreso</option></select>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de movimientos:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDC"><option value="1">D&eacute;bitos</option><option value="2">Cr&eacute;ditos</option><option value="4">Ambos</option></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T0_LABEL">D0:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T0" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T0-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T1_LABEL">D1:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T1" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T1-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T2_LABEL">D2:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                       '<input type="text" id="ANAL_T2" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T2-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T3_LABEL">D3:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T3" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T3-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T4_LABEL">D4:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T4" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T4-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T5_LABEL">D5:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T5" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T5-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T6_LABEL">D6:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T6" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T6-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T7_LABEL">D7:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T7" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T7-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T8_LABEL">D8:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T8" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T8-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T9_LABEL">D9:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T9" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T9-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Lineas de Informes <small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th><th>Nombre</th></th><th>Cuenta</th><th>Tipo</th><th id="tdD0">D0</th><th id="tdD1">D1</th><th id="tdD2">D2</th><th id="tdD3">D3</th><th id="tdD4">D4</th><th id="tdD5">D5</th><th id="tdD6">D6</th><th id="tdD7">D7</th><th id="tdD8">D8</th><th id="tdD9">D9</th><th>Subir</th></thead>'+
                        '<tbody id="tablaLineasDiezmoInforme"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeLineasDeInformes();
 });

$(document).on("click", "#lineasDeCedula", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear lineas de c&eacute;dula</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear lineas de c&eacute;dulas<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige cedula:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="cedulasSelect"></select>'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige Concepto:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="conceptoSelect"></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Elige tipo de movimientos:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select style="width: 100%;font-size: 20px;" id="tipoDC"><option value="1">D&eacute;bitos</option><option value="2">Cr&eacute;ditos</option><option value="4">Ambos</option></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T0_LABEL">D0:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T0" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T0-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T1_LABEL">D1:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T1" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T1-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T2_LABEL">D2:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                       '<input type="text" id="ANAL_T2" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T2-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T3_LABEL">D3:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T3" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T3-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T4_LABEL">D4:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T4" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T4-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T5_LABEL">D5:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T5" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T5-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T6_LABEL">D6:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T6" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T6-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T7_LABEL">D7:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T7" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T7-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T8_LABEL">D8:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T8" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T8-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" id="ANAL_T9_LABEL">D9:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="ANAL_T9" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="ANAL_T9-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" >RFC:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="rfc" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="rfc-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" >Razon Social:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="razonSocial" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="razonSocial-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12" >Correo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" id="correo" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="correo-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-5 col-sm-5 col-xs-5" >M&eacute;todo de pago:</label><span class="required">*</span>'+
                      '<div class="col-md-7 col-sm-7 col-xs-7">'+
                        ' <select id="metodoDePago" class="form-control col-md-7" style="float: left;">'+
                            '<option value="01">Efectivo</option>'+
                            '<option value="02">Cheque</option>'+
                            '<option value="03">Transferencia</option>'+
                            '<option value="04">Tarjeta de cr&eacute;dito</option>'+
                            '<option value="05">Monedero electr&oacute;nico</option>'+
                            '<option value="06">Dinero electr&oaacute;nico</option>'+
                            '<option value="08">Vales de despensa</option>'+
                            '<option value="28">Tarjeta de d&eacute;bito</option>'+
                            '<option value="29">Tarjeta de servicio</option>'+
                            '<option value="99">Otros</option>'+
                          '</select>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3" >Num Cta Pago:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" id="NumCtaPago" maxlength="4" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevaLineaCedula" idCedula="-1" class="btn btn-success">Guardar nueva linea</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Lineas de agrupamiento <small></small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Cuenta</th><th>Tipo</th><th>Num Cta</th><th>Met. PAgo</th><th>RFC</th><th>Razon Social</th><th>Correo</th><th id="tdD0">D0</th><th id="tdD1">D1</th><th id="tdD2">D2</th><th id="tdD3">D3</th><th id="tdD4">D4</th><th id="tdD5">D5</th><th id="tdD6">D6</th><th id="tdD7">D7</th><th id="tdD8">D8</th><th id="tdD9">D9</th><th>Eliminar</th></thead>'+
                        '<tbody id="tablaLineaCedulas"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      configInicialDeLineasDeCedulas();
 });




$(document).on("click", "#tiposDeDiario", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear Tipos de diario</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear Tipos de diario<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombre" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">C&oacute;digo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="codigo" id="codigo" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevoTipoDeDiario" idTipoDeDiario="-1" class="btn btn-success">Guardar nuevo</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Crear <small>Tipos de Diario</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th><th>Nombre</th><th>C&oacute;digo</th><th>Editar</th></thead>'+
                        '<tbody id="tablaTiposDeDiario"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTiposDeDiario();
 });


function actualizaUsuariosIglesias()
{
  $.ajax({
    url: "/listaUsuariosIglesias",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.UsuariosIglesias);
        var cad = '';
        var iglesias = Object.keys(resp.iglesias);
        var i;
        var cadSelect = '';
        for(i=0;i<iglesias.length;i++)
        {
          cadSelect = cadSelect + '<option name="'+resp.iglesias[iglesias[i]].DESCR+'" value="'+iglesias[i]+'">'+resp.iglesias[iglesias[i]].DESCR+'</option>';
        }
        $("#iglesiaSelect").html(cadSelect);
        var palabraActivo = '';
        for(i=0;i<aver2.length;i++)
        {
          var Activo = parseInt(resp.UsuariosIglesias[aver2[i]]["Activo"]);
          if(Activo==1)
          {
            palabraActivo="Activo";
          }
          else
          {
            palabraActivo="Inactivo"; 
          }
          var IdUsuario = resp.UsuariosIglesias[aver2[i]]["IdUsuario"];
          cad=cad+'<tr><td>'+resp.UsuariosIglesias[aver2[i]]["Nombre"]+'</td><td>'+resp.UsuariosIglesias[aver2[i]]["Usuario"]+'</td><td>'+resp.UsuariosIglesias[aver2[i]]["Iglesia"]+'</td><td>'+palabraActivo+'</td><td><button type="button" IdUsuario="'+IdUsuario+'" class="btn btn-round btn-warning resetPasswordUsuarioIglesia">Reset</button></td><td><button type="button" IdUsuario="'+IdUsuario+'" class="btn btn-round btn-warning activoInactivoIglesiaUsuario">Activo/Inactivo</button></td></tr>';
        }
        $("#tablaUsuariosIglesia").html(cad);
      }
        
    }
  });
}



$(document).on("click", ".eliminarPalabra", function (){
  var IdLigadoRFC = $(this).attr("IdLigadoRFC");
  var param = {IdLigadoRFC : IdLigadoRFC}
   $.ajax({
    url: "/eliminarPalabra",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaEtiquetas();
      }
    }
  });
});

$(document).on("click", ".eliminarNumCtaPago", function (){
  var IdNumCtaPago = $(this).attr("IdNumCtaPago");
  var param = {IdNumCtaPago : IdNumCtaPago}
   $.ajax({
    url: "/eliminarNumCtaPago",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaTablaClientes();
      }
    }
  });
});

$(document).on("click", ".nuevaPalabraEtiqueta", function (){
  var idEtiqueta = $(this).attr("idEtiqueta");
  var palabra = $('#palabra'+idEtiqueta).val().trim();
  if(palabra=="" )
  {
    alert("Te falta escribir la palabra para la etiqueta");
    return;
  }
  var param = {idEtiqueta : idEtiqueta, palabra : palabra}
   $.ajax({
    url: "/nuevaPalabraEtiqueta",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaEtiquetas();
      }
    }
  });  
});

$(document).on("click", ".nvoNumCtaPago", function (){
  var idCliente = $(this).attr("idCliente");
  var NumCtaPago = $('#inputNumCtaPago'+idCliente).val().trim();
  if(NumCtaPago=="" || NumCtaPago.length!=4)
  {
    alert("Te falta escribir el numero de cta de pago a 4 digitos");
    return;
  }
  var param = {idCliente : idCliente, NumCtaPago : NumCtaPago}
   $.ajax({
    url: "/nvoNumCtaPago",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaTablaClientes();
      }
    }
  });  
});


function actualizaTablaClientes() {
   $.ajax({
    url: "/actualizaTablaClientes",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, cad = '', j;
        var aver2 = Object.keys(resp.clientes);
        for(i=0;i<aver2.length;i++)
        {
          var aver3 = Object.keys(resp.clientes[aver2[i]].NumCtaPagoList);
          var cadNumCtaPago = '<input type="text" placeholder="NUM CT APAGO" maxlength="4" id="inputNumCtaPago'+resp.clientes[aver2[i]].IdCliente+'" /><button type="button" idCliente="'+resp.clientes[aver2[i]].IdCliente+'" class="btn btn-round btn-success nvoNumCtaPago"><b>+</b></button> <br>';
          for(j=0;j<aver3.length;j++)
          {
            cadNumCtaPago = cadNumCtaPago + resp.clientes[aver2[i]].NumCtaPagoList[aver3[j]].NumCtaPago+'<button type="button" IdNumCtaPago="'+resp.clientes[aver2[i]].NumCtaPagoList[aver3[j]].IdNumCtaPago+'" class="btn btn-round btn-danger eliminarNumCtaPago"><b>-</b></button> <br>';
          }
          cad=cad+'<tr><td>'+resp.clientes[aver2[i]].Rfc+'</td><td>'+resp.clientes[aver2[i]].RazonSocial+'</td><td>'+resp.clientes[aver2[i]].Correo+'</td><td>'+cadNumCtaPago+'</td><td><button type="button" idCliente="'+resp.clientes[aver2[i]].IdCliente+'" class="btn btn-round btn-warning editarCliente" rfc="'+resp.clientes[aver2[i]].Rfc+'" razonSocial="'+resp.clientes[aver2[i]].RazonSocial+'" correo="'+resp.clientes[aver2[i]].Correo+'" NumCtaPago="'+resp.clientes[aver2[i]].NumCtaPago+'" >Editar</button></td></td></tr>';

        }
        $('#tablaClientes').html(cad);
      }
    }
  });
}

$(document).on("click", ".editarCliente", function (){
  var idCliente = $(this).attr("idCliente");
  $("#nuevoCliente").html("Guardar modificacion de "+$(this).attr("rfc"));
  $("#nuevoCliente").attr("idCliente",idCliente);
  $("#rfc").val($(this).attr("rfc"));
  $("#razonSocial").val($(this).attr("razonSocial"));
  $("#correo").val($(this).attr("correo"));
  $("html, body").animate({ scrollTop: 0 }, "slow");
});
$(document).on("click", "#nuevoCliente", function (){
  var rfc = $("#rfc").val().trim();
  var razonSocial = $("#razonSocial").val().trim();
  var correo = $("#correo").val().trim();
  if(rfc=="")
  {
    alert("Te falto de escribir el RFC");
    return;
  }
  if(razonSocial=="")
  {
    alert("Te falto de escribir la razon social");
    return;
  }
  if(correo=="")
  {
    alert("Te falto de escribir el correo");
    return;
  }
 
  var idCliente = $(this).attr("idCliente");
  var param = {
    idCliente : idCliente,
    razonSocial : razonSocial,
    rfc : rfc,
    correo : correo,
  };
  $.ajax({
    url: "/guardaCliente",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        actualizaTablaClientes();
      }
      if(resp.success==0)
      {
        alert("hubo un error, perdón");
      }
    }
  });
});


$(document).on("click", "#contabilizarAltaActivo", function (){

var nombreProveedor = $("#nombreProveedor").val().trim();
   var delPeriodo = $("#delPeriodo").val().trim();
var user = $("#USUARIOACTUAL").html();
  var BUNIT = $("#BUNITACTUAL").html();
var tipoDiario = $("#tipoDiario").val().trim();
var cuenta = $("#cuenta").val().trim();
var FechaInicioRelLaboral = $("#FechaInicioRelLaboral").val();
     var anio = FechaInicioRelLaboral.substring(6,10);
    var mes = FechaInicioRelLaboral.substring(3,5);
    var dia = FechaInicioRelLaboral.substring(0,2);
  
//      
  var fecha = dia+mes+anio;
  var descActivo = $("#descActivo").val().trim()+" "+$("#serieActivo").val().trim();
  var codigoActivo = $("#codigoActivo").val().trim();
  var descr =  descActivo;
  var treference =  descActivo;
  if(descr.length>50)
  {
    descr=descr.substring(0,50);
  }
  if(treference.length>15)
  {
    treference=treference.substring(0,15);
  }
  var cantidadActivo = parseFloat($("#cantidadActivo").val().trim());
  cantidadActivo = Math.round(cantidadActivo * 100) / 100 ;
  if(cantidadActivo<0)
  {
    alert("El valor del activo debe de ser mayor a $0");
    return;
  }

  cad = '||4|'+BUNIT+'|'+tipoDiario+'|'+treference+'|'+delPeriodo+'|'+fecha+'|'+cuenta+'||NF|10||||||||'+nombreProveedor+'|'+cantidadActivo+'|C|'+treference+'|'+delPeriodo+'|'+fecha+'|997110|UFNT|20|10|PSGENER01|0|||OUT|||'+descr+'|'+cantidadActivo+'|D|'+treference+'|'+delPeriodo+'|'+fecha+'|997110|UFIN|10|20|PSGENER01|0|||IN|||'+descr+'|'+cantidadActivo+'|C|'+treference+'|'+delPeriodo+'|'+fecha+'|205205|||20||||||||'+descr+'|'+cantidadActivo+'|D|'+codigoActivo+'|I|';
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      var hash = resp.hash;
      var u = $("#USUARIOACTUAL").html();
      console.log(cad);
       var BUNITViejito = $("#BUNITACTUAL").html();
      var USUARIOACTUAL = $("#USUARIOACTUAL").html();
      
      window.open(
        "/generarDiario?hash="+hash+"&source="+u+"&diario="+cad+"&libro=A&db=SunSystemsData&BUNITViejito="+BUNITViejito+"&pass=activower",
        '_blank'
      );
    }
  });
 

  
});


$(document).on("click", "#botonLocoDarDeAlta119Sillas", function (){

  
  var user = $("#USUARIOACTUAL").html();
  var BUNIT = $("#BUNITACTUAL").html();
  

  
  var xml =   `<SSC><User><Name>MCR</Name></User><SunSystemsContext><BusinessUnit>M11</BusinessUnit></SunSystemsContext>
    <Payload>`;
var i;
for(i=651;i<=769;i++){
xml=xml+`<Asset>
            <AdvancedDepreciationAccountBalanceSheet>209205</AdvancedDepreciationAccountBalanceSheet>
            <AdvancedDepreciationAccountProfitLoss>903205</AdvancedDepreciationAccountProfitLoss>
            <AssetCode>E00`+i+`</AssetCode>
            <AssetCurrencyCode>MXP1</AssetCurrencyCode>
            <AssetStatus>0</AssetStatus>
            <BalanceSheetAccount>209205</BalanceSheetAccount>
            <BaseDepreciationMethod>4</BaseDepreciationMethod>
            <BasePercentage>20</BasePercentage>
            <Description>Silla ejecutiva Midas 4600, Sala de Juntas `+(i-649)+`</Description>
            <LookupCode>SILLA `+(i-649)+`</LookupCode>
            <ShortHeading>SILLA `+(i-649)+`</ShortHeading>
            <StartPeriod>0082019</StartPeriod>
            <Status>0</Status>
            <TransactionDepreciationMethod>4</TransactionDepreciationMethod>
            <TransactionPercentage>20</TransactionPercentage>
            <AssetPresets>
                <DepPset_AssetCode></DepPset_AssetCode>
                <DepPset_Descr>Silla ejecutiva Midas 4600, Sala de Juntas `+(i-649)+`</DepPset_Descr>
                <DepPset_Factor>1.00000</DepPset_Factor>
                <DepPset_LdgAnlCode1>UFIN</DepPset_LdgAnlCode1>
                <DepPset_LdgAnlCode10></DepPset_LdgAnlCode10>
                <DepPset_LdgAnlCode2>NF</DepPset_LdgAnlCode2>
                <DepPset_LdgAnlCode3>20</DepPset_LdgAnlCode3>
                <DepPset_LdgAnlCode4>PSGENER01</DepPset_LdgAnlCode4>
                <DepPset_LdgAnlCode5>0</DepPset_LdgAnlCode5>
                <DepPset_LdgAnlCode6></DepPset_LdgAnlCode6>
                <DepPset_LdgAnlCode7></DepPset_LdgAnlCode7>
                <DepPset_LdgAnlCode8></DepPset_LdgAnlCode8>
                <DepPset_LdgAnlCode9></DepPset_LdgAnlCode9>
                <DepPset_Lookup>SILLA `+(i-649)+`</DepPset_Lookup>
            </AssetPresets>
            </Asset>`
}
 
      
  xml=xml+ ` </Payload>
</SSC>`;
$.ajax({
    url: "/subeSSC",  
    dataType : "json",
    type : "post",
    async : true,
    data : {cad : xml, component : "Asset", method : "CreateOrAmend"},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("listo ya se dio de alta el activo: "+codigoActivo);
      }
    }
  });

///////////////////////////
///poliza de alta

var treference = "ACTIVOS SILLAS";
var delPeriodo = "2019008";

var anio = delPeriodo.substring(0,4);
var mes  = delPeriodo.substring(5);
var fecha = "27"+mes+anio;

var cad ='';
  cad = '||123|M11|JV|';

  cad=cad+treference+'|'+delPeriodo+'|'+fecha+'|178140|||10||||||||PM STEELE SILLAS SALA DE JUNTAS|417213.020|C|||'+treference+'|'+delPeriodo+'|'+fecha+'|997110|UFNT|20|10|PSGENER01|0|||OUT|||SILLAS SALA DE JUNTAS|417213.020|D|||'+treference+'|'+delPeriodo+'|'+fecha+'|997110|UFIN|10|20|PSGENER01|0|||IN|||SILLAS SALA DE JUNTAS|417213.020|C|||';
var i;
for(i=650;i<=769;i++){
  if(i==769) {
  cad=cad+treference+'|'+delPeriodo+'|'+fecha+'|205205|||20||||||||SILLA EJECUTIVA MIDAS 4600, SALA JUNTAS '+(i-649)+'|3476.200|D|E00'+i+'|I|';
    
} else {
  cad=cad+treference+'|'+delPeriodo+'|'+fecha+'|205205|||20||||||||SILLA EJECUTIVA MIDAS 4600, SALA JUNTAS '+(i-649)+'|3476.780|D|E00'+i+'|I|';

}
  
  }
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      var hash = resp.hash;
      var u = "MCR";
      
       var BUNITViejito = "M11";
      var USUARIOACTUAL = "MCR";
      
      window.open(
        "/generarDiario?hash="+hash+"&source="+u+"&diario="+cad+"&libro=A&db=SunSystemsData&BUNITViejito="+BUNITViejito+"&pass=activower2",
        '_blank'
      );
    }
  });

});  
$(document).on("click", "#darDeAltaActivo", function (){

  
  var user = $("#USUARIOACTUAL").html();
  var BUNIT = $("#BUNITACTUAL").html();
  var codigoActivo = $("#codigoActivo").val().trim();
  var descActivo = $("#descActivo").val().trim()+" "+$("#serieActivo").val().trim();
  var delPeriodo = $("#delPeriodoSTART_PERIOD").val().trim();
var anio = delPeriodo.substring(0,4);
var mes  = delPeriodo.substring(4);
  var period = mes+anio;
  var look = descActivo;
  if(descActivo.length>15)
  {
    look = descActivo.substring(0,15);
  }
  var pcentajeActivo = parseInt($("#pcentajeActivo").val().trim());
  if(pcentajeActivo>100) {
    alert("el pcentaje de depreciacion debe de ser menor o igual a 100");
  //  return;
  }
  if(pcentajeActivo<0) {
    alert("el pcentaje de depreciacion debe de ser mayor o igual a 0");
   // return;
  }


  
  var xml = `<SSC><User><Name>`+user+`</Name></User><SunSystemsContext><BusinessUnit>`+BUNIT+`</BusinessUnit></SunSystemsContext>
    <Payload>
        <Asset>
            <AdvancedDepreciationAccountBalanceSheet>209205</AdvancedDepreciationAccountBalanceSheet>
            <AdvancedDepreciationAccountProfitLoss>903205</AdvancedDepreciationAccountProfitLoss>
            <AssetCode>`+codigoActivo+`</AssetCode>
            <AssetCurrencyCode>MXP1</AssetCurrencyCode>
            <AssetStatus>0</AssetStatus>
            <BalanceSheetAccount>209205</BalanceSheetAccount>
            <BaseDepreciationMethod>4</BaseDepreciationMethod>
            <BasePercentage>`+pcentajeActivo+`</BasePercentage>
            <Description>`+descActivo+`</Description>
            <LookupCode>`+look+`</LookupCode>
            <ShortHeading>`+look+`</ShortHeading>
            <StartPeriod>`+period+`</StartPeriod>
            <Status>0</Status>
            <TransactionDepreciationMethod>4</TransactionDepreciationMethod>
            <TransactionPercentage>`+pcentajeActivo+`</TransactionPercentage>
            <AssetPresets>
                <DepPset_AssetCode></DepPset_AssetCode>
                <DepPset_Descr>`+descActivo+`</DepPset_Descr>
                <DepPset_Factor>1.00000</DepPset_Factor>
                <DepPset_LdgAnlCode1>UFIN</DepPset_LdgAnlCode1>
                <DepPset_LdgAnlCode10></DepPset_LdgAnlCode10>
                <DepPset_LdgAnlCode2>NF</DepPset_LdgAnlCode2>
                <DepPset_LdgAnlCode3>20</DepPset_LdgAnlCode3>
                <DepPset_LdgAnlCode4>SUOPERA01</DepPset_LdgAnlCode4>
                <DepPset_LdgAnlCode5>0</DepPset_LdgAnlCode5>
                <DepPset_LdgAnlCode6></DepPset_LdgAnlCode6>
                <DepPset_LdgAnlCode7></DepPset_LdgAnlCode7>
                <DepPset_LdgAnlCode8></DepPset_LdgAnlCode8>
                <DepPset_LdgAnlCode9></DepPset_LdgAnlCode9>
                <DepPset_Lookup>`+look+`</DepPset_Lookup>
            </AssetPresets>
            </Asset>
    </Payload>
</SSC>`;
$.ajax({
    url: "/subeSSC",  
    dataType : "json",
    type : "post",
    async : true,
    data : {cad : xml, component : "Asset", method : "CreateOrAmend"},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("listo ya se dio de alta el activo: "+codigoActivo);
      }
    }
  });

});  
$(document).on("click", "#altaActivo", function (){
 
       
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Dar de alta activo</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Dar de alta activo</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<br><br>'+
                      '<div id="loadingCampos"/>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Código de Activo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="codigoActivo" id="codigoActivo" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Descripción de Activo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="descActivo" id="descActivo" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Serie de Activo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="serieActivo" id="serieActivo" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Pcentaje de depreciación:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="pcentajeActivo" id="pcentajeActivo" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Periodo contable:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="delPeriodo"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Periodo de inicio de depreciaci&oacute;n del activo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="delPeriodoSTART_PERIOD"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Fecha de transaccion de la poliza:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="FechaInicioRelLaboral" placeholder="Fecha de inicio" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="darDeAltaActivo" class="btn btn-success">Dar De Alta Activo Fijo en la tabla de activos</button>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Cuenta con la que se compr&oacute; el activo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="cuenta"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group" >'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Tipo de diario:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="tipoDiario"></select>'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Valor del Activo:  $</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="cantidadActivo" id="cantidadActivo" class="form-control col-md-9 soloNumeros" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Proveedor (nombre cheque o transferencia):  $</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="nombreProveedor" id="nombreProveedor" class="form-control col-md-9" style="float: right;" />'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="contabilizarAltaActivo" class="btn btn-success">Contabilizar Alta Activo Fijo</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
        $('#FechaInicioRelLaboral').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1",
          locale: {
              format: 'DD/MM/YYYY'
          }

        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });

       $('#FechaInicioRelLaboral').on('apply.daterangepicker', function(ev, picker) {
        console.log(picker.startDate.format('DD/MM/YYYY'));
        console.log(picker.endDate.format('DD/MM/YYYY'));
        var hola = picker.endDate.format('DD/MM/YYYY');
        $('#FechaInicioRelLaboral').val(hola);
      });
       var cadSelect = '';
   $.ajax({
    url: "/infoAnticipos",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i =0;
        var aver2 = Object.keys(resp.periodos);
        var cadSelect = '';
        for(i=0;i<aver2.length;i++)
        {
          cadSelect = cadSelect + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#delPeriodo").html(cadSelect);
        $("#delPeriodoSTART_PERIOD").html(cadSelect);
        aver2 = Object.keys(resp.CuentasList);
        cadSelect = '';
        for(i=0;i<aver2.length;i++)
        {
          cadSelect = cadSelect + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#cuenta").html(cadSelect);

        aver2 = Object.keys(resp.TipoDiarioList);
        cadSelect = '';
        for(i=0;i<aver2.length;i++)
        {
          cadSelect = cadSelect + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#tipoDiario").html(cadSelect);

      }
    }
  });
  
 });


$(document).on("click", "#timbradoIngresosManual", function (){
 
  var metodoDePagoSelect = '<select id="metodoDePago-2" class="form-control" style="float: left;"><option value="01">Efectivo</option><option value="02">Cheque</option><option value="03">Transferencia</option><option value="04">Tarjeta de crédito</option><option value="05">Monedero electrónico</option><option value="06">Dinero electr&amp;oaacute;nico</option><option value="08">Vales de despensa</option><option value="28">Tarjeta de débito</option><option value="29">Tarjeta de servicio</option><option value="99">Otros</option></select>';

   var monedaSelect = '<select id="moneda" class="form-control" style="float: left;"><option value="MXN">Pesos Mexicanos</option><option value="USD">D&oacute;lares Estadounidenses</option></select>';
       
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Timbrar ingreso manual</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Timbrar ingreso manual</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<br><br>'+
                      '<div id="loadingCampos"/>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">RFC:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9" id="ponSelect"></div>'+
                    '</div>'+
                     '<div class="form-group" style="display:none;">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Num Cta Pago:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="selectNumCtaPago-2"></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">M&eacute;todo de pago:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+metodoDePagoSelect+'</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Moneda:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+monedaSelect+'</div>'+
                    '</div>'+
                    '<div class="form-group" id="mostrarTipoDeCambio" style="display:none;">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Tipo de cambio:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="tipoDeCambio" id="tipoDeCambio" class="form-control col-md-9 soloNumeros" style="float: right;" value="1" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Concepto:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<select style="font-size:20px;" id="selectConcepto-2">'+
'<option value="94111901" label2="Diezmos y ofrendas" cvu="ACT">Diezmos y ofrendas</option>'+
'<option value="94111901" label2="Donativo" cvu="ACT">Donativo</option>'+
'<option value="55101528" label2="Venta de material religioso" cvu="D63">Venta de material religioso (libros)</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="C62">Para venta de material religioso que sea distinto a libros</option>'+
'<option value="60101809" label2="Venta de material religioso" cvu="XKI">Para venta de material religioso que sea distinto a libros(Cuando sean dos productos o más)</option>'+
                        '</select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Cantidad en pesos:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="cantidad" id="cantidad" class="form-control col-md-9 soloNumeros" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Concepto adicional (opcional):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="conceptoAdicional" id="conceptoAdicional" class="form-control col-md-9 conceptoAdicional" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Incluir Iva?</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="checkbox" name="iva" id="iva" class="form-control col-md-9" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">IVA:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" value="0" name="ivaInput" id="ivaInput" class="form-control col-md-9" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Versi&oacute;n:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9"><select id="version"><option value="3.3">3.3</select></div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" idBanco="-2" conceptoAdicional="" id="timbraIngresosNewManual" deVerdad="1" class="btn btn-success">Timbrar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<label style="font-size: 20px;">Si la factura que vas a timbrar, sustituye a una o a varias previamente timbradas, favor de seleccionar las facturas aqui:</label>'+
                        '<input type="text" id="cfdiRelacionado" class="form-control" autocomplete>'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<ul class="to_do" id="toDo"></ul>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);

      //<option value="3.2">3.2</select>
       var cadSelect = '';
   $.ajax({
    url: "/cargaTimbradoManual",  
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i =0;
        var aver2 = Object.keys(resp.clientes);
        var first = true;
        var guardaIdCliente = 0;
        for(i=0;i<aver2.length;i++)
        {
          if(first)
          {
            first=false;
            guardaIdCliente = resp.clientes[aver2[i]].IdCliente;
          }
          cadSelect = cadSelect + '<option value="'+resp.clientes[aver2[i]].IdCliente+'">'+resp.clientes[aver2[i]].Rfc+' - '+resp.clientes[aver2[i]].RazonSocial+'</option>';
        }
        var cadOption = '<select style="font-size:20px;"  idBanco="-2" class="selectCliente" id="selectCliente-2">'+cadSelect+'</select>';
        $("#ponSelect").html(cadOption);
        $('.selectCliente').val(guardaIdCliente).trigger('change');

        var facturas = new Array();
        aver2 = Object.keys(resp.facturas);
        for(i=0;i<aver2.length;i++)
        {
          facturas.push( aver2[i].toString().trim() + " | "+ resp.facturas[aver2[i]]["Rfc"]+ " | $"+ resp.facturas[aver2[i]]["Cantidad"]+ " | "+ resp.facturas[aver2[i]]["Fecha"]);
        }    
        listaGlobalUUID = new Array();
            $('#cfdiRelacionado').autocomplete({
              lookup: facturas,
              appendTo: '#autocomplete-container',
              onSelect: function(e, term, item){
                    console.log(e.value);
                    var arr = e.value.split("|");
                    var UUID = arr[0].trim();
                    if(!listaGlobalUUID.includes(UUID)) {
                      listaGlobalUUID.push(UUID);
                      $("#toDo").append('<li>'+e.value+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="closeToDo"><i class="fa fa-close"></i></span></li>');
                      
                    }
                   
                }
            });  


      }
    }
  });
  
 });
var listaGlobalUUID = new Array();

$(document).on("click", ".closeToDo", function (){
  $(this).parent().remove();
});
$(document).on("click", "#configClientes", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Configurar Clientes</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Configurar Clientes</h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">RFC:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="rfc" id="rfc" class="form-control col-md-9" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Razon Social:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="razonSocial" id="razonSocial" class="form-control col-md-9" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Correo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="correo" id="correo" class="form-control col-md-9" style="float: right;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="nuevoCliente" idCliente="-1" class="btn btn-success">Guardar nuevo</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Clientes  <small> para facturaci&oacute;n </small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>RFC</th><th>Razon Social</th><th>Correo</th><th>NumCtaPago</th><th>Editar</th></thead>'+
                        '<tbody id="tablaClientes"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTablaClientes();
 });

$(document).on("click", "#configuraDestinatariosIglesias", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Configurar Tesoreros de Iglesia</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Configurar Tesoreros de iglesia local<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombre" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Correo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="correo" id="correo" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Password:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="password" id="password" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                   '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Iglesia:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<select id="iglesiaSelect" style="font-size:22px;"></select>'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="nuevoUsuarioIglesia" idCedula="-1" class="btn btn-success">Guardar nuevo</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Tesoreros de <small>Iglesia local</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Nombre</th><th>Correo</th><th>Iglesia</th><th>Activo</th><th>Reset Password</th><th>Editar</th></thead>'+
                        '<tbody id="tablaUsuariosIglesia"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaUsuariosIglesias();
 });


$(document).on("click", "#conceptosInformes", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear concepto de informe de diezmos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear concepto de informe de diezmos<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombre" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6"><br>'+
                        '<button type="submit" id="guardarNuevoConcepto" idDiezmoConcepto="-1" class="btn btn-success">Guardar nuevo concepto</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Crear <small>C&eacute;dulas</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>Nombre</th><th>Activo</th><th>Editar</th></thead>'+
                        '<tbody id="tablaDiezmoConcepto"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaDiezmoConcepto();
 });

$(document).on("click", "#crearCedula", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Crear c&eacute;dula</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Crear c&eacute;dulas<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="nombre" id="nombre" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevaCedula" idCedula="-1" class="btn btn-success">Guardar nueva</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Crear <small>C&eacute;dulas</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th><th>Nombre</th><th>Editar</th></thead>'+
                        '<tbody id="tablaCedulas"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaCedulas();
 });
   $(document).on("click", "#tipoDeDimensiones", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Tipo de dimensiones</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Tipo de dimensiones <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">C&oacute;digo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="codigo" id="codigo" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Descripci&oacute;n:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="descr" id="descr" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="guardarNuevoTipoDeDimension" ANL_CAT_ID="-1" class="btn btn-success">Guardar nuevo o modificacion</button>'+
                      '</div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="limpiar" class="btn btn-warning">Limpiar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="clearfix"></div>'+
                '<div class="col-md-12 col-sm-12 col-xs-12">'+
                  '<div class="x_panel">'+
                    '<div class="x_title">'+
                      '<h2>Dimensiones <small>Tipos de dimensiones</small></h2>'+
                      '<div class="clearfix"></div>'+
                    '</div>'+
                    '<div class="x_content">'+
                      '<table class="table table-hover">'+
                        '<thead><tr><th>#</th><th>Nombre</th><th>Descripci&oacute;n</th><th>Editar</th></thead>'+
                        '<tbody id="tablaDimensiones"></tbody>'+
                      '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
      actualizaTipoDeDimensiones();
 });

   $(document).on("click", "#diarioReporte", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diario en PDF</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diario en excel <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Diario</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="diario" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarDiarioEnPDF" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });


   $(document).on("click", "#reciboDiarioReporte", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Recibo de caja</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Recibo de caja <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Diario</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="diario" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReciboEnPDF" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });

   $(document).on("click", "#diarioEnExcel", function (){
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diario en excel</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diario en excel <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Diario</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="diario" class="form-control col-md-10" style="float: left;" />'+
                       '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarDiarioEnExcel" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';     
      $("#mainContent").html(cad);
 });
   
   

$(document).on("click", "#buscarDiarioReferenciaButton", function (){
  var referencia = parseFloat($("#referencia").val());
  if(referencia=="")
  {
    alert("Tienes que escribir una referencia antes de buscar! perdon");
    return;
  }
 
  var param = {referencia : referencia};
  $.ajax({
    url: "/buscarPorReferenciaDiarios",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i;
        var cad='';
        var aver2 = Object.keys(resp.diarios);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'">'+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+format2(resp.diarios[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.diarios[aver2[i]]["D_C"]+'</td><td>'+resp.diarios[aver2[i]]["TRANS_DATETIME"]+'</td><td>'+resp.diarios[aver2[i]]["PERIOD"]+'</td><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.diarios[aver2[i]]["TREFERENCE"]+'</td></tr>';
        } 
        $("#tablaDiariosPorCantidad").html(cad);
      }
       if(resp.success==0)
      {
        alert("Hubi un error!");
      }
    }
  });  
});


$(document).on("click", "#buscarPorCantidadSumaButton", function (){
  var cantidad = parseFloat($("#cantidad").val());
  if(cantidad==0)
  {
    alert("Tienes que escribir una cantidad antes de buscar! perdon");
    return;
  }
 
  var param = {cantidad : cantidad};
  $.ajax({
    url: "/buscarPorCantidadSuma",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i;
        var cad='';
        var aver2 = Object.keys(resp.diarios);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'">'+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+format2(resp.diarios[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.diarios[aver2[i]]["D_C"]+'</td><td>'+resp.diarios[aver2[i]]["TRANS_DATETIME"]+'</td><td>'+resp.diarios[aver2[i]]["PERIOD"]+'</td><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.diarios[aver2[i]]["TREFERENCE"]+'</td></tr>';
        } 
        $("#tablaDiariosPorCantidad").html(cad);
      }
       if(resp.success==0)
      {
        alert("Hubo un error!");
      }
    }
  });  
});

$(document).on("click", "#buscarDiarioCantidadButton", function (){
  var cantidad = parseFloat($("#cantidad").val());
  if(cantidad==0)
  {
    alert("Tienes que escribir una cantidad antes de buscar! perdon");
    return;
  }
 
  var param = {cantidad : cantidad};
  $.ajax({
    url: "/buscarPorCantidadDiarios",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i;
        var cad='';
        var aver2 = Object.keys(resp.diarios);
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'">'+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+format2(resp.diarios[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.diarios[aver2[i]]["D_C"]+'</td><td>'+resp.diarios[aver2[i]]["TRANS_DATETIME"]+'</td><td>'+resp.diarios[aver2[i]]["PERIOD"]+'</td><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.diarios[aver2[i]]["TREFERENCE"]+'</td></tr>';
        } 
        $("#tablaDiariosPorCantidad").html(cad);
      }
       if(resp.success==0)
      {
        alert("Hubi un error!");
      }
    }
  });  
});

$(document).on("click", "#guardarClasificacionDimensiones", function (){
  var TipoDondeEstaranLasDimensiones = parseInt($("#TipoDondeEstaranLasDimensiones").val());
  if(TipoDondeEstaranLasDimensiones==0)
  {
    alert("Tienes que seleccionar un tipo antes de guardar!");
    return;
  }
  var S_HEAD1 = $("#entry1").attr("S_HEAD");
  var S_HEAD2 = $("#entry2").attr("S_HEAD");
  var S_HEAD3 = $("#entry3").attr("S_HEAD");
  var S_HEAD4 = $("#entry4").attr("S_HEAD");
  var S_HEAD5 = $("#entry5").attr("S_HEAD");
  var S_HEAD6 = $("#entry6").attr("S_HEAD");
  var S_HEAD7 = $("#entry7").attr("S_HEAD");
  var S_HEAD8 = $("#entry8").attr("S_HEAD");
  var S_HEAD9 = $("#entry9").attr("S_HEAD");
  var S_HEAD10 = $("#entry10").attr("S_HEAD");
  var entry1 = $("#entry1").val();
  var entry2 = $("#entry2").val();
  var entry3 = $("#entry3").val();
  var entry4 = $("#entry4").val();
  var entry5 = $("#entry5").val();
  var entry6 = $("#entry6").val();
  var entry7 = $("#entry7").val();
  var entry8 = $("#entry8").val();
  var entry9 = $("#entry9").val();
  var entry10 = $("#entry10").val();  
  var param = {TipoDondeEstaranLasDimensiones : TipoDondeEstaranLasDimensiones,
    entry1 : entry1,
    entry2 : entry2,
    entry3 : entry3,
    entry4 : entry4,
    entry5 : entry5,
    entry6 : entry6,
    entry7 : entry7,
    entry8 : entry8,
    entry9 : entry9,
    entry10 : entry10,
    S_HEAD1 : S_HEAD1,
    S_HEAD2 : S_HEAD2,
    S_HEAD3 : S_HEAD3,
    S_HEAD4 : S_HEAD4,
    S_HEAD5 : S_HEAD5,
    S_HEAD6 : S_HEAD6,
    S_HEAD7 : S_HEAD7,
    S_HEAD8 : S_HEAD8,
    S_HEAD9 : S_HEAD9,
    S_HEAD10 : S_HEAD10
  };
  $.ajax({
    url: "/guardarClasificacionDimensiones",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("Los cambios en la asignacion de las dimensiones se hicieron correctamente!");
      }
       if(resp.success==2)
      {
        alert("Hubi un error!");
      }
    }
  });  
});

var contains = function(needle) {
    // Per spec, the way to identify NaN is that it is not equal to itself
    var findNaN = needle !== needle;
    var indexOf;

    if(!findNaN && typeof Array.prototype.indexOf === 'function') {
        indexOf = Array.prototype.indexOf;
    } else {
        indexOf = function(needle) {
            var i = -1, index = -1;

            for(i = 0; i < this.length; i++) {
                var item = this[i];

                if((findNaN && item !== item) || item === needle) {
                    index = i;
                    break;
                }
            }

            return index;
        };
    }

    return indexOf.call(this, needle) > -1;
};


function requestCedulaBanco(resp) {
  var cuentas = Object.keys(resp.cuentas);
        var i,j;
        $("#tablaConcentradoCedulaBancos").html('');
        for(i=0;i<cuentas.length;i++)
        {
          var periodos = Object.keys(resp.cuentas[cuentas[i]].PeriodosList);
          var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>'+resp.cuentas[cuentas[i]].Nombre+'<small></small></h2>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br>'+
                  '<div class="form-group">'+
                  '<table class="table table-striped" id="tabla'+cuentas[i]+'"><thead><tr><th>'+resp.cuentas[cuentas[i]].Codigo+'</th>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<th>'+periodos[j]+'</th>';
                   }
                   cad=cad+'</tr></thead><tbody><tr><td>Saldo Inicial</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].SaldoInicial,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Depositos</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].Depositos,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Retiros</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].Retiros,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Saldo Final</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].SaldoFinal,'$')+'</td>';
                   }
                  cad=cad+'</tr></tbody></table>'+                  
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>';
            $("#tablaConcentradoCedulaBancos").append(cad);
        }
        var propias = Object.keys(resp.propias);
        var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Reporte de transferencias y cheques entre cuentas propias<small></small></h2>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br>'+
                  '<div class="form-group">'+
                  '<table class="table table-striped" id="propias"><thead><tr><th>Fecha de operaci&oacute;n</th>'+
                  '<th>Cta. Bancaria Salida</th><th>Importe Salida</th><th>Cta. Bancaria Entrada</th><th>Importe Salida</th><th>Observaciones</th></tr></thead><tbody>';
        var bandera = false;
        for(i=0;i<propias.length;i++)
        {
          cad=cad+'<tr><td>'+resp.propias[propias[i]].Fecha+'</td><td>'+resp.propias[propias[i]].SalidaCuenta+'</td><td>'+resp.propias[propias[i]].SalidaImporte+'</td><td>'+resp.propias[propias[i]].EntradaCuenta+'</td><td>'+resp.propias[propias[i]].EntradaImporte+'</td><td>'+resp.propias[propias[i]].Observaciones+'</td></tr>';
          bandera = true;           
        }
        cad=cad+'</tr></tbody></table>'+                  
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>';
        if(bandera)
        {
          $("#tablaConcentradoCedulaBancos").append(cad);  
        }
}
$(document).on("click", "#generarCedulaCuentasBancos", function (){
    var urlCampo = $("#campoLista").val();
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = $("#alPeriodo").val();
  var hash  = $("#campoLista").attr("hash");
  var param = {delPeriodo : delPeriodo, alPeriodo : alPeriodo, hash : hash }
  var dataType = "json";
  var type = "post";
  var crossDomain = false;
  var jsonpCallback = "";
  if(urlCampo.length>1)
  {
    dataType = "jsonp";
    type = "GET";
    crossDomain = true;
    jsonpCallback = "requestCedulaBanco";
  }
  $.ajax({
    url: "/generarCedulaCuentasBancos",
    dataType : dataType,
    type : type,
    //crossDomain : crossDomain,
    data: param,
    //jsonpCallback : jsonpCallback,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var cuentas = Object.keys(resp.cuentas);
        var i,j;
        $("#tablaConcentradoCedulaBancos").html('');
        for(i=0;i<cuentas.length;i++)
        {
          var periodos = Object.keys(resp.cuentas[cuentas[i]].PeriodosList);
          var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>'+resp.cuentas[cuentas[i]].Nombre+'<small></small></h2>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br>'+
                  '<div class="form-group">'+
                  '<table class="table table-striped" id="tabla'+cuentas[i]+'"><thead><tr><th>'+resp.cuentas[cuentas[i]].Codigo+'</th>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<th>'+periodos[j]+'</th>';
                   }
                   cad=cad+'</tr></thead><tbody><tr><td>Saldo Inicial</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].SaldoInicial,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Depositos</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].Depositos,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Retiros</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].Retiros,'$')+'</td>';
                   }
                   cad=cad+'</tr><tr><td>Saldo Final</td>';
                   for(j=0;j<periodos.length;j++)
                   {
                    cad=cad+'<td>'+format2(resp.cuentas[cuentas[i]].PeriodosList[periodos[j]].SaldoFinal,'$')+'</td>';
                   }
                  cad=cad+'</tr></tbody></table>'+                  
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>';
            $("#tablaConcentradoCedulaBancos").append(cad);
        }
        var propias = Object.keys(resp.propias);
        var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Reporte de transferencias y cheques entre cuentas propias<small></small></h2>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br>'+
                  '<div class="form-group">'+
                  '<table class="table table-striped" id="propias"><thead><tr><th>Fecha de operaci&oacute;n</th>'+
                  '<th>Cta. Bancaria Salida</th><th>Importe Salida</th><th>Cta. Bancaria Entrada</th><th>Importe Salida</th><th>Observaciones</th></tr></thead><tbody>';
        var bandera = false;
        for(i=0;i<propias.length;i++)
        {
          cad=cad+'<tr><td>'+resp.propias[propias[i]].Fecha+'</td><td>'+resp.propias[propias[i]].SalidaCuenta+'</td><td>'+resp.propias[propias[i]].SalidaImporte+'</td><td>'+resp.propias[propias[i]].EntradaCuenta+'</td><td>'+resp.propias[propias[i]].EntradaImporte+'</td><td>'+resp.propias[propias[i]].Observaciones+'</td></tr>';
          bandera = true;           
        }
        cad=cad+'</tr></tbody></table>'+                  
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>';
        if(bandera)
        {
          $("#tablaConcentradoCedulaBancos").append(cad);  
        }
      }
    }
  });
});

$(document).on("click", "#generarReporteDeMAT", function (){
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = $("#alPeriodo").val();

  var param = {delPeriodo : delPeriodo, alPeriodo : alPeriodo}
  $.ajax({
    url: "/generarReporteDeMAT",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#graficas").html("");
        Chart.defaults.global.legend = {
          enabled: true
        };
         Chart.defaults.global.title = {
          enabled: true
        };
        var iglesias = Object.keys(resp.diezmos);
        var cuentas = Object.keys(resp.cuentas);
        var periodos = Object.keys(resp.periodos);
        var iglesiasArray = new Array();
        var i, j, k;
        var height = 27 * iglesias.length;
        var maximo = 0;
        var iglesiasIndicadores = new Array();
        for(i=0;i<iglesias.length;i++)
        {
          iglesiasArray.push(resp.diezmos[iglesias[i]].Nombre);
        }
        var cadJS='<script type="text/javascript">';
        for(i=0;i<cuentas.length;i++)
        {
          var cuenta = resp.cuentas[cuentas[i]].ACNT_CODE;
          var ncuenta = resp.cuentas[cuentas[i]].DESCR;
          maximo=0;
            var datos = new Array();
             var datosPrimo = new Array();
           
            iglesiasIndicadores = new Array();
            for(k=0;k<iglesias.length;k++)  
            {
              var valor = 0;
              for(j=0;j<periodos.length;j++) 
              {
                var PERIOD = periodos[j];
                if(PERIOD in resp.diezmos[iglesias[k]].PeriodosList)
                {
                  if(cuenta in resp.diezmos[iglesias[k]].PeriodosList[PERIOD].CuentasList)
                  {
                    valor += resp.diezmos[iglesias[k]].PeriodosList[PERIOD].CuentasList[cuenta].Saldo;
                  } 
                }
              }
              if(valor!=0)
              {
                valor = Math.round(valor * 100) / 100 ;
              }
              datos.push(valor);
              var valorPrimo = valor*-1;
              datosPrimo.push(valorPrimo);
              if(valorPrimo>maximo){maximo=valorPrimo;}
            }
            if(maximo<0)
            {
              maximo*=-1;
            }
            for(k=0;k<iglesias.length;k++)
            {
              iglesiasIndicadores.push( {text: resp.diezmos[iglesias[k]].Nombre, max: maximo});
            }
            var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
                '<div class="x_panel">'+
                  '<div class="x_title">'+
                    '<h2>'+ncuenta+' '+delPeriodo+' al '+alPeriodo+'<small>Personas</small></h2>'+
                    '<div class="clearfix"></div>'+
                  '</div>'+
                  '<div class="x_content">'+
                    '<div id="echart_bar_horizontal'+cuenta+'" style="height: '+height+'px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;"><div style="position: relative; overflow: hidden; width: 245px; height: '+height+'px; cursor: default;"><canvas width="490" height="'+(height+370)+'" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 245px; height: '+height+'px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 46px; top: 184.167px; background-color: rgba(0, 0, 0, 0.498039);">Apr<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#26B99A"></span>2015 : 104,970<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#34495E"></span>2016 : 121,594</div></div>'+
                  '</div>'+
                '</div>'+
              '</div>';
            cad=cad + '<div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>'+ncuenta+' '+delPeriodo+' al '+alPeriodo+'<small>Personas</small></h2>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <div id="echart_sonar'+cuenta+'" style="height: 770px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;"><div style="position: relative; overflow: hidden; width: 545px; height: 770px; cursor: default;"><canvas width="790" height="1110" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 545px; height: 770px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: -99.9844px; top: 127px; background-color: rgba(0, 0, 0, 0.498039);">Actual Spending<br>Sales : 5000<br>Administration : 14000<br>Information Techology : 28000<br>Customer Support : 31000<br>Development : 42000<br>Marketing : 21000</div></div>\
                  </div>\
                </div>\
              </div>';

          $("#graficas").append(cad);
            var echartRadar = echarts.init(document.getElementById('echart_sonar'+cuenta), theme);

      echartRadar.setOption({
        title: {
          text: ncuenta,
          subtext: cuenta
        },
         tooltip: {
            trigger: 'item'
        },
        legend: {
          orient: 'vertical',
          x: 'right',
          y: 'bottom',
          data: [ncuenta]
        },
        toolbox: {
          show: true,
          feature: {
            restore: {
              show: true,
              title: "Restaurar"
            },
            saveAsImage: {
              show: true,
              title: "Guardar Imagen"
            }
          }
        },
        polar: [{
          indicator: iglesiasIndicadores
        }],
        calculable: true,
        series: [{
          name: ncuenta,
          type: 'radar',
          data: [{
            value: datosPrimo,
            name: ncuenta
          }]
        }]
      });


           var echartBar = echarts.init(document.getElementById('echart_bar_horizontal'+cuenta), theme);
            echartBar.setOption({
              title: {
                text: ncuenta,
                subtext: cuenta
              },
              tooltip: {
                trigger: 'axis'
              },
              legend: {
                x: 100,
                data: [ncuenta]
              },
              toolbox: {
                show: true,
                feature: {
                  saveAsImage: {
                    show: true,
                    title: "Guardar imagen"
                  }
                }
              },
              calculable: true,
              xAxis: [{
                type: 'value',
                boundaryGap: [0, 0.01]
              }],
              yAxis: [{
                type: 'category',
                data: iglesiasArray
              }],
              series: [{
                name: ncuenta,
                type: 'bar',
                data: datos
              }]
            });
         // }//for J
         }// for I
        //cadJS = cadJS + '<\/script>';
        //$("#graficasJS").html(cadJS);
      }
       if(resp.success==0)
      {
        alert("Hubo un error, perdon");
      }
    }
  });  
});




$(document).on("click", ".detalleIglesiaSabana", function (){
  var mes = parseInt($(this).attr("mes"));
  var cuenta = $(this).attr("cuenta");
  var iglesia = $(this).attr("iglesia");
  var anio = $("#delPeriodo").val();
  var periodo = anio+"0"+mes;
  if(mes<10)
  {
    periodo = anio+"00"+mes;
  }

  

  var param = {mes : mes, cuenta : cuenta, iglesia: iglesia, periodo : periodo, anio : anio}
  $.ajax({
    url: "/detalleIglesiaSabana",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         $("html, body").animate({ scrollTop: 0 }, "slow");
        var i;
        var cad='';
        var aver2 = Object.keys(resp.diarios);
        var total=0.0;
        cad=cad+'<tr><td>Diario</a></td><td>Linea</td><td>Cantidad</td><td>D_C</td><td>Fecha</td><td>Periodo</td><td>Descripci&oacute;n</td><td>Referencia</td></tr>';
        for(i=0;i<aver2.length;i++)
        {
          total+=parseFloat(resp.diarios[aver2[i]]["AMOUNT"]);
          cad=cad+'<tr><td><u><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'">'+resp.diarios[aver2[i]]["Diario"]+'</a></u></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+format2(resp.diarios[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.diarios[aver2[i]]["D_C"]+'</td><td>'+resp.diarios[aver2[i]]["TRANS_DATETIME"]+'</td><td>'+resp.diarios[aver2[i]]["PERIOD"]+'</td><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.diarios[aver2[i]]["TREFERENCE"]+'</td></tr>';
        } 
        cad=cad+'<tr><td colspan="8">Total: '+format2(total,"$")+'</td></tr>';
        $("#tablaDetalleSabana").html(cad);
      }
      if(resp.success==0)
      {
        alert("Hubo un error, perdon");
      }
    }
  });  
});

$(document).on("click", ".detalleSabana", function (){
  var delPeriodo = $(this).attr("delPeriodo");
  var alPeriodo = $(this).attr("alPeriodo");
  var llave = $(this).attr("llave");
  var er = $(this).attr("er");
  

  var param = {er : er, llave : llave, delPeriodo: delPeriodo, alPeriodo : alPeriodo}
  $.ajax({
    url: "/detalleSabana",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i;
        var cad='';
        var aver2 = Object.keys(resp.diarios);
        var total=0.0;
        cad=cad+'<tr><td>Diario</a></td><td>Linea</td><td>Cantidad</td><td>D_C</td><td>Fecha</td><td>Periodo</td><td>Descripci&oacute;n</td><td>Referencia</td></tr>';
        for(i=0;i<aver2.length;i++)
        {
          total+=parseFloat(resp.diarios[aver2[i]]["AMOUNT"]);
          cad=cad+'<tr><td><u><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'">'+resp.diarios[aver2[i]]["Diario"]+'</a></u></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+format2(resp.diarios[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.diarios[aver2[i]]["D_C"]+'</td><td>'+resp.diarios[aver2[i]]["TRANS_DATETIME"]+'</td><td>'+resp.diarios[aver2[i]]["PERIOD"]+'</td><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.diarios[aver2[i]]["TREFERENCE"]+'</td></tr>';
        } 
        cad=cad+'<tr><td colspan="8">Total: '+format2(total,"$")+'</td></tr>';
        cad=cad+'<tr><td colspan="8">Llave: '+llave+'</td></tr>';
        $("#tablaDetalleSabana").html(cad);
      }
      if(resp.success==0)
      {
        alert("Hubo un error, perdon");
      }
    }
  });  
});


$(document).on("click", "#generarReporteDeMATSabana", function (){
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = $("#alPeriodo").val();

  var param = {delPeriodo : delPeriodo, alPeriodo : alPeriodo}
  $.ajax({
    url: "/generarReporteDeMATSabana",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var sabana = Object.keys(resp.sabana);
        var cad='';
        var total=0.0;
        for(i=0;i<sabana.length;i++)
        {
          var nombre = resp.sabana[sabana[i]].Nombre;
          var er = sabana[i];
          var conceptos = Object.keys(resp.sabana[sabana[i]].PorConcepto);
          cad=cad+'<tr><td colspan="3"></td></tr>';        
          cad=cad+'<tr><td colspan="3">'+nombre+' '+er+'</td></tr>';
          cad=cad+'<tr><td colspan="3"></td></tr>';        
          cad=cad+'<tr><td>Nombre de la Cuenta</td><td>Detalle</td><td>Saldo</td></tr>';
          total=0.0;
          for(k=0;k<conceptos.length;k++)  
          {
            var llave = conceptos[k];
            var saldo = resp.sabana[sabana[i]].PorConcepto[llave].Saldo;  
            var NombreCuenta = resp.sabana[sabana[i]].PorConcepto[llave].NombreCuenta;    
            total+=saldo;
            cad=cad+'<tr><td style="cursor:pointer;" class="detalleSabana" er="'+er+'" llave="'+llave+'" delPeriodo="'+delPeriodo+'" alPeriodo="'+alPeriodo+'"><u>'+NombreCuenta+'</u></td><td>'+llave+'</td><td>'+format2(saldo,'$')+'</td></tr>';
          }//for K
          cad=cad+'<tr><td colspan="3">Total: '+format2(total,'$')+'</td></tr>';
        }// for I
        $("#tablaSabana").html(cad);
      }
      if(resp.success==0)
      {
        alert("Hubo un error, perdon");
      }
    }
  });  
});



$(document).on("click", "#generarReporteDeIglesiasDiezmosEnExcel", function (){
  var delPeriodo = $("#delPeriodo").val();
 // var alPeriodo = $("#alPeriodo").val();
 //816 x 624
 //1334   y 1020
  window.open(
            "/generarReporteDeIglesiasDiezmosEnExcel?delPeriodo=" + delPeriodo,
            '_blank'
          );
});  
$(document).on("click", "#generarReporteDeIglesiasDiezmos", function (){
  var delPeriodo = $("#delPeriodo").val();
  
  var param = {delPeriodo : delPeriodo}
  $.ajax({
    url: "/generarReporteDeIglesiasDiezmos",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i, j, k, l;
        var cad='';
        var aver = Object.keys(resp.diezmos);

        for(i=0;i<aver.length;i++)
        {
          cad=cad+'<tr><td></td></tr>';
          cad=cad+'<tr><td>Distrito: '+resp.diezmos[aver[i]].Nombre+'</td></tr>';
          var iglesias = Object.keys(resp.diezmos[aver[i]].IglesiaList);
          for(j=0;j<iglesias.length;j++)
          {
            cad=cad+'<tr><td>Iglesia: '+resp.diezmos[aver[i]].IglesiaList[iglesias[j]].Nombre+'</td></tr>';
            var cuentas = Object.keys(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList);
            for(k=0;k<cuentas.length;k++)
            {
              var periodos = Object.keys(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList[cuentas[k]].PeriodoList);
              if(k==0)
              {
                cad=cad+'<tr><td>Nombre</td><td>Enero</td><td>Febrero</td><td>Marzo</td><td>Abril</td><td>Mayo</td><td>Junio</td><td>Julio</td><td>Agosto</td><td>Septiembre</td><td>Octubre</td><td>Noviembre</td><td>Diciembre</td></tr>';
              }
              cad=cad+'<tr><td>'+resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList[cuentas[k]].DESCR+'</td>';
              cad=cad+'<td class="detalleIglesiaSabana" mes="1" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'1'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="2" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'2'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="3" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'3'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="4" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'4'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="5" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'5'+cuentas[k]+'"></td>\
              <td  class="detalleIglesiaSabana" mes="6" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'6'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="7" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'7'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="8" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'8'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="9" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'9'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="10" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'10'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="11" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'11'+cuentas[k]+'"></td>\
              <td class="detalleIglesiaSabana" mes="12" cuenta="'+cuentas[k]+'" iglesia="'+iglesias[j]+'" id="'+iglesias[j]+'12'+cuentas[k]+'"></td></tr>'
              for(l=0;l<periodos.length;l++)
              {
                var p = parseInt(periodos[l].substring(5));
                $('#'+iglesias[j]+p+cuentas[k]).html(format2( parseFloat(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList[cuentas[k]].PeriodoList[periodos[l]].Saldo),'$'));
              }
            }
          }
        }
        $("#iglesiasReporteDiezmosDistritos").html(cad);
  

        for(i=0;i<aver.length;i++)
        {
          var iglesias = Object.keys(resp.diezmos[aver[i]].IglesiaList);
          for(j=0;j<iglesias.length;j++)
          {
            var cuentas = Object.keys(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList);
            for(k=0;k<cuentas.length;k++)
            {
              var periodos = Object.keys(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList[cuentas[k]].PeriodoList);
              for(l=0;l<periodos.length;l++)
              {
                var p = parseInt(periodos[l].substring(5));
                $('#'+iglesias[j]+p+cuentas[k]).html(format2( parseFloat(resp.diezmos[aver[i]].IglesiaList[iglesias[j]].CuentaList[cuentas[k]].PeriodoList[periodos[l]].Saldo),'$'));
              }
            }
          }
        }
        
      }
    }
  });
});

$(document).on("click", "#generarReporteDeIglesias", function (){
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = $("#alPeriodo").val();

  var param = {delPeriodo : delPeriodo, alPeriodo : alPeriodo}
  $.ajax({
    url: "/generarReporteDeIglesias",
    dataType : "json",
    type : "post",
    data: param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#graficas").html("");
        Chart.defaults.global.legend = {
          enabled: true
        };
         Chart.defaults.global.title = {
          enabled: true
        };
        var iglesias = Object.keys(resp.diezmos);
        var cuentas = Object.keys(resp.cuentas);
        var periodos = Object.keys(resp.periodos);
        var iglesiasArray = new Array();
        var i, j, k;
        var height = 27 * iglesias.length;
        for(i=0;i<iglesias.length;i++)
        {
          iglesiasArray.push(resp.diezmos[iglesias[i]].Nombre);
        }
        var cadJS='<script type="text/javascript">';
        for(i=0;i<cuentas.length;i++)
        {
          var cuenta = resp.cuentas[cuentas[i]].ACNT_CODE;
          var ncuenta = resp.cuentas[cuentas[i]].DESCR;
          /*for(j=0;j<periodos.length;j++) 
          {
            var PERIOD = periodos[j];*/
            var datos = new Array();
            for(k=0;k<iglesias.length;k++)  
            {
              var valor = 0;
              //var PERIODOS = Object.keys();
              for(j=0;j<periodos.length;j++) 
              {
                var PERIOD = periodos[j];
                if(PERIOD in resp.diezmos[iglesias[k]].PeriodosList)
                {
                  if(cuenta in resp.diezmos[iglesias[k]].PeriodosList[PERIOD].CuentasList)
                  {
                    valor += resp.diezmos[iglesias[k]].PeriodosList[PERIOD].CuentasList[cuenta].Saldo;
                  } 
                }
              }
              if(valor!=0)
              {
                valor = Math.round(valor * 100) / 100  
              }
              datos.push(valor);
            }
            var cad = '<div class="col-md-12 col-sm-12 col-xs-12">'+
                '<div class="x_panel">'+
                  '<div class="x_title">'+
                    '<h2>'+ncuenta+' '+delPeriodo+' al '+alPeriodo+'<small>Iglesias</small></h2>'+
                    '<div class="clearfix"></div>'+
                  '</div>'+
                  '<div class="x_content">'+
                    '<div id="echart_bar_horizontal'+cuenta+'" style="height: '+height+'px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;"><div style="position: relative; overflow: hidden; width: 245px; height: '+height+'px; cursor: default;"><canvas width="490" height="'+(height+370)+'" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 245px; height: '+height+'px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 46px; top: 184.167px; background-color: rgba(0, 0, 0, 0.498039);">Apr<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#26B99A"></span>2015 : 104,970<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#34495E"></span>2016 : 121,594</div></div>'+
                  '</div>'+
                '</div>'+
              '</div>';

          $("#graficas").append(cad);


           var echartBar = echarts.init(document.getElementById('echart_bar_horizontal'+cuenta), theme);
            echartBar.setOption({
              title: {
                text: ncuenta,
                subtext: cuenta
              },
              tooltip: {
                trigger: 'axis'
              },
              legend: {
                x: 100,
                data: [ncuenta]
              },
              toolbox: {
                show: true,
                feature: {
                  saveAsImage: {
                    show: true,
                    title: "Save Image"
                  }
                }
              },
              calculable: true,
              xAxis: [{
                type: 'value',
                boundaryGap: [0, 0.01]
              }],
              yAxis: [{
                type: 'category',
                data: iglesiasArray
              }],
              series: [{
                name: ncuenta,
                type: 'bar',
                data: datos
              }]
            });
         // }//for J
         }// for I
        //cadJS = cadJS + '<\/script>';
        //$("#graficasJS").html(cadJS);
      }
       if(resp.success==0)
      {
        alert("Hubo un error, perdon");
      }
    }
  });  
});

   $(document).on("click", "#generarBUNIT", function (){
    var BUNIT = $("#BUNIT").val();
    var cuadre = $("#cuadre").val();
    var descr = $("#descr").val();
    if(BUNIT.length==3)
    {
      if(cuadre=="")
      {
        alert("Tienes que escribir la cuenta de cuadre");
        return;
      }
      if(descr=="")
      {
        alert("Tienes que escribir la descripcion de la unidad de negocio");
        return;
      }
      var param = {BUNIT : BUNIT, cuadre : cuadre, descr : descr}
      $.ajax({
        url: "/generarBUNIT",
        dataType : "json",
        type : "post",
        data: param,
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("Unidad de negocio creada!");
          }
           if(resp.success==2)
          {
            alert("Ya existe esa Unidad de negocio!");
          }
        }
      });  
    }
    else
    {
      alert("La Unidad de Negocio debe de tener 3 letras");
    }
    
  });
   
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

$(document).on("click", "#guardarConfigOpciones", function (){
    var tipoDimension = $("#selectTipoD").val();
    var periodoTimbrado = $("#selectPeriodoTimbrado").val();
    var base = $("#base").val();
    var PCENT_AFROUMN = $("#PCENT_AFROUMN").val();
    var PCENT_SALUD = $("#PCENT_SALUD").val();
    var Parte_Exenta = $("#Parte_Exenta").val();
    var Empresa = $("#Empresa").val().trim();
 
    var rfc = $("#rfc").val().trim();
    var rfcAnterior = $("#rfcAnterior").val().trim();
    var regimen = $("#regimen").val().trim();
    var razonSocial = $("#razonSocial").val().trim();
    var regPatronal = $("#regPatronal").val().trim();
    if(regPatronal.length!=11)
    {
      alert("El registro patronal debe de tener 11 caracteres");
      return;
    }


    var lugarExpedicion = $("#lugarExpedicion").val().trim();
    if(lugarExpedicion.length!=5)
    {
      alert("El lugar de expedicion es el codigo postal, y es de 5 numeros");
      return;
    }

    var pass = Base64.encode($("#passwordDeSAT").val());
    var param = {pass : pass, Empresa : Empresa, tipoDimension : tipoDimension, rfcAnterior : rfcAnterior, rfc : rfc, regimen : regimen, razonSocial : razonSocial, regPatronal : regPatronal, lugarExpedicion : lugarExpedicion, periodoTimbrado : periodoTimbrado, base : base, PCENT_AFROUMN : PCENT_AFROUMN, PCENT_SALUD : PCENT_SALUD, Parte_Exenta : Parte_Exenta}
    $.ajax({
      url: "/guardarConfigOpciones",
      dataType : "json",
      type : "post",
      data: param,
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          alert("Cambios guardados!");
        }
      }
    });  
  });
   
   $(document).on("click", "#guardarBUNIT", function (){
    var BUNIT = $("#selectBUNIT").val();
    var param = {BUNIT : BUNIT}
    $.ajax({
      url: "/guardarBUNIT",
      dataType : "json",
      type : "post",
      data: param,
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          $("#BUNITACTUAL").html(BUNIT);
          alert("Unidad de negocio cambiada");
        }
      }
    });  
  });
   

$(document).on("click", "#configOpciones", function (){
  $.ajax({
    url: "/configOpciones",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Opciones de la unidad de negocio</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Opciones de la unidad de negocio <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre de la empresa: (carpeta en C:/Compacw/Empresas/)</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" maxlength="50" name="Empresa" id="Empresa" class="form-control col-md-10" style="float: left;" value="'+resp.Empresa+'" />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Password de : (carpeta en C:/Compacw/Empresas/)</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" maxlength="100" id="passwordDeSAT" class="form-control col-md-10" style="float: left;" value="'+Base64.decode(resp.pass)+'" />'+
                      '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="selectTipoD">Seleccionar uso de unidades de negocio:</label>'+
                          '<select id="selectTipoD" class="form-control" required="" >'+
                            '<option value="1">Las obligatorias</option>'+
                            '<option value="2">Las opcionales y las obligatorias</option>'+
                            '<option value="3">Ninguna</option>'+
                            '<option value="4">Todas</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<h3>Datos para facturaci&oacute;n:</h3>'+
                    '<br><hr>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-6 col-sm-6 col-xs-6">Periodo que empieza el timbrado con Sevenplus:</label>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<select id="selectPeriodoTimbrado" class="form-control col-md-16" style="float: right;"></select>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">Base Denominacional:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="base" id="base" class="form-control col-md-10" style="float: right;" value="'+resp.base+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">PCENT AFROUMN (ejemplo 0.026):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="PCENT_AFROUMN" id="PCENT_AFROUMN" class="form-control col-md-10" style="float: right;" value="'+resp.afroumn+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">PCENT SALUD (ejemplo: 0.055):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="PCENT_SALUD" id="PCENT_SALUD" class="form-control col-md-10" style="float: right;" value="'+resp.salud+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">Parte Exenta (ejemplo: 6884.7):</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="Parte_Exenta" id="Parte_Exenta" class="form-control col-md-10" style="float: right;" value="'+resp.exenta+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">RFC Anterior:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="rfcAnterior" id="rfcAnterior" class="form-control col-md-10" style="float: right;" value="'+resp.rfcAnterior+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">RFC:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="15" name="rfc" id="rfc" class="form-control col-md-10" style="float: right;" value="'+resp.rfc+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">Raz&oacute;n Social:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="150" name="razonSocial" id="razonSocial" class="form-control col-md-10" style="float: right;" value="'+resp.razonSocial+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="regimen">Regimen fiscal de la empresa u organizaci&oacute;n:</label>'+
                          '<select id="regimen" class="form-control" required="" >'+
                          '<option value="601">General de Ley Personas Morales</option>'+
                          '<option value="603">Personas Morales con Fines no Lucrativos</option>'+
                          '<option value="605">Sueldos y Salarios e Ingresos Asimilados a Salarios</option>'+
                          '<option value="606">Arrendamiento</option>'+
                          '<option value="608">Demás ingresos</option>'+
                          '<option value="609">Consolidación</option>'+
                          '<option value="610">Residentes en el Extranjero sin Establecimiento Permanente en México</option>'+
                          '<option value="611">Ingresos por Dividendos (socios y accionistas)</option>'+
                          '<option value="612">Personas Físicas con Actividades Empresariales y Profesionales</option>'+
                          '<option value="614">Ingresos por intereses</option>'+
                          '<option value="616">Sin obligaciones fiscales</option>'+
                          '<option value="620">Sociedades Cooperativas de Producción que optan por diferir sus ingresos</option>'+
                          '<option value="621">Incorporación Fiscal</option>'+
                          '<option value="622">Actividades Agrícolas, Ganaderas, Silvícolas y Pesqueras</option>'+
                          '<option value="623">Opcional para Grupos de Sociedades</option>'+
                          '<option value="624">Coordinados</option>'+
                          '<option value="628">Hidrocarburos</option>'+
                          '<option value="607">Régimen de Enajenación o Adquisición de Bienes</option>'+
                          '<option value="629">De los Regímenes Fiscales Preferentes y de las Empresas Multinacionales</option>'+
                          '<option value="630">Enajenación de acciones en bolsa de valores</option>'+
                          '<option value="615">Régimen de los ingresos por obtención de premios</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">Reg. Patronal:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" maxlength="11" name="regPatronal" id="regPatronal" class="form-control col-md-10" style="float: right;" value="'+resp.regPatronal+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label style="float: left;" class="control-label col-md-3 col-sm-3 col-xs-3">Lugar de Expedici&oacute;n: (C&oacute;digo postal)</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text"  name="lugarExpedicion" id="lugarExpedicion" class="form-control col-md-9 soloNumeros" maxlength="5" style="float: right;" value="'+resp.lugarExpedicion+'" />'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarConfigOpciones" class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';
        $("#mainContent").html(cad);
        var i=0, aver2 = Object.keys(resp.periodos), cad = '<option value="0">Seleciona un periodo</option>';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+resp.periodos[aver2[i]].PERIOD+'">'+resp.periodos[aver2[i]].PERIOD+'</option>';
        }
        $('#selectPeriodoTimbrado').html(cad);
        $('#selectPeriodoTimbrado option[value="'+resp.periodoTimbrado+'"]').attr('selected', 'selected');        
        $('#regimen option[value="'+resp.regimen+'"]').attr('selected', 'selected');        



      $('#selectTipoD option[value="'+resp.tipoDimension+'"]').attr('selected', 'selected');
    }});  
  });

$(document).on("click", "#cambiarUnidadDeNegocio", function (){
  $.ajax({
    url: "/cambiarUnidadDeNegocio",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
//      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
    },
    complete : function (){
    }, 
    success : function (resp){
      var bunit = resp.BUNIT;
      var aver2 = Object.keys(resp.unidades);
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Cambiar de unidad de negocio</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Cambiar unidad de negocio <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<p><label for="selectBUNIT">Seleccionar unidad de negocio:</label>'+
                          '<select id="selectBUNIT" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarBUNIT" class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';
         $("#mainContent").html(cad);
       cad = '';
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString()+'">'+aver2[i].toString()+'</option>';
      }          
      $("#selectBUNIT").html(cad);
      $('#selectBUNIT option[value="'+bunit+'"]').attr('selected', 'selected');
    }});  
  });


$(document).on("change", "#persona", function (){
    var ERSeleccionado = $(this).val();
  var BUNITViejito = $("#BUNITACTUAL").html();
    var USUARIOACTUAL = $("#USUARIOACTUAL").html();
    if(USUARIOACTUAL=="MPJ")
    {
      BUNITViejito = $("#selectCampo").val();
    }
   var param = {ER: ERSeleccionado, BUNITViejito : BUNITViejito};
       $.ajax({
        url: "/cargaInfoManuntencionPersona",
        dataType : "json",
        type : "post",
        data: param, 
        async : true,
        beforeSend : function (){
    //      myMsgSpinner = msgSpinner("Obteniendo la informacion...");
        },
        complete : function (){
        }, 
        success : function (resp){

          if(resp.success==1)
          {
           $("#CuentaBancariaManual").val(resp.CuentaBancaria);
           $("#rfcManual").val(resp.rfc);
           $("#correoManual").val(resp.correo);
           $("#c_EstadoManual").val(resp.c_Estado);
           $("#c_PaisManual").val(resp.c_Pais);
           $("#nombreManual").val(resp.nombre);
           $("#curpManual").val(resp.curp);
           $("#numEmpleadoManual").val(resp.numEmpleado);
           $("#TipoContratoManual").val(resp.TipoContrato);
           $("#TipoJornadaManual").val(resp.TipoJornada);
           $("#NumSeguridadSocialManual").val(resp.NumSeguridadSocial);
           var FechaInicioRelLaboral = resp.FechaInicioRelLaboral
           //var anio = FechaInicioRelLaboral.substring(0,4);
           //var mes = FechaInicioRelLaboral.substring(5,7);
           //var dia = FechaInicioRelLaboral.substring(8,10);

           var anio = FechaInicioRelLaboral.substring(6);
           var mes = FechaInicioRelLaboral.substring(3,5);
           var dia = FechaInicioRelLaboral.substring(0,2);
           
          // FechaInicioRelLaboral = anio+"-"+mes+"-"+dia;
           FechaInicioRelLaboral = anio+"-"+mes+"-"+dia;
           console.log(FechaInicioRelLaboral);
           $("#FechaInicioRelLaboralManual").val(FechaInicioRelLaboral);
           $("#FechaInicioRelLaboral").val(FechaInicioRelLaboral);
           $("#RiesgoPuestoManual").val(resp.RiesgoPuesto);
           $("#PeriodicidadPagoManual").val(resp.PeriodicidadPago);
           $("#DepartamentoManual").val(resp.Departamento);
           $("#TipoRegimenManual").val(resp.TipoRegimen);
           $("#c_BancoManual").val(resp.c_Banco);
           $("#SDIManual").val(resp.SDI);
          }
          if(resp.success==2)
          {
            //todavia no hay registros de esa persona
             $("#rfcManual").val("");
             $("#correoManual").val("");
             $("#nombreManual").val("");
             $("#curpManual").val("");
             $("#SDIManual").val("");
             $("#numEmpleadoManual").val("");
             //$("#TipoContrato").val(resp.TipoContrato);
             //$("#TipoJornada").val(resp.TipoJornada);
             $("#NumSeguridadSocialManual").val("");
             $("#CuentaBancariaManual").val("");
            
             $("#FechaInicioRelLaboralManual").val("");
             //$("#RiesgoPuesto").val(resp.RiesgoPuesto);
             //$("#PeriodicidadPago").val(resp.PeriodicidadPago);
             //$("#Departamento").val(resp.Departamento);
             //$("#TipoRegimen").val(resp.TipoRegimen);
            $("#noSeVe").css("display","block");
          }
          if(resp.success==0)
          {
            alert("Hubo un error!");
          }
        }
      });

});
$(document).on("click", "#timbradoManuntencionManual", function (){
    
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Timbrado de manuntenci&oacute;n Manual</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Timbrado de manuntenci&oacute;n Manual<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                '<br><br>'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodoTimbradoManual">Del periodo:</label>'+
                          '<select id="delPeriodoTimbradoManual" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                     '<br><br>'+
                      '<div class="form-group">'+
                      '<p><label for="persona">De la persona:</label>'+
                          '<select id="persona" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_TipoNomina_Manual">Tipo de N&oacute;mina:</label>'+
                          '<select id="c_TipoNomina_Manual" class="form-control" required="" >'+
                            '<option value="O">Ordinaria</option>'+
                            '<option value="E">Extraordinaria</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Correo:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="email" name="correoManual" maxlength="150"  id="correoManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3">Nombre:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="nombreManual" maxlength="150"  id="nombreManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">RFC:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="rfcManual" maxlength="15"  id="rfcManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">CURP:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="curpManual" maxlength="20"  id="curpManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">N&uacute;mero de empleado: (3 cifras)</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="numEmpleadoManual" maxlength="3"  id="numEmpleadoManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_PaisManual">Pais:</label>'+
                          '<select id="c_PaisManual" class="form-control" required="" >'+
                          '<option value="MEX">M&eacute;xico</option>'+
                          '<option value="USA">Estados Unidos</option>'+
                          '<option value="CAN">C&aacute;nada</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_EstadoManual">Estado:</label>'+
                          '<select id="c_EstadoManual" class="form-control" required="" >'+
                          '<option value="AGU">Aguascalientes</option>'+
                          '<option value="BCN">Baja Norte</option>'+
                          '<option value="BCS">Baja Sur</option>'+
                          '<option value="CAM">Campeche</option>'+
                          '<option value="CHP">Chiapas</option>'+
                          '<option value="CHH">Chihuahua</option>'+
                          '<option value="COA">Coahuila</option>'+
                          '<option value="COL">Colima</option>'+
                          '<option value="DIF">Ciudad de M&eacute;xico</option>'+
                          '<option value="DUR">Durango</option>'+
                          '<option value="GUA">Guanajuato</option>'+
                          '<option value="GRO">Guerrero</option>'+
                          '<option value="HID">Hidalgo</option>'+
                          '<option value="JAL">Jalisco</option>'+
                          '<option value="MEX">M&eacute;xico</option>'+
                          '<option value="MIC">Michoac&aacute;n</option>'+
                          '<option value="MOR">Morelos</option>'+
                          '<option value="NAY">Nayarit</option>'+
                          '<option value="NLE">Nuevo Le&oacute;n</option>'+
                          '<option value="OAX">Oaxaca</option>'+
                          '<option value="PUE">Puebla</option>'+
                          '<option value="QUE">Quer&eacute;taro</option>'+
                          '<option value="ROO">Quintana Roo</option>'+
                          '<option value="SLP">San Luis Potos&iacute;</option>'+
                          '<option value="SIN">Sinaloa</option>'+
                          '<option value="SON">Sonora</option>'+
                          '<option value="TAB">Tabasco</option>'+
                          '<option value="TAM">Tamaulipas</option>'+
                          '<option value="TLA">Tlaxcala</option>'+
                          '<option value="VER">Veracruz</option>'+
                          '<option value="YUC">Yucat&aacute;n</option>'+
                          '<option value="ZAC">Zacatecas</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoContratoManual">Tipo de contrato:</label>'+
                          '<select id="TipoContratoManual" class="form-control" required="" >'+
                          '<option value="01">Contrato de trabajo por tiempo indeterminado</option>'+
                          '<option value="02">Contrato de trabajo para obra determinada</option>'+
                          '<option value="03">Contrato de trabajo por tiempo determinado</option>'+
                          '<option value="04">Contrato de trabajo por temporada</option>'+
                          '<option value="05">Contrato de trabajo sujeto a prueba</option>'+
                          '<option value="06">Contrato de trabajo con capacitación inicial</option>'+
                          '<option value="07">Modalidad de contratación por pago de hora laborada</option>'+
                          '<option value="08">Modalidad de trabajo por comisi&oacute;n laboral</option>'+
                          '<option value="09">Modalidades de contratación donde no existe relación de trabajo</option>'+
                          '<option value="10">Jubilaci&oacute;n, pensi&oacute;n, retiro.</option>'+
                          '<option value="99">Otro contrato</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoJornadaManual">Tipo de jornada:</label>'+
                          '<select id="TipoJornadaManual" class="form-control" required="" >'+
                          '<option value="01">Diurna</option>'+
                          '<option value="02">Nocturna</option>'+
                          '<option value="03">Mixta</option>'+
                          '<option value="04">Por hora</option>'+
                          '<option value="05">Reducida</option>'+
                          '<option value="06">Continuada</option>'+
                          '<option value="07">Partida</option>'+
                          '<option value="08">Por turnos</option>'+
                          '<option value="99">Otra Jornada</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">N&uacute;mero de seguridad social:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="NumSeguridadSocialManual" maxlength="15"  id="NumSeguridadSocialManual" class="form-control col-md-10" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Fecha de inicio de relacion laboral:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="FechaInicioRelLaboralManual" placeholder="Fecha de inicio" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="RiesgoPuestoManual">Riesgo de puesto:</label>'+
                          '<select id="RiesgoPuestoManual" class="form-control" required="" >'+
                          '<option value="">Seleccione una opción</option>'+
                          '<option value="1">Clase I</option>'+
                          '<option value="2">Clase II</option>'+
                          '<option value="3">Clase III</option>'+
                          '<option value="4">Clase IV</option>'+
                          '<option value="5">Clase V</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="PeriodicidadPagoManual">Periodicidad de pago:</label>'+
                          '<select id="PeriodicidadPagoManual" class="form-control" required="" >'+
                          '<option value="01">Diario</option>'+
                          '<option value="02">Semanal</option>'+
                          '<option value="03">Catorcenal</option>'+
                          '<option value="04">Quincenal</option>'+
                          '<option value="05">Mensual</option>'+
                          '<option value="06">Bimestral</option>'+
                          '<option value="07">Unidad obra</option>'+
                          '<option value="08">Comisi&oacute;n</option>'+
                          '<option value="09">Precio alzado</option>'+
                          '<option value="10">Decenal</option>'+
                          '<option value="99">Otra Periodicidad</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="DepartamentoManual">Departamento:</label>'+
                          '<select id="DepartamentoManual" class="form-control" required="" >'+
                          '<option value="MINISTROS DE CULTO">MINISTROS DE CULTO</option>'+
                          '<option value="ASOCIADOS RELIGIOSOS">ASOCIADOS RELIGIOSOS</option>'+
                          '<option value="TRABAJADORES">TRABAJADORES</option>'+
                          '<option value="EMERITOS">EMERITOS</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoRegimenManual">Tipo de Regimen:</label>'+
                          '<select id="TipoRegimenManual" class="form-control" required="" >'+
                          '<option value="02">Sueldos</option>'+
                          '<option value="03">Jubilados</option>'+
                          '<option value="04">Pensionados</option>'+
                          '<option value="05">Asimilados Miembros Sociedades Cooperativas Produccion</option>'+
                          '<option value="06">Asimilados Integrantes Sociedades Asociaciones Civiles</option>'+
                          '<option value="07">Asimilados Miembros consejos</option>'+
                          '<option value="08">Asimilados comisionistas</option>'+
                          '<option value="09">Asimilados Honorarios</option>'+
                          '<option value="10">Asimilados acciones</option>'+
                          '<option value="11">Asimilados otros</option>'+
                          '<option value="99">Otro Regimen</option>'+
                          '</select></p>'+
                    '</div>'+
                     '<br><br>'+
                    '<div class="form-group">'+
                    '<label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Cuenta bancaria:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="CuentaBancariaManual" maxlength="18"  id="CuentaBancariaManual" class="form-control col-md-10" style="float: right;" />'+
                        '</div>'+
                        '<label id="CuentaBancariaMensaje" class="control-label col-md-12 col-sm-12 col-xs-12" style="float:left;"></label>'+
                    '</div>'+
                     '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="c_BancoManual">Banco donde se le deposita:</label>'+
                          '<select id="c_BancoManual" class="form-control" required="" >'+
                          '<option value="002">BANAMEX</option>'+
                          '<option value="006">BANCOMEXT</option>'+
                          '<option value="009">BANOBRAS</option>'+
                          '<option value="012">BBVA BANCOMER</option>'+
                          '<option value="014">SANTANDER</option>'+
                          '<option value="019">BANJERCITO</option>'+
                          '<option value="021">HSBC</option>'+
                          '<option value="030">BAJIO</option>'+
                          '<option value="032">IXE</option>'+
                          '<option value="036">INBURSA</option>'+
                          '<option value="037">INTERACCIONES</option>'+
                          '<option value="042">MIFEL</option>'+
                          '<option value="044">SCOTIABANK</option>'+
                          '<option value="058">BANREGIO</option>'+
                          '<option value="059">INVEX</option>'+
                          '<option value="060">BANSI</option>'+
                          '<option value="062">AFIRME</option>'+
                          '<option value="072">BANORTE</option>'+
                          '<option value="137">BANCOPPEL</option>'+
                          '</select></p>'+
                    '</div>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<p><label class="control-label col-md-3 col-sm-3 col-xs-3" style="float:left;">Salario diario integrado:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="text" name="SDIManual"  id="SDIManual" class="form-control col-md-10 soloNumeros" style="float: right;" /></p>'+
                        '</div>'+
                    '</div>'+
                     '<br><br>'+
                 '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Fecha de pago:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="FechaPagoManual" placeholder="Fecha de pago" aria-describedby="inputSuccess2Status3">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha3" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status3" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="clearfix"/>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">De la Fecha:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="deFechaManual" placeholder="Fecha Inicial de Pago" aria-describedby="inputSuccess2StatusX">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2StatusX" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">A la Fecha:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="aFechaManual" placeholder="Fecha Final de Pago" aria-describedby="inputSuccess2Status2">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha2" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status2" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="x_content">'+
                        '<br><table id="percepcionesTablaNomina" class="table table-striped" style="text-align:center; font-size:16px;"><thead><tr><th>Percepcion</th><th>Gravado</th><th>Exento</th><th>Agregar</th></tr></thead><tbody ></tbody></table>'+
                      '</div>'+
                      '<div class="x_content">'+
                        '<br><table id="deduccionesTablaNomina" class="table table-striped" style="text-align:center; font-size:16px;"><thead><tr><th>Deducciones</th><th>Cantidad</th><th>Agregar</th></tr></thead><tbody ></tbody></table>'+
                      '</div>'+
                      '<div class="x_content">'+
                        '<br><table id="otrosPagosTablaNomina" class="table table-striped" style="text-align:center; font-size:16px;"><thead><tr><th>Otros Pagos</th><th>Cantidad</th><th>Agregar</th></tr></thead><tbody ></tbody></table>'+
                      '</div>'+
                    '<br><br>'+
                      '<div id="loadingCampos"/>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<button type="submit" deVerdad="0" class="btn btn-success generaVistaPreviaManual" id="generaVistaPreviaManual">Genera vista previa</button>'+
                      '</div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" deVerdad="1" class="btn btn-warning generaVistaPreviaManual" id="timbrarManual">Timbrar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $("#FechaPagoManual").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
      $("#deFechaManual").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
      $("#aFechaManual").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
      $("#FechaInicioRelLaboralManual").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
   
      var cadSelectPercepciones = '<select style="font-size:16px" id="nuevaPercepcion"></select><hr><div id="ocultoPercepciones"/><hr>';

      var cadSelectDeducciones = '<select style="font-size:16px" id="nuevaDeduccion"></select>';
      var cadSelectOtrosPagos = '<select style="font-size:16px" id="nuevaOtrosPagos"></select>';

      $('#percepcionesTablaNomina > tbody:last-child').append('<tr><td>'+cadSelectPercepciones+'</td><td><input type="text" class="soloNumeros" id="gravadoPercepcion"/></td><td><input type="text" class="soloNumeros" id="exentoPercepcion"/></td><td><button type="submit" id="agregarPercepcion" class="btn btn-success">Agregar</button></td></tr>'); 
      $('#deduccionesTablaNomina > tbody:last-child').append('<tr><td>'+cadSelectDeducciones+'</td><td><input type="text" class="soloNumeros" id="importeDeduccion"/></td><td><button type="submit" id="agregarDeduccion" class="btn btn-success">Agregar</button></td></tr>');
      $('#otrosPagosTablaNomina > tbody:last-child').append('<tr><td>'+cadSelectOtrosPagos+'</td><td><input type="text" class="soloNumeros" id="importeOtrosPagos"/></td><td><button type="submit" id="agregarOtrosPagos" class="btn btn-success">Agregar</button></td></tr>'); 
     
     dameOptionSegunTipoConceptoSATDeLaBD(1);
     dameOptionSegunTipoConceptoSATDeLaBD(2);
     dameOptionSegunTipoConceptoSATDeLaBD(3);
    var param = {BUNIT : $("#BUNITACTUAL").html()}
        $.ajax({
          url: "/cargaER",
          dataType : "json",
          type : "post",
          async : true,
          data : param,
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              $("#generaVistaPreviaManual").attr("LugarExpedicion",resp.lugarExpedicion);
              $("#timbrarManual").attr("LugarExpedicion",resp.lugarExpedicion);
              $("#generaVistaPreviaManual").attr("rfc",resp.rfc);
              $("#timbrarManual").attr("rfc",resp.rfc);
              $("#generaVistaPreviaManual").attr("regimen",resp.regimen);
              $("#timbrarManual").attr("regimen",resp.regimen);
              $("#generaVistaPreviaManual").attr("razonSocial",resp.razonSocial);
              $("#timbrarManual").attr("razonSocial",resp.razonSocial);
              $("#generaVistaPreviaManual").attr("regPatronal",resp.regPatronal);
              $("#timbrarManual").attr("regPatronal",resp.regPatronal);
              
              
             
              

              var i, cad= '<option value="0">No esta en la lista</option>';
              var aver2 = Object.keys(resp.personas);
              for(i=0;i<aver2.length;i++)
              {
                cad=cad+'<option value="'+resp.personas[aver2[i]].ANL_CODE.trim()+'">'+resp.personas[aver2[i]].NAME.trim()+'</option>';
              }
              $("#persona").html(cad);
            }
          }
        });
       $('#deFecha').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
       $('#aFecha').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
        $('#FechaPago').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim().substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodoTimbradoManual").html(cad);
        //  $("#alPeriodo").html(cad);
         // $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });

function dameFolioQueSigue () {
  $.ajax({
    url: "/dameFolioQueSigue",
    dataType : "json",
    type : "post",
    async : false,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      return resp.folio;
    }
  });
}
function timestampCFDI () {
  
 var pad = function (amount, width) {
  var padding = "";
  while (padding.length < width - 1 && amount < Math.pow(10, width - padding.length - 1))
   padding += "0";
  return padding + amount.toString();
 }
 var date = new Date();
 date = date ? date : new Date();
 var offset = date.getTimezoneOffset();
 return pad(date.getFullYear(), 4)
   + "-" + pad(date.getMonth() + 1, 2)
   + "-" + pad(date.getDate(), 2)
   + "T" + pad(date.getHours(), 2)
   + ":" + pad(date.getMinutes(), 2)
   + ":" + pad(date.getSeconds(), 2);
}
function dameNoCertificadoSegunRFC (rfc)  {
  if (rfc=="IAS930628FA8") {//TAMBO
    return "00001000000307190478";
  }
  if (rfc=="IAS1610245E2") {//ANT
    return "00001000000406760642";
  }
  if (rfc=="IAS161024N33") {//SONORA
    return "00001000000407084128";
  }
  if (rfc=="IAS161024KU0") {//GOLFO
    return "00001000000407047411";
  }
  if (rfc=="IAS160707FS4") {//Sinaloa
    return "00001000000406730421";
  }
  if (rfc=="IAS161024796") {//Chihuahua
    return "00001000000406465085";
  }
  if (rfc=="IAS161024RK9") {//Occidente
    return "00001000000406629683";
  }
  if (rfc=="IAS160707U62") {//UMN
    return "00001000000406720491";
  }
  if (rfc=="IAS161020KZ6") {//Noroccidental
    return "00001000000412126996";
  }
  if (rfc=="IAS161024ER2") {//Baja Norte
    return "00001000000406656019";
  }
  if (rfc=="IAS1610243N1") {//Baja Sur
    return "00001000000406557389";
  }
  if (rfc=="IAS930629HZ1") {//Noreste 
    return "00001000000305906415";
  }
  if (rfc=="IAS1610243P6") {//Noreste nuevo
    return "00001000000411704960";
  }
  if (rfc=="IAS180719LX2") {//Regio nuevo
    return "00001000000411998935";
  }
  return "";
}

$(document).on("change", "#c_TipoNomina_Manual", function (){
  var valorActual = $(this).val();
  if(valorActual=="E")
  {
    alert("Atencion! Periodicidad de Pago debe de ser 99 - Otra Periodicidad");
  }
});
$(document).on("focusout", "#FechaPagoManual", function (){
  var FechaPagoManual = $("#FechaPagoManual").val().trim();
  $("#deFechaManual").val(FechaPagoManual.substring(0,8)+"01");
  var final = "30";
  var mes = parseInt(FechaPagoManual.substring(5,7));

  if(mes==1 || mes == 3 || mes == 5 || mes == 7 || mes == 8 || mes == 10 || mes == 12) 
  {
    final = "31";
  }
  else
  {
    if(mes==2)
    {
      var anio = parseInt(FechaPagoManual.substring(0,4));
      if(anio%4==0)
      {
        final="29";
      }
      else
      {
        final="28";
      }
    }
  }
  $("#aFechaManual").val(FechaPagoManual.substring(0,8)+final);  
});
$(document).on("click", ".generaVistaPreviaManual", function (){
  //validaciones
  var FechaPagoManual = $("#FechaPagoManual").val().trim();
  var FechaInicioRelLaboralManual = $("#FechaInicioRelLaboralManual").val().trim();
  if(FechaPagoManual=="")
  {
    alert("Te falta de escribir la fecha de pago");
    return;
  }
  var deFechaManual = $("#deFechaManual").val().trim();
  if(deFechaManual=="")
  {
    alert("Te falta de escribir la fecha inicial del rango de pago");
    return;
  }
  var aFechaManual = $("#aFechaManual").val().trim();
  if(aFechaManual=="")
  {
    alert("Te falta de escribir la fecha final del rango de pago");
    return;
  }
  var cuantasPercepciones = $(".percepcionesClass").length;
  if(cuantasPercepciones==0)
  {
    alert("Te falta de agregar por lo menos una percepcion");
    return;
  }
  var cuantasDeducciones = $(".deduccionesClass").length;
  var cuantasOtrosPagos = $(".otrosPagosClass").length;
    
  var periodo = $("#delPeriodoTimbradoManual").val().trim(); 
  var folioQueSigue = -123;
  var recuerdame = this;
  $.ajax({
    url: "/dameFolioQueSigue",
    dataType : "json",
    type : "post",
    async : false,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      folioQueSigue = resp.folio;
      var ER = $("#persona").val().trim();
      var deVerdad = $(recuerdame).attr("deVerdad");
      var regPatronal = $(recuerdame).attr("regPatronal");

     
      var CuentaBancariaManual = $("#CuentaBancariaManual").val().trim();
      var rfcManual = $("#rfcManual").val().trim();
      var correoManual = $("#correoManual").val().trim();
      var c_TipoNomina_Manual = $("#c_TipoNomina_Manual").val().trim();
      var c_EstadoManual = $("#c_EstadoManual").val().trim();
      var c_PaisManual = $("#c_PaisManual").val().trim();
      var nombreManual = $("#nombreManual").val().trim();
      var curpManual = $("#curpManual").val().trim();
      var numEmpleadoManual = $("#numEmpleadoManual").val().trim();
      var TipoContratoManual = parseInt($("#TipoContratoManual").val().trim());
      var TipoJornadaManual = $("#TipoJornadaManual").val().trim();
      var NumSeguridadSocialManual = $("#NumSeguridadSocialManual").val().trim();
               
      var TimeStamp = timestampCFDI();// $(recuerdame).attr("TimeStamp");
      var totalPercepciones = 0;
      var totalGravado = 0;
      var totalExento = 0;
      var totalOtrosPagos = 0;
      var totalDeducciones = 0;
      var totalISR = 0;
      var subTotal = 0;
      var totalNeto = 0;
      var i;
      var cadPercepciones = '';
      var tengoFiniquito = false;
      var tengoIndemnizacion = false;
      for(i=0;i<cuantasPercepciones;i++)
      {
        $($('.percepcionesClass')[i]).attr("");
        totalGravado+= parseFloat($($(".percepcionesClass")[i]).attr("gravado"));
        totalExento+= parseFloat($($(".percepcionesClass")[i]).attr("exento"));
        var idRegistro = parseInt($($(".percepcionesClass")[i]).attr("idRegistro"));
        var cadIdRegistro = ""+idRegistro;
        if(idRegistro<10)
        {
          cadIdRegistro = "00"+idRegistro;
        }
        else
        {
          if(idRegistro<100)
          {
            cadIdRegistro = "0"+idRegistro;
          }  
        }

        cadPercepciones=cadPercepciones+$($(".percepcionesClass")[i]).attr("TipoSAT")+'|'+cadIdRegistro+'|'+$($(".percepcionesClass")[i]).attr("Concepto")+'|'+$($(".percepcionesClass")[i]).attr("gravado")+'|'+$($(".percepcionesClass")[i]).attr("exento")+'|';
        if($($(".percepcionesClass")[i]).attr("TipoSAT")=="039")
        {
          tengoFiniquito = true;
          cadPercepciones=cadPercepciones+$($(".percepcionesClass")[i]).attr("exento")+'|'+$($(".percepcionesClass")[i]).attr("exento")+'|0.00|';//0.00 es ingreso NO acumulable
        }
        if($($(".percepcionesClass")[i]).attr("TipoSAT")=="025")
        {
          tengoIndemnizacion = true;
          //total pagado, num años de servicio, ultimo sueldo mensual ordinario, ingreso acumulable, ingreso no acumulable
          cadPercepciones=cadPercepciones+$("#TotalPagado").val()+'|'+$("#NumAñosServicio").val()+'|'+$("#UltimoSueldoMensOrd").val()+'|'+$("#IngresoAcumulable").val()+'|'+$("#IngresoNoAcumulable").val()+'|';
        }
        
      }
      totalGravado = Math.round(totalGravado * 100) / 100;
      totalExento = Math.round(totalExento * 100) / 100;
      totalPercepciones=totalGravado+totalExento;
      totalPercepciones = Math.round(totalPercepciones * 100) / 100;
      var TipoSAT = "";
      var cadDeducciones = '';
      for(i=0;i<cuantasDeducciones;i++)
      {
        totalDeducciones+= parseFloat($($(".deduccionesClass")[i]).attr("importe"));
        TipoSAT = $($(".deduccionesClass")[i]).attr("TipoSAT");
        if(parseInt(TipoSAT)==2)//ISR
        {
          totalISR+= parseFloat($($(".deduccionesClass")[i]).attr("importe"));
        }
        var idRegistro = parseInt($($(".deduccionesClass")[i]).attr("idRegistro"));
        var cadIdRegistro = ""+idRegistro;
        if(idRegistro<10)
        {
          cadIdRegistro = "00"+idRegistro;
        }
        else
        {
          if(idRegistro<100)
          {
            cadIdRegistro = "0"+idRegistro;
          }  
        }
        var importeD = parseFloat($($(".deduccionesClass")[i]).attr("importe"));
        importeD = Math.round(importeD * 100) / 100;
      
        if (!(importeD%1)) { 
          importeD = importeD + ".00";
        }
        importeD = ""+ importeD;
        var auxA = importeD.split(".");
        if(auxA.length==2) {
          var v = auxA[1].length;
          if(v==1) {
            importeD = importeD + "0";
          }
        }
        cadDeducciones=cadDeducciones+$($(".deduccionesClass")[i]).attr("TipoSAT")+'|'+cadIdRegistro+'|'+$($(".deduccionesClass")[i]).attr("Concepto")+'|'+importeD+'|';
      }
      var cadOtrosPagos = '';
      for(i=0;i<cuantasOtrosPagos;i++)
      {
        totalOtrosPagos+= parseFloat($($(".otrosPagosClass")[i]).attr("importe"));
        TipoSAT = $($(".otrosPagosClass")[i]).attr("TipoSAT");
        var idRegistro = parseInt($($(".otrosPagosClass")[i]).attr("idRegistro"));
        var cadIdRegistro = ""+idRegistro;
        if(idRegistro<10)
        {
          cadIdRegistro = "00"+idRegistro;
        }
        else
        {
          if(idRegistro<100)
          {
            cadIdRegistro = "0"+idRegistro;
          }  
        }
        cadOtrosPagos=cadOtrosPagos+$($(".otrosPagosClass")[i]).attr("TipoSAT")+'|'+cadIdRegistro+'|'+$($(".otrosPagosClass")[i]).attr("Concepto")+'|'+$($(".otrosPagosClass")[i]).attr("importe")+'|';
        if($($(".otrosPagosClass")[i]).attr("TipoSAT")=="002")//subsidio
        {

          var totalGravadoPercepciones =totalGravado;
          var subsidioFijo = "";
            if (totalGravadoPercepciones <= 1768.96) {
              subsidioFijo = "407.02";
            } else {
              if (totalGravadoPercepciones <= 2653.38) {
                subsidioFijo = "406.83";
              } else {
                if (totalGravadoPercepciones <= 3472.84) {
                  subsidioFijo = "406.62";
                } else {
                  if (totalGravadoPercepciones <= 3537.87) {
                    subsidioFijo = "392.77";
                  } else {
                    if (totalGravadoPercepciones <= 4446.15) {
                      subsidioFijo = "382.46";
                    } else {
                      if (totalGravadoPercepciones <= 4717.18) {
                        subsidioFijo = "354.23";
                      } else {
                        if (totalGravadoPercepciones <= 5335.42) {
                          subsidioFijo = "324.87";
                        } else {
                          if (totalGravadoPercepciones <= 6224.67) {
                            subsidioFijo = "294.63";
                          } else {
                            if (totalGravadoPercepciones <= 7113.9) {
                              subsidioFijo = "253.54";
                            } else {
                              if (totalGravadoPercepciones <= 7382.33) {
                                subsidioFijo = "217.61";
                              } else {
                                subsidioFijo = "0";
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          cadOtrosPagos=cadOtrosPagos+subsidioFijo+'|';
        }
        /*if(parseInt(TipoSAT)==2)//ISR
        {
          totalISR+= parseFloat($($(".deduccionesClass")[i]).attr("importe"));
        }*/
      }
      
      totalISR = Math.round(totalISR * 100) / 100;
      totalDeducciones = Math.round(totalDeducciones * 100) / 100;
      var totalOtrasDeducciones = totalDeducciones - totalISR;
      totalOtrasDeducciones = Math.round(totalOtrasDeducciones * 100) / 100;

      totalOtrosPagos = Math.round(totalOtrosPagos * 100) / 100;
      
      subTotal = totalPercepciones + totalOtrosPagos;
      subTotal = Math.round(subTotal * 100) / 100;
      totalNeto = subTotal - totalDeducciones;
      totalNeto = Math.round(totalNeto * 100) / 100;
      
      if (!(subTotal%1)) { 
        subTotal = subTotal + ".00";
      }
      subTotal = ""+ subTotal;
      var auxA = subTotal.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          subTotal = subTotal + "0";
        }
      }
      if (!(totalNeto%1)) { 
        totalNeto = totalNeto + ".00";
      }
      totalNeto = ""+ totalNeto;
      auxA = totalNeto.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalNeto = totalNeto + "0";
        }
      }

      if (!(totalPercepciones%1)) { 
        totalPercepciones = totalPercepciones + ".00";
      }
      totalPercepciones = ""+ totalPercepciones;
      auxA = totalPercepciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalPercepciones = totalPercepciones + "0";
        }
      }
      if (!(totalOtrosPagos%1)) { 
        totalOtrosPagos = totalOtrosPagos + ".00";
      }
      totalOtrosPagos = ""+ totalOtrosPagos;
      auxA = totalOtrosPagos.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalOtrosPagos = totalOtrosPagos + "0";
        }
      }
      if (!(totalDeducciones%1)) { 
        totalDeducciones = totalDeducciones + ".00";
      }
      totalDeducciones = ""+ totalDeducciones;
      auxA = totalDeducciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalDeducciones = totalDeducciones + "0";
        }
      }
      

      var LugarExpedicion = $(recuerdame).attr("LugarExpedicion").trim();
      var rfcEmisor = $(recuerdame).attr("rfc").trim();
      var regimen = $(recuerdame).attr("regimen").trim();
      var razonSocial = $(recuerdame).attr("razonSocial").trim();
      var rfcReceptor = $("#rfcManual").val().trim();
      var razonSocialReceptor = $("#nombreManual").val().trim();



      var deVerdad = $(recuerdame).attr("deVerdad");


      var CuentaBancariaManual = $("#CuentaBancariaManual").val().trim();
      var rfcManual = $("#rfcManual").val().trim();
      var correoManual = $("#correoManual").val().trim();
      
      ///borrar variables de por aqui
      var c_EstadoManual = $("#c_EstadoManual").val().trim();
      var TipoRegimenManual = $("#TipoRegimenManual").val().trim();
      
      var c_PaisManual = $("#c_PaisManual").val().trim();
      var nombreManual = $("#nombreManual").val().trim();
      var DepartamentoManual = $("#DepartamentoManual").val().trim();
      var PeriodicidadPagoManual = $("#PeriodicidadPagoManual").val().trim();
      var c_BancoManual = $("#c_BancoManual").val().trim();
      var SDIManual = $("#SDIManual").val().trim();
      var RiesgoPuestoManual = $("#RiesgoPuestoManual").val().trim();
      
      var numEmpleadoManual = $("#numEmpleadoManual").val().trim();
      var TipoContratoManual = $("#TipoContratoManual").val().trim();
      var TipoJornadaManual = $("#TipoJornadaManual").val().trim();
      var NumSeguridadSocialManual = $("#NumSeguridadSocialManual").val().trim();
      //1.2|O|2017-04-28|2017-04-01|2017-04-30|30|18279.57|11429.49|0.00|MUMD650506HPLRNN07|09|01|09|016|MINISTROS DE CULTO|Ninguno|05|014|56667710414|NLE|18279.57|11395.57|6884.00|046|004|MANUTENCION|11395.57|6884.00|10104.51|1324.98|012|444|ANTICIPO|10104.51|002|002|ISR|1324.98||

      var date1 = new Date(deFechaManual);
      var date2 = new Date(aFechaManual);
      var timeDiff = Math.abs(date2.getTime() - date1.getTime());
      var diffDaysParaTimbreDiasPagados = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
      var certificado = dameNoCertificadoSegunRFC(rfcEmisor);
      var cadOriginal = '||3.3|N|'+folioQueSigue+'|'+TimeStamp+'|99|'+certificado+'|'+subTotal+'|'+totalDeducciones+'|MXN|'+totalNeto+'|N|PUE|'+LugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|'+regimen+'|'+rfcReceptor+'|'+razonSocialReceptor+'|P01|84111505|1|ACT|Pago de nómina|'+subTotal+'|'+subTotal+'|'+totalDeducciones+'|';
      if(cuantasDeducciones==0)
      {
        cadOriginal = '||3.3|N|'+folioQueSigue+'|'+TimeStamp+'|99|'+certificado+'|'+subTotal+'|MXN|'+totalNeto+'|N|PUE|'+LugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|'+regimen+'|'+rfcReceptor+'|'+razonSocialReceptor+'|P01|84111505|1|ACT|Pago de nómina|'+subTotal+'|'+subTotal+'|';
      }


      cadOriginal=cadOriginal+'1.2|'+c_TipoNomina_Manual+'|'+FechaPagoManual+'|'+deFechaManual+'|'+aFechaManual+'|';

      cadOriginal=cadOriginal+diffDaysParaTimbreDiasPagados+'|'+totalPercepciones+'|';
      if(cuantasDeducciones>0)
      {
        cadOriginal=cadOriginal+totalDeducciones+'|'+totalOtrosPagos+'|';  
      }
      //else
      //{
        //cadOriginal=cadOriginal+'|'+curpManual+'|';
      //}
      if (TipoContratoManual<8)//es de sueldos, entonces es obligatorio:
      {
        cadOriginal=cadOriginal+regPatronal+'|';
      }
      cadOriginal=cadOriginal+curpManual+'|';
      
      if (TipoContratoManual<8)//es de sueldos, entonces es obligatorio:
      {
        var date1 = new Date(FechaInicioRelLaboralManual);
        var date2 = new Date(FechaPagoManual);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var semanas =  Math.trunc(diffDays/7);
        var antiguedad = "P"+semanas+"W";
        cadOriginal=cadOriginal+NumSeguridadSocialManual+'|'+FechaInicioRelLaboralManual+'|'+antiguedad+'|';
      }
      cadOriginal=cadOriginal+TipoContratoManual+'|'+TipoJornadaManual+'|'+TipoRegimenManual+'|'+numEmpleadoManual+'|'+DepartamentoManual+'|Ninguno|';
      if (TipoContratoManual<8)//es de sueldos, entonces es obligatorio:
      {
        cadOriginal=cadOriginal+RiesgoPuestoManual+'|';
      }
      cadOriginal=cadOriginal+PeriodicidadPagoManual+'|';
      var esCLABE = CuentaBancariaManual.length;
      if(esCLABE==18)//CLABE
      {
        cadOriginal=cadOriginal+CuentaBancariaManual+'|';
      }
      else
      {
        cadOriginal=cadOriginal+c_BancoManual+'|'+CuentaBancariaManual+'|';
      }
      if (TipoContratoManual<8)//es de sueldos, entonces es obligatorio:
      {
        cadOriginal=cadOriginal+SDIManual+'|';
      }
      cadOriginal=cadOriginal+c_EstadoManual+'|'+totalPercepciones+'|'+totalGravado+'|'+totalExento+'|'+cadPercepciones;
      if (totalOtrasDeducciones > 0.009) {//0.009
        console.log(totalOtrasDeducciones);
        cadOriginal=cadOriginal+totalOtrasDeducciones+'|';
      } else {
        if (totalISR > 0.009) {//0.009
          cadOriginal=cadOriginal+totalOtrasDeducciones+'|';
        }
      }
      if (totalISR > 0.009) {//0.009
        cadOriginal=cadOriginal+totalISR+'|';
      }
      
      cadOriginal=cadOriginal+cadDeducciones+cadOtrosPagos+'|';
      console.log(cadOriginal);
      var fini = 0;
      if(tengoFiniquito)
      {
        fini = 1;
      }
      var inde = 0;
      if(tengoIndemnizacion)
      {
        inde = 1;
      }
      var param = {ER : ER, TimeStamp : TimeStamp, deVerdad : deVerdad, cadOriginal : cadOriginal, TipoContrato : TipoContratoManual, cuantasPercepciones : cuantasPercepciones, cuantasDeducciones : cuantasDeducciones, cuantasOtrosPagos : cuantasOtrosPagos, periodo : periodo, nombre : nombreManual, manual : 1, fini : fini, inde : inde}
      $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="30%"  /><center>');
      $.ajax({
        url: "/timbraNomina3.3",
        dataType : "json",
        type : "post",
        data : param,
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            window.open(
              "/" + resp.pdf,
              '_blank'
            );
            $("#loadingCampos").html('');
          }
          if(resp.success==-1)
          {
           alert("Hubo un error: "+resp.error+" REVISAR: "+resp.revisar);
          }
        }
      });
    }
  });  
});
$(document).on("click", ".eliminarPercepcion", function (){ 
  $(this).parent().parent().remove();
  if(parseInt($(this).parent().parent().attr("TipoSAT").trim())==25)//indeminizacion
  {
   $("#ocultoPercepciones").html("");
  }
});

$(document).on("click", "#agregarOtrosPagos", function (){ 
  var importeDeduccion = $("#importeOtrosPagos").val();
  var TipoSAT = $("#nuevaOtrosPagos option:selected").attr("TipoSAT");
  var idRegistro = TipoSAT;//$("#nuevaOtrosPagos").val();
  
  var Concepto = $("#nuevaOtrosPagos option:selected").attr("concepto");
  var TipoSATPalabra = $("#nuevaOtrosPagos option:selected").html();
  $('#otrosPagosTablaNomina > tbody:last-child').append('<tr class="otrosPagosClass" importe="'+importeDeduccion+'" TipoSAT="'+TipoSAT+'" idRegistro="'+idRegistro+'" Concepto="'+Concepto+'"  ><td>'+TipoSATPalabra+'</td><td>'+format2(importeDeduccion,'$')+'</td><td><button type="submit" class="btn btn-danger eliminarPercepcion">Eliminar</button></td></tr>'); 
});

$(document).on("click", "#agregarDeduccion", function (){ 
  var importeDeduccion = $("#importeDeduccion").val();
  var idRegistro = $("#nuevaDeduccion").val();
  var TipoSAT = $("#nuevaDeduccion option:selected").attr("TipoSAT");
  var Concepto = $("#nuevaDeduccion option:selected").attr("concepto");
  var TipoSATPalabra = $("#nuevaDeduccion option:selected").html();
  $('#deduccionesTablaNomina > tbody:last-child').append('<tr class="deduccionesClass" importe="'+importeDeduccion+'" TipoSAT="'+TipoSAT+'" idRegistro="'+idRegistro+'" Concepto="'+Concepto+'"  ><td>'+TipoSATPalabra+'</td><td>'+format2(importeDeduccion,'$')+'</td><td><button type="submit" class="btn btn-danger eliminarPercepcion">Eliminar</button></td></tr>'); 
});
/*
$(document).on("change", "#nuevaPercepcion", function (){   
  //var TipoSAT = $("#nuevaPercepcion option:selected").attr("TipoSAT");
});
*/
$(document).on("click", "#agregarPercepcion", function (){ 
  var importeGravado = $("#gravadoPercepcion").val();
  if(importeGravado=="")
  {
    importeGravado="0.00";
  }
  var importeExento = $("#exentoPercepcion").val();
  if(importeExento=="")
  {
    importeExento="0.00";
  }
  var idRegistro = $("#nuevaPercepcion").val();
  var TipoSAT = $("#nuevaPercepcion option:selected").attr("TipoSAT");
  var Concepto = $("#nuevaPercepcion option:selected").attr("concepto");
  var TipoSATPalabra = $("#nuevaPercepcion option:selected").html();
  $('#percepcionesTablaNomina > tbody:last-child').append('<tr class="percepcionesClass" gravado="'+importeGravado+'" exento="'+importeExento+'" TipoSAT="'+TipoSAT+'" idRegistro="'+idRegistro+'" Concepto="'+Concepto+'"  ><td>'+TipoSATPalabra+'</td><td>'+format2(importeGravado,'$')+'</td><td>'+format2(importeExento,'$')+'</td><td><button type="submit" class="btn btn-danger eliminarPercepcion">Eliminar</button></td></tr>');
   if(TipoSAT=="025")//indeminizacion
  {
  var cuantasPercepciones = $(".percepcionesClass").length;
  var cuantasDeducciones = $(".deduccionesClass").length;
  var cuantasOtrosPagos = $(".otrosPagosClass").length;
  var i, totalGravado = 0.0, totalExento = 0.0, totalDeducciones = 0.0, totalOtrosPagos = 0.0;
  for(i=0;i<cuantasPercepciones;i++)
  {
    totalGravado+= parseFloat($($(".percepcionesClass")[i]).attr("gravado"));
    totalExento+= parseFloat($($(".percepcionesClass")[i]).attr("exento"));
  }
  for(i=0;i<cuantasDeducciones;i++)
  {
    totalDeducciones+= parseFloat($($(".deduccionesClass")[i]).attr("importe"));
  }
  for(i=0;i<cuantasOtrosPagos;i++)
  {
    totalOtrosPagos+= parseFloat($($(".otrosPagosClass")[i]).attr("importe"));
  }
  var sumaTodo = totalGravado+totalExento+totalOtrosPagos-totalDeducciones;
  sumaTodo = Math.round(sumaTodo * 100) / 100;
      var FechaInicioRelLaboralManual = $("#FechaInicioRelLaboralManual").val();
      var FechaPagoManual = $("#FechaPagoManual").val();


      var date1 = new Date(FechaInicioRelLaboralManual);
        var date2 = new Date(FechaPagoManual);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var semanas =  Math.trunc(diffDays/7);
        
  //var FechaInicioRelLaboralParaCalculo = FechaInicioRelLaboral.substring(3,5)+"/"+FechaInicioRelLaboral.substring(0,2)+"/"+FechaInicioRelLaboral.substring(6,10);
       
  /*  var date1 = new Date(FechaInicioRelLaboralParaCalculo);
    var date2 = new Date(TRANS_DATETIME);
    var timeDiff = Math.abs(date2.getTime() - date1.getTime());
    var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
    var semanas =  Math.trunc(diffDays/7);
*/
var anios = parseInt(Math.round(semanas / 52));
  
    var cad = '<label for="TotalPagado">Total pagado:</label><input type="text" disabled id="TotalPagado" value="'+sumaTodo+'"/><br>';
    cad=cad+'<label for="NumAñosServicio">NumAñosServicio:</label><input type="text" disabled id="NumAñosServicio" value="'+anios+'"/><br>';
    cad=cad+'<label for="UltimoSueldoMensOrd">Ultimo Sueldo Mensual Ordinario:</label><input type="text"  id="UltimoSueldoMensOrd" value="0.00" class="soloNumeros"/><br>';
    cad = cad+'<label for="IngresoAcumulable">Ingreso Acumulable:</label><input type="text" disabled id="IngresoAcumulable" value="'+totalGravado+'"/><br>';
cad = cad+'<label for="IngresoNoAcumulable">Ingreso No Acumulable:</label><input type="text" disabled id="IngresoNoAcumulable" value="'+totalExento+'"/><br>';
        

    
    $("#ocultoPercepciones").html(cad);

    
 
  }
});
$(document).on("click", "#timbradoManuntencion", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Timbrado de manuntenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Timbrado de manuntenci&oacute;n<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                '<br><br>'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodoTimbrado">Del periodo:</label>'+
                          '<select id="delPeriodoTimbrado" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                     '<br><br>'+
                 '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Fecha de pago:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="FechaPago" placeholder="Fecha de pago" aria-describedby="inputSuccess2Status3">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha3" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status3" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="clearfix"/>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">De la Fecha:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="deFecha" placeholder="Fecha de transaccion" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">A la Fecha:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="aFecha" placeholder="Fecha de transaccion" aria-describedby="inputSuccess2Status2">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha2" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status2" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoNomina">Tipo de Manuntenci&oacute;n:</label>'+
                          '<select id="TipoNomina" class="form-control" required="" >'+
                            '<option value="O">Ordinaria</option><option value="E">Extraordinaria</option></select></p>'+
                    '</div>'+
                    '<br><br>'+
                    '<br><br>'+
                    '<div class="form-group">'+
                      '<p><label for="TipoPoliza">Modo de extraer el estado de cuenta:</label>'+
                          '<select id="TipoPoliza" class="form-control" required="" >'+
                            '<option value="1">Modo responsable</option><option value="2">Modo contador flojo</option></select></p>'+
                    '</div>'+
                      '<div id="loadingCampos"/>'+
                    '<br><br>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="generaPretimbrado" class="btn btn-success">Genera vista previa</button>'+
                      '</div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6 col-md-offset-6">'+
                        '<button type="submit" id="imprimirRecibosYaTimbrados" class="btn btn-success">Imprime recibos ya timbrados del periodo</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><tbody id="tablaDetalleSabana"></tbody></table>'+
                      '</div>'+
                    '<table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>Nombre</th><th>Periodo</th><th>Total</th><th>Estado de cuenta</th><th>Vista Previa</th><th>Timbrar y mandar</th></tr></thead><tbody id="pretimbradoTablaNomina"></tbody></table>'
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
       $('#deFecha').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
       $('#aFecha').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
        $('#FechaPago').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
        });
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim().substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodoTimbrado").html(cad);
        //  $("#alPeriodo").html(cad);
         // $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });

$(document).on("click", ".cancelaTimbradoNomina", function (){
  var UUID = $(this).attr("UUID");
  var ER = $(this).attr("ER");
  var TimeStamp = $(this).attr("TimeStamp");
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  var param = {UUID : UUID, TimeStamp : TimeStamp,ER :ER, deVerdad : 1}
  $.ajax({
    url: "/cancelaTimbradoNomina",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      $("#loadingCampos").html('');
      if(resp.success==1)
      {
        //generaPretimbrado();
        $("#generarTablaDeTimbradoManutencionMinistros").click();
        alert("factura cancelada, vuelve a generar el payroll");
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: perdón");
      }
    }
  });
});



$(document).on("click", ".verTimbradoNominaXML", function (){
  var ER = $(this).attr("ER");
  
  var periodo = $(this).attr("periodo");
  var UUID = $(this).attr("UUID");
  var param = {ER : ER, periodo : periodo, deVerdad : 0, esManual : 0, UUID : UUID}
  $.ajax({
    url: "/verTimbradoNominaXML",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var xml = resp.xml;
        window.open(
          "/" + resp.xml,
          '_blank'
        );
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: perdón");
      }
    }
  });
});


$(document).on("click", ".verTimbradoNomina", function (){
  var ER = $(this).attr("ER");
  
  var periodo = $(this).attr("periodo");
  var UUID = $(this).attr("UUID");
  var param = {ER : ER, periodo : periodo, deVerdad : 0, esManual : 0, UUID : UUID}
  $.ajax({
    url: "/verTimbradoNomina",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: perdón");
      }
    }
  });
});
$(document).on("click", ".vistaPreviaTimbradoNomina", function (){
  var ER = $(this).attr("ER");
  var TimeStamp = $(this).attr("TimeStamp");
  var cadOriginal = $(this).attr("cadOriginal");

  var deducciones = $(this).attr("deducciones");
  var percepciones = $(this).attr("percepciones");
  var otros = $(this).attr("otros");
  var tipoContrato = $(this).attr("tipoContrato");
  var periodo = $(this).attr("delperiodo");
  var param = {periodo: periodo, ER : ER, TimeStamp : TimeStamp, deVerdad : 0, esManual : 0, manual : 0 , cadOriginal : cadOriginal, TipoContrato : tipoContrato, cuantasPercepciones : percepciones, cuantasDeducciones : deducciones, cuantasOtrosPagos : otros, nombre : ER}
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="30%"  /><center>');
  $.ajax({
    url: "/timbraNomina3.3",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
        $("#loadingCampos").html('');
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: "+resp.error+" REVISAR: "+resp.revisar);
      }
    }
  });
});


$(document).on("click", ".estadoDeCuentaNomina", function (){
  var ER = $(this).attr("ER");
  var periodo = $(this).attr("delPeriodo");
  window.open(
    "/generarEstadoDeCuenta?cuenta="+ER+"&delPeriodo="+periodo+"&alPeriodo="+periodo,
    '_blank'
  );
});
$(document).on("click", ".timbrarNomina", function (){
  //$("html, body").animate({ scrollTop: 0 }, "slow");
  var ER = $(this).attr("ER");
  var TimeStamp = $(this).attr("TimeStamp");
  var cadOriginal = $(this).attr("cadOriginal");

  var deducciones = $(this).attr("deducciones");
  var percepciones = $(this).attr("percepciones");
  var otros = $(this).attr("otros");
  var tipoContrato = $(this).attr("tipoContrato");
  var periodo = $(this).attr("delperiodo");
  var a =  cadOriginal.split('|');
  var indexOfNombre = 19;
  var indexOfCantidad = 11;
  if(deducciones==0)
  {
    indexOfNombre = 18;
    indexOfCantidad = 10;
  }

  var nombre = a[indexOfNombre];
  var param = {periodo : periodo, ER : ER, TimeStamp : TimeStamp, deVerdad : 1, esManual : 0, manual :0, cadOriginal : cadOriginal, TipoContrato : tipoContrato, cuantasPercepciones : percepciones, cuantasDeducciones : deducciones, cuantasOtrosPagos : otros, nombre : ER}
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/timbraNomina3.3",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#generarTablaDeTimbradoManutencionMinistros").click();
        //generaPretimbrado();
        $("#loadingCampos").html('');
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: "+resp.error+" REVISAR: "+resp.revisar);
      }
    }
  });
});
function generaPretimbrado() {
  var periodo = $("#delPeriodoTimbrado").val();
  var deFecha = $("#deFecha").val();
  var aFecha = $("#aFecha").val();
  var FechaPago = $("#FechaPago").val();

  var metodoDePago = "NA";// $("#metodoDePago").val();
  var TipoNomina = $("#TipoNomina").val();

  var anioDeFecha = deFecha.substring(6,10);
  var mesDeFecha = deFecha.substring(0,2);
  var diaDeFecha = deFecha.substring(3,5);
  var deFechaFormato = anioDeFecha+"-"+mesDeFecha+"-"+diaDeFecha;

  var anioAFecha = aFecha.substring(6,10);
  var mesAFecha = aFecha.substring(0,2);
  var diaAFecha = aFecha.substring(3,5);
  var AFechaFormato = anioAFecha+"-"+mesAFecha+"-"+diaAFecha;
var TipoPoliza = $("#TipoPoliza").val();

  var param = {periodo : periodo, deFecha : deFechaFormato, aFecha : AFechaFormato, TipoNomina : TipoNomina, metodoDePago : metodoDePago, FechaPago : FechaPago, TipoPoliza : TipoPoliza}
  $.ajax({
    url: "/generaPretimbrado",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i = 0, cad = '', aver2 = Object.keys(resp.conceptos), IdCFDINomina = -1;
        for(i=0;i<aver2.length;i++)
        {
          ER = resp.conceptos[aver2[i]].ER;
          TimeStamp = resp.conceptos[aver2[i]].TimeStamp;
          var botonEstadoDeCuenta = '<td><button type="button"  ER="'+ER+'"  delPeriodo="'+periodo+'" class="btn btn-round btn-success estadoDeCuentaNomina">Estado de cuenta</button></td>';
          if(parseInt(resp.conceptos[aver2[i]].Timbrado) == 0)
          {
            cad=cad+'<tr><td>'+resp.conceptos[aver2[i]].Nombre+'</td><td>'+resp.conceptos[aver2[i]].Periodo+'</td><td>'+format2(parseFloat(resp.conceptos[aver2[i]].Total),'$')+'</td>'+botonEstadoDeCuenta+'<td><button type="button"  ER="'+ER+'"  TimeStamp="'+TimeStamp+'" class="btn btn-round btn-success vistaPreviaTimbradoNomina">Vista previa</button></td><td><button type="button" ER="'+ER+'"  TimeStamp="'+TimeStamp+'" class="btn btn-round btn-warning timbrarNomina">Timbrar</button></td></tr>';  
          }
          else
          {
            cad=cad+'<tr><td>'+resp.conceptos[aver2[i]].Nombre+'</td><td>'+resp.conceptos[aver2[i]].Periodo+'</td><td>'+format2(parseFloat(resp.conceptos[aver2[i]].Total),'$')+'</td>'+botonEstadoDeCuenta+'<td><button type="button"  ER="'+ER+'"  periodo="'+resp.conceptos[aver2[i]].Periodo+'" UUID="'+resp.conceptos[aver2[i]].UUID+'" class="btn btn-round btn-success verTimbradoNomina">Ver</button>&nbsp;&nbsp;<button type="button"  ER="'+ER+'"  periodo="'+resp.conceptos[aver2[i]].Periodo+'" UUID="'+resp.conceptos[aver2[i]].UUID+'" style="display:none" class="btn btn-round btn-success verTimbradoNominaXML">Ver XML</button></td><td><button type="button"  UUID="'+resp.conceptos[aver2[i]].UUID+'"  ER="'+ER+'"  TimeStamp="'+TimeStamp+'" class="btn btn-round btn-danger cancelaTimbradoNomina" >Cancelar</button></td></tr>';
          }
          
        }
        $('#pretimbradoTablaNomina').html(cad);
      }
    }
  });
}


$(document).on("click", "#imprimirRecibosYaTimbrados", function (){
  var periodo = $("#delPeriodo").val();
  var param={periodo : periodo};
  $.ajax({
    url: "/imprimirRecibosYaTimbrados",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        window.open(
          "/" +resp.pdf,  
          '_blank'
        );
      }
    }
  });
});
$(document).on("click", "#generaPretimbrado", function (){
  generaPretimbrado();
});
function actualizaFechaMesesIntervalo() {
  var periodo = $("#FechaPago").val();
  if($("#FechaPago").length==0)
  {
    periodo = $("#FechaPagoManual").val();
  }
  var mes = parseInt(periodo.substring(0,2));
  var anio = parseInt(periodo.substring(6,10));
  var mesS = ""+mes;
  if(mes<10)
  {
    mesS = "0"+mes;
  }
   var anioAnterior = anio;
  var mesAnterior = mes;
  /*if(mes>1)
  {
    mesAnterior = mes-1;
  }
  else
  {
    mesAnterior = 12;
    anioAnterior = anio - 1;
  }*/
  var mesAnteriorS = ""+mesAnterior;
  if(mesAnterior<10)
  {
    mesAnteriorS = "0"+mesAnterior;
  }
 // var deFecha = ""+mesAnteriorS+"/25/"+anioAnterior;
  //var aFecha = mesS+"/24/"+anio;
  var deFecha = ""+mesAnteriorS+"/01/"+anioAnterior;
  var diaFinal = 31;
  if(mesAnterior==4 || mesAnterior==6 || mesAnterior==9 || mesAnterior==11)
  {
    diaFinal = 30;
  }
  if(mesAnterior==2)
  {
    diaFinal==28;
    if(anio%4==0)
    {
      diaFinal=29;
    }
  }
var aFecha = mesS+"/"+diaFinal+"/"+anio;

 $("#deFecha").val(deFecha);
  $("#aFecha").val(aFecha);
}
$(document).on("change", "#FechaPago", function (){
 actualizaFechaMesesIntervalo();
});


$(document).on("change", "#delPeriodoTimbradoManual", function (){
  var periodo = $(this).val();///2016010
  //11/08/2016
  //mes dia añio
  var anio = parseInt(periodo.substring(0,4));
  var mes = parseInt(periodo.substring(5,7));
  //substring(5,2) checar!
  var mesS = ""+mes;
  if(mes<10)
  {
    mesS = "0"+mes;
  }
  var FechaPago = anio+"-"+mesS+"-25";
  $("#FechaPagoManual").val(FechaPago);
  $("#FechaPagoManual").trigger("focusout");
});

$(document).on("change", "#delPeriodoTimbrado", function (){
  var periodo = $(this).val();///2016010
  //11/08/2016
  //mes dia añio
  var anio = parseInt(periodo.substring(0,4));
  var mes = parseInt(periodo.substring(5,7));
  //substring(5,2) checar!
  var mesS = ""+mes;
  if(mes<10)
  {
    mesS = "0"+mes;
  }
  var FechaPago = mesS+"/25/"+anio;
  $("#FechaPago").val(FechaPago);
 actualizaFechaMesesIntervalo();
});


$(document).on("click", ".detalleIglesia", function (){
  var delPeriodo = $(this).attr("delPeriodo");
  var alPeriodo = $(this).attr("alPeriodo");
  var delDistrito = $("#delDistrito").val();
  var deLaIglesia = $("#deLaIglesia").val();
  var delTipoDeIngreso = $("#delTipoDeIngreso").val();

  var param = { delPeriodo : delPeriodo, alPeriodo:alPeriodo, delDistrito:delDistrito, delTipoDeIngreso : delTipoDeIngreso, deLaIglesia : deLaIglesia};
  $.ajax({
    url: "/generarReporteDeIglesiasDiezmosEnPaginaDetalle",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.diezmos[delDistrito].IglesiaList);
        var i;
        var cad = '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead><tr><th>Iglesia</th><th>'+delPeriodoAnterior+'-'+alPeriodoAnterior+'</th><th>'+delPeriodo+'-'+alPeriodo+'</th><th>Crecimiento</th></tr></thead><tbody>';
        for(i=0;i<aver2.length;i++)
        {
          var anterior = "No hay nada";
          var este = "No hay nada";
          var cuak = "";
          if(Object.keys(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList).length>0)
          {
            anterior = parseFloat(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList[delTipoDeIngreso].PeriodoList[delPeriodoAnterior].Saldo);
            este = parseFloat(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList[delTipoDeIngreso].PeriodoList[delPeriodo].Saldo);
            cuak = ((este-anterior)/anterior)*100;
            cuak = Math.round(cuak * 100) / 100;
          }
          cad = cad + '<tr><td>'+resp.diezmos[delDistrito].IglesiaList[aver2[i]].Nombre+'</td><td><a href="javascript:;" class="detalleIglesia" deLaIglesia="'+aver2[i]+'" delTipoDeIngreso="'+delTipoDeIngreso+'"  delDistrito="'+delDistrito+'" delPeriodo="'+delPeriodoAnterior+'" alPeriodo="'+alPeriodoAnterior+'">'+format2(anterior,'$')+'</a></td><td><a href="javascript:;" class="detalleIglesia" delTipoDeIngreso="'+delTipoDeIngreso+'" deLaIglesia="'+aver2[i]+'" delPeriodo="'+delPeriodo+'" delDistrito="'+delDistrito+'"  alPeriodo="'+alPeriodo+'">'+format2(este,'$')+'</a></td><td>'+cuak+' %</td></tr>';
        }
        cad=cad+'</tbody></table>';
        console.log(cad);
        $('#reporteEnPagina').html(cad);
      }
    }
  });
});



$(document).on("click", "#generarReporteBalanza", function (){
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = $("#alPeriodo").val();
  var delPeriodoMes = parseInt(delPeriodo.substring(4));
  var delPeriodoAnio = parseInt(delPeriodo.substring(0,4));
  var delPeriodoAnterior = "";
  if(delPeriodoMes>1){
    delPeriodoMes--;
    delPeriodoAnterior = delPeriodoAnio+"0"+delPeriodoMes;
    if(delPeriodoMes<10)
    {
      delPeriodoAnterior = delPeriodoAnio+"00"+delPeriodoMes;
    }
    
  } else {
    delPeriodoAnio--;
    delPeriodoMes = "01";
    delPeriodoAnterior = delPeriodoAnio+"0"+delPeriodoMes;
  }

  
  var BUNIT = $("#BUNITACTUAL").html();
  var param = {alPeriodo: alPeriodo, delPeriodo : delPeriodo, bunit: BUNIT};
  $.ajax({
    url: "/generarBalanzaSevenPagina",
    dataType : "json",
    type : "get",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var cad = '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead><tr><th>Cuenta</th><th>Nombre</th><th>Saldo Inicial</th><th>Total d&eacute;bito</th><th>Total cr&eacute;dito</th><th>Saldo final</th><th>Saldo Final Alternativo</th></tr></thead><tbody>';
        var aver2 = Object.keys(resp.balanza);
        var i;
        for(i=0;i<aver2.length;i++)
        {
          var sum = (parseFloat(resp.balanza[aver2[i]].Inicial) / parseFloat(resp.balanza[aver2[i]].Inicial_B) ) * 100;
          var cadAdicional = '';
          sum = Math.round(sum * 100) / 100;
          if(parseInt(resp.balanza[aver2[i]].Inicial_B)==0){ sum = " - ";}

          cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+aver2[i]+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr='+resp.balanza[aver2[i]].DESCR+'&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+aver2[i]+' '+cadAdicional+'</a></td><td>'+resp.balanza[aver2[i]].DESCR+'</td><td>'+format2(parseFloat(resp.balanza[aver2[i]].Inicial),'$')+'<br>'+format2(parseFloat(resp.balanza[aver2[i]].Inicial_B),'$')+'<br>'+sum+'%</td>';  

          sum = (parseFloat(resp.balanza[aver2[i]].Creditos) / parseFloat(resp.balanza[aver2[i]].Creditos_B) ) * 100;
          sum = Math.round(sum * 100) / 100;
          if(parseInt(resp.balanza[aver2[i]].Creditos_B)==0){ sum = " - ";}
          cad=cad+'<td>'+format2(parseFloat(resp.balanza[aver2[i]].Creditos),'$')+'<br>'+format2(parseFloat(resp.balanza[aver2[i]].Creditos_B),'$')+'<br>'+sum+'%</td>';  

          sum = (parseFloat(resp.balanza[aver2[i]].Debitos) / parseFloat(resp.balanza[aver2[i]].Debitos_B) ) * 100;
          sum = Math.round(sum * 100) / 100;
          if(parseInt(resp.balanza[aver2[i]].Debitos_B)==0){ sum = " - ";}
          cad=cad+'<td>'+format2(parseFloat(resp.balanza[aver2[i]].Debitos),'$')+'<br>'+format2(parseFloat(resp.balanza[aver2[i]].Debitos_B),'$')+'<br>'+sum+'%</td>';  

          sum = (parseFloat(resp.balanza[aver2[i]].Final) / parseFloat(resp.balanza[aver2[i]].Final_B) ) * 100;
          sum = Math.round(sum * 100) / 100;
          if(parseInt(resp.balanza[aver2[i]].Final_B)==0){ sum = " - ";}
          cad=cad+'<td>'+format2(parseFloat(resp.balanza[aver2[i]].Final),'$')+'<br>'+format2(parseFloat(resp.balanza[aver2[i]].Final_B),'$')+'<br>'+sum+'%</td>';
var string = numeral(parseFloat(resp.balanza[aver2[i]].FINAL_ALTERNATIVO)).format('$0,0.00');
          
cad=cad+'<td>'+string+'</td></tr>';  

          cad=cad+'</tr>';  
        }
        cad=cad+'</tbody></table>';
        $('#reporteEnPagina').html(cad);
      }
    }
  });
});

$(document).on("click", "#generarReporteDeIglesiasDiezmosEnPagina", function (){
  var delPeriodo = $("#delPeriodo").val();
  var delPeriodoMes = parseInt(delPeriodo.substring(4));
  var delPeriodoAnio = parseInt(delPeriodo.substring(0,4));
  delPeriodoAnio--;
  var delPeriodoAnterior = delPeriodoAnio+"0"+delPeriodoMes;
  if(delPeriodoMes<10)
  {
    delPeriodoAnterior = delPeriodoAnio+"00"+delPeriodoMes;
  }
  var alPeriodo = $("#alPeriodo").val();
  var alPeriodoMes = parseInt(alPeriodo.substring(4));
  var alPeriodoAnio = parseInt(alPeriodo.substring(0,4));
  alPeriodoAnio--;
  var alPeriodoAnterior = alPeriodoAnio+"0"+alPeriodoMes;
  if(alPeriodoMes<10)
  {
    alPeriodoAnterior = alPeriodoAnio+"00"+alPeriodoMes;
  }
  var delDistrito = $("#delDistrito").val();
  var delTipoDeIngreso = $("#delTipoDeIngreso").val();
  var param = { delPeriodo : delPeriodo, alPeriodo:alPeriodo, delDistrito:delDistrito, delTipoDeIngreso : delTipoDeIngreso};
  $.ajax({
    url: "/generarReporteDeIglesiasDiezmosEnPagina",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.diezmos[delDistrito].IglesiaList);
        var i;
        var cad = '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead><tr><th>Iglesia</th><th>'+delPeriodoAnterior+'-'+alPeriodoAnterior+'</th><th>'+delPeriodo+'-'+alPeriodo+'</th><th>Crecimiento</th></tr></thead><tbody>';
        for(i=0;i<aver2.length;i++)
        {
          var anterior = "No hay nada";
          var este = "No hay nada";
          var cuak = "";
          
          if(Object.keys(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList).length>0)
          {
            anterior = parseFloat(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList[delTipoDeIngreso].PeriodoList[delPeriodoAnterior].Saldo);
            este = parseFloat(resp.diezmos[delDistrito].IglesiaList[aver2[i]].CuentaList[delTipoDeIngreso].PeriodoList[delPeriodo].Saldo);
            cuak = ((este-anterior)/anterior)*100;
            cuak = Math.round(cuak * 100) / 100;
          }
          cad = cad + '<tr><td>'+resp.diezmos[delDistrito].IglesiaList[aver2[i]].Nombre+'</td><td><a href="javascript:;" class="detalleIglesia" deLaIglesia="'+aver2[i]+'" delTipoDeIngreso="'+delTipoDeIngreso+'"  delDistrito="'+delDistrito+'" delPeriodo="'+delPeriodoAnterior+'" alPeriodo="'+alPeriodoAnterior+'">'+format2(anterior,'$')+'</a></td><td><a href="javascript:;" class="detalleIglesia" delTipoDeIngreso="'+delTipoDeIngreso+'" deLaIglesia="'+aver2[i]+'" delPeriodo="'+delPeriodo+'" delDistrito="'+delDistrito+'"  alPeriodo="'+alPeriodo+'">'+format2(este,'$')+'</a></td><td>'+cuak+' %</td></tr>';
        }
        cad=cad+'</tbody></table>';
        console.log(cad);
        $('#reporteEnPagina').html(cad);
      }
    }
  });
});

$(document).on("click", "#balanza", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Balanza</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Balanza<small>de comprobaci&oacute;n</small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteBalanza" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="x_content" id="reporteDetalle">'+
                      '</div><br><hr><br>'+
                      '<div class="x_content" id="reporteEnPagina">'+
                      '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim().substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<anios.length;i++)
          {
            cad=cad+'<option value="'+anios[i].toString().trim()+'">'+anios[i].toString().trim()+'</option>';
          } 
          cad='';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          }
          var cadX = '';
          aver2 = Object.keys(resp.distritos);
          for(i=0;i<aver2.length;i++)
          {
            cadX=cadX+'<option value="'+aver2[i]+'">'+resp.distritos[aver2[i]].Nombre+'</option>';
          }
          var cadY = '';
          aver2 = Object.keys(resp.cuentasIngreso);
          for(i=0;i<aver2.length;i++)
          {
            cadY=cadY+'<option value="'+aver2[i]+'">'+resp.cuentasIngreso[aver2[i]].Completo+'</option>';
          }
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });
$(document).on("click", "#declaracionPorLigado", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Declaraci&oacute;n Por Ligado</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Árboles<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<center><img src="static/lavado.png"/></center>'+
                  '<br />'+
                  '<div class="form-group" id="arbol">'+
                      '<div class="acidjs-css3-treeview">'+
    '<ul>'+
        '<li>'+
            '<input type="checkbox" id="node-0" checked="checked" /><label><input type="checkbox" /><span></span></label><label for="node-0">Libraries</label>'+
            '<ul>'+
                '<li>'+
                    '<input type="checkbox" id="node-0-0" checked="checked" /><label><input type="checkbox" /><span></span></label><label for="node-0-0">Documents</label>'+
                    '<ul>'+
                        '<li>'+
                            '<input type="checkbox" id="node-0-0-0" checked="checked" /><label><input type="checkbox" /><span></span></label><label for="node-0-0-0">My Documents</label>'+
                            '<ul>'+
                               '<li>'+
                                  '<input type="checkbox" id="node-0-0-0-0" /><label><input type="checkbox" /><span></span></label><label for="node-0-0-0-0">Downloads</label>'+
                                '</li>'+
                                '<li>'+
                                    '<input type="checkbox" id="node-0-0-0-1" /><label><input type="checkbox" /><span></span></label><label for="node-0-0-0-1">Projects</label>'+
                                '</li>'+
                            '</ul>'+
                        '</li>'+
                    '</ul>'+
                '</li>'+
                '<li>'+
                    '<input type="checkbox" id="node-0-1" /><label><input type="checkbox" /><span></span></label><label for="node-0-1">Music</label>'+
                    '<ul>'+
                        '<li>'+
                            '<input type="checkbox" id="node-0-1-0" /><label><input type="checkbox" /><span></span></label><label for="node-0-1-0">My Music</label>'+
                        '</li>'+
                        '<li>'+
                          '<input type="checkbox" id="node-0-1-1" /><label><input type="checkbox" /><span></span></label><label for="node-0-1-1">Public Music</label>'+
                        '</li>'+
                    '</ul>'+
                '</li>'+
                '<li>'+
                    '<input type="checkbox" id="node-0-2" /><label><input type="checkbox" /><span></span></label><label for="node-0-2">Pictures</label>'+
                    '<ul>'+
                        '<li>'+
                            '<input type="checkbox" id="node-0-2-0" /><label><input type="checkbox" /><span></span></label><label for="node-0-2-0">My Pictures</label>'+
                        '</li>'+
                        '<li>'+
                            '<input type="checkbox" id="node-0-2-1" /><label><input type="checkbox" /><span></span></label><label for="node-0-2-1">Public Pictures</label>'+
                        '</li>'+
                    '</ul>'+
                '</li>'+
                '<li>'+
                  '<input type="checkbox" id="node-0-3" checked="checked" /><label><input type="checkbox" checked="checked" /><span></span></label><label for="node-0-3">Video</label>'+
                    '<ul>'+
                        '<li>'+
                            '<input type="checkbox" id="node-0-3-0" /><label><input type="checkbox" checked="checked" /><span></span></label><label for="node-0-3-0">My Videos</label>'+
                        '</li>'+
                        '<li>'+
                          '<input type="checkbox" id="node-0-3-1" /><label><input type="checkbox" checked="checked" /><span></span></label><label for="node-0-3-1">Public Videos</label>'+
                        '</li>'+
                    '</ul>'+
                '</li>'+
            '</ul>'+
        '</li>'+
    '</ul>'+
'</div>'+
'<p> </p>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
  $(".acidjs-css3-treeview").delegate("label input:checkbox", "change", function() {
        var
            checkbox = $(this),
            nestedList = checkbox.parent().next().next(),
            selectNestedListCheckbox = nestedList.find("label:not([for]) input:checkbox");
     
        if(checkbox.is(":checked")) {
            return selectNestedListCheckbox.prop("checked", true);
        }
        selectNestedListCheckbox.prop("checked", false);
  });
      var param = {anio : 2017}
      $.ajax({
        url: "/dameArboles",
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.arbol);
          var cad = '<div class="acidjs-css3-treeview">';
          var i, j, auxV;
          for(i=0;i<aver2.length;i++)
          {
            cad=cad +'<ul><li><input type="checkbox" id="node-'+i+'"/><label><input type="checkbox" /><span></span></label><label for="node-'+i+'">'+resp.arbol[aver2[i]].Descripcion+'  '+format2(parseFloat(resp.arbol[aver2[i]].Importe),'$')+'</label>';
            var aver3 = resp.arbol[aver2[i]].Rama1;
            for(j=0;j<aver3.length;j++)
            {
              cad=cad+' <ul><li><input type="checkbox" id="node-'+i+'-'+j+'"/><label><input type="checkbox" /><span></span></label><label for="node-'+i+'-'+j+'">'+resp.arbol[aver2[i]].Rama1[aver3[j]].Descripcion+'  '+format2(parseFloat(resp.arbol[aver2[i]].Rama1[aver3[j]].Importe),'$')+'</label>';
              //for k
              cad=cad +'</li></ul>';
            }
            cad=cad +'</li></ul>';
          }
          cad = cad + '</div>';
          $("#arbol").html(cad);
        }
      });
  });

$(document).on("click", "#antilavado", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Antilavado de ingresos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Anti-Lavadora<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<center><img src="static/lavado.png"/></center>'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group" style="display:none;">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarAntilavadora" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="detalleAntiLavadoraDiv"></div>'+
                  '<div class="form-group" id="reporteDetalleFacturacion">'+
                  '<table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>RFC</th><th>Cantidad del mes</th><th>Cantidad sin declarar</th><th>&iquest;Declare este mes?</th></tr></thead><tbody id="reporteFacturas"></tbody></table>'+
                  '</div>'+
                  '<div id="container"></div>'+
                  '<div id="sliders">'+
                      '<table>'+
                          '<tr>'+
                            '<td>Alpha Angle</td>'+
                            '<td><input id="alpha" type="range" min="0" max="45" value="15"/> <span id="alpha-value" class="value"></span></td>'+
                          '</tr>'+
                          '<tr>'+
                            '<td>Beta Angle</td>'+
                            '<td><input id="beta" type="range" min="-45" max="45" value="15"/> <span id="beta-value" class="value"></span></td>'+
                          '</tr>'+
                          '<tr>'+
                            '<td>Depth</td>'+
                            '<td><input id="depth" type="range" min="20" max="100" value="50"/> <span id="depth-value" class="value"></span></td>'+
                          '</tr>'+
                      '</table>'+
                  '</div>'+
                  '<div id="containerDonut" style="height: 400px"></div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/periodosDeFacturacion",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.facturas);
          var cad = '';
          var i, j, auxV;
          for(i=0;i<aver2.length;i++)
          {
            cad=cad +'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
          }
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);

          
        }
      });
  });
var chart;

$(document).on("click", ".detalleAntilavadora", function (){
  var delPeriodo = $(this).attr("del");
  var alPeriodo = $(this).attr("al");
  var rfc = $(this).attr("rfc");
  var param = { delPeriodo : delPeriodo, alPeriodo:alPeriodo, rfc: rfc};
  $.ajax({
    url: "/verFacturacionDeIngresosRFC",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        /*window.open(
          "/generarExcelAntilavadora?delPeriodo=" +delPeriodo+'&alPeriodo='+alPeriodo+'&rfc'+rfc,
          '_blank'
        );*/
        var aver2 = Object.keys(resp.facturas);
          cad = '<table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>Folio</th><th>BUNIT</th><th>Fecha</th><th>Folio fiscal</th><th>Cantidad</th><th>PDF</th><th>Cancelar</th><th>idBanco</th></tr></thead><tbody id="reporteFacturas">';

          var i, j, auxV;
          for(i=0;i<aver2.length-1;i++)
          {
            for(j=i+1;j<aver2.length;j++)
            {
              if(parseInt(resp.facturas[aver2[i]].Folio)<parseInt(resp.facturas[aver2[j]].Folio))
              {
                auxV = aver2[i]
                aver2[i] = aver2[j]
                aver2[j] = auxV;
              }
            }
          }
          for(i=0;i<aver2.length;i++)
          {
            var color = 'background-color:#FF0;'
            if(parseInt(resp.facturas[aver2[i]].Tipo)==1)//banco
            {
              color = 'background-color:#FFF;'
            }
            cad=cad+'<tr style="'+color+'"><td>'+resp.facturas[aver2[i]].Folio+'</td><td>'+resp.facturas[aver2[i]].BUNIT+'</td><td>'+resp.facturas[aver2[i]].Fecha+'</td><td><a class="muestraXML" xml="'+resp.facturas[aver2[i]].XML+'" >'+resp.facturas[aver2[i]].UUID+'</a></td><td>'+format2(parseFloat(resp.facturas[aver2[i]].Cantidad),'$')+'</td><td><a uuid="'+resp.facturas[aver2[i]].UUID+'" class="muestraPDF" pdf="'+resp.facturas[aver2[i]].PDF+'" >Ver PDF</a></td><td><button type="submit" idBanco="'+resp.facturas[aver2[i]].IdBanco+'" class="btn btn-danger cancelarIngresosNew" UUID="'+resp.facturas[aver2[i]].UUID+'">Cancelar</button> </td>';
            if(parseInt(resp.facturas[aver2[i]].Tipo)==1)//banco
            {
              cad=cad+'<td><a href="/generarBanco?idBanco='+resp.facturas[aver2[i]].IdBanco+'" target="_blank">'+resp.facturas[aver2[i]].IdBanco+'</a></td>';
            }
            else
            {
              cad=cad+'<td></td>';              
            }

            cad=cad+'</tr>';
          } 
          cad=cad+'</tbody></table>';
          $("#detalleAntiLavadoraDiv").html(cad);
      }
    }
  });
});


$(document).on("click", ".declare", function (){
  var rfc = $(this).attr("rfc");
  var declare = $(this).is(':checked') ? "1" : "0";
  var cantidad = $(this).attr("cantidad");
  var periodo = $(this).attr("del");
  var param = { rfc : rfc, cantidad:cantidad, periodo:periodo, declare : declare};
  $.ajax({
    url: "/declare",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
      }
    }
  });
  
});
$(document).on("click", "#generarAntilavadora", function (){
  var delPeriodo = $("#delPeriodo").val();
  var alPeriodo = delPeriodo;// $("#alPeriodo").val();
  var param = { delPeriodo : delPeriodo, alPeriodo:alPeriodo};
  $.ajax({
    url: "/generarAntilavadora",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var i=0,aver2 = Object.keys(resp.facturas),cad='';
        var x = new Array();
        var y = new Array();
        var pie = new Array();
        for(i=0;i<aver2.length;i++)
        {
          x.push(resp.facturas[aver2[i]].Rfc+'-'+resp.facturas[aver2[i]].RazonSocial);
          var cantidad = parseFloat(resp.facturas[aver2[i]].Cantidad);
          cantidad = Math.round(cantidad*100)/100;
          y.push(cantidad);
          pie.push(new Array(resp.facturas[aver2[i]].Rfc,cantidad ));
          cad=cad+'<tr><td><a href="javascript:void(0)" rfc="'+resp.facturas[aver2[i]].Rfc+'" del="'+delPeriodo+'" al="'+alPeriodo+'" class="detalleAntilavadora"><u>'+resp.facturas[aver2[i]].Rfc+'</u></a></td><td>'+format2(parseFloat(resp.facturas[aver2[i]].Cantidad),'$')+'</td><td>'+format2(parseFloat(resp.facturas[aver2[i]].Cantidad),'$')+'</td><td><input type="checkbox" name="declare" rfc="'+resp.facturas[aver2[i]].Rfc+'" del="'+delPeriodo+'" cantidad="'+resp.facturas[aver2[i]].Cantidad+'" al="'+alPeriodo+'" class="form-control col-md-9 declare" /></td></tr>';
        }
        $("#reporteFacturas").html(cad);
        Highcharts.chart('containerDonut', {
            chart: {
                type: 'pie',
                options3d: {
                    enabled: true,
                    alpha: 45
                }
            },
            title: {
                text: 'Antilavado'
            },
            subtitle: {
                text: delPeriodo+ ' al '+alPeriodo
            },
            plotOptions: {
                pie: {
                    innerSize: 100,
                    depth: 45
                }
            },
            series: [{
                name: 'Facturado',
                data: pie
            }]
        });
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'column',
                options3d: {
                    enabled: true,
                    alpha: 15,
                    beta: 15,
                    depth: 50,
                    viewDistance: 25
                }
            },
            title: {
                text: 'Antilavado'
            },
            subtitle: {
                text: delPeriodo+ ' al '+alPeriodo
            },
            plotOptions: {
                column: {
                    depth: 25
                }
            },
            xAxis: {
                categories: x,
                title: {
                    text: null
                }
            },
            series: [{
                data: y
            }]
        });
        showValues();
        // Activate the sliders
        $('#sliders input').on('input change', function () {
            chart.options.chart.options3d[this.id] = parseFloat(this.value);
            showValues();
            chart.redraw(false);
        });
      }
    }
  });
});

function showValues() {
    $('#alpha-value').html(chart.options.chart.options3d.alpha);
    $('#beta-value').html(chart.options.chart.options3d.beta);
    $('#depth-value').html(chart.options.chart.options3d.depth);
}

function verFacturacionDeNomina() {

   var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Facturacion de manutenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Facturacion de manutenci&oacute;n<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<select class="form-control" id="selectAnio" style="font-size:20px;">'+
                        '<option value="2018">2018</option>'+
                        '<option selected value="2019">2019</option>'+
                        '<option value="2020">2020</option>'+
                        '</select>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="reporteDetalleFacturacion">'+
                  '<table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>Persona</th><th>Enero</th><th>Febrero</th><th>Marzo</th><th>Abril</th><th>Mayo</th><th>Junio</th><th>Julio</th>><th>Agosto</th>><th>Septiembre</th>><th>Octubre</th>><th>Noviembre</th>><th>Diciembre</th><th>Reporte</th></tr></thead><tbody id="bodyFacturasManutencion"></tbody></table>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      var anio = $("#selectAnio").val();
      $.ajax({
        url: "/verFacturacionDeNomina",
        dataType : "json",
        type : "post",
        data: {anio : anio},
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.facturas);
          var cad = '', i=0,j=0;
          var aver3;
          var BUNIT = $("#BUNITACTUAL").html();
          for(i=0;i<aver2.length;i++) {
            var nombre = resp.facturas[aver2[i]].Nombre.trim();
            cad=cad+'<tr><td>'+resp.facturas[aver2[i]].Nombre+'</td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Enero);
            cad=cad+'<td>';
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Enero[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Enero[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Enero[aver3[j]].Manual)==0){
                fecha = ""+anio+"-01-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Enero[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="01" class="pdfNomina" er="'+aver2[i]+'" target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'001/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Febrero);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Febrero[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Febrero[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Febrero[aver3[j]].Manual)==0){
                fecha = ""+anio+"-02-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Febrero[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="02" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'002/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Marzo);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Marzo[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Marzo[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Marzo[aver3[j]].Manual)==0){
                fecha = ""+anio+"-03-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Marzo[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="03" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'003/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Abril);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Abril[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Abril[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Abril[aver3[j]].Manual)==0){
                fecha = ""+anio+"-04-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Abril[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="04" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'004/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Mayo);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Mayo[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Mayo[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Mayo[aver3[j]].Manual)==0){
                fecha = ""+anio+"-05-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Mayo[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="05" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'005/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Junio);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Junio[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Junio[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Junio[aver3[j]].Manual)==0){
                fecha = ""+anio+"-06-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Junio[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="06" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'006/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Julio);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Julio[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Julio[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Julio[aver3[j]].Manual)==0){
                fecha = ""+anio+"-07-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Julio[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="07" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'007/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Agosto);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Agosto[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Agosto[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Agosto[aver3[j]].Manual)==0){
                fecha = ""+anio+"-08-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Agosto[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="08" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'008/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Septiembre);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Septiembre[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Septiembre[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Septiembre[aver3[j]].Manual)==0){
                fecha = ""+anio+"-09-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Septiembre[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="09" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'009/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Octubre);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Octubre[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Octubre[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Octubre[aver3[j]].Manual)==0){
                fecha = ""+anio+"-10-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Octubre[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="10" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'010/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Noviembre);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Noviembre[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Noviembre[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Noviembre[aver3[j]].Manual)==0){
                fecha = ""+anio+"-11-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Noviembre[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="11" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'011/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            
            cad=cad+'</td><td>';
            aver3 = Object.keys(resp.facturas[aver2[i]].Diciembre);
            for(j=0;j<aver3.length;j++) {
              var string = numeral(parseFloat(resp.facturas[aver2[i]].Diciembre[aver3[j]].Cantidad)).format('$0,0.00');
              var fecha = resp.facturas[aver2[i]].Diciembre[aver3[j]].Fecha;
              if(parseInt(resp.facturas[aver2[i]].Diciembre[aver3[j]].Manual)==0){
                fecha = ""+anio+"-12-25";
              }
              cad=cad+'<span cadOriginal="'+resp.facturas[aver2[i]].Diciembre[aver3[j]].CadOriginal+'" class="uuidManutencion" UUID="'+aver3[j]+'"><a mes="12" class="pdfNomina" er="'+aver2[i]+'"  target="_blank" href="static/manuntencion/3.3/'+BUNIT+'/'+anio+'012/'+fecha+'/'+nombre+'_TIMBRADO.pdf">'+string+'</a><br>';
            }
            cad=cad+'</td><td><button class="btn btn-success imprimePDFNominaDePersona" er="'+aver2[i]+'">Todos</td></td></tr>';
          }//for aver2
          $("#bodyFacturasManutencion").html(cad);

        }
      });
}

$(document).on("click", ".imprimePDFNominaDePersona", function (){
  var er = $(this).attr("er");
  var cads = new Array();
  var i;
  var hola = $('.pdfNomina[er="'+er+'"]');
  for(i=0;i<hola.length;i++) {
    cads.push($(hola[i]).attr("href"));
  }
  
  var anio = $("#selectAnio").val();
  $.ajax({
    url: "/imprimirRecibosYaTimbradosDePersona",
    dataType : "json",
    type : "post",
    data: {anio : anio, cads : cads, er : er},
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      window.open(
          "/" +resp.pdf,  
          '_blank'
        );
    }
  });

});
function verFacturacionDeIngresos() {
  var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Facturacion de ingresos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Facturacion de ingresos<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group" id="reporteDetalleFacturacion">'+
                  '<table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>Folio</th><th>BUNIT</th><th>Fecha</th><th>Folio fiscal</th><th>Cantidad</th><th>PDF</th><th>Cancelar</th><th>Status</th></tr></thead><tbody id="reporteFacturas"></tbody></table>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/verFacturacionDeIngresos",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.facturas);
          cad = '';
          var i, j, auxV;
          for(i=0;i<aver2.length-1;i++)
          {
            for(j=i+1;j<aver2.length;j++)
            {
              if(parseInt(resp.facturas[aver2[i]].Folio)<parseInt(resp.facturas[aver2[j]].Folio))
              {
                auxV = aver2[i]
                aver2[i] = aver2[j]
                aver2[j] = auxV;
              }
            }
          }
          for(i=0;i<aver2.length;i++)
          {
            var status = "Vigente";
            var style = "";
            if(resp.facturas[aver2[i]].Cancelada == 1) {
              status = "Cancelada";
              style = ' style="background-color:#F00;color:#FFF;" ';
            }
            cad=cad+'<tr '+style+'><td>'+resp.facturas[aver2[i]].Folio+'</td><td>'+resp.facturas[aver2[i]].BUNIT+'</td><td>'+resp.facturas[aver2[i]].Fecha+'</td><td><a class="muestraXML" xml="'+resp.facturas[aver2[i]].XML+'" >'+resp.facturas[aver2[i]].UUID+'</a></td><td>'+format2(parseFloat(resp.facturas[aver2[i]].Cantidad),'$')+'</td><td><a uuid="'+resp.facturas[aver2[i]].UUID+'" class="muestraPDF" pdf="'+resp.facturas[aver2[i]].PDF+'" >Ver PDF</a></td><td> <button type="submit" idBanco="0" class="btn btn-danger cancelarIngresosNew" UUID="'+resp.facturas[aver2[i]].UUID+'">Cancelar</button> </td><td>'+status+'</td> </tr>';
          } 
          $("#reporteFacturas").html(cad);
        }
      });
}


$(document).on("click", "#verFacturacionDeNomina", function (){
  verFacturacionDeNomina();      
});
$(document).on("click", "#verFacturacionDeIngresos", function (){
  verFacturacionDeIngresos();      
});
$(document).on("click", "#iglesiasReporteDiezmosExcel", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diezmos de iglesias en Excel </h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diezmos de iglesias<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delDistrito">Del distrito:</label>'+
                          '<select id="delDistrito" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delTipoDeIngreso">Del tipo de ingreso:</label>'+
                          '<select id="delTipoDeIngreso" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeIglesiasDiezmosEnPagina" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="x_content" id="reporteDetalle">'+
                      '</div><br><hr><br>'+
                      '<div class="x_content" id="reporteEnPagina">'+
                      '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim().substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<anios.length;i++)
          {
            cad=cad+'<option value="'+anios[i].toString().trim()+'">'+anios[i].toString().trim()+'</option>';
          } 
          cad='';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          }
          var cadX = '';
          aver2 = Object.keys(resp.distritos);
          for(i=0;i<aver2.length;i++)
          {
            cadX=cadX+'<option value="'+aver2[i]+'">'+resp.distritos[aver2[i]].Nombre+'</option>';
          }
          var cadY = '';
          aver2 = Object.keys(resp.cuentasIngreso);
          for(i=0;i<aver2.length;i++)
          {
            cadY=cadY+'<option value="'+aver2[i]+'">'+resp.cuentasIngreso[aver2[i]].Completo+'</option>';
          }
          $("#delTipoDeIngreso").html(cadY);
          $("#delDistrito").html(cadX);
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });


var arrayCads = new Array();
var arrayER = new Array();
var arrayCuantasPercepciones = new Array();
var arrayCuantasDeducciones = new Array();
var arrayCuantasOtrosPagos = new Array();
$(document).on("click", "#contabilizarYTimbrar", function (){
  var delPeriodo = $("#delPeriodo").val();
  window.open(
    "/generarDiario?libro=A&diario=-1&delPeriodo=" + delPeriodo,
    '_blank'
  );
});


$(document).on("click", "#GenerarExcelConEstaLista", function (){
  var cad = 'data:text/csv;charset=utf-8,Nobre,Periodo,Cantidad';
  var i;
  var nombres = $(".todosLosNombresParaExcel");
  var periodos = $(".todosLosPeriodosParaExcel");
  var cantidades = $(".todosLasCantidadesParaExcel");
  for(i=0;i<nombres.length;i++)
  {
    var iA = nombres[i];
    var iB = periodos[i];
    var iC = cantidades[i];
    cad=cad+'\n'+$(iA).html()+","+$(iB).html()+","+$(iC).html().replace(",","").replace(",","").replace("$","");
  }
              var encodedUri = encodeURI(cad);
              var link = document.createElement("a");
              link.setAttribute("href", encodedUri);
              link.setAttribute("download", "manutencion.csv");
              link.click(); 
});  
$(document).on("click", "#generarTablaDeTimbradoManutencionMinistros", function (){
  var periodo = $("#delPeriodo").val();
  $("#tablaTimbrado").html('<div class="col-md-12 col-sm-12 col-xs-12" id="loadingCampos"></div><div class="col-md-12 col-sm-12 col-xs-12"><table class="table table-striped" style="text-align:center; font-size:24px;"><thead><tr><th>Nombre</th><th>Periodo</th><th>Total</th><th>Estado de cuenta</th><th>Vista Previa</th><th>Timbrar y mandar</th></tr></thead><tbody id="pretimbradoTablaNomina"></tbody></table><a href="javascript:void(0)" class="vesAlISRAnualExcel" periodo="'+periodo+'"><button type="submit" class="btn btn-success">Ver ISR timbrado Anual en Excel</button></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" class="vesAlISRAnual" periodo="'+periodo+'"><button type="submit" class="btn btn-success">Ver ISR timbrado Anual</button></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" class="vesAlISR" periodo="'+periodo+'"><button type="submit" class="btn btn-success">Ver ISR timbrado del Mes</button></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="submit" id="GenerarExcelConEstaLista" class="btn btn-success">General Excel con esta lista</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="submit" id="imprimirRecibosYaTimbrados" class="btn btn-success">General PDF de nomina con esta lista</button></div>');
//   cadN = '||3.3|N|'+folioQueSigue+'|'+dateISO+'|99|'+certificado+'|'+percepciones+'|'+descuentosTotales+'|MXN|'+subtotalN+'|N|PUE|'+lugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|'+regimen+'|'+rfc+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+percepciones+'|'+percepciones+'|'+descuentosTotales+'|1.2|O|'+TRANS_DATETIME+'|'+fechaInicio+'|'+fechaFinal+'|'+diffDaysParaTimbreDiasPagados+'|'+percepciones+'|'+descuentosTotales+'|0.00|'+curp+'|09|01|09|'+ne+'|MINISTROS DE CULTO|Ninguno|05|'+banco+'|'+cuentaBancaria+'|'+estado+'|'+percepciones+'|'+gravado+'|'+exento+'|046|014|MANUTENCION|'+gravado+'|'+exento+'|0|'+isr+'|002|010|ISR|'+isr+'||';
  var i;
  var cad = '';
  
  var timestamp = Math.floor(Date.now() / 1000);
  var cuantos = 0;
  for(i=0;i<arrayER.length;i++)
  {
    var c = arrayCads[i];
      var er = arrayER[i];
      var deducciones = arrayCuantasDeducciones[i];
      var percepciones = arrayCuantasPercepciones[i];
      var otros = arrayCuantasOtrosPagos[i];
      var tipoContrato = "09";//ministros hardcode
      
      var tipoPayroll = parseInt($("#generarPreContabilizacionClientSide").attr("tipo"));//1 asociados, 2 ministros, 3 jubilados
      if(tipoPayroll==1)
      {
        tipoContrato ="01";
      }
      var a =  c.split('|');
      a[11] = Math.round(a[11] * 100) / 100;
      var indexOfNombre = 19;
      var indexOfCantidad = 11;
      if(deducciones==0)
      {
        indexOfNombre = 18;
        indexOfCantidad = 10;
      }


      cad=cad+'<tr><td class="todosLosNombresParaExcel">'+a[indexOfNombre]+'</td><td class="todosLosPeriodosParaExcel">'+periodo+'</td><td cantidad="'+a[indexOfCantidad]+'" class="todosLasCantidadesParaExcel">'+format2(parseFloat(a[indexOfCantidad]),'$')+'</td><td><button type="button" er="'+er+'" delperiodo="'+periodo+'" class="btn btn-round btn-success estadoDeCuentaNomina">Estado de cuenta</button></td><td><button type="button" deducciones="'+deducciones+'" percepciones="'+percepciones+'" otros="'+otros+'" tipoContrato="'+tipoContrato+'" cadOriginal="'+c+'" er="'+er+'" delperiodo="'+periodo+'" timestamp="'+timestamp+'" class="btn btn-round btn-success vistaPreviaTimbradoNomina">Vista previa</button></td><td><button type="button" er="'+er+'" timestamp="'+timestamp+'" deducciones="'+deducciones+'" percepciones="'+percepciones+'" otros="'+otros+'" tipoContrato="'+tipoContrato+'" delperiodo="'+periodo+'" cadOriginal="'+c+'" class="btn btn-round btn-warning timbrarNomina">Timbrar</button></td></tr>';
    var param = { periodo : periodo, ER : arrayER[i], cad : arrayCads[i], cantidad : a[indexOfCantidad], currentTime : timestamp, cuantasPercepciones : arrayCuantasPercepciones[i], cuantasDeducciones : arrayCuantasDeducciones[i], cuantasOtrosPagos : arrayCuantasOtrosPagos[i] };
    $.ajax({
      url: "/insertaCadNomina",
      dataType : "json",
      type : "post",
      async : false,
      data : param,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          cuantos++;
          var j;
          var aver2 = Object.keys(resp.facturado);
          for(j=0;j<aver2.length;j++)
          {
             cad=cad+'<tr><td>TIMBRADO: '+a[indexOfNombre]+'</td><td>'+periodo+'</td><td>'+format2(parseFloat(resp.facturado[aver2[j]].Cantidad),'$')+'</td><button type="button" er="'+er+'" delperiodo="'+periodo+'" class="btn btn-round btn-success estadoDeCuentaNomina">Estado de cuenta</button><td><button type="button"  ER="'+er+'"  periodo="'+periodo+'" UUID="'+aver2[j]+'" class="btn btn-round btn-success verTimbradoNomina">Ver</button>&nbsp;&nbsp;<button type="button"  ER="'+er+'"  periodo="'+periodo+'" UUID="'+aver2[j]+'" style="display:none" class="btn btn-round btn-success verTimbradoNominaXML">Ver XML</button></td><td><button type="button"  UUID="'+aver2[j]+'"  ER="'+er+'"  TimeStamp="'+timestamp+'" class="btn btn-round btn-danger cancelaTimbradoNomina" >Cancelar</button></td></tr>';
          }
        }
      }
    });
  }
  $("#pretimbradoTablaNomina").html(cad);
});

$(document).on("click", "#generarPreContabilizacionClientSide", function (){
  var tipoPayroll = parseInt($(this).attr("tipo"));//1 asociados, 2 ministros, 3 emeritos
  var regPatronal = $("#delPeriodo").attr("regPatronal");
  var folioQueSigue = parseInt($("#delPeriodo").attr("folio"));
  var dateISO = $("#delPeriodo").attr("date");
  var rfcEmisor = $("#delPeriodo").attr("rfc");
  var regimen = $("#delPeriodo").attr("regimen");
  var razonSocial = $("#delPeriodo").attr("razonSocial");
  var regPatronal = $("#delPeriodo").attr("regPatronal");
  var lugarExpedicion = $("#delPeriodo").attr("lugarExpedicion");
  

  var PERIOD = $("#delPeriodo").val();
  var anio = PERIOD.substring(0,4)
  var mes = PERIOD.substring(5,7);
  var TRANS_DATETIME = anio+"-"+mes+"-25";
  var TRANS_DATETIMEForSSC = "25"+mes+anio;
  var fechaInicio = anio+"-"+mes+"-01";
  var diaFinal = "30";
  if(mes=="01" || mes=="03" || mes=="05" || mes=="07"  || mes=="08" || mes=="10" || mes=="12")
  {
    diaFinal = "31";
  }
  if(mes=="02")
  {
    diaFinal="28";
    if(parseInt(anio)%4==0)
    {
      diaFinal="29";
    }
  }
  var fechaFinal = anio+"-"+mes+"-"+diaFinal;
  var date1 = new Date(fechaInicio);
  var date2 = new Date(fechaFinal);
  var timeDiff = Math.abs(date2.getTime() - date1.getTime());
  var diffDaysParaTimbreDiasPagados = Math.ceil(timeDiff / (1000 * 3600 * 24))+1;    
  var TREFERENCE = "01/"+mes+"/"+anio;
  var rows=hot.countRows();  
  var cols=hot.countCols();
  var param = { delPeriodo : delPeriodo};
  var cuak = hot.getData(0,0,rows,cols);
  var i;
  var cad2 = '';
  var cuantasLineas = 0;
  var cuantasLineasBase = 18;
  var cuentaAportacionesDeJubilaciones = '812110';
  var cuentaEBPViejitos = '338EBPDI01';
  var BUNIT = $("#BUNITACTUAL").html();
  var tipoDeDiario = "JV";
  if(tipoPayroll==3)//emeritos
  {
    var sumaTodo = 0;
    var cadDeCosas='';
    var cuentaISRJubilados = '338ISRRE01';
    var cuentaDiezmoJubilado = '338EBPDI01';
    var TREFERENCE = "JUBILACION";
    var descrCosas = "APORTE DE JUBILACION "+PERIOD;
    var cad3 = '';
    arrayCads = new Array();
    arrayER = new Array();
    arrayCuantasPercepciones = new Array();
    arrayCuantasDeducciones = new Array();
    arrayCuantasOtrosPagos = new Array();
    //aqui empieza!!
    var cadN = '';
    var certificado = dameNoCertificadoSegunRFC(rfcEmisor);
    console.log("Cuantos son: "+cuak.length);
    for(i=0;i<cuak.length;i++)
    {
      var ER = cuak[i][0];
      if(!ER)
      {
        break;
      }
    //  var TotalADepositar = cuak[i][3];
   
      var nombre = cuak[i][1];
      var Departamento = cuak[i][2];
      var Pension = cuak[i][3];
      var BonoCondicional = cuak[i][4];
      var AyudaDeRentaViejitos = cuak[i][5];
      var BonoDeConyugue = cuak[i][6];
      var BonoDeNavidad = cuak[i][7];
      var TotalDeIngresosViejitos = cuak[i][8];
      var SeguroDeSobreviviente = cuak[i][9];
      var TotalDIA = cuak[i][10];
      var diezmo = cuak[i][11];
      var BaseGravable = cuak[i][12];
      var exento = cuak[i][13];
      var gravado = cuak[i][14];
      var isr = cuak[i][15];
      var TotalAPagarViejitos = cuak[i][16];
      var Funcion = cuak[i][17];
      var rfc = cuak[i][18];
      var curp = cuak[i][19];
      var ne = cuak[i][20];
      var banco = cuak[i][21];
      var cuentaBancaria = cuak[i][22];
      var estado = cuak[i][23];
      if(ne<10)
      {
        ne="00"+ne;
      }
      else
      {
        if(ne<100)
        {
          ne="0"+ne;
        }
      }
      gravado = Math.round(parseFloat(gravado) * 100) / 100;
      exento = Math.round(parseFloat(exento) * 100) / 100;
      var guardaExento = exento;
      var guardaGravado = gravado;
      var ANAL_T3 = Funcion;
      isr = Math.round(isr * 100) / 100;
      if (!(isr%1)) { 
        isr = isr + ".00";
      }
      isr = ""+ isr;
      var auxA = isr.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          isr = isr + "0";
        }
      }
      cadN = '';
      var descuentosTotales = parseFloat(isr);
      var BUNITViejito = $("#BUNITACTUAL").html();
      var USUARIOACTUAL = $("#USUARIOACTUAL").html();
      if(USUARIOACTUAL=="MPJ")
      {
        BUNITViejito = $("#selectCampoPayroll").val();
        BUNIT = BUNITViejito;
      }
      //var anticipos = rentaPcent + afroumn + incapacidad;//para descuentos... sure?
      var param = { ER : ER, PERIOD : PERIOD, BUNITViejito : BUNITViejito};//EMERITOS
      var cuantasPercepciones = 1;
      var cuantasDeducciones = 0;
      if(parseFloat(isr)>0.00)
      {
        cuantasDeducciones++;
      }
      var cuantasOtrosPagos = 0;
      var cadAdicionalDeducciones = '';
      var cadAdicionalPercepciones = '';
      var cadAdicionalOtrosPagos = '';
      var totalOtrasDeducciones = 0;
      var totalOtrosPagos = 0;//EMERITOS

      $.ajax({
        url: "/dameDescuentosDelER",//y creditos tambien :) //EMERITOS
        dataType : "json",
        type : "post",
        async : false,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var aver2 = Object.keys(resp.anticipo);//EMERITOS
            if(aver2.length>0)
            {
              resp.anticipo["0"].Cantidad = Math.round(parseFloat(resp.anticipo["0"].Cantidad) * 100) / 100;
              if(resp.anticipo["0"].Cantidad>0.00)//EMERITOS
              {
                cuantasDeducciones++;
                cadAdicionalDeducciones=cadAdicionalDeducciones+'012|030|ANTICIPO|'+resp.anticipo["0"].Cantidad+'|';
                totalOtrasDeducciones+=parseFloat(resp.anticipo["0"].Cantidad);  
              }
            }
            aver2 = Object.keys(resp.infonavit);//EMERITOS
            if(aver2.length>0)
            {
              cuantasDeducciones++;
              resp.infonavit["0"].Cantidad = Math.round(parseFloat(resp.infonavit["0"].Cantidad) * 100) / 100;
              cadAdicionalDeducciones=cadAdicionalDeducciones+'009|445|INFONAVIT|'+resp.infonavit["0"].Cantidad+'|';
              totalOtrasDeducciones+=parseFloat(resp.infonavit["0"].Cantidad);
            }
            aver2 = Object.keys(resp.otros);//EMERITOS
            if(aver2.length>0)
            {
              cuantasDeducciones++;
              resp.otros["0"].Cantidad = Math.round(parseFloat(resp.otros["0"].Cantidad) * 100) / 100;
              
              cadAdicionalDeducciones=cadAdicionalDeducciones+'004|005|OTROS|'+resp.otros["0"].Cantidad+'|';
              totalOtrasDeducciones+=parseFloat(resp.otros["0"].Cantidad);
            }
            aver2 = Object.keys(resp.percepcionesDepre);
            if(aver2.length>0)
            {
              if(aver2.indexOf("0")!=-1)//EMERITOS
              {
                cuantasOtrosPagos++;
                resp.percepcionesDepre["0"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["0"].Cantidad) * 100) / 100;
                
                cadAdicionalOtrosPagos=cadAdicionalOtrosPagos+'999|888|OTROS|'+resp.percepcionesDepre["0"].Cantidad+'|';
                totalOtrosPagos+=parseFloat(resp.percepcionesDepre["0"].Cantidad);
              }
              if(aver2.indexOf("1")!=-1)//EMERITOS
              {
                cuantasPercepciones++;
                resp.percepcionesDepre["1"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["1"].Cantidad) * 100) / 100;
                var subtotalPrima = resp.percepcionesDepre["1"].Cantidad;
                var limiteExentoPrima = 1267.35;
                var exentoPrima = 0.00;
                var gravadoPrima = 0.00;
                if(subtotalPrima<=limiteExentoPrima)
                {
                  exentoPrima=subtotalPrima;//EMERITOS
                } else {
                  exentoPrima = limiteExentoPrima;
                  gravadoPrima =subtotalPrima-exentoPrima;
                  gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                }
                exentoPrima = Math.round(parseFloat(exentoPrima) * 100) / 100;
                gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                cadAdicionalPercepciones=cadAdicionalPercepciones+'021|121|PRIMA|'+gravadoPrima+'|'+exentoPrima+'|';
                exentoPrima = Math.round(parseFloat(exentoPrima) * 100) / 100;
                gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                
                gravado=gravado+gravadoPrima;
                exento=exento+exentoPrima;
                
                isr = dameISRDeGravado(gravado) - dameSubsidio(gravado);
                isr = Math.round(isr * 100) / 100;
                if (!(isr%1)) { 
                  isr = isr + ".00";
                }
                isr = ""+ isr;
                var auxA = isr.split(".");
                if(auxA.length==2) {
                  var v = auxA[1].length;
                  if(v==1) {
                    isr = isr + "0";
                  }
                }

              }
              if(aver2.indexOf("2")!=-1)//EMERITOS
              {
                //EMERITOS
                cuantasPercepciones++;
                resp.percepcionesDepre["2"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["2"].Cantidad) * 100) / 100;
                var subtotalPrima = resp.percepcionesDepre["2"].Cantidad;
                var limiteExentoPrima = 2418;
                var exentoPrima = 0.00;
                var gravadoPrima = 0.00;
                if(subtotalPrima<=limiteExentoPrima)
                {
                  exentoPrima=subtotalPrima;
                } else {
                  exentoPrima = limiteExentoPrima;
                  gravadoPrima =subtotalPrima-exentoPrima;
                  gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                }
                cadAdicionalPercepciones=cadAdicionalPercepciones+'002|102|AGUINALDO|'+gravadoPrima+'|'+exentoPrima+'|';
                gravado+=gravadoPrima;
                exento+=exentoPrima;
                isr = dameISRDeGravado(gravado);
                isr = Math.round(isr * 100) / 100;
                if (!(isr%1)) { 
                  isr = isr + ".00";
                }
                isr = ""+ isr;
                var auxA = isr.split(".");
                if(auxA.length==2) {
                  var v = auxA[1].length;
                  if(v==1) {
                    isr = isr + "0";
                  }
                }

                //EMERITOS
              }
            }
          }
        }
      });
      //EMERITOS
      totalOtrosPagos = Math.round(totalOtrosPagos * 100) / 100;
      totalOtrasDeducciones = Math.round(totalOtrasDeducciones * 100) / 100;
      //gravado+=sumaleAlGravado;
      descuentosTotales+=totalOtrasDeducciones;
      descuentosTotales = Math.round(descuentosTotales * 100) / 100;
      gravado = Math.round(gravado * 100) / 100;
      guardaGravado = Math.round(guardaGravado * 100) / 100;
      guardaExento = Math.round(guardaExento * 100) / 100;
      var percepciones = gravado + exento;
      var percepcionesMasOtrosPagos = percepciones + totalOtrosPagos;
      percepciones = Math.round(percepciones * 100) / 100;
      percepcionesMasOtrosPagos = Math.round(percepcionesMasOtrosPagos * 100) / 100;
      var subtotalN = percepcionesMasOtrosPagos;// - descuentosTotales;
      subtotalN = Math.round(subtotalN * 100) / 100;
      var totalRecibo = subtotalN - descuentosTotales;
      totalRecibo = Math.round(totalRecibo * 100) / 100;
      if (!(percepcionesMasOtrosPagos%1)) { 
        percepcionesMasOtrosPagos = percepcionesMasOtrosPagos + ".00";
      }
      percepcionesMasOtrosPagos = ""+ percepcionesMasOtrosPagos;
      var auxA = percepcionesMasOtrosPagos.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          percepcionesMasOtrosPagos = percepcionesMasOtrosPagos + "0";
        }
      }
      if (!(totalOtrosPagos%1)) { 
        totalOtrosPagos = totalOtrosPagos + ".00";
      }
      totalOtrosPagos = ""+ totalOtrosPagos;
      var auxA = totalOtrosPagos.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalOtrosPagos = totalOtrosPagos + "0";
        }
      }
      if (!(totalOtrasDeducciones%1)) { 
        totalOtrasDeducciones = totalOtrasDeducciones + ".00";
      }
      totalOtrasDeducciones = ""+ totalOtrasDeducciones;
      var auxA = totalOtrasDeducciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalOtrasDeducciones = totalOtrasDeducciones + "0";
        }
      }//EMERITOS
      if (!(descuentosTotales%1)) { 
        descuentosTotales = descuentosTotales + ".00";
      }
      descuentosTotales = ""+ descuentosTotales;
      var auxA = descuentosTotales.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          descuentosTotales = descuentosTotales + "0";
        }
      }//EMERITOS
      if (!(guardaExento%1)) { //EMERITOS
        guardaExento = guardaExento + ".00";
      }
      guardaExento = ""+ guardaExento;
      var auxA = guardaExento.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          guardaExento = guardaExento + "0";
        }
      }
      if (!(exento%1)) { //EMERITOS
        exento = exento + ".00";
      }
      exento = ""+ exento;
      var auxA = exento.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          exento = exento + "0";
        }
      }//EMERITOS
      if (!(gravado%1)) { 
        gravado = gravado + ".00";
      }
      gravado = ""+ gravado;
      var auxA = gravado.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          gravado = gravado + "0";
        }
      }//EMERITOS
      if (!(guardaGravado%1)) { 
        guardaGravado = guardaGravado + ".00";
      }
      guardaGravado = ""+ guardaGravado;
      var auxA = guardaGravado.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          guardaGravado = guardaGravado + "0";
        }
      }//EMERITOS
      if (!(totalRecibo%1)) { 
        totalRecibo = totalRecibo + ".00";
      }
      totalRecibo = ""+ totalRecibo;
      var auxA = totalRecibo.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalRecibo = totalRecibo + "0";
        }
      }
      if (!(subtotalN%1)) { 
        subtotalN = subtotalN + ".00";
      }
      subtotalN = ""+ subtotalN;
      var auxA = subtotalN.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          subtotalN = subtotalN + "0";
        }
      }//EMERITOS
      if (!(percepciones%1)) { 
        percepciones = percepciones + ".00";
      }
      percepciones = ""+ percepciones;
      var auxA = percepciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          percepciones = percepciones + "0";
        }
      }//EMERITOS     
      //09 es el tipo de contrato, no existe relacion de trabajo
      //01 tipo de jornada, diurna
      //09 es el tipo de regimen, Asimilados a honorarios
      //05 es periodicidad de pago, Mensual
      //014 es el banco
      //046 ingreso asimilado a salarios
      //002 ISR
      //EMERITOS
      var noPongasBanco = false;
      console.log("CB: "+cuentaBancaria);
      if(cuentaBancaria.length==18)
      {
        noPongasBanco = true;
      }
      if(tipoPayroll==3)////EMERITOS
      {
        cadN = '||3.3|N|'+folioQueSigue+'|'+dateISO+'|99|'+certificado+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }
        cadN=cadN+'MXN|'+totalRecibo+'|N|PUE|'+lugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|603|'+rfc+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+subtotalN+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }

        cadN=cadN+'1.2|O|'+TRANS_DATETIME+'|'+fechaInicio+'|'+fechaFinal+'|'+diffDaysParaTimbreDiasPagados+'|'+percepciones+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|'+totalOtrosPagos+'|';
        }

        cadN=cadN+curp+'|09|99|11|'+ne+'|MINISTROS DE CULTO|Ninguno|05|';
        if(noPongasBanco){}
        else
        {
          cadN = cadN + banco+'|';
        }
        cadN = cadN + cuentaBancaria+'|'+estado+'|'+percepciones+'|'+gravado+'|'+exento+'|046|014|MANUTENCION|'+guardaGravado+'|'+guardaExento+'|'+cadAdicionalPercepciones;
        if(parseFloat(totalOtrasDeducciones)>0.00)
        {
          cadN=cadN+totalOtrasDeducciones+'|';
        }
        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+isr+'|';
        }
        cadN=cadN+cadAdicionalDeducciones;
        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+'002|010|ISR|'+isr+'|';
        }
        cadN=cadN+cadAdicionalOtrosPagos+'|';
      }
      arrayCuantasPercepciones.push(cuantasPercepciones);
      arrayCuantasDeducciones.push(cuantasDeducciones);
      arrayCuantasOtrosPagos.push(cuantasOtrosPagos);
      folioQueSigue++;
      arrayCads.push(cadN);
      arrayER.push(ER);
    }
    for(i=0;i<cuak.length;i++)
    {
      var ER = cuak[i][0];
      if(!ER)
      {
        break;
      }
      var Nombre = cuak[i][1];
      var Departamento = cuak[i][2];
      var Pension = cuak[i][3];
      var BonoCondicional = cuak[i][4];
      var AyudaDeRentaViejitos = cuak[i][5];
      var BonoDeConyugue = cuak[i][6];
      var BonoDeNavidad = cuak[i][7];
      var TotalDeIngresosViejitos = cuak[i][8];
      var SeguroDeSobreviviente = cuak[i][9];
      var TotalDIA = cuak[i][10];
      var DiezmoViejito = cuak[i][11];
      var ListaNetaEBPViejitos = cuak[i][12];
      var Exento = cuak[i][13];
      var Gravado = cuak[i][14];
      var ISR = cuak[i][15];
      var TotalAPagarViejitos = cuak[i][16];
      var Funcion = cuak[i][17];
      var RFC = cuak[i][18];
      var CURP = cuak[i][19];
      var NE = cuak[i][20];
      var Banco = cuak[i][21];
      var CuentaBancaria = cuak[i][22];
      var Estado = cuak[i][23];
      
      
      var totalDeVerdad = parseFloat(Exento)+parseFloat(Gravado)-parseFloat(ISR);
      totalDeVerdad = Math.round(parseFloat(totalDeVerdad) * 100) / 100;
      sumaTodo+=totalDeVerdad;
      var tfww = "";
      if(BUNIT=="MS1")
      {
        tfww="NF";
      }
      if(Pension>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JPENSI01|"+Nombre+"|"+Pension+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||PENSION|"+Pension+"|C|";
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+Pension+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JPENSI01</td></tr>';
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+Pension+'</td><td>C</td><td>'+TREFERENCE+'</td><td>PENSION</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
      }
      if(BonoCondicional>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JBOCON01|"+Nombre+"|"+BonoCondicional+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||BONO CONDICIONAL|"+BonoCondicional+"|C|";
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoCondicional+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JBOCON01</td></tr>';
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoCondicional+'</td><td>C</td><td>'+TREFERENCE+'</td><td>BONO CONDICIONAL</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
      }
      if(AyudaDeRentaViejitos>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JRENTA01|"+Nombre+"|"+AyudaDeRentaViejitos+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||AYUDA DE RENTA|"+AyudaDeRentaViejitos+"|C|";
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+AyudaDeRentaViejitos+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JRENTA01</td></tr>';
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+AyudaDeRentaViejitos+'</td><td>C</td><td>'+TREFERENCE+'</td><td>AYUDA DE RENTA</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
      }
      if(BonoDeConyugue>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JCONYU01|"+Nombre+"|"+BonoDeConyugue+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||BONO DE CONYUGUE|"+BonoDeConyugue+"|C|";
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoDeConyugue+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JCONYU01</td></tr>';
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoDeConyugue+'</td><td>C</td><td>'+TREFERENCE+'</td><td>BONO DE CONYUGUE</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
      }
      if(BonoDeNavidad>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JBONAV01|"+Nombre+"|"+BonoDeNavidad+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||BONO DE NAVIDAD|"+BonoDeNavidad+"|C|";
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoDeNavidad+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JBONAV01</td></tr>';
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+BonoDeNavidad+'</td><td>C</td><td>'+TREFERENCE+'</td><td>BONO DE NAVIDAD</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
      }
      if(SeguroDeSobreviviente>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||SEGURO DE SOBREVIVIENTE|"+SeguroDeSobreviviente+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JSEGVI01|"+Nombre+"|"+SeguroDeSobreviviente+"|C|";
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+SeguroDeSobreviviente+'</td><td>D</td><td>'+TREFERENCE+'</td><td>SEGURO DE SOBREVIVIENTE</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+SeguroDeSobreviviente+'</td><td>C</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JSEGVI01</td></tr>';
      }
      if(DiezmoViejito>0.009)
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||DIEZMO|"+DiezmoViejito+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaEBPViejitos+"||"+tfww+"|10||||"+ER+"|||JDIEZM01|"+Nombre+"|"+DiezmoViejito+"|C|";
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+DiezmoViejito+'</td><td>D</td><td>'+TREFERENCE+'</td><td>DIEZMO</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
        cad3 = cad3 + '<tr><td>'+cuentaEBPViejitos+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+DiezmoViejito+'</td><td>C</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JDIEZM01</td></tr>';
      }
      if(ISR>0.009 )
      {
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||ISR|"+ISR+"|D|";
        cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaISRJubilados+"||"+tfww+"|10||||"+ER+"|||JISRVI01|"+Nombre+"|"+ISR+"|C|";
        cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ISR+'</td><td>D</td><td>'+TREFERENCE+'</td><td>ISR</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
        cad3 = cad3 + '<tr><td>'+cuentaISRJubilados+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ISR+'</td><td>C</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td>JISRVI01</td></tr>';
      }
    









      //  cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||DIEZMO|"+diezmo+"|D|";

        //cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaDiezmoJubilado+"||"+tfww+"|10||||"+ER+"||||"+Nombre+"|"+diezmo+"|C|";
        
        /*cad3 = cad3 + '<tr><td>'+ER+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+diezmo+'</td><td>D</td><td>'+TREFERENCE+'</td><td>DIEZMO</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
        cad3 = cad3 + '<tr><td>'+cuentaDiezmoJubilado+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+diezmo+'</td><td>C</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td></td></tr>';
        if(ISR>=0.009)
        {
          cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ER+"||"+tfww+"|10||||||||ISR|"+ISR+"|D|";
          cadDeCosas=cadDeCosas+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaISRJubilados+"||"+tfww+"|10||||"+ER+"||||"+Nombre+"|"+ISR+"|C|";
           cad3 = cad3 + '<tr><td>'+ER+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+ISR+'</td><td>D</td><td>'+TREFERENCE+'</td><td>ISR</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';
          cad3 = cad3 + '<tr><td>'+cuentaISRJubilados+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+diezmo+'</td><td>C</td><td>'+TREFERENCE+'</td><td>'+Nombre+'</td><td></td><td>'+tfww+'</td><td>10</td><td></td><td></td><td></td><td>'+ER+'</td><td></td><td></td><td></td></tr>';
        }
      
      */
    }
    sumaTodo = Math.round(parseFloat(sumaTodo) * 100) / 100;
    var cad = '';
    var descr = "APORTACION DIA JUBILACION "+PERIOD;
    //cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaAportacionesDeJubilaciones+"|UFTF||10|SUGENER01|3||||||"+descr+"|"+sumaTodo+"|D|"+cadDeCosas;
    if(BUNIT=="MS1")
    {
      //cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaAportacionesDeJubilaciones+"|UFTF|F|10|SUGENER01|3||||||"+descr+"|"+sumaTodo+"|D|"+cadDeCosas;
    }
    cad2 = cad2 + '<tr><td>'+cuentaAportacionesDeJubilaciones+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+sumaTodo+'</td><td>D</td><td>'+TREFERENCE+'</td><td>'+descr+'</td><td>UFTF</td><td></td><td>10</td><td>SUGENER01</td><td>3</td><td></td><td></td><td></td><td></td><td></td></tr>'+cad3;
        cad2 = cad3;//hardcode
        cad = cadDeCosas;
    $("#contabilizarManuntencionTable").html(cad2);
    var cuantasLineas = $('#contabilizarManuntencionTable tr').length;
    var cadNomina =   "||"+cuantasLineas+"|"+BUNIT+"|"+tipoDeDiario+"|"+cad;
    $("#contabilizarManutencionMinistros").attr("cad",cadNomina);
    $("#contabilizarManutencionMinistros").attr("BUNIT",BUNIT);
    return;
  }
  for(i=0;i<cuak.length;i++)
  {
    var tiempo = cuak[i][10];
    if(tiempo>0)//ya lo llenó
    {
      var Renta_Integrada = cuak[i][16];
      var sueldo = cuak[i][12];
      var posgrado = cuak[i][13];
      
      sueldo+=posgrado;
      var sobreSueldo = cuak[i][14];
      var depreciacion = cuak[i][15];
      var afroumn = cuak[i][23];
      if(afroumn<=0)
      {
        cuantasLineasBase-=2;
      }
     
      if(Renta_Integrada>0){}
      else
      {
        cuantasLineasBase-=2;
      }
      if(sueldo<=0)
      {
        cuantasLineasBase-=2;
      }
      if(sobreSueldo<=0)
      {
        cuantasLineasBase-=2;
      }
      if(depreciacion<=0)
      {
        cuantasLineasBase-=2;
      }
      var sdi = 0;
      var imss = 0;
      var cv = 0;
      if(tipoPayroll==1)//asociados
      {
        sdi = cuak[i][42];
        imss = cuak[i][43];
        cv = cuak[i][44];
        if(imss>0)
        {
          cuantasLineasBase+=2;
        }
        if(cv>0)
        {
          cuantasLineasBase+=2;
        }
      }
      cuantasLineas+=cuantasLineasBase;
    }
  }
  var cad = "||"+cuantasLineas+"|"+BUNIT+"|"+tipoDeDiario+"|";
  cad = ''
  var cuentaSueldo = "811180";
  var cuentaSobreSueldo = "811250";
  var cuentaDepreciacion = "811260";
  var cuentaRenta = "811310";
  //deducciones
  var cuentaDiezmo = "612110";
  var cuentaPcentRenta = "788998";
  var cuentaISR = "338ISRRE01";
  var cuentaSubsidio = "175110";
  var cuentaAportacionesDeJubilaciones = '812110';
  if(tipoPayroll==1)//asociados
  {
    cuentaISR = "338ISRAS01";
  }
  var cuentaCuotaIMSS = "338CUOTA01";
  var cuentaCV = "338CESAN01";

  var cuentaIncapacidad = "338INCAP01";
  var cuentaAFROUMN = "368AFROU01";

  arrayCads = new Array();
  arrayER = new Array();
  arrayCuantasPercepciones = new Array();
  arrayCuantasDeducciones = new Array();
  arrayCuantasOtrosPagos = new Array();
  //Asociados
 // ||3.3|N|172|2017-12-28T12:03:30|99|00001000000406720491|27328.00|MXN|27328.00|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|601|RURA700928NE8|ALEJANDRO RUEDA DE LEON ROMERO|P01|84111505|1|ACT|Pago de nómina|27328.00|27328.00|1.2|E|2017-12-14|2017-12-01|2017-12-31|30|27328.00|D4918553105|RURA700928HCSDML02|23007010137|2016-01-01|P101W|01|01|02|8|ASOCIADOS RELIGIOSOS|Ninguno|1|99|002|90103051842|696.80|NLE|27328.00|6832|20496|002|049|AGUINALDO|0.00|13664|021|050|PRIMA VACACIONAL|6832|6832||

//ministros
//  ||3.3|N|632|2017-12-19T14:02:17|99|00001000000305906415|12570.89|408.00|MXN|12162.89|N|PUE|64810|IAS930629HZ1|IGLESIA ADVENTISTA DEL SEPTIMO DIA SECCION NORESTE|603|MERJ481015V24|Medina Rodriguez Jesus|P01|84111505|1|ACT|Pago de nómina|12570.89|12570.89|408.00|1.2|O|2017-04-25|2017-04-01|2017-04-30|29|12570.89|408.00|0.00|MERJ481015HTSDDS10|09|01|09|076|MINISTROS DE CULTO|Ninguno|05|014|56667741820|NLE|12570.89|5686.83|6884.06|046|014|MANUTENCION|5686.83|6884.06|0|408|002|010|ISR ASOCIADOS|408||
  //MINISTROS !! perdon por tanto hardcodear, quien quiera que leas esto..ç
  var cadN = '';
  var certificado = dameNoCertificadoSegunRFC(rfcEmisor);
  for(i=0;i<cuak.length;i++)
  {
    var tiempo = cuak[i][10];
    if(tiempo>0)//ya lo llenó
    {
      var ER = cuak[i][0].trim();
      var nombre = cuak[i][1].trim();
      var Departamento = cuak[i][3].trim();
      var rfc = cuak[i][37].trim();
      var curp = cuak[i][38].trim();
      var ne = parseInt(cuak[i][39].trim());
      if(ne<10)
      {
        ne="00"+ne;
      }
      else
      {
        if(ne<100)
        {
          ne="0"+ne;
        }
      }

      var banco = parseInt(cuak[i][40].trim());
      if(banco<10)
      {
        banco="00"+banco;
      }
      else
      {
        if(banco<100)
        {
          banco="0"+banco;
        }
      }
      var cuentaBancaria = cuak[i][41].trim();
      var estado = cuak[i][42].trim();
      var exento = cuak[i][32];
      var gravado = cuak[i][33];
      gravado = Math.round(parseFloat(gravado) * 100) / 100;
      exento = Math.round(parseFloat(exento) * 100) / 100;
           
      var guardaExento = exento;
      var guardaGravado = gravado;
      var sueldo = cuak[i][12];
      var posgrado = cuak[i][13];
      
      sueldo+=posgrado;
      var sobreSueldo = cuak[i][14];
      sobreSueldo = Math.round(sobreSueldo * 100) / 100;

      var depreciacion = cuak[i][15];
      var Renta_Integrada = cuak[i][16];
//ministros
    var ViajesRegular = cuak[i][43];
      var ViajesEspecial = cuak[i][44];
      var ViajesEsposa = cuak[i][45];

if(tipoPayroll==1)//asociados
{
     ViajesRegular = cuak[i][52];
       ViajesEspecial = cuak[i][53];
       ViajesEsposa = cuak[i][54];

}
  

      var renta = cuak[i][28];
      var ANAL_T3 = cuak[i][36];
      var ANAL_T4 = "3";
      var ANAL_T6 = cuak[i][0];
      //deducciones
      var diezmo = 0;
      if(!isNaN(cuak[i][18]))
      {
        diezmo+=cuak[i][18];
      }
      if(!isNaN(cuak[i][19]))
      {
        diezmo+=cuak[i][19];
      }
      if(!isNaN(cuak[i][20]))
      {
        diezmo+=cuak[i][20];
      }
      diezmo = Math.round(diezmo * 100) / 100;
      
      var rentaPcent = cuak[i][21];
      var isr = cuak[i][35];
      isr = Math.round(isr * 100) / 100;
      if (!(isr%1)) { 
        isr = isr + ".00";
      }
      isr = ""+ isr;
      var auxA = isr.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          isr = isr + "0";
        }
      }
      var incapacidad = cuak[i][22];
      var afroumn = cuak[i][23];
      cadN = '';
      var descuentosTotales = parseFloat(isr);
      //var anticipos = rentaPcent + afroumn + incapacidad;//para descuentos... sure?
      var param = { ER : ER, PERIOD : PERIOD};
      var cuantasPercepciones = 1;
      var cuantasDeducciones = 0;
      if(parseFloat(isr)>0.00)
      {
        cuantasDeducciones++;
      }
      var cuantasOtrosPagos = 0;
      var cadAdicionalDeducciones = '';
      var cadAdicionalPercepciones = '';
      var cadAdicionalOtrosPagos = '';
      var totalOtrasDeducciones = 0;
    //  var sumaleAlGravado = 0;
      var totalOtrosPagos = 0;
      $.ajax({
        url: "/dameDescuentosDelER",//y creditos tambien :)
        dataType : "json",
        type : "post",
        async : false,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var delPeriodoER = parseInt($("#delPeriodo").val());



 
            var aver2 = Object.keys(resp.anticipo);
            if(aver2.length>0)
            {
              resp.anticipo["0"].Cantidad = Math.round(parseFloat(resp.anticipo["0"].Cantidad) * 100) / 100;
              if(resp.anticipo["0"].Cantidad>0.00)
              {
                  cuantasDeducciones++;
              console.log(Departamento);
                if(Departamento=="MINISTRO" && delPeriodoER <= 2019003) {
                    cadAdicionalDeducciones=cadAdicionalDeducciones+'004|005|OTROS|'+resp.anticipo["0"].Cantidad+'|';
                    totalOtrasDeducciones+=parseFloat(resp.anticipo["0"].Cantidad);
                } else {
                  cadAdicionalDeducciones=cadAdicionalDeducciones+'012|030|ANTICIPO|'+resp.anticipo["0"].Cantidad+'|';
                  totalOtrasDeducciones+=parseFloat(resp.anticipo["0"].Cantidad);    
                }
                
              }
            }
            aver2 = Object.keys(resp.infonavit);
            if(aver2.length>0)
            {
              cuantasDeducciones++;
              resp.infonavit["0"].Cantidad = Math.round(parseFloat(resp.infonavit["0"].Cantidad) * 100) / 100;
              cadAdicionalDeducciones=cadAdicionalDeducciones+'009|445|INFONAVIT|'+resp.infonavit["0"].Cantidad+'|';
              totalOtrasDeducciones+=parseFloat(resp.infonavit["0"].Cantidad);
            }
            aver2 = Object.keys(resp.otros);
            if(aver2.length>0)
            {
              cuantasDeducciones++;
              resp.otros["0"].Cantidad = Math.round(parseFloat(resp.otros["0"].Cantidad) * 100) / 100;
              
              cadAdicionalDeducciones=cadAdicionalDeducciones+'004|005|OTROS|'+resp.otros["0"].Cantidad+'|';
              totalOtrasDeducciones+=parseFloat(resp.otros["0"].Cantidad);
            }
            aver2 = Object.keys(resp.percepcionesDepre);
            if(aver2.length>0)
            {
              if(aver2.indexOf("0")!=-1)
              {
                cuantasOtrosPagos++;
                resp.percepcionesDepre["0"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["0"].Cantidad) * 100) / 100;
                
                cadAdicionalOtrosPagos=cadAdicionalOtrosPagos+'999|888|OTROS|'+resp.percepcionesDepre["0"].Cantidad+'|';
                totalOtrosPagos+=parseFloat(resp.percepcionesDepre["0"].Cantidad);
              }
              if(aver2.indexOf("1")!=-1)
              {
                cuantasPercepciones++;
                resp.percepcionesDepre["1"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["1"].Cantidad) * 100) / 100;
                var subtotalPrima = resp.percepcionesDepre["1"].Cantidad;
                var limiteExentoPrima = 1267.35;
                var exentoPrima = 0.00;
                var gravadoPrima = 0.00;
                if(subtotalPrima<=limiteExentoPrima)
                {
                  exentoPrima=subtotalPrima;
                } else {
                  exentoPrima = limiteExentoPrima;
                  gravadoPrima =subtotalPrima-exentoPrima;
                  gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                }
                exentoPrima = Math.round(parseFloat(exentoPrima) * 100) / 100;
                gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                cadAdicionalPercepciones=cadAdicionalPercepciones+'021|121|PRIMA|'+gravadoPrima+'|'+exentoPrima+'|';
                exentoPrima = Math.round(parseFloat(exentoPrima) * 100) / 100;
                gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                
                gravado=gravado+gravadoPrima;
                exento=exento+exentoPrima;
                if(isr==0 &&gravadoPrima>0.00){
                  cuantasDeducciones++;
                  }
console.log("isr antes: "+isr);
console.log("gravadoPrima: "+gravadoPrima);
console.log("gravado: "+gravado);
  //departamento?
  if(Departamento=="ASOCIADO"){
                isr = dameISRDeGravado(gravado);
              } else {
                            isr = dameISRDeGravado(gravado) - dameSubsidio(gravado);
              }
    

                console.log("isr despues: "+isr);
                isr = Math.round(isr * 100) / 100;
                if(isr>0) {
                  descuentosTotales = parseFloat(isr);  
                }
                
                if (!(isr%1)) { 
                  isr = isr + ".00";
                }
                isr = ""+ isr;
                var auxA = isr.split(".");
                if(auxA.length==2) {
                  var v = auxA[1].length;
                  if(v==1) {
                    isr = isr + "0";
                  }
                }

                //hot.setCellMeta(0, 0, 'renderer', firstRenderer);
                //hot.render();


 

              

              }
              if(aver2.indexOf("2")!=-1)
              {
                cuantasPercepciones++;
                resp.percepcionesDepre["2"].Cantidad = Math.round(parseFloat(resp.percepcionesDepre["2"].Cantidad) * 100) / 100;
                var subtotalPrima = resp.percepcionesDepre["2"].Cantidad;
                var limiteExentoPrima = 2534.70;
                var exentoPrima = 0.00;
                var gravadoPrima = 0.00;
                if(subtotalPrima<=limiteExentoPrima)
                {
                  exentoPrima=subtotalPrima;
                } else {
                  exentoPrima = limiteExentoPrima;
                  gravadoPrima =subtotalPrima-exentoPrima;
                  gravadoPrima = Math.round(parseFloat(gravadoPrima) * 100) / 100;
                }
                cadAdicionalPercepciones=cadAdicionalPercepciones+'002|102|AGUINALDO|'+gravadoPrima+'|'+exentoPrima+'|';
                gravado+=gravadoPrima;
                exento+=exentoPrima;
                if(isr==0 &&gravadoPrima>0.00){
                  cuantasDeducciones++;
                  }

                if(Departamento=="ASOCIADO"){
                isr = dameISRDeGravado(gravado);
              } else {
                            isr = dameISRDeGravado(gravado) - dameSubsidio(gravado);
              }
  
                isr = Math.round(isr * 100) / 100;
                if(isr>0) {
                  descuentosTotales = parseFloat(isr);  
                }
                
                
                if (!(isr%1)) { 
                  isr = isr + ".00";
                }
                isr = ""+ isr;
                var auxA = isr.split(".");
                if(auxA.length==2) {
                  var v = auxA[1].length;
                  if(v==1) {
                    isr = isr + "0";
                  }
                }

              }
              
              
              
            }
          }
        }
      });
      var sdi = 0;
      var imss = 0;
      var cv = 0;
      var subsidioCausado = 0;
      var subsidioEfectivo = 0;
      if(tipoPayroll==1)//asociados
      {
        sdi = cuak[i][43];
        imss = cuak[i][44];
        cv = cuak[i][45];
        var FechaInicioRelLaboral = cuak[i][46];
        var NumSeguridadSocial = cuak[i][47];
        if(NumSeguridadSocial.length==10)
        {
          NumSeguridadSocial="0"+NumSeguridadSocial;
        }
        subsidioCausado = cuak[i][48];
        subsidioCausado = Math.round(parseFloat(subsidioCausado) * 100) / 100;
        subsidioEfectivo = cuak[i][49];
        subsidioEfectivo = Math.round(parseFloat(subsidioEfectivo) * 100) / 100;
        if(subsidioEfectivo>0.00)
        {
          cuantasOtrosPagos++;
          cadAdicionalOtrosPagos=cadAdicionalOtrosPagos+'002|002|SUBSIDIO|'+subsidioEfectivo+'|'+subsidioCausado+'|';
          totalOtrosPagos+=subsidioEfectivo;
        } else {
           if(subsidioCausado>0.00)
          {
            cuantasOtrosPagos++;
            cadAdicionalOtrosPagos=cadAdicionalOtrosPagos+'002|002|SUBSIDIO|0.01|'+subsidioCausado+'|';
            totalOtrosPagos+=0.01;
          }
        }
        /*
        si isr es 0, no ponerlo, ni aqui ni en la contabilizacion
        si subsidio entregado es mas de 0, ponerlo en el cad de otros pagos, junto con su cadCount++ y el subsidio causado para el timbrado
        var FechaInicioRelLaboral = '01/06/2017';
        var TRANS_DATETIME = '2018-01-25';
        */
        var FechaInicioRelLaboralParaCalculo = FechaInicioRelLaboral.substring(3,5)+"/"+FechaInicioRelLaboral.substring(0,2)+"/"+FechaInicioRelLaboral.substring(6,10);
       
        var date1 = new Date(FechaInicioRelLaboralParaCalculo);
        var date2 = new Date(TRANS_DATETIME);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var semanas =  Math.trunc(diffDays/7);
        var antiguedad = "P"+semanas+"W";
        if(imss>0)
        {
          cuantasDeducciones++;
          imss = Math.round(parseFloat(imss) * 100) / 100;
              
          cadAdicionalDeducciones=cadAdicionalDeducciones+'001|001|IMSS|'+imss+'|';
          totalOtrasDeducciones+=parseFloat(imss);
        }
        if(cv>0)
        {
          cuantasDeducciones++;
          cv = Math.round(parseFloat(cv) * 100) / 100;
          cadAdicionalDeducciones=cadAdicionalDeducciones+'003|003|RCV|'+cv+'|';
          totalOtrasDeducciones+=parseFloat(cv);
        }
      }
      totalOtrosPagos = Math.round(totalOtrosPagos * 100) / 100;
      totalOtrasDeducciones = Math.round(totalOtrasDeducciones * 100) / 100;
      //gravado+=sumaleAlGravado;
      descuentosTotales+=totalOtrasDeducciones;
      descuentosTotales = Math.round(descuentosTotales * 100) / 100;
      gravado = Math.round(gravado * 100) / 100;


      guardaGravado = Math.round(guardaGravado * 100) / 100;
      guardaExento = Math.round(guardaExento * 100) / 100;

      exento = Math.round(exento * 100) / 100;
      gravado = Math.round(gravado * 100) / 100;

      var percepciones = gravado + exento;
      var percepcionesMasOtrosPagos = percepciones + totalOtrosPagos;
      percepciones = Math.round(percepciones * 100) / 100;
      percepcionesMasOtrosPagos = Math.round(percepcionesMasOtrosPagos * 100) / 100;
      
//var anioF = FechaInicioRelLaboral.substring(6,10)
      var subtotalN = percepcionesMasOtrosPagos;// - descuentosTotales;
      subtotalN = Math.round(subtotalN * 100) / 100;

      var totalRecibo = subtotalN - descuentosTotales;
      totalRecibo = Math.round(totalRecibo * 100) / 100;

      if (!(percepcionesMasOtrosPagos%1)) { 
        percepcionesMasOtrosPagos = percepcionesMasOtrosPagos + ".00";
      }
      percepcionesMasOtrosPagos = ""+ percepcionesMasOtrosPagos;
      var auxA = percepcionesMasOtrosPagos.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          percepcionesMasOtrosPagos = percepcionesMasOtrosPagos + "0";
        }
      }

      if (!(totalOtrosPagos%1)) { 
        totalOtrosPagos = totalOtrosPagos + ".00";
      }
      totalOtrosPagos = ""+ totalOtrosPagos;
      var auxA = totalOtrosPagos.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalOtrosPagos = totalOtrosPagos + "0";
        }
      }



      if (!(totalOtrasDeducciones%1)) { 
        totalOtrasDeducciones = totalOtrasDeducciones + ".00";
      }
      totalOtrasDeducciones = ""+ totalOtrasDeducciones;
      var auxA = totalOtrasDeducciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalOtrasDeducciones = totalOtrasDeducciones + "0";
        }
      }


      if (!(descuentosTotales%1)) { 
        descuentosTotales = descuentosTotales + ".00";
      }
      descuentosTotales = ""+ descuentosTotales;
      var auxA = descuentosTotales.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          descuentosTotales = descuentosTotales + "0";
        }
      }

if (!(guardaExento%1)) { 
        guardaExento = guardaExento + ".00";
      }
      guardaExento = ""+ guardaExento;
      var auxA = guardaExento.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          guardaExento = guardaExento + "0";
        }
      }



      if (!(exento%1)) { 
        exento = exento + ".00";
      }
      exento = ""+ exento;
      var auxA = exento.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          exento = exento + "0";
        }
      }

      if (!(gravado%1)) { 
        gravado = gravado + ".00";
      }
      gravado = ""+ gravado;
      var auxA = gravado.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          gravado = gravado + "0";
        }
      }

      if (!(guardaGravado%1)) { 
        guardaGravado = guardaGravado + ".00";
      }
      guardaGravado = ""+ guardaGravado;
      var auxA = guardaGravado.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          guardaGravado = guardaGravado + "0";
        }
      }


      if (!(totalRecibo%1)) { 
        totalRecibo = totalRecibo + ".00";
      }
      totalRecibo = ""+ totalRecibo;
      var auxA = totalRecibo.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          totalRecibo = totalRecibo + "0";
        }
      }

      if (!(subtotalN%1)) { 
        subtotalN = subtotalN + ".00";
      }
      subtotalN = ""+ subtotalN;
      var auxA = subtotalN.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          subtotalN = subtotalN + "0";
        }
      }


      
      if (!(percepciones%1)) { 
        percepciones = percepciones + ".00";
      }
      percepciones = ""+ percepciones;
      var auxA = percepciones.split(".");
      if(auxA.length==2) {
        var v = auxA[1].length;
        if(v==1) {
          percepciones = percepciones + "0";
        }
      }

     
      //09 es el tipo de contrato, no existe relacion de trabajo
      //01 tipo de jornada, diurna
      //09 es el tipo de regimen, Asimilados a honorarios
      //05 es periodicidad de pago, Mensual
      //014 es el banco
      //046 ingreso asimilado a salarios
      //002 ISR
      var noPongasBanco = false;
      if(cuentaBancaria.length==18)
      {
        noPongasBanco = true;
      }
      //if cuantas deducciones es igual a 0, no poner descuentos!!!
      if(tipoPayroll==1)//asociados
      {
        var anioF = FechaInicioRelLaboral.substring(6,10);
        var mesF = FechaInicioRelLaboral.substring(3,5);
        var diaF = FechaInicioRelLaboral.substring(0,2);
        cadN = '||3.3|N|'+folioQueSigue+'|'+dateISO+'|99|'+certificado+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }
        cadN=cadN+'MXN|'+totalRecibo+'|N|PUE|'+lugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|603|'+rfc+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+subtotalN+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }
        cadN=cadN+'1.2|O|'+TRANS_DATETIME+'|'+fechaInicio+'|'+fechaFinal+'|'+diffDaysParaTimbreDiasPagados+'|'+percepciones+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|'+totalOtrosPagos+'|';
        }
        cadN=cadN+''+regPatronal+'|'+curp+'|'+NumSeguridadSocial+'|'+anioF+'-'+mesF+'-'+diaF+'|'+antiguedad+'|01|01|02|'+ne+'|ASOCIADOS RELIGIOSOS|Ninguno|1|05|';
        if(noPongasBanco){}
        else
        {
          cadN = cadN + banco+'|';
        }
        cadN = cadN + cuentaBancaria+'|'+sdi+'|'+estado+'|'+percepciones+'|'+gravado+'|'+exento+'|038|015|MANUTENCION|'+guardaGravado+'|'+guardaExento+'|'+cadAdicionalPercepciones;
        if(parseFloat(totalOtrasDeducciones)>0.00)
        {
          cadN=cadN+totalOtrasDeducciones+'|';
        }
        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+isr+'|';
        }
        cadN=cadN+cadAdicionalDeducciones;
        console.log("cadAdicionalDeducciones");
        console.log(cadAdicionalDeducciones);
        console.log("cuantasDeducciones");
        console.log(cuantasDeducciones);

        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+'002|010|ISR|'+isr+'|';
        }
        cadN=cadN+cadAdicionalOtrosPagos+'|';
        /*
        si isr es 0, no ponerlo, ni aqui ni en la contabilizacion
        si subsidio entregado es mas de 0, ponerlo en el cad de otros pagos, junto con su cadCount++ y el subsidio causado para el timbrado
        */
      }
      if(tipoPayroll==2)//ministros
      {
        cadN = '||3.3|N|'+folioQueSigue+'|'+dateISO+'|99|'+certificado+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }
        cadN=cadN+'MXN|'+totalRecibo+'|N|PUE|'+lugarExpedicion+'|'+rfcEmisor+'|'+razonSocial+'|603|'+rfc+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+subtotalN+'|'+subtotalN+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|';
        }

        cadN=cadN+'1.2|O|'+TRANS_DATETIME+'|'+fechaInicio+'|'+fechaFinal+'|'+diffDaysParaTimbreDiasPagados+'|'+percepciones+'|';
        if(cuantasDeducciones>0)
        {
          cadN=cadN+descuentosTotales  +'|'+totalOtrosPagos  +'|';
        }else{
        if(cuantasOtrosPagos>0)
        {
          cadN=cadN+totalOtrosPagos  +'|';
        }
  
        }
        

        cadN=cadN+curp+'|09|99|11|'+ne+'|MINISTROS DE CULTO|Ninguno|05|';
        if(noPongasBanco){}
        else
        {
          cadN = cadN + banco+'|';
        }
        cadN = cadN + cuentaBancaria+'|'+estado+'|'+percepciones+'|'+gravado+'|'+exento+'|046|014|MANUTENCION|'+guardaGravado+'|'+guardaExento+'|'+cadAdicionalPercepciones;
        if(parseFloat(totalOtrasDeducciones)>0.00)
        {
          cadN=cadN+totalOtrasDeducciones+'|';
        }
        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+isr+'|';
        }
        cadN=cadN+cadAdicionalDeducciones;
        if(parseFloat(isr)>0.00)
        {
          cadN=cadN+'002|010|ISR|'+isr+'|';
        }
        cadN=cadN+cadAdicionalOtrosPagos+'|';
        
      }
      
      
       
    
      arrayCuantasPercepciones.push(cuantasPercepciones);
      arrayCuantasDeducciones.push(cuantasDeducciones);
      arrayCuantasOtrosPagos.push(cuantasOtrosPagos);

       //Asociados
 // ||3.3|N|172|2017-12-28T12:03:30|99|00001000000406720491|27328.00|MXN|27328.00|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|601|RURA700928NE8|ALEJANDRO RUEDA DE LEON ROMERO|P01|84111505|1|ACT|Pago de nómina|27328.00|27328.00|1.2|E|2017-12-14|2017-12-01|2017-12-31|30|27328.00|D4918553105|RURA700928HCSDML02|23007010137|2016-01-01|P101W|01|01|02|8|ASOCIADOS RELIGIOSOS|Ninguno|1|99|002|90103051842|696.80|NLE|27328.00|6832|20496|002|049|AGUINALDO|0.00|13664|021|050|PRIMA VACACIONAL|6832|6832||

      folioQueSigue++;
      arrayCads.push(cadN);
      arrayER.push(ER);
      //aqui termina!!! }
     // if(BUNIT=="M11"){
        ANAL_T4 = "32A";
      //}
     var ANAL_T4_32B = '32B';
     var ANAL_T4_31D = '31D';
      //apreciaciones
      if(sueldo>0)
      {
         if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSueldo+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||*|"+nombre+"|"+sueldo+"|D|";
         
         }else{
         cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSueldo+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"||||"+nombre+"|"+sueldo+"|D|";
          
         }
        cad2 = cad2 + '<tr><td>'+cuentaSueldo+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+sueldo+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|MANUTENCION|"+sueldo+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||MANUTENCION|"+sueldo+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+sueldo+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>MANUTENCION</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      if(sobreSueldo>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSobreSueldo+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||*|"+nombre+"|"+sobreSueldo+"|D|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSobreSueldo+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"||||"+nombre+"|"+sobreSueldo+"|D|";
      }
        cad2 = cad2 + '<tr><td>'+cuentaSobreSueldo+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+sobreSueldo+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|MINISTERIAL|"+sobreSueldo+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||MINISTERIAL|"+sobreSueldo+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+sobreSueldo+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>MINISTERIAL</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      if(depreciacion>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaDepreciacion+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||*|"+nombre+"|"+depreciacion+"|D|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaDepreciacion+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"||||"+nombre+"|"+depreciacion+"|D|";
      }
        cad2 = cad2 + '<tr><td>'+cuentaDepreciacion+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+depreciacion+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|PARTICIPACIÓN DE PÚLPITO|"+depreciacion+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||PARTICIPACIÓN DE PÚLPITO|"+depreciacion+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+depreciacion+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>PARTICIPACIÓN DE PÚLPITO</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      var cuentaViajesRegulares = '822110';
      var cuentaViajesEspecial = '824110';
      var cuentaViajesEsposa = '811420';
      if(ViajesRegular>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesRegulares+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"|||*|"+nombre+"|"+ViajesRegular+"|D|";
          } else {
            if(BUNIT=="MN1")
            {
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesRegulares+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"|||DSICFD01|"+nombre+"|"+ViajesRegular+"|D|";
            }
            else{
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesRegulares+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"||||"+nombre+"|"+ViajesRegular+"|D|";  
              }
        
          }
        cad2 = cad2 + '<tr><td>'+cuentaViajesRegulares+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesRegular+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4_32B+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|VIAJES REGULAR|"+ViajesRegular+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||VIAJES REGULAR|"+ViajesRegular+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesRegular+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>VIAJES REGULAR</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      if(ViajesEspecial>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEspecial+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"|||*|"+nombre+"|"+ViajesEspecial+"|D|";
          } else {
            if(BUNIT=="MN1")
            {
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEspecial+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"|||DSICFD01|"+nombre+"|"+ViajesEspecial+"|D|";
            }
            else{
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEspecial+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4_32B+"||"+ANAL_T6+"||||"+nombre+"|"+ViajesEspecial+"|D|";  
              }
        
          }
        cad2 = cad2 + '<tr><td>'+cuentaViajesEspecial+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesEspecial+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4_32B+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|VIAJES ESPECIAL|"+ViajesEspecial+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||VIAJES ESPECIAL|"+ViajesEspecial+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesEspecial+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>VIAJES ESPECIAL</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      var proyectoMes = "PENE";
      if(mes=="02")
      {
        proyectoMes = "PFEB";
      }
      if(mes=="03")
      {
        proyectoMes = "PMAR";
      }
      if(mes=="04")
      {
        proyectoMes = "PABR";
      }
      if(mes=="05")
      {
        proyectoMes = "PMAY";
      }
      if(mes=="06")
      {
        proyectoMes = "PJUN";
      }
      if(mes=="07")
      {
        proyectoMes = "PJUL";
      }
      if(mes=="08")
      {
        proyectoMes = "PAGO";
      }
      if(mes=="09")
      {
        proyectoMes = "PSEP";
      }
      if(mes=="10")
      {
        proyectoMes = "POCT";
      }
      if(mes=="11")
      {
        proyectoMes = "PNOV";
      }
      if(mes=="12")
      {
        proyectoMes = "PDIC";
      }
      if(ViajesEsposa>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEsposa+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||*|"+nombre+"|"+ViajesEsposa+"|D|";
          } else {
            if(BUNIT=="MN1")
            {
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEsposa+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||DSICFD01|"+nombre+"|"+ViajesEsposa+"|D|";
            }
            else{
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaViajesEsposa+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"||VESPOS01|"+proyectoMes+"|"+nombre+"|"+ViajesEsposa+"|D|";  
              }
        
          }
        cad2 = cad2 + '<tr><td>'+cuentaViajesEsposa+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesEsposa+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td>VESPOS01</td>\
        <td>'+proyectoMes+'</td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|VIAJES ESPOSA|"+ViajesEsposa+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||VIAJES ESPOSA|"+ViajesEsposa+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+ViajesEsposa+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>VIAJE AYUDA ESPOSA</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      
      
      
      
      
       
      if(Renta_Integrada>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaRenta+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||*|"+nombre+"|"+Renta_Integrada+"|D|";
          } else {
            if(BUNIT=="MN1")
            {
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaRenta+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"|||DSICFD01|"+nombre+"|"+Renta_Integrada+"|D|";
            }
            else{
              cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaRenta+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4+"||"+ANAL_T6+"||||"+nombre+"|"+Renta_Integrada+"|D|";  
              }
        
          }
        cad2 = cad2 + '<tr><td>'+cuentaRenta+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+Renta_Integrada+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFTF</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>'+ANAL_T4+'</td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|CASA DE GOBIERNO|"+Renta_Integrada+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||CASA DE GOBIERNO|"+Renta_Integrada+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+Renta_Integrada+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>CASA DE GOBIERNO</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      if(subsidioEfectivo>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSubsidio+"||NF|10||||"+ANAL_T6+"|||*|"+nombre+"|"+subsidioEfectivo+"|D|";
        } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSubsidio+"|||10||||"+ANAL_T6+"||||"+nombre+"|"+subsidioEfectivo+"|D|";
       }
        cad2 = cad2 + '<tr><td>'+cuentaSubsidio+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+subsidioEfectivo+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|SUBSIDIO|"+subsidioEfectivo+"|C|";
          } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||SUBSIDIO|"+subsidioEfectivo+"|C|";
         }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+subsidioEfectivo+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>SUBSIDIO</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      } else {
        
       /* if(subsidioCausado>0.00){
          if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSubsidio+"||NF|10||||"+ANAL_T6+"|||*|"+nombre+"|"+subsidioCausado+"|D|";
        } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaSubsidio+"|||10||||"+ANAL_T6+"||||"+nombre+"|"+subsidioCausado+"|D|";
       }
        cad2 = cad2 + '<tr><td>'+cuentaSubsidio+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+subsidioCausado+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|SUBSIDIO|"+subsidioCausado+"|C|";
          } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||SUBSIDIO|"+subsidioCausado+"|C|";
         }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+subsidioCausado+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>SUBSIDIO</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
        }
        */
      }
      //DEDUCCIONES

if(diezmo>0)
      {
      
      if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|DIEZMO|"+diezmo+"|D|";
    } else {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||DIEZMO|"+diezmo+"|D|";
    }
      cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
      <td>'+PERIOD+'</td>\
      <td>'+TRANS_DATETIME+'</td>\
      <td>'+diezmo+'</td>\
      <td>D</td>\
      <td>'+TREFERENCE+'</td>\
      <td>DIEZMO</td>\
      <td></td>\
      <td></td>\
      <td>10</td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      </tr>';
      var orgIdTemp = "AG"+BUNIT+"1";
      //if(BUNIT=="M11"){}
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaDiezmo+"|UFTF|NF|10|"+ANAL_T3+"|"+ANAL_T4_31D+"|"+orgIdTemp+"|"+ANAL_T6+"|||*|"+nombre+"|"+diezmo+"|C|";
    } else {
cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaDiezmo+"|UFTF||10|"+ANAL_T3+"|"+ANAL_T4_31D+"|"+orgIdTemp+"|"+ANAL_T6+"||||"+nombre+"|"+diezmo+"|C|";
    }
      cad2 = cad2 + '<tr><td>'+cuentaDiezmo+'</td>\
      <td>'+PERIOD+'</td>\
      <td>'+TRANS_DATETIME+'</td>\
      <td>'+diezmo+'</td>\
      <td>C</td>\
      <td>'+TREFERENCE+'</td>\
      <td>'+nombre+'</td>\
      <td>UFTF</td>\
      <td></td>\
      <td>10</td>\
      <td>'+ANAL_T3+'</td>\
      <td>'+ANAL_T4_31D+'</td>\
      <td>'+orgIdTemp+'</td>\
      <td>'+ANAL_T6+'</td>\
      <td></td>\
      <td></td>\
      <td></td>\
      </tr>'; 
}
      if(rentaPcent>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|PCENT RENTA|"+rentaPcent+"|D|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||PCENT RENTA|"+rentaPcent+"|D|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+rentaPcent+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>PCENT RENTA</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaPcentRenta+"|UFNT|NF|10|"+ANAL_T3+"|0|*|"+ANAL_T6+"|||*|"+nombre+"|"+rentaPcent+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaPcentRenta+"|UFNT||10|"+ANAL_T3+"|0|*|"+ANAL_T6+"||||"+nombre+"|"+rentaPcent+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+cuentaPcentRenta+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+rentaPcent+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td>UFNT</td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td>0</td>\
        <td>*</td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
      }
      
      if(parseFloat(isr)>0)
      {
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|IMPUESTO SOBRE LA RENTA|"+isr+"|D|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||IMPUESTO SOBRE LA RENTA|"+isr+"|D|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+isr+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>IMPUESTO SOBRE LA RENTA</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaISR+"||NF|10|"+ANAL_T3+"|||"+ANAL_T6+"|||*|"+nombre+"|"+isr+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaISR+"|||10|"+ANAL_T3+"|||"+ANAL_T6+"||||"+nombre+"|"+isr+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+cuentaISR+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+isr+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td></td>\
        <td></td>\
        <td>'+ANAL_T6+'</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
  
      }
      if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|INCAPACIDAD|"+incapacidad+"|D|";
    } else {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||INCAPACIDAD|"+incapacidad+"|D|";
    }
      cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
      <td>'+PERIOD+'</td>\
      <td>'+TRANS_DATETIME+'</td>\
      <td>'+incapacidad+'</td>\
      <td>D</td>\
      <td>'+TREFERENCE+'</td>\
      <td>INCAPACIDAD</td>\
      <td></td>\
      <td></td>\
      <td>10</td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      <td></td>\
      </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaIncapacidad+"||NF|10|"+ANAL_T3+"|||"+ANAL_T6+"|||*|"+nombre+"|"+incapacidad+"|C|";
    } else {
      cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaIncapacidad+"|||10|"+ANAL_T3+"|||"+ANAL_T6+"||||"+nombre+"|"+incapacidad+"|C|";
    }
      cad2 = cad2 + '<tr><td>'+cuentaIncapacidad+'</td>\
      <td>'+PERIOD+'</td>\
      <td>'+TRANS_DATETIME+'</td>\
      <td>'+incapacidad+'</td>\
      <td>C</td>\
      <td>'+TREFERENCE+'</td>\
      <td>'+nombre+'</td>\
      <td></td>\
      <td></td>\
      <td>10</td>\
      <td>'+ANAL_T3+'</td>\
      <td></td>\
      <td></td>\
      <td>'+ANAL_T6+'</td>\
      <td></td>\
      <td></td>\
      <td></td>\
      </tr>';

      if(afroumn>0)
      {
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|FOBONO|"+afroumn+"|D|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||FOBONO|"+afroumn+"|D|";
      }
        cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+afroumn+'</td>\
        <td>D</td>\
        <td>'+TREFERENCE+'</td>\
        <td>FOBONO</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        <td></td>\
        </tr>';
        if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaAFROUMN+"||NF|10|"+ANAL_T3+"||*|"+ANAL_T6+"|IN|*|*|"+nombre+"|"+afroumn+"|C|";
      } else {
        cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaAFROUMN+"|||10|"+ANAL_T3+"||*|"+ANAL_T6+"|IN|*||"+nombre+"|"+afroumn+"|C|";
      }
        cad2 = cad2 + '<tr><td>'+cuentaAFROUMN+'</td>\
        <td>'+PERIOD+'</td>\
        <td>'+TRANS_DATETIME+'</td>\
        <td>'+afroumn+'</td>\
        <td>C</td>\
        <td>'+TREFERENCE+'</td>\
        <td>'+nombre+'</td>\
        <td></td>\
        <td></td>\
        <td>10</td>\
        <td>'+ANAL_T3+'</td>\
        <td></td>\
        <td>*</td>\
        <td>'+ANAL_T6+'</td>\
        <td>IN</td>\
        <td>*</td>\
        <td></td>\
        </tr>';
      }
      if(tipoPayroll==1)//asociados
      {
        if(imss>0)
        {
          if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|CUOTA IMSS|"+imss+"|D|";
        } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||CUOTA IMSS|"+imss+"|D|";
        }
          cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+imss+'</td>\
          <td>D</td>\
          <td>'+TREFERENCE+'</td>\
          <td>CUOTA IMSS</td>\
          <td></td>\
          <td></td>\
          <td>10</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaCuotaIMSS+"||NF|10||||"+ANAL_T6+"|||*|"+nombre+"|"+imss+"|C|";
        } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaCuotaIMSS+"|||10||||"+ANAL_T6+"||||"+nombre+"|"+imss+"|C|";
        }
          cad2 = cad2 + '<tr><td>'+cuentaCuotaIMSS+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+imss+'</td>\
          <td>C</td>\
          <td>'+TREFERENCE+'</td>\
          <td>'+nombre+'</td>\
          <td></td>\
          <td></td>\
          <td>10</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td>'+ANAL_T6+'</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          </tr>';
        }
        if(cv>0)
        {
          if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"||NF|10|||||||*|RCV|"+cv+"|D|";
        } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+ANAL_T6+"|||10||||||||RCV|"+cv+"|D|";
        }
          cad2 = cad2 + '<tr><td>'+ANAL_T6+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+cv+'</td>\
          <td>D</td>\
          <td>'+TREFERENCE+'</td>\
          <td>RCV</td>\
          <td></td>\
          <td></td>\
          <td>10</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td></td>\
          </tr>';
if(BUNIT=="MG1" || BUNIT=="MS1" || BUNIT=="M4R")
         {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaCV+"||NF|10||||"+ANAL_T6+"|||*|"+nombre+"|"+cv+"|C|";
        } else {
          cad=cad+TREFERENCE+"|"+PERIOD+"|"+TRANS_DATETIMEForSSC+"|"+cuentaCV+"|||10||||"+ANAL_T6+"||||"+nombre+"|"+cv+"|C|";
        }
          cad2 = cad2 + '<tr><td>'+cuentaCV+'</td>\
          <td>'+PERIOD+'</td>\
          <td>'+TRANS_DATETIME+'</td>\
          <td>'+cv+'</td>\
          <td>C</td>\
          <td>'+TREFERENCE+'</td>\
          <td>'+nombre+'</td>\
          <td></td>\
          <td></td>\
          <td>10</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          <td>'+ANAL_T6+'</td>\
          <td></td>\
          <td></td>\
          <td></td>\
          </tr>';
        }
      }
     
    }
  }
  $("#contabilizarManuntencionTable").html(cad2);
  
  var cuantasLineas = $('#contabilizarManuntencionTable tr').length;
  cadNomina =   "||"+cuantasLineas+"|"+BUNIT+"|"+tipoDeDiario+"|"+cad;
  $("#contabilizarManutencionMinistros").attr("cad",cadNomina);
  $("#contabilizarManutencionMinistros").attr("BUNIT",BUNIT);

});
var cadNomina = '';
$(document).on("click", "#contabilizarManutencionMinistros", function (){
  var cad = $(this).attr("cad");
  if(cad=="")
  {
    alert("Primero debes de generar la prepoliza para ver que todo este bien");
    return;
  }
  var tipoPayroll = parseInt($("#generarPreContabilizacionClientSide").attr("tipo"));//1 asociados, 2 ministros, 3 emeritos
 /*
  if(tipoPayroll==3)//viejitos, crear dimensiones en detalle
  {
    var BUNIT = $(this).attr("BUNIT");
   
    var param = { BUNIT : BUNIT};
    $.ajax({
      url: "/creaDetallesParaViejitos",
      dataType : "json",
      type : "post",
      async : true,
      data : param,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp) {
      }
    });
  }
*/
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp) {
      var hash = resp.hash;
      var u = $("#USUARIOACTUAL").html();
    //  cad = cadNomina;
      console.log(cad);
       var BUNITViejito = $("#BUNITACTUAL").html();
    var USUARIOACTUAL = $("#USUARIOACTUAL").html();
    if(USUARIOACTUAL=="MPJ")
    {
      BUNITViejito = $("#selectCampoPayroll").val();
    }
      window.open(
        "/generarDiario?hash="+hash+"&source="+u+"&diario="+cad+"&libro=A&db=SunSystemsData&BUNITViejito="+BUNITViejito+"&pass=",
        '_blank'
      );
    }
  });
});

$(document).on("click", "#generarPreContabilizacion", function (){
  var delPeriodo = $("#delPeriodo").val();
  var param = { delPeriodo : delPeriodo};



  $.ajax({
    url: "/generarPreContabilizacion",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var cad = '', i = 0, aver2 = Object.keys(resp.calculo);  
        $("#headPreManutencion").html('<tr><td>Manutencion</td><td>Punto MD</td><td>Ministerial</td><td>Pulpito</td><td>Total Manutencion</td><td>Diezmo</td><td>Diezmo renta</td><td>AFROUMN</td><td>Salud e incapacidad</td><td>Total descuentos</td><td>Neto</td><td>Exenta</td><td>Gravada</td><td>Gravado anual</td><td>Limite inferior</td><td>Exedente limite inferior</td><td>Impuesto marginal</td><td>Cuota fija</td><td>Impuesto anual</td><td>Impuesto mensual</td></tr>');
        
        var cad2 = '';
        var aver3 = Object.keys(resp.prepoliza);
        for (i =0; i < aver3.length; i++) 
        {
          cad2 = cad2 + '<tr><td>'+resp.prepoliza[aver3[i]].ACCNT_CODE+'</td>\
          <td>'+resp.prepoliza[aver3[i]].PERIOD+'</td>\
          <td>'+resp.prepoliza[aver3[i]].TRANS_DATETIME+'</td>\
          <td>'+resp.prepoliza[aver3[i]].AMOUNT+'</td>\
          <td>'+resp.prepoliza[aver3[i]].D_C+'</td>\
          <td>'+resp.prepoliza[aver3[i]].TREFERENCE+'</td>\
          <td>'+resp.prepoliza[aver3[i]].DESCRIPTN+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T1+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T2+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T3+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T4+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T5+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T6+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T7+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T8+'</td>\
          <td>'+resp.prepoliza[aver3[i]].ANAL_T9+'</td>\
          </tr>';
        }
        for (i =0; i < aver2.length; i++) {
          cad=cad+'<tr><td>'+resp.calculo[aver2[i]].Nombre+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].S,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].MD,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].SS,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].D,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].TotalIngresos,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Diezmo,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].DiezmoRenta,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Afroumn,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Salud,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].TotalDescuentos,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Neto,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Exenta,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].Gravada,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].GravadaAnual,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].LimiteInferior,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].ExedenteLimiteInferior,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].ImpuestoMarginal,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].CuotaFija,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].ImpuestoAnual,'$')+'</td>\
          <td>'+format2(resp.calculo[aver2[i]].ImpuestoMensual,'$')+'</td>\
          </tr>';
        }
        $("#tablaContabilizarManutencion").html(cad);
        $("#contabilizarManuntencionTable").html(cad2);
      }
    }
  });
});
var guardaFila=0, guardaColumna=0;


function initializePayrollTableAsociados() {
  var siNo = new Array();
  siNo.push("NO");
  siNo.push("SI");

  var cincoDiez = new Array();
  cincoDiez.push("0");
  cincoDiez.push("5");
  cincoDiez.push("10");
  
           
  var hotElement = document.querySelector('#hot');
  var hotElementContainer = hotElement.parentNode;
  var hotSettings = {
    //data: dataObject,
    columns: [
      {
        data: 'ER',
        type: 'text',
        editor: false,
        width: 1
      },
      {
        data: 'Nombre',
        type: 'text',
        editor: false,
        width: 350
      },
      {
        data: 'Status',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'Departamento',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'SueldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 100
      },
      {
        data: 'PosgradoPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'SobreSueldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 40
      },
      {
        data: 'DepPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'AguinaldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'PrimaVacacionalPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'tiempoLaborPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'DescontarDiezmoDeRentaAntesDeLaBaseGravable',
        type: 'dropdown',
        source: siNo, 
        width: 300
      },
      {
        data: 'Sueldos',
        type: 'text',
        editor: false,
        width: 70
      },
      {
        data: 'Posgrado',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'SS',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'Depre',
        type: 'numeric',
        editor: false,
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Renta_Integrada',
        type: 'numeric',
        editor: 'numeric',
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'TotalIngresosMensuales',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoManutencionDescontadoDeBaseGravable',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoBonosDescontadoDeBaseGravable',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoDeLaRenta',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'RentaPcent',
        type: 'text',
        editor: false,
        width: 110
      },
      {
        data: 'IncapacidadYSalud',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'AFROUMN',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'TotalDeDescuentosAntesDeLaBase',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'ManutencionParaCalculoISRAsimilableASalarios',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'Aguinaldo',
        type: 'text',
        editor: false,
        width: 90
      },
      {
        data: 'Prima',
        type: 'text',
        editor: false,
        width: 90
      },
      {
        data: 'CasaDeGobierno',
        type: 'numeric',
        editor: 'numeric',
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'CasaAsociacionUnion',
        type: 'dropdown',
        source: siNo, 
        width: 150
      },
      {
        data: 'RentaAdelantada',
        type: 'dropdown',
        source: siNo, 
        width: 150
      },
      {
        data: 'PcentDescRenta',
        type: 'dropdown',
        source: cincoDiez, 
        width: 150
      },
      {
        data: 'Exento',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Gravado',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'GravadoConBonos',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'ISRMinistro',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Proyecto',
        type: 'text',
        editor: 'text',
        width: 110
      },
      {
        data: 'RFC',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'CURP',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'NE',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'Banco',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'CuentaBancaria',
        type: 'text',
        editor: false,
        width: 100
      },
      {
        data: 'Estado',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'SDI',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 60,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'imss',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 60,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'cv',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 60,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'FechaInicioRelLaboral',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'NumSeguridadSocial',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'SubsidioCausado',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 260,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'SubsidioEntregado',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 260,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'AnioIMSS',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'DiasVaca',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'ViajesRegular',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      },
      {
        data: 'ViajesEspecial',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      },
      {
        data: 'ViajesEsposa',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      }

    ],
    stretchH: 'all',
    width: screen.width-0,
    autoWrapRow: true,
    height: 887,
    maxRows: 700,
    manualRowResize: true,
    manualColumnResize: true,
    rowHeaders: true,
    hiddenColumns: {
      columns: [0],
      indicators: false
    },
    fixedColumnsLeft: 2,
    colHeaders: [
      'ER',
      'Nombre',
      'Status',
      'Departamento',
      '% Sueldo',
      '% Posgrado',
      '% SS',
      '% Dep',
      '% Aguinaldo',
      '% Prima vacacional',
      '% tiempo de labor',
      'Descontar Diezmo De Renta Antes De La Base Gravable',
      'Sueldos',
      'Posgrado',
      'SS',
      'Depre',
      'Renta integrada',
      'TotalIngresosMensuales integrada',
      'Diezmo Manutencion Descontado De Base Gravable',
      'Diezmo Bonos Descontado De Base Gravable',
      'Diezmo de Renta',
      '% Renta',
      'Incapacidad y Salud',
      'FOBONO',
      'Total de descuentos antes de la base',
      'Manutencion para calculo ISR Asimilables a salarios',
      'Aguinaldo',
      'Prima',
      'Casa de gobierno',
      'Integrar bonos?',
      'Renta adelantada?',
      '% Desc. Renta',
      'Exento',
      'Gravado',
      'Gravado con Bonos',
      'ISR Asociados',
      'Funcion',
      'RFC',
      'CURP',
      'N.E.',
      'Banco',
      'Cuenta Bancaria',
      'Estado',
      'SDI',
      'IMSS',
      'CV',
      'FechaInicioRelLaboral',
      'NumSeguridadSocial',
      'Subsidio Causado',
      'Subsidio Entregado',
      'Años IMSS',
      'Dias de vacaciones',
      'Viajes Regular',
      'Viajes Especial',
      'Viajes Esposa',
    ],
    afterChange: function(changes, source) {
      if(source=="edit")
      {
        var fila = changes[0][0];
        var columna = changes[0][1];
        guardaFila = fila;
        guardaColumna = columna;
        var comoEstaba = changes[0][2];
        var comoEstaAhora = changes[0][3];
        var ER = hot.getDataAtCell(fila,0);
        var sueldoPCent = hot.getDataAtCell(fila,4);
        var posgradoPCent = hot.getDataAtCell(fila,5);
        var sobrePcent = hot.getDataAtCell(fila,6);
        var deprePcent = hot.getDataAtCell(fila,7);
        var aguinaldoPcent = hot.getDataAtCell(fila,8);
        var primaPcent = hot.getDataAtCell(fila,9);
        var tiempoDeLabor = hot.getDataAtCell(fila,10);
        var descontarDiezmoDeRentaAntesDeLaBaseGravable = hot.getDataAtCell(fila,11);
        var RentaIntegrada = hot.getDataAtCell(fila,16);


        var CasaDeGobierno = hot.getDataAtCell(fila,28);
        var CasaAsociacionUnion = hot.getDataAtCell(fila,29);
        var RentaAdelantada = hot.getDataAtCell(fila,30);
        var PcentDescRenta = hot.getDataAtCell(fila,31);
        var Proyecto = hot.getDataAtCell(fila,36);
        var ViajesRegular = hot.getDataAtCell(fila,52);
        var ViajesEspecial = hot.getDataAtCell(fila,53);
        var ViajesEsposa = hot.getDataAtCell(fila,54);

//ASOCIADOS
        var param = {
          ER : ER,
          sueldoPCent : sueldoPCent,
          posgradoPCent : posgradoPCent,
          sobrePcent : sobrePcent,
          deprePcent : deprePcent,
          aguinaldoPcent : aguinaldoPcent,
          primaPcent : primaPcent,
          tiempoDeLabor : tiempoDeLabor,
          descontarDiezmoDeRentaAntesDeLaBaseGravable : descontarDiezmoDeRentaAntesDeLaBaseGravable,
          RentaIntegrada : RentaIntegrada,
          CasaDeGobierno : CasaDeGobierno,
          CasaAsociacionUnion : CasaAsociacionUnion,
          RentaAdelantada : RentaAdelantada,
          PcentDescRenta : PcentDescRenta,
          Proyecto : Proyecto,
          ViajesRegular : ViajesRegular,
          ViajesEspecial : ViajesEspecial,
          ViajesEsposa : ViajesEsposa
        };
        $.ajax({
          url: "/modificaPersonaPayroll",//ASOCIADOS
          dataType : "json",
          type : "post",
          async : true,
          data : param,
          beforeSend : function (){
            $("#cambiaMensaje").html("Guardando cambios...");
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              $("#cambiaMensaje").html("Todos los cambios guardados");
              //initializePayrollTable();
            }
          }
        });
      }
    },
    manualRowMove: true,
    manualColumnMove: true,
    contextMenu: true,
    filters: true,
    dropdownMenu: true
  };
  hot = new Handsontable(hotElement, hotSettings);
  var param = {diarioAnterior : 1};
  $.ajax({
    url: "/datosPayroll",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var data = new Array();
      var aver2 = Object.keys(resp.payroll);
      var i;
      var base = resp.base;
      $("#base").html(base);
      $("#baseLabel").html("Base: "+format2(base,'$'));
      

      for(i=0;i<aver2.length;i++)
      {
        var row = new Array();
        var periodoInicial = parseInt(resp.payroll[aver2[i]].PERIOD);
        var periodoA = ""+$("#delPeriodo").val();;
        row["FechaInicioRelLaboral"] = resp.payroll[aver2[i]].FechaInicioRelLaboral;
        var fecha = resp.payroll[aver2[i]].FechaInicioRelLaboral;
var FechaPago = "25/"+periodoA.substring(5)+"/"+periodoA.substring(0,4);
        console.log(periodoA);
//var d = new Date(2011,10,30);

        var date1 = new Date(parseInt(fecha.substring(6)),parseInt(fecha.substring(3,5))-1,parseInt(fecha.substring(0,2)) );
        var date2 = new Date(parseInt(periodoA.substring(0,4)),parseInt(periodoA.substring(5))-1,25);

        console.log(date1);
        console.log(date2);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var aniosAntiguedad =  Math.trunc(diffDays/365);
        var diasDeVacaciones = 6;
        if(aniosAntiguedad==0)
        {
          aniosAntiguedad=1;
        }
        if(aniosAntiguedad<=1)
        {
diasDeVacaciones = 6;
} else {                  
        if(aniosAntiguedad==2)
        {
          diasDeVacaciones = 8;
        } else {
         if(aniosAntiguedad==3){diasDeVacaciones = 10;}
         else{
          if(aniosAntiguedad==4){diasDeVacaciones = 12;}
          else{
            if(aniosAntiguedad>=5 && aniosAntiguedad <= 9){diasDeVacaciones = 14;}
            else {
              if(aniosAntiguedad>=10 && aniosAntiguedad <= 14){diasDeVacaciones = 16;}
              else {
                if(aniosAntiguedad>=15 && aniosAntiguedad <= 19){diasDeVacaciones = 18;}
                else {
                  diasDeVacaciones = 20;
                }
              }
            }
          }
         } 
        }
        }
        
        row["AnioIMSS"] = aniosAntiguedad;
        row["DiasVaca"] = diasDeVacaciones;
        row["NumSeguridadSocial"] = resp.payroll[aver2[i]].NumSeguridadSocial;
        row["RFC"] = resp.payroll[aver2[i]].Rfc;
        console.log(resp.payroll[aver2[i]].Rfc+" "+aniosAntiguedad);
        row["CURP"] = resp.payroll[aver2[i]].Curp;
        row["NE"] = resp.payroll[aver2[i]].Num;
        row["Banco"] = resp.payroll[aver2[i]].Banco;
        row["CuentaBancaria"] = resp.payroll[aver2[i]].CuentaBancaria;
        row["Estado"] = resp.payroll[aver2[i]].Estado;


        
        row["CasaDeGobierno"] = parseFloat(resp.payroll[aver2[i]].Ayuda_renta);
        row["CasaAsociacionUnion"] = resp.payroll[aver2[i]].Casa_Campo;
        row["RentaAdelantada"] = resp.payroll[aver2[i]].Renta_Adelantada;
        row["PcentDescRenta"] = parseInt(resp.payroll[aver2[i]].PCENT_Descuento_Renta);
        row["CasaDeGobierno"] = Math.round(row["CasaDeGobierno"] * 100) / 100;


        row["ER"] = resp.payroll[aver2[i]].ER;
        row["Nombre"] = resp.payroll[aver2[i]].Nombre;
        row["Departamento"] = resp.payroll[aver2[i]].Departamento.trim().substring(0,8);
        row["SueldoPcent"] = resp.payroll[aver2[i]].PCENT_Manutencion;
        row["PosgradoPcent"] = resp.payroll[aver2[i]].PCENT_Posgrado;
        row["SobreSueldoPcent"] = resp.payroll[aver2[i]].PCENT_Ministerial;
        row["DepPcent"] = resp.payroll[aver2[i]].PCENT_Pulpito;
        row["AguinaldoPcent"] = resp.payroll[aver2[i]].PCENT_Extraordinaria;
        row["PrimaVacacionalPcent"] = resp.payroll[aver2[i]].PCENT_Extraordinaria_Prima;
        row["tiempoLaborPcent"] = resp.payroll[aver2[i]].PCENT_tiempolabor;
        row["Sueldos"] = base * (parseFloat(row["SueldoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["Sueldos"] = Math.round(row["Sueldos"] * 100) / 100;


        row["Posgrado"] = base * (parseFloat(row["PosgradoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["SS"] = base * (parseFloat(row["SobreSueldoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["Depre"] = base * (parseFloat(row["DepPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["DescontarDiezmoDeRentaAntesDeLaBaseGravable"] = resp.payroll[aver2[i]].DescontarDiezmoDeRentaAntesDeLaBaseGravable;
        row["Renta_Integrada"] = resp.payroll[aver2[i]].Renta_Integrada;
        var cuatroCosas = row["Sueldos"] + row["Posgrado"] + row["SS"] + row["Depre"];
        var p = ""+periodoInicial;
        var anio = parseInt(p.substring(0,4));
        var mes = parseInt(p.substring(5,7));
        var periodoVer = parseInt($("#delPeriodo").val());
        var pVer = ""+periodoVer;
        var anioVer = parseInt(pVer.substring(0,4));
        var mesVer = parseInt(pVer.substring(5,7));
        var numMeses = 12;
        var BUNITACTUAL = $("#BUNITACTUAL").html();
        if(anio<anioVer)
        {
          numMeses = 12;
        }
        else
        {
          if(anio==anioVer)
          {
            numMeses = 12 - mes + 1;
            if(row["ER"]=="ERTORCA01" ||  row["ER"]=="ERMURAB01")
            {
              numMeses=11;
            }
            if(row["ER"]=="ERMARNI01" && BUNITACTUAL=="MM1")
            {
              numMeses=12;
            }
            if(row["ER"]=="ERZARLU01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }
            if(row["ER"]=="ERHEROB01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }


            if(row["ER"]=="ERHEROB01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }
            
            if(row["ER"]=="ERGUIOS01" && BUNITACTUAL=="M41")
            {
              numMeses=4;
            }
            if(row["ER"]=="ERMENYA01" && BUNITACTUAL=="M11")
            {
              numMeses=5;
            }
            
            if(row["ER"]=="ERMURAB01" && BUNITACTUAL=="M11")
            {
              numMeses=12;
            }
            if(row["ER"]=="ERRIOEL01" && BUNITACTUAL=="MU1")
            {
              numMeses=6;
            }
            if(row["ER"]=="EROROLU01" && BUNITACTUAL=="MU1")
            {
              numMeses=8;
            }
            if(row["ER"]=="ERCORIV01" && BUNITACTUAL=="MU1")
            {
              numMeses=8;
            }
            if(row["ER"]=="ERGALBE01")
            {
              numMeses=7;
            }

          } 
          else
          {
            if(anio>anioVer)
            {
              numMeses = 0;
            }   
          }
        }
        
        

        var aguinaldo = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["PosgradoPcent"])/100) +(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * (parseFloat(row["AguinaldoPcent"])/100)   ;
        var prima = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["PosgradoPcent"])/100) +(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * (parseFloat(row["PrimaVacacionalPcent"])/100);
        if(numMeses!=12)
        {
          //console.log(resp.payroll[aver2[i]].ER+"  "+aguinaldo+"  "+prima);
        }
        aguinaldo = aguinaldo * numMeses / 12;
        prima = prima * numMeses / 12;
        if(numMeses!=12)
        {
          //console.log(resp.payroll[aver2[i]].Nombre+"  "+aguinaldo+"  "+prima);
        }

        aguinaldo = Math.round(aguinaldo * 100) / 100;
        prima = Math.round(prima * 100) / 100;
        row["Aguinaldo"] = aguinaldo;
        row["Prima"] = prima;

        row["TotalIngresosMensuales"] = cuatroCosas + row["Renta_Integrada"] ;
//Renta_Integrada

        row["DiezmoManutencionDescontadoDeBaseGravable"] = cuatroCosas * 0.1;
        row["DiezmoBonosDescontadoDeBaseGravable"] = ((prima+aguinaldo) / numMeses) * 0.1;
        //DiezmoDeLaRenta
        if(row["ER"]=="ERMURAB01" && BUNITACTUAL=="M11")
        {
          row["DiezmoBonosDescontadoDeBaseGravable"] = ((prima+aguinaldo) / 6) * 0.1;
        }
        if(row["DescontarDiezmoDeRentaAntesDeLaBaseGravable"]=="SI")
        {
          row["DiezmoDeLaRenta"] = row["CasaDeGobierno"] * 0.1;
        }
        row["RentaPcent"] = row["CasaDeGobierno"] * (row["PcentDescRenta"] / 100);
      

        row["IncapacidadYSalud"] = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * 5.5/100 * 25/100;

        row["AFROUMN"] = base * ( (parseFloat(row["SueldoPcent"])/100) ) * 2.75/100 ;
        row["AFROUMN"] = Math.round(row["AFROUMN"] * 100) / 100;   
        row["AFROUMN"] = 0.0;
        row["IncapacidadYSalud"] = Math.round(row["IncapacidadYSalud"] * 100) / 100;
        if(BUNITACTUAL=="MG1" && ( resp.payroll[aver2[i]].ER=="ERHERAL01" || resp.payroll[aver2[i]].ER=="ERHERAL01" || resp.payroll[aver2[i]].ER=="ERTORAB01" || resp.payroll[aver2[i]].ER=="ERALVJA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MR1" && ( resp.payroll[aver2[i]].ER=="ERJIMMA01" || resp.payroll[aver2[i]].ER=="ERJIMMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MM1" && ( resp.payroll[aver2[i]].ER=="ERDAVSA01" || resp.payroll[aver2[i]].ER=="ERHEROB01"  || resp.payroll[aver2[i]].ER=="ERPIMAR01" || resp.payroll[aver2[i]].ER=="ERVARJO01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
         if(BUNITACTUAL=="MN1" && ( resp.payroll[aver2[i]].ER=="ERCAHMA01" || resp.payroll[aver2[i]].ER=="ERPERDA01"   || resp.payroll[aver2[i]].ER=="ERSAROF01"   || resp.payroll[aver2[i]].ER=="ERCONVI01"   || resp.payroll[aver2[i]].ER=="ERAYOCA01" || resp.payroll[aver2[i]].ER=="ERBERMI01" || resp.payroll[aver2[i]].ER=="ERFIGED01" || resp.payroll[aver2[i]].ER=="ERLOPYE01" || resp.payroll[aver2[i]].ER=="ERCASER01" || resp.payroll[aver2[i]].ER=="ERDELYA01"  || resp.payroll[aver2[i]].ER=="ERLOZAN01" ) )
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MU1" && resp.payroll[aver2[i]].ER=="ERARMJA01" ) {
            console.log("MIRAAA : "+resp.payroll[aver2[i]].ER);
           }
        if(BUNITACTUAL=="MU1" && ( resp.payroll[aver2[i]].ER=="ERARMJA01" || resp.payroll[aver2[i]].ER=="ERCORIV01"   || resp.payroll[aver2[i]].ER=="ERGARRA01"   || resp.payroll[aver2[i]].ER=="EROROOL01"   || resp.payroll[aver2[i]].ER=="ERTORDI01" || resp.payroll[aver2[i]].ER=="ERYEPMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        else{
           
        }
        

        if(BUNITACTUAL=="MUR" && ( resp.payroll[aver2[i]].ER=="ERSAUMA01" || resp.payroll[aver2[i]].ER=="ERSAUMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }

        
        if(BUNITACTUAL=="MK1" && ( resp.payroll[aver2[i]].ER=="ERROJAB01" || resp.payroll[aver2[i]].ER=="ERLOPRE01" || resp.payroll[aver2[i]].ER=="ERZEPAB01" || resp.payroll[aver2[i]].ER=="ERCONDA01" || resp.payroll[aver2[i]].ER=="ERREYJO01"   )   )
        {
          row["AFROUMN"] = 0.0;
         
         // row["IncapacidadYSalud"] = 0.0;
        }

        if(BUNITACTUAL=="MS1" && ( resp.payroll[aver2[i]].ER=="ERSANJE01" || resp.payroll[aver2[i]].ER=="ERPEREN01" || resp.payroll[aver2[i]].ER=="ERJIMMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }

        
        if(resp.payroll[aver2[i]].ER=="ERALPNO01" || resp.payroll[aver2[i]].ER=="ERAGURA01"  || resp.payroll[aver2[i]].ER=="ERNUÑJO01" || resp.payroll[aver2[i]].ER=="ERNUDJO01" || resp.payroll[aver2[i]].ER=="ERNOVVA01" || resp.payroll[aver2[i]].ER=="ERURBKE01" || row["Departamento"]=="TRABAJAD" ) {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        row["DiezmoBonosDescontadoDeBaseGravable"] = Math.round(row["DiezmoBonosDescontadoDeBaseGravable"] * 100) / 100;
        row["DiezmoDeLaRenta"] = Math.round(row["DiezmoDeLaRenta"] * 100) / 100;
        row["RentaPcent"] = Math.round(row["RentaPcent"] * 100) / 100;
        var BUNITACTUAL = $("#BUNITACTUAL").html();
        
        if(isNaN(row["DiezmoDeLaRenta"]))
        {
          row["DiezmoDeLaRenta"] = 0;
        }
        row["DiezmoManutencionDescontadoDeBaseGravable"] = Math.round(row["DiezmoManutencionDescontadoDeBaseGravable"] * 100) / 100;
 if(row["ER"]=="ERNUNDI01"){
          row["DiezmoManutencionDescontadoDeBaseGravable"] = 0.0;
          row["DiezmoBonosDescontadoDeBaseGravable"] = 0.0;
          row["DiezmoDeLaRenta"] = 0.0;
        }
       

        row["TotalDeDescuentosAntesDeLaBase"] = 0;
        if(!isNaN(row["AFROUMN"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["AFROUMN"];
        }
        if(!isNaN(row["IncapacidadYSalud"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["IncapacidadYSalud"];
        }
        if(!isNaN(row["RentaPcent"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["RentaPcent"];
        }
        if(!isNaN(row["DiezmoDeLaRenta"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoDeLaRenta"];
        }
        if(!isNaN(row["DiezmoBonosDescontadoDeBaseGravable"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoBonosDescontadoDeBaseGravable"];
        }
        if(!isNaN(row["DiezmoManutencionDescontadoDeBaseGravable"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoManutencionDescontadoDeBaseGravable"];
        }
        row["TotalDeDescuentosAntesDeLaBase"] = Math.round(row["TotalDeDescuentosAntesDeLaBase"] * 100) / 100;
        

 
        //7350.72
        row["ManutencionParaCalculoISRAsimilableASalarios"] = row["TotalIngresosMensuales"]  - row["TotalDeDescuentosAntesDeLaBase"] ;
        var parteExenta = 12251.20;
        var UMA = 80.6;
        if(periodoVer<=2018001)
        {
          UMA = 75.49;
        }
        if(periodoVer>=2019002)
        {
          UMA = 84.49;
        }
        var SMG = 88.36;
        var Prima = UMA * 15;
        var Aguinaldo = UMA * 30;
       
        
        


        row["ManutencionParaCalculoISRAsimilableASalarios"] = Math.round(row["ManutencionParaCalculoISRAsimilableASalarios"] * 100) / 100;
         
        if(periodoVer<2018002)
        {
          parteExenta = 11474.50;
        }
        if(periodoVer>=2019002)
        {
          parteExenta = 12842.50;
        }
        if(BUNITACTUAL=="M11" && periodoVer<2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MR1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7355.20
        }
        if(BUNITACTUAL=="MM1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7350.00
        }
        if(BUNITACTUAL=="MM1" && periodoVer==2018001)
        {
          parteExenta = 6884.00
        }
        if(BUNITACTUAL=="MG1" && periodoVer==2018005)
        {
          parteExenta = 12251.20
        }
        if(BUNITACTUAL=="MK1" && periodoVer<=2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20
        }
        if(BUNITACTUAL=="MS1" && periodoVer<=2018006 && periodoVer>2018001 && (row["ER"] == 'ERBENRA01' || row["ER"] == 'ERGALBE01') )
        {
          parteExenta = 7355.00
        }
        var sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 0;
        if(periodoVer<=2018005 && periodoVer>=2018001 && BUNITACTUAL!="MR1" && BUNITACTUAL != "MM1")
        {
          sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 2450.24 * 2;
          if(periodoVer==2018001)
          {
            sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 2294.9 * 2;
            
          }
        }
        if(row["Departamento"]=="TRABAJAD")
        {
          parteExenta = 0.0; 
        }
        
        row["Exento"] = 0;
        row["Gravado"] = 0;
row["ViajesRegular"] = parseFloat(resp.payroll[aver2[i]].ViajesRegular);
        row["ViajesEspecial"] = parseFloat(resp.payroll[aver2[i]].ViajesEspecial);
        row["ViajesEsposa"] = parseFloat(resp.payroll[aver2[i]].ViajesEsposa);
        
        ///calculo de SDI
        var salarioDiario = (row["ManutencionParaCalculoISRAsimilableASalarios"]+row["ViajesEsposa"] +row["ViajesEspecial"]+row["ViajesRegular"])/30.4; //magic number
        
        var diasDelMes2 = daysInMonth(mes,anio);
        if(BUNITACTUAL=="MM1")
        {
        //salarioDiario = (row["ManutencionParaCalculoISRAsimilableASalarios"]+row["ViajesEsposa"] +row["ViajesEspecial"]+row["ViajesRegular"])/diasDelMes2; //magic number
          
        }
        
        var minLey = diasDeVacaciones * salarioDiario * 0.25;
        var primaDiaria = minLey / 365;
        var minLeyAguinaldo = 15 * salarioDiario;
        var aguinaldoDiario = minLeyAguinaldo / 365;
        //fin de calculo de SDI
        if(row["ManutencionParaCalculoISRAsimilableASalarios"]<=parteExenta){
          row["Exento"] = row["ManutencionParaCalculoISRAsimilableASalarios"];
          row["Gravado"] = 0;
        } else {
          row["Exento"] = parteExenta;
          row["Gravado"] = row["ManutencionParaCalculoISRAsimilableASalarios"] -parteExenta+row["ViajesEsposa"] +row["ViajesEspecial"]+row["ViajesRegular"];

        }

       
        if(row["ER"]=="ERMURAB01" && BUNITACTUAL=="M11")
        {
          numMeses=6;
          Prima=0;
          //suma = (Prima/6)+(Aguinaldo/6);//hardcode maximus por deciciones administrativas fuera del reglamento
          //console.log("P:"+Prima+" A:"+Aguinaldo+" S:"+suma);
        }
        var suma = (Prima/numMeses)+(Aguinaldo/numMeses);

        if(parseInt(row["CasaAsociacionUnion"])==1 || row["CasaAsociacionUnion"]=="SI")//integrar bonos
        {
          suma = (row["Prima"]/numMeses)+(row["Aguinaldo"]/numMeses);
        }
        if(row["ER"]=="ERTREER01" && BUNITACTUAL=="MK1")
        {
          suma = 301.62;
        }
        var factor = (suma / row["ManutencionParaCalculoISRAsimilableASalarios"])+1;
        

         if(row["ER"]=="ERMURAB01" && BUNITACTUAL=="M11")
        {
          console.log("Murillo;");
          console.log(suma);
          console.log(row["ManutencionParaCalculoISRAsimilableASalarios"]);
          console.log(factor);
          console.log(row["Gravado"]);
        }
        var manutencionMensualIntegradaPorFactor = factor * row["Gravado"];
       // row["SDI"] = (row["ManutencionParaCalculoISRAsimilableASalarios"] / 30.42)*factor;
        row["SDI"] = salarioDiario+primaDiaria+aguinaldoDiario;
        row["SDI"] = Math.round(row["SDI"] * 100) / 100;


       // if(numMeses!=12)
       if(row["ER"]=="ERTREER01")
        {
          console.log(row["ER"]+" numero de meses: "+numMeses);
          console.log("calculo de SDI de "+row["ER"]);
          console.log("Prima: "+Prima);
          console.log("Aguinaldo: "+Aguinaldo);
          console.log("Suma de integracion: "+suma);
          console.log("Factor de integracion: "+factor);
          console.log("SDI "+row["SDI"]);
          
        }
        var unidadDelIMSS = UMA;
        var tresSMG = unidadDelIMSS * 3;
        var exedenteTresSMG = 0;
        periodoVer = ""+periodoVer;
        var anio = parseInt(periodoVer.substring(0,4));
        var mes = parseInt(periodoVer.substring(5,7));
        var diasDelMes = daysInMonth(mes,anio);
        if(row["SDI"]>tresSMG)
        {
          exedenteTresSMG = row["SDI"] - tresSMG;
        }

        var diasAusentismo = 0;
        var riesgoTrabajoPatron = 0.005 * row["SDI"] * diasDelMes;
        //0.05
        if(BUNITACTUAL=="MS1" || BUNITACTUAL=="M4R" || BUNITACTUAL=="MP1" || BUNITACTUAL=="MUR" || BUNITACTUAL=="MR1")
        {
          riesgoTrabajoPatron = 0.0054355 * row["SDI"] * diasDelMes;
        }

        var enfermedadesCuotaFijaPatron = ((unidadDelIMSS * 0.204) * diasDelMes) + ((unidadDelIMSS * 0.204) * diasAusentismo);
        var enfermedadesExedentePatron = ((exedenteTresSMG * 0.011) * diasDelMes) + ((exedenteTresSMG * 0.011) * diasAusentismo);
        var enfermedadesExedenteTrabajador = ((exedenteTresSMG * 0.004) * diasDelMes) + ((exedenteTresSMG * 0.004) * diasAusentismo);

        var enfermedadesPrestPatron = ((row["SDI"] * 0.007) * diasDelMes) + ((row["SDI"] * 0.007) * diasAusentismo);
        var enfermedadesPrestTrabajador = ((row["SDI"] * 0.0025) * diasDelMes) + ((row["SDI"] * 0.0025) * diasAusentismo);

        var gastosMedicosPatron =  ((row["SDI"] * 0.0105) * diasDelMes) + ((row["SDI"] * 0.0105) * diasAusentismo);
        var gastosMedicosTrabajador =  ((row["SDI"] * 0.00375) * diasDelMes) + ((row["SDI"] * 0.00375) * diasAusentismo);
        var invalidezPatron = (row["SDI"] * 0.0175) * diasDelMes;
        var invalidezTrabajador = (row["SDI"] * 0.00625) * diasDelMes;
        var guarderiaPatron = (row["SDI"] * 0.01) * diasDelMes;

        var imss = riesgoTrabajoPatron + enfermedadesCuotaFijaPatron + enfermedadesExedentePatron +enfermedadesExedenteTrabajador + enfermedadesPrestPatron + enfermedadesPrestTrabajador + gastosMedicosPatron + gastosMedicosTrabajador + invalidezPatron + invalidezTrabajador + guarderiaPatron;
        imss = Math.round(imss * 100) / 100;
        var diasDeIncapacidad = 0;
        var sarRetiroPatron =  ((row["SDI"] * 0.02) * diasDelMes) + ((row["SDI"] * 0.02) * diasDeIncapacidad);
        var sarCesantiaPatron =  ((row["SDI"] * 0.0315) * diasDelMes);
        var sarCesantiaTrabajador =  ((row["SDI"] * 0.01125) * diasDelMes);
        var rcv = sarRetiroPatron + sarCesantiaPatron + sarCesantiaTrabajador;
        rcv = Math.round(rcv * 100) / 100;

        var infonavitPatron =  ((row["SDI"] * 0.05) * (diasDelMes+diasDeIncapacidad));
        infonavitPatron = Math.round(infonavitPatron * 100) / 100;        
        var total3 = infonavitPatron + rcv + imss;

        var patron = riesgoTrabajoPatron + enfermedadesCuotaFijaPatron + enfermedadesExedentePatron + enfermedadesPrestPatron + gastosMedicosPatron + invalidezPatron + guarderiaPatron + sarRetiroPatron + sarCesantiaPatron + infonavitPatron;
        var trabajador = enfermedadesExedenteTrabajador + enfermedadesPrestTrabajador +gastosMedicosTrabajador + invalidezTrabajador + sarCesantiaTrabajador;
        var imssTrabajador = enfermedadesExedenteTrabajador + enfermedadesPrestTrabajador +gastosMedicosTrabajador + invalidezTrabajador;
        var cvTrabajador = sarCesantiaTrabajador;
        imssTrabajador = Math.round(imssTrabajador * 100) / 100;
        cvTrabajador = Math.round(cvTrabajador * 100) / 100;
        row["imss"] = imssTrabajador;
        row["cv"] = cvTrabajador;
        var sumaleAlManutencion = 0.0;
        row["GravadoConBonos"] = 0.00;

        

        if(parseInt(row["CasaAsociacionUnion"])==1 || row["CasaAsociacionUnion"]=="SI")//integrar bonos
        {
          var PrimaNeta =   row["Prima"] - Prima;
          var AguinaldoNeto =   row["Aguinaldo"] - Aguinaldo;
          sumaleAlManutencion += (PrimaNeta/numMeses)+(AguinaldoNeto/numMeses);     
          //console.log(row["ER"]+"    sumale al manutencion: "+sumaleAlManutencion);
          row["GravadoConBonos"] = row["Gravado"]+sumaleAlManutencion+sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas;
          //row["ManutencionParaCalculoISRAsimilableASalarios"] += sumaleAlManutencion;
        }
        sumaleAlManutencion = Math.round(sumaleAlManutencion * 100) / 100;
        var subsidio = dameSubsidio(row["Gravado"]+sumaleAlManutencion+sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas);
        subsidio = Math.round(subsidio * 100) / 100;
        row["SubsidioCausado"] = subsidio;

        var isrAsociado = dameISRDeGravado(row["Gravado"]+sumaleAlManutencion+sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas);
        if(periodoVer<2018002)
        {
          //isrAsociado = dameISRDeGravado2017(row["Gravado"]);
          isrAsociado = dameISRDeGravado(row["Gravado"]+sumaleAlManutencion+sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas);
        }
        var difSubsidio = isrAsociado - row["SubsidioCausado"];
        if(difSubsidio>0)
        {
          row["ISRMinistro"] = difSubsidio;
          row["SubsidioEntregado"] = 0.00;
        } 
        else
        {
          if(difSubsidio<0)
          {
            row["ISRMinistro"] = 0.0;
            row["SubsidioEntregado"] = -1 * difSubsidio;
          } 
          else
          {
            row["ISRMinistro"] = 0.0;
            row["SubsidioEntregado"] = 0.00;
          }          
        }
        row["Proyecto"] = resp.payroll[aver2[i]].Proyecto;
        if(row["Departamento"]=="ASOCIADO")
        {
           row["ISRMinistro"] =  dameISRDeGravado(row["Gravado"]+sumaleAlManutencion+sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas);
         
          row["SubsidioCausado"] = 0.00;
          row["SubsidioEntregado"] = 0.00;
        }
        if(row["Departamento"]=="ASOCIADO" || row["Departamento"]=="TRABAJAD")
        {
          data.push(row);
        }
      }
      hot.loadData(data);
      hot.selectCell(guardaFila,guardaColumna);
    }
  });
}
function daysInMonth (month, year) {
    return new Date(year, month, 0).getDate();
}


function initializePayrollTableEmeritos() {
  var siNo = new Array();
  siNo.push("NO");
  siNo.push("SI");

  var cincoDiez = new Array();
  cincoDiez.push("0");
  cincoDiez.push("5");
  cincoDiez.push("10");
  
           
  var hotElement = document.querySelector('#hot');
  var hotElementContainer = hotElement.parentNode;
  var hotSettings = {
    //data: dataObject,
    columns: [
      {
        data: 'ER',
        type: 'text',
        editor: false,
        width: 1
      },
      {
        data: 'Nombre',
        type: 'text',
        editor: false,
        width: 350
      },
      {
        data: 'Departamento',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'Pension',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'BonoCondicional',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 170,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'AyudaDeRenta',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'BonoDeConyugue',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'BonoNavidad',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'TotalDeIngresos',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'SeguroDeSobreviviente',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 220,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'TotalDIA',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 170,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'Diezmo',
        type: 'numeric',
        format: '$0,0.00',
        editor: false ,
        width: 170,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'ListaNetaEBP',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 150,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'Exento',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'Gravado',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'ISRViejito',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 190,
        language: 'en',
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'TotalAPagar',
        type: 'text',
        format: '$0,0.00',
        editor: false,
        width: 230,
        numericFormat: {
          pattern: '$0,0.00',
          culture: 'en-US'
        }
      },
      {
        data: 'Funcion',
        type: 'text',
        editor: 'text',
        width: 110
      },
      {
        data: 'RFC',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'CURP',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'NE',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'Banco',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'CuentaBancaria',
        type: 'text',
        editor: false,
        width: 100
      },
      {
        data: 'Estado',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'UnidadesSeguro',
        type: 'text',
        editor: false,
        width: 30
      }
    ],
    stretchH: 'all',
    width: screen.width-0,
    autoWrapRow: true,
    height: 887,
    maxRows: 700,
    manualRowResize: true,
    manualColumnResize: true,
    rowHeaders: true,
    hiddenColumns: {
      columns: [0],
      indicators: false
    },
    fixedColumnsLeft: 2,
    colHeaders: [
      'ER',
      'Nombre',
      'Departamento',
      'Pension',
      'Bono condicional',
      'Ayuda de renta',
      'Bono de conyugue',
      'Bono de navidad',
      'Total de ingresos',
      'Seguro de sobreviviente',
      'Total DIA',
      'Diezmo',
      'Lista Neta EBP',
      'Exento',
      'Gravado',
      'ISR Viejitos',
      'Total a Pagar',
      'Funcion',
      'RFC',
      'CURP',
      'N.E.',
      'Banco',
      'Cuenta Bancaria',
      'Estado',
      'Unidades Seguro'
    ],
    afterChange: function(changes, source) {
      if(source=="edit")
      {
        var fila = changes[0][0];
        var columna = changes[0][1];
        guardaFila = fila;
        guardaColumna = columna;
        var comoEstaba = changes[0][2];
        var comoEstaAhora = changes[0][3];
        var ER = hot.getDataAtCell(fila,0);
        var Pension = hot.getDataAtCell(fila,3);
        var BonoCondicional = hot.getDataAtCell(fila,4);
        var AyudaDeRenta = hot.getDataAtCell(fila,5);
        var BonoDeConyugue = hot.getDataAtCell(fila,6);
        var BonoDeNavidad = hot.getDataAtCell(fila,7);
        var SeguroDeSobreviviente = hot.getDataAtCell(fila,9);
        var Funcion = hot.getDataAtCell(fila,17);
        var BUNITViejito = $("#BUNITACTUAL").html();
        var USUARIOACTUAL = $("#USUARIOACTUAL").html();
        if(USUARIOACTUAL=="MPJ")
        {
          BUNITViejito = $("#selectCampoPayroll").val();
        }
        
        var param = {
          ER : ER,
          Pension : Pension,
          BonoCondicional : BonoCondicional,
          AyudaDeRenta : AyudaDeRenta,
          BonoDeConyugue : BonoDeConyugue,
          BonoDeNavidad : BonoDeNavidad,
          SeguroDeSobreviviente : SeguroDeSobreviviente,
          Funcion : Funcion,
          BUNITViejito : BUNITViejito
        };
        $.ajax({
          url: "/modificaPersonaPayrollEmeritos",
          dataType : "json",
          type : "post",
          async : true,
          data : param,
          beforeSend : function (){
            $("#cambiaMensaje").html("Guardando cambios...");
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              $("#cambiaMensaje").html("Todos los cambios guardados");
              //initializePayrollTable();
            }
          }
        });
      }
    },
    manualRowMove: true,
    manualColumnMove: true,
    contextMenu: true,
    filters: true,
    dropdownMenu: true
  };
  hot = new Handsontable(hotElement, hotSettings);
  var BUNITViejito = $("#BUNITACTUAL").html();
  var USUARIOACTUAL = $("#USUARIOACTUAL").html();
  if(USUARIOACTUAL=="MPJ")
  {
    BUNITViejito = $("#selectCampoPayroll").val();
  }
  var totalPension = 0;
  var totalBonoCondicional = 0;
  var totalAyudaDeRenta  = 0;
  var totalBonoDeConyugue = 0;
  var totalBonoNavidad = 0;
  var totalUnidadesSeguro = 0;

  var totalTotalDeIngresos = 0;
  var totalSeguroDeSobreviviente = 0;
  var totalTotalDIA = 0;
  var totalDiezmo = 0;
  var totalListaNetaEBP = 0;
  var totalExento = 0;
  var totalGravado = 0;
  var totalISRViejitos = 0;
  var totalTotalAPagar = 0;
  var param = {diarioAnterior : 1, BUNITViejito : BUNITViejito};
  $.ajax({
    url: "/datosPayroll",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var data = new Array();
      var aver2 = Object.keys(resp.payroll);
      var i;
      var base = resp.base;
      $("#base").html(base);
      $("#baseLabel").html("Base: "+format2(base,'$'));
      

      for(i=0;i<aver2.length;i++)
      {
        var row = new Array();
        row["UnidadesSeguro"] = resp.payroll[aver2[i]].Unidades_seguro;
        row["RFC"] = resp.payroll[aver2[i]].Rfc;
        row["CURP"] = resp.payroll[aver2[i]].Curp;
        row["NE"] = resp.payroll[aver2[i]].Num;
        row["Banco"] = resp.payroll[aver2[i]].Banco;
        row["CuentaBancaria"] = resp.payroll[aver2[i]].CuentaBancaria;
        row["Estado"] = resp.payroll[aver2[i]].Estado;
        
        

        row["ER"] = resp.payroll[aver2[i]].ER;
        row["Nombre"] = resp.payroll[aver2[i]].Nombre;
        row["Departamento"] = resp.payroll[aver2[i]].Departamento.trim().substring(0,7);

        row["Pension"] = resp.payroll[aver2[i]].PCENT_Manutencion;
        row["BonoCondicional"] = resp.payroll[aver2[i]].PCENT_Posgrado;
        row["AyudaDeRenta"] = resp.payroll[aver2[i]].PCENT_Ministerial;
        row["BonoDeConyugue"] = resp.payroll[aver2[i]].PCENT_Pulpito;
        row["BonoNavidad"] = resp.payroll[aver2[i]].PCENT_Extraordinaria;
        var suma = row["Pension"]  + row["BonoCondicional"] + row["AyudaDeRenta"] + row["BonoDeConyugue"] + row["BonoNavidad"];
        suma = Math.round(suma * 100) / 100;
        row["TotalDeIngresos"] = suma;
        row["SeguroDeSobreviviente"] = resp.payroll[aver2[i]].Ayuda_renta;
        var totalDIA = suma - row["SeguroDeSobreviviente"];
        totalDIA = Math.round(totalDIA * 100) / 100;
        row["TotalDIA"] = totalDIA;
        var diezmo = parseFloat(row["TotalDeIngresos"])*0.1;
        diezmo = Math.round(diezmo * 100) / 100;
        row["Funcion"] = resp.payroll[aver2[i]].Proyecto;
        row["Diezmo"] = diezmo;

        row["ListaNetaEBP"] = parseFloat(row["TotalDIA"])-diezmo;
        row["ListaNetaEBP"] = Math.round(row["ListaNetaEBP"] * 100) / 100;
        var BUNITACTUAL = $("#BUNITACTUAL").html();
        
        var parteExenta = 12251.20;
        var periodoVer = parseInt($("#delPeriodo").val());
        if(periodoVer<2018002)
        {
          parteExenta = 11474.50;
        }
        if(BUNITACTUAL=="M11" && periodoVer<2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MR1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7355.20;
        }
        if(BUNITACTUAL=="MM1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7350.00;
        }
        if(BUNITACTUAL=="MG1" && periodoVer==2018005)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MM1" && periodoVer==2018001)
        {
          parteExenta = 6884.00
        }
        if(BUNITACTUAL=="MK1" && periodoVer<=2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MS1" && periodoVer<=2018006 && periodoVer>2018001 && (row["ER"] == 'ERBENRA01' || row["ER"] == 'ERGALBE01') )
        {
          parteExenta = 7355.00
        }
        if(periodoVer>=2019002)
        {
          parteExenta = 12842.5;
        }
        row["Exento"] = 0;
        row["Gravado"] = 0;
        if(row["ListaNetaEBP"]<=parteExenta){
          row["Exento"] = row["ListaNetaEBP"];
          row["Gravado"] = 0;
        } else {
          row["Exento"] = parteExenta;
          row["Gravado"] = row["ListaNetaEBP"] -parteExenta;
        }
        row["Exento"] = Math.round(row["Exento"] * 100) / 100;
        row["Gravado"] = Math.round(row["Gravado"] * 100) / 100;
        row["ISRViejito"] = dameISRDeGravado(row["Gravado"]);
        if(row["ER"]=="RCHAAP01")
        {
          row["ISRViejito"] = 0;
        } else {
        row["ISRViejito"] = dameISRDeGravado(row["Gravado"]);
          
        }
        var TotalAPagar = row["ListaNetaEBP"] - row["ISRViejito"];
        TotalAPagar = Math.round(TotalAPagar * 100) / 100;
        row["TotalAPagar"] = TotalAPagar;
        if(row["Departamento"]=="EMERITO")
        {
          totalPension+=row["Pension"];
          totalDiezmo+=row["Diezmo"];
          totalBonoCondicional+=row["BonoCondicional"];
          totalAyudaDeRenta+=row["AyudaDeRenta"];
          totalBonoDeConyugue+=row["BonoDeConyugue"];
          totalBonoNavidad+=row["BonoNavidad"];

          totalTotalDeIngresos+=row["TotalDeIngresos"];
          totalSeguroDeSobreviviente+=row["SeguroDeSobreviviente"];
          totalTotalDIA+=row["TotalDIA"];
          totalListaNetaEBP+=row["ListaNetaEBP"];
          totalExento+=row["Exento"];
          totalGravado+=row["Gravado"];
          totalISRViejitos+=row["ISRViejito"];
          totalTotalAPagar+=row["TotalAPagar"];
          
          data.push(row);
        }
      }
      var row = new Array();
      totalPension = Math.round(totalPension * 100) / 100;
      totalTotalAPagar = Math.round(totalTotalAPagar * 100) / 100;
      totalDiezmo = Math.round(totalDiezmo * 100) / 100;
      totalBonoCondicional = Math.round(totalBonoCondicional * 100) / 100;
      totalAyudaDeRenta = Math.round(totalAyudaDeRenta * 100) / 100;
      totalBonoDeConyugue = Math.round(totalBonoDeConyugue * 100) / 100;
      totalBonoNavidad = Math.round(totalBonoNavidad * 100) / 100;
      totalTotalDeIngresos = Math.round(totalTotalDeIngresos * 100) / 100;
      totalSeguroDeSobreviviente = Math.round(totalSeguroDeSobreviviente * 100) / 100;
      totalTotalDIA = Math.round(totalTotalDIA * 100) / 100;
      totalListaNetaEBP = Math.round(totalListaNetaEBP * 100) / 100;
      totalExento = Math.round(totalExento * 100) / 100;
      totalGravado = Math.round(totalGravado * 100) / 100;
      totalISRViejitos = Math.round(totalISRViejitos * 100) / 100;

      row["Pension"] = totalPension;
      row["TotalAPagar"] = totalTotalAPagar;
      row["BonoCondicional"] = totalBonoCondicional;
      row["AyudaDeRenta"] = totalAyudaDeRenta;
      row["BonoDeConyugue"] = totalBonoDeConyugue;
      row["BonoNavidad"] = totalBonoNavidad;
      row["TotalDeIngresos"] = totalTotalDeIngresos;
      row["SeguroDeSobreviviente"] = totalSeguroDeSobreviviente;
      row["TotalDIA"] = totalTotalDIA;
      row["ListaNetaEBP"] = totalListaNetaEBP;
      row["Exento"] = totalExento;
      row["Gravado"] = totalGravado;
      row["Diezmo"] = totalDiezmo;
      row["ISRViejito"] = totalISRViejitos;
      row["Nombre"] = "";
      row["Departamento"] = "TOTALES:";
      row["ER"] = "";
      data.push(row);
      hot.loadData(data);
      hot.selectCell(guardaFila,guardaColumna);
    }
  });
}
function initializePayrollTable() {
  var siNo = new Array();
  siNo.push("NO");
  siNo.push("SI");

  var cincoDiez = new Array();
  cincoDiez.push("0");
  cincoDiez.push("5");
  cincoDiez.push("10");
  
           
  var hotElement = document.querySelector('#hot');
  var hotElementContainer = hotElement.parentNode;
  var hotSettings = {
    //data: dataObject,
    columns: [
      {
        data: 'ER',
        type: 'text',
        editor: false,
        width: 1
      },
      {
        data: 'Nombre',
        type: 'text',
        editor: false,
        width: 350
      },
      {
        data: 'Status',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'Departamento',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'SueldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 100
      },
      {
        data: 'PosgradoPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'SobreSueldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 40
      },
      {
        data: 'DepPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'AguinaldoPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'PrimaVacacionalPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'tiempoLaborPcent',
        type: 'text',
        editor: 'numeric',
        width: 80
      },
      {
        data: 'DescontarDiezmoDeRentaAntesDeLaBaseGravable',
        type: 'dropdown',
        source: siNo, 
        width: 300
      },
      {
        data: 'Sueldos',
        type: 'text',
        editor: false,
        width: 70
      },
      {
        data: 'Posgrado',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'SS',
        type: 'text',
        editor: false,
        width: 80
      },
      {
        data: 'Depre',
        type: 'numeric',
        editor: false,
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Renta_Integrada',
        type: 'numeric',
        editor: 'numeric',
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'TotalIngresosMensuales',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoManutencionDescontadoDeBaseGravable',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoBonosDescontadoDeBaseGravable',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'DiezmoDeLaRenta',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'RentaPcent',
        type: 'text',
        editor: false,
        width: 110
      },
      {
        data: 'IncapacidadYSalud',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'AFROUMN',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'TotalDeDescuentosAntesDeLaBase',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'ManutencionParaCalculoISRAsimilableASalarios',
        type: 'text',
        editor: false,
        width: 300
      },
      {
        data: 'Aguinaldo',
        type: 'text',
        editor: false,
        width: 90
      },
      {
        data: 'Prima',
        type: 'text',
        editor: false,
        width: 90
      },
      {
        data: 'CasaDeGobierno',
        type: 'numeric',
        editor: 'numeric',
        width: 100,
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'CasaAsociacionUnion',
        type: 'dropdown',
        source: siNo, 
        width: 150
      },
      {
        data: 'RentaAdelantada',
        type: 'dropdown',
        source: siNo, 
        width: 150
      },
      {
        data: 'PcentDescRenta',
        type: 'dropdown',
        source: cincoDiez, 
        width: 150
      },
      {
        data: 'Exento',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Gravado',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'GravadoConBonos',
        type: 'numeric',
        format: '$0,0.00',
        editor: false,
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'ISRMinistro',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        width: 90,
        language: 'en',
        numericFormat: {
          pattern: '0.00'
        }
      },
      {
        data: 'Proyecto',
        type: 'text',
        editor: 'text',
        width: 110
      },
      {
        data: 'RFC',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'CURP',
        type: 'text',
        editor: false,
        width: 150
      },
      {
        data: 'NE',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'Banco',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'CuentaBancaria',
        type: 'text',
        editor: false,
        width: 100
      },
      {
        data: 'Estado',
        type: 'text',
        editor: false,
        width: 30
      },
      {
        data: 'ViajesRegular',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      },
      {
        data: 'ViajesEspecial',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      },
      {
        data: 'ViajesEsposa',
        type: 'numeric',
        format: '$0,0.00',
        editor: 'numeric',
        numericFormat: {
          pattern: '0.00'
        },
        width: 130
      }
    ],
    stretchH: 'all',
    width: screen.width-0,
    autoWrapRow: true,
    height: 887,
    maxRows: 700,
    manualRowResize: true,
    manualColumnResize: true,
    rowHeaders: true,
    hiddenColumns: {
      columns: [0],
      indicators: false
    },
    fixedColumnsLeft: 2,
    colHeaders: [
      'ER',
      'Nombre',
      'Status',
      'Departamento',
      '% Sueldo',
      '% Posgrado',
      '% SS',
      '% Dep',
      '% Aguinaldo',
      '% Prima vacacional',
      '% tiempo de labor',
      'Descontar Diezmo De Renta Antes De La Base Gravable',
      'Sueldos',
      'Posgrado',
      'SS',
      'Depre',
      'Renta integrada',
      'TotalIngresosMensuales integrada',
      'Diezmo Manutencion Descontado De Base Gravable',
      'Diezmo Bonos Descontado De Base Gravable',
      'Diezmo de Renta',
      '% Renta',
      'Incapacidad y Salud',
      'FOBONO',
      'Total de descuentos antes de la base',
      'Manutencion para calculo ISR Asimilables a salarios',
      'Aguinaldo',
      'Prima',
      'Casa de gobierno',
      'Integrar bonos?',
      'Renta adelantada?',
      '% Desc. Renta',
      'Exento',
      'Gravado',
      'GravadoConBonos',
      'ISR Ministros',
      'Funcion',
      'RFC',
      'CURP',
      'N.E.',
      'Banco',
      'Cuenta Bancaria',
      'Estado',
      'Viajes Regular',
      'Viajes Especial',
      'Viajes Esposa'
    ],
    afterChange: function(changes, source) {
      if(source=="edit")
      {
        var fila = changes[0][0];
        var columna = changes[0][1];
        guardaFila = fila;
        guardaColumna = columna;
        var comoEstaba = changes[0][2];
        var comoEstaAhora = changes[0][3];
        var ER = hot.getDataAtCell(fila,0);
        var sueldoPCent = hot.getDataAtCell(fila,4);
        var posgradoPCent = hot.getDataAtCell(fila,5);
        var sobrePcent = hot.getDataAtCell(fila,6);
        var deprePcent = hot.getDataAtCell(fila,7);
        var aguinaldoPcent = hot.getDataAtCell(fila,8);
        var primaPcent = hot.getDataAtCell(fila,9);
        var tiempoDeLabor = hot.getDataAtCell(fila,10);
        var descontarDiezmoDeRentaAntesDeLaBaseGravable = hot.getDataAtCell(fila,11);
        var RentaIntegrada = hot.getDataAtCell(fila,16);


        var CasaDeGobierno = hot.getDataAtCell(fila,28);
        var CasaAsociacionUnion = hot.getDataAtCell(fila,29);
        var RentaAdelantada = hot.getDataAtCell(fila,30);
        var PcentDescRenta = hot.getDataAtCell(fila,31);
        var Proyecto = hot.getDataAtCell(fila,36);

        var ViajesRegular = hot.getDataAtCell(fila,43);
        var ViajesEspecial = hot.getDataAtCell(fila,44);
        var ViajesEsposa = hot.getDataAtCell(fila,45);

        var param = {
          ER : ER,
          sueldoPCent : sueldoPCent,
          posgradoPCent : posgradoPCent,
          sobrePcent : sobrePcent,
          deprePcent : deprePcent,
          aguinaldoPcent : aguinaldoPcent,
          primaPcent : primaPcent,
          tiempoDeLabor : tiempoDeLabor,
          descontarDiezmoDeRentaAntesDeLaBaseGravable : descontarDiezmoDeRentaAntesDeLaBaseGravable,
          RentaIntegrada : RentaIntegrada,
          CasaDeGobierno : CasaDeGobierno,
          CasaAsociacionUnion : CasaAsociacionUnion,
          RentaAdelantada : RentaAdelantada,
          PcentDescRenta : PcentDescRenta,
          Proyecto : Proyecto,
          ViajesRegular : ViajesRegular,
          ViajesEspecial : ViajesEspecial,
          ViajesEsposa : ViajesEsposa
        };
        $.ajax({
          url: "/modificaPersonaPayroll",
          dataType : "json",
          type : "post",
          async : true,
          data : param,
          beforeSend : function (){
            $("#cambiaMensaje").html("Guardando cambios...");
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              $("#cambiaMensaje").html("Todos los cambios guardados");
              //initializePayrollTable();
            }
          }
        });
      }
    },
    manualRowMove: true,
    manualColumnMove: true,
    contextMenu: true,
    filters: true,
    dropdownMenu: true
  };
  hot = new Handsontable(hotElement, hotSettings);
  var param = {diarioAnterior : 1};
  $.ajax({
    url: "/datosPayroll",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var data = new Array();
      var aver2 = Object.keys(resp.payroll);
      var i;
      var base = resp.base;
      $("#base").html(base);
      $("#baseLabel").html("Base: "+format2(base,'$'));
      

      for(i=0;i<aver2.length;i++)
      {
        var row = new Array();
        row["RFC"] = resp.payroll[aver2[i]].Rfc;
        row["CURP"] = resp.payroll[aver2[i]].Curp;
        row["NE"] = resp.payroll[aver2[i]].Num;
        row["Banco"] = resp.payroll[aver2[i]].Banco;
        row["CuentaBancaria"] = resp.payroll[aver2[i]].CuentaBancaria;
        row["Estado"] = resp.payroll[aver2[i]].Estado;
        
        row["CasaDeGobierno"] = parseFloat(resp.payroll[aver2[i]].Ayuda_renta);
        row["CasaAsociacionUnion"] = resp.payroll[aver2[i]].Casa_Campo;
        row["RentaAdelantada"] = resp.payroll[aver2[i]].Renta_Adelantada;
        row["PcentDescRenta"] = parseInt(resp.payroll[aver2[i]].PCENT_Descuento_Renta);
        row["CasaDeGobierno"] = Math.round(row["CasaDeGobierno"] * 100) / 100;


        row["ER"] = resp.payroll[aver2[i]].ER;
        row["Nombre"] = resp.payroll[aver2[i]].Nombre;
        row["Departamento"] = resp.payroll[aver2[i]].Departamento.trim().substring(0,8);
        row["SueldoPcent"] = resp.payroll[aver2[i]].PCENT_Manutencion;
        row["PosgradoPcent"] = resp.payroll[aver2[i]].PCENT_Posgrado;
        row["SobreSueldoPcent"] = resp.payroll[aver2[i]].PCENT_Ministerial;
        row["DepPcent"] = resp.payroll[aver2[i]].PCENT_Pulpito;
        row["AguinaldoPcent"] = resp.payroll[aver2[i]].PCENT_Extraordinaria;
        row["PrimaVacacionalPcent"] = resp.payroll[aver2[i]].PCENT_Extraordinaria_Prima;
        row["tiempoLaborPcent"] = resp.payroll[aver2[i]].PCENT_tiempolabor;
        row["Sueldos"] = base * (parseFloat(row["SueldoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["Posgrado"] = base * (parseFloat(row["PosgradoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["SS"] = base * (parseFloat(row["SobreSueldoPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["Depre"] = base * (parseFloat(row["DepPcent"])/100) * (parseFloat(row["tiempoLaborPcent"])/100);
        row["DescontarDiezmoDeRentaAntesDeLaBaseGravable"] = resp.payroll[aver2[i]].DescontarDiezmoDeRentaAntesDeLaBaseGravable;
        row["Renta_Integrada"] = resp.payroll[aver2[i]].Renta_Integrada;
        var cuatroCosas = row["Sueldos"] + row["Posgrado"] + row["SS"] + row["Depre"];
        var aguinaldo = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["PosgradoPcent"])/100) +(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * (parseFloat(row["AguinaldoPcent"])/100);
        var prima = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["PosgradoPcent"])/100) +(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * (parseFloat(row["PrimaVacacionalPcent"])/100);
         var numMeses = 12;
        var BUNITACTUAL = $("#BUNITACTUAL").html();
        
        if(row["ER"]=="ERRIOEL01" && BUNITACTUAL=="MU1")
        {
          numMeses=6;
          console.log("MIRA; le puse 6 como num de meses a ERRIOEL01")
        }
        if(row["ER"]=="ERMARNI01" && BUNITACTUAL=="MM1")
            {
              numMeses=12;
            }
            if(row["ER"]=="ERZARLU01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }
            if(row["ER"]=="ERHEROB01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }

        if(row["ER"]=="ERHEROB01" && BUNITACTUAL=="MM1")
            {
              numMeses=3;
            }
        if(row["ER"]=="ERGUIOS01" && BUNITACTUAL=="M41")
        {
          numMeses=4;
        }
        
        if(row["ER"]=="EROROLU01" && BUNITACTUAL=="MU1")
        {
          numMeses=8;
        }
        if(row["ER"]=="ERCORIV01" && BUNITACTUAL=="MU1")
        {
          numMeses=8;
        }
        aguinaldo = aguinaldo * numMeses / 12;
        prima = prima * numMeses / 12;
        aguinaldo = Math.round(aguinaldo * 100) / 100;
        prima = Math.round(prima * 100) / 100;
        
        
        row["Aguinaldo"] = aguinaldo;
        row["Prima"] = prima;

        row["TotalIngresosMensuales"] = cuatroCosas + row["Renta_Integrada"] ;
//Renta_Integrada
       

        row["DiezmoManutencionDescontadoDeBaseGravable"] = cuatroCosas * 0.1;
        row["DiezmoBonosDescontadoDeBaseGravable"] = ((prima+aguinaldo) / numMeses) * 0.1;
        //DiezmoDeLaRenta
        if(row["DescontarDiezmoDeRentaAntesDeLaBaseGravable"]=="SI")
        {
          row["DiezmoDeLaRenta"] = row["CasaDeGobierno"] * 0.1;
        }
        row["RentaPcent"] = row["CasaDeGobierno"] * (row["PcentDescRenta"] / 100);
        row["IncapacidadYSalud"] = base * ( (parseFloat(row["SueldoPcent"])/100)+(parseFloat(row["SobreSueldoPcent"])/100))    * (parseFloat(row["tiempoLaborPcent"])/100) * 5.5/100 * 25/100;
        var periodoVer = parseInt($("#delPeriodo").val());
        if(periodoVer>=2019001)
        {
          row["AFROUMN"] = base * ( (parseFloat(row["SueldoPcent"])/100) ) * 2.9/100 ;
        
        }
        else
        {
          row["AFROUMN"] = base * ( (parseFloat(row["SueldoPcent"])/100) ) * 2.75/100 ;
        
        }
        
        row["AFROUMN"] = Math.round(row["AFROUMN"] * 100) / 100;   
        row["IncapacidadYSalud"] = Math.round(row["IncapacidadYSalud"] * 100) / 100;
        var BUNITACTUAL = $("#BUNITACTUAL").html();
        //y aqui empiezo con mis hardcodes... jeje perdon {
        if(BUNITACTUAL=="MS1" &&  ( resp.payroll[aver2[i]].ER=="ERPEREN01" || resp.payroll[aver2[i]].ER=="ERJIMMA01"  ) )
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MG1" && ( resp.payroll[aver2[i]].ER=="ERHERAL01" || resp.payroll[aver2[i]].ER=="ERHERAL01" || resp.payroll[aver2[i]].ER=="ERTORAB01" || resp.payroll[aver2[i]].ER=="ERALVJA01" || resp.payroll[aver2[i]].ER=="ERMUÑIS01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MR1" && ( resp.payroll[aver2[i]].ER=="ERJIMMA01" || resp.payroll[aver2[i]].ER=="ERJIMMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MM1" && ( resp.payroll[aver2[i]].ER=="ERDAVSA01" || resp.payroll[aver2[i]].ER=="ERHEROB01" || resp.payroll[aver2[i]].ER=="ERPIMAR01" || resp.payroll[aver2[i]].ER=="ERVARJO01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MN1" && ( resp.payroll[aver2[i]].ER=="ERCAHMA01" || resp.payroll[aver2[i]].ER=="ERPERDA01"   || resp.payroll[aver2[i]].ER=="ERSAROF01"   || resp.payroll[aver2[i]].ER=="ERCONVI01"   || resp.payroll[aver2[i]].ER=="ERAYOCA01" || resp.payroll[aver2[i]].ER=="ERBERMI01" || resp.payroll[aver2[i]].ER=="ERFIGED01" || resp.payroll[aver2[i]].ER=="ERLOPYE01" || resp.payroll[aver2[i]].ER=="ERXL01" || resp.payroll[aver2[i]].ER=="ERCASER01" || resp.payroll[aver2[i]].ER=="ERDELYA01"  || resp.payroll[aver2[i]].ER=="ERLOZAN01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MU1" && ( resp.payroll[aver2[i]].ER=="ERPONED01" || resp.payroll[aver2[i]].ER=="ERPONED01"))
        {
          row["AFROUMN"] = 0.0;
          //row["IncapacidadYSalud"] = 0.0;
        }
         if(BUNITACTUAL=="MK1" && ( resp.payroll[aver2[i]].ER=="ERROJAB01" || resp.payroll[aver2[i]].ER=="ERLOPRE01" || resp.payroll[aver2[i]].ER=="ERZEPAB01" || resp.payroll[aver2[i]].ER=="ERCONDA01" || resp.payroll[aver2[i]].ER=="ERREYJO01" ))
        {
          row["AFROUMN"] = 0.0;
        // row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MS1" && ( resp.payroll[aver2[i]].ER=="ERSANJE01" || resp.payroll[aver2[i]].ER=="ERSANJE01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        if(BUNITACTUAL=="MUR" && ( resp.payroll[aver2[i]].ER=="ERSAUMA01" || resp.payroll[aver2[i]].ER=="ERSAUMA01"))
        {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }


        if(resp.payroll[aver2[i]].ER=="ERALPNO01" || resp.payroll[aver2[i]].ER=="ERAGURA01"  || resp.payroll[aver2[i]].ER=="ERNUÑJO01" || resp.payroll[aver2[i]].ER=="ERNUDJO01"  || resp.payroll[aver2[i]].ER=="ERMORAB01" ) {
          row["AFROUMN"] = 0.0;
          row["IncapacidadYSalud"] = 0.0;
        }
        //y aqui termino con mis hardcodes... jeje perdon }

        row["DiezmoBonosDescontadoDeBaseGravable"] = Math.round(row["DiezmoBonosDescontadoDeBaseGravable"] * 100) / 100;
        row["DiezmoDeLaRenta"] = Math.round(row["DiezmoDeLaRenta"] * 100) / 100;
        row["RentaPcent"] = Math.round(row["RentaPcent"] * 100) / 100;
        
        if(isNaN(row["DiezmoDeLaRenta"]))
        {
          row["DiezmoDeLaRenta"] = 0;
        }

        row["DiezmoManutencionDescontadoDeBaseGravable"] = Math.round(row["DiezmoManutencionDescontadoDeBaseGravable"] * 100) / 100;


        row["TotalDeDescuentosAntesDeLaBase"] = 0;
        if(!isNaN(row["AFROUMN"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["AFROUMN"];
        }
        if(!isNaN(row["IncapacidadYSalud"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["IncapacidadYSalud"];
        }
        if(!isNaN(row["RentaPcent"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["RentaPcent"];
        }
        if(!isNaN(row["DiezmoDeLaRenta"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoDeLaRenta"];
        }
        if(!isNaN(row["DiezmoBonosDescontadoDeBaseGravable"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoBonosDescontadoDeBaseGravable"];
        }
        if(!isNaN(row["DiezmoManutencionDescontadoDeBaseGravable"]))
        {
          row["TotalDeDescuentosAntesDeLaBase"] += row["DiezmoManutencionDescontadoDeBaseGravable"];
        }
        row["TotalDeDescuentosAntesDeLaBase"] = Math.round(row["TotalDeDescuentosAntesDeLaBase"] * 100) / 100;
        

 
        //7350.72
        row["ManutencionParaCalculoISRAsimilableASalarios"] = row["TotalIngresosMensuales"]  - row["TotalDeDescuentosAntesDeLaBase"] ;

        row["ManutencionParaCalculoISRAsimilableASalarios"] = Math.round(row["ManutencionParaCalculoISRAsimilableASalarios"] * 100) / 100;
        var parteExenta = 12251.20;
        if(periodoVer<2018002)
        {
          parteExenta = 11474.50;
        }
        if(BUNITACTUAL=="M11" && periodoVer<2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MR1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7355.20;
        }
        if(BUNITACTUAL=="MM1" && periodoVer<=2018006 && periodoVer>2018001)
        {
          parteExenta = 7350.00;
        }
        if(BUNITACTUAL=="MG1" && periodoVer==2018005)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MM1" && periodoVer==2018001)
        {
          parteExenta = 6884.00
        }
        if(BUNITACTUAL=="MK1" && periodoVer<=2018004 && periodoVer>2018001)
        {
          parteExenta = 12251.20;
        }
        if(BUNITACTUAL=="MS1" && periodoVer<=2018006 && periodoVer>2018001 && (row["ER"] == 'ERBENRA01' || row["ER"] == 'ERGALBE01') )
        {
          parteExenta = 7355.00
        }
        if(periodoVer>=2019002)
        {
          parteExenta = 12842.5;
        }
        var sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 0;
        if(periodoVer<=2018005 && periodoVer>=2018001 && BUNITACTUAL!="MR1" && BUNITACTUAL != "MM1")
        {
          sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 2450.24 * 2;
          if(periodoVer==2018001)
          {
            sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas = 2294.9 * 2;
            
          }
        }
        row["Exento"] = 0;
        row["ViajesRegular"] = parseFloat(resp.payroll[aver2[i]].ViajesRegular);
        row["ViajesEspecial"] = parseFloat(resp.payroll[aver2[i]].ViajesEspecial);
        row["ViajesEsposa"] = parseFloat(resp.payroll[aver2[i]].ViajesEsposa);
        
        row["Gravado"] = 0;
        if(row["ManutencionParaCalculoISRAsimilableASalarios"]<=parteExenta){
          row["Exento"] = row["ManutencionParaCalculoISRAsimilableASalarios"];
          row["Gravado"] = 0;
        } else {
          row["Exento"] = parteExenta;
          row["Gravado"] = row["ManutencionParaCalculoISRAsimilableASalarios"] -parteExenta+row["ViajesEsposa"] +row["ViajesEspecial"]+row["ViajesRegular"];
        }
        //row["Gravado"] = row["Gravado"] + row["ViajesRegular"]  + row["ViajesEspecial"] + row["ViajesEsposa"];
        
        var sumaleTodoViajes = row["Gravado"] + sumarAParteGrabadaPorAjusteDeFacilidadDe5Umas;
        sumaleTodoViajes = Math.round(sumaleTodoViajes * 100) / 100;
        row["GravadoConBonos"] = sumaleTodoViajes;
        row["ISRMinistro"] = dameISRDeGravado(sumaleTodoViajes);
        if(periodoVer<2018002)
        {
          //row["ISRMinistro"] = dameISRDeGravado2017(row["Gravado"]);
          row["ISRMinistro"] = dameISRDeGravado(sumaleTodoViajes);
        }
        row["Proyecto"] = resp.payroll[aver2[i]].Proyecto;
        if(row["Departamento"]=="MINISTRO")
        {
          data.push(row);
        }
      }
      hot.loadData(data);
      hot.selectCell(guardaFila,guardaColumna);
      
      // update spreadsheet setting
     /* var rows=hot.countRows();  // get the count of the rows in the table
      var cols=hot.countCols();  // get the count of the columns in the table.
      for(var row=0; row<rows; row++){  // go through each row of the table
          for(var col=0; col<cols; col++){  // go through each column of the row

             if (col==25)
            {
              var cell = hot.getCell(row,col);                                  
              cell.style.backgroundColor = "#00FF00";
            }
            if (col==32)
            {
              var cell = hot.getCell(row,col);                                  
              cell.style.backgroundColor = "#FE2EF7";
            }
            if (col==33)
            {
              var cell = hot.getCell(row,col);                                  
              cell.style.backgroundColor = "#F7FE2E";
            }  
          }
      }
      hot.render(); */

      /*hot.updateSettings({
        cells: function (row, col, prop) {  
          if(row%2==0)
          {
             var cell = hot.getCell(row,col);                                  
            cell.style.backgroundColor = "#E6E6E6";
          } 
                             
        }
      });
      */

    }
  });
}
function dameSubsidio(gravado) {
  if (gravado==0.00)
  {
    return 0.0;
  }
  var cuotaFija = 0;
  if(gravado<=1768.96)
  {
    cuotaFija = 407.02;
  } else{
    if(gravado<= 2653.38)
    {
      cuotaFija = 406.83;
    } else{
      if(gravado<= 3472.84)
      {
        cuotaFija =  406.62;
      } else{
        if(gravado<= 3537.87)
        {
          cuotaFija = 392.77;
        } else{
          if(gravado<= 4446.15)
          {
            cuotaFija =  382.46;
          } else{
            if(gravado<= 4717.18)
            {
              cuotaFija =  354.23;
            } else{
              if(gravado<= 5335.42)
              {
                cuotaFija =  324.87;
              } else{
                if(gravado<= 6224.67)
                {
                  cuotaFija = 294.63;
                } else{
                  if(gravado<= 7113.90)
                  {
                    cuotaFija = 253.54;
                  } else{
                    if(gravado<=7382.33)
                    {
                      cuotaFija = 217.61;
                    } else{
                      cuotaFija = 0;
                    }
                    
                  }   
                } 
              } 
            }    
          }  
        }
      } 
    }  
  } 
  return cuotaFija;
}

function dameISRDeGravado2017(gravado) {
  if (gravado==0.00)
  {
    return 0.0;
  }
  var limiteInferior = 0;
  var pcent = 0;
  var cuotaFija = 0;
  if(gravado<=496.07)
  {
    limiteInferior = 0.01;
    cuotaFija = 0;
    pcent = 1.92;
  } else{
    if(gravado<=4210.41)
    {
      limiteInferior = 496.08;
      cuotaFija = 9.52;
      pcent = 6.40;
    } else{
      if(gravado<=7399.42)
      {
        limiteInferior = 4210.42;
        cuotaFija = 247.24;
        pcent = 10.88;
      } else{
        if(gravado<=8601.50)
        {
          limiteInferior = 7399.43;
          cuotaFija = 594.21;
          pcent = 16.00;
        } else{
          if(gravado<=10298.35)
          {
            limiteInferior = 8601.51;
            cuotaFija = 786.54;
            pcent = 17.92;
          } else{
            if(gravado<=20770.29)
            {
              limiteInferior = 10298.36;
              cuotaFija = 1090.61;
              pcent = 21.36;
            } else{
              if(gravado<=32736.83)
              {
                limiteInferior = 20770.30;
                cuotaFija = 3327.42;
                pcent = 23.52;
              } else{
                if(gravado<=62500.00)
                {
                  limiteInferior = 32736.84;
                  cuotaFija = 6141.95;
                  pcent = 30.00;
                } else{
                  if(gravado<=83333.33)
                  {
                    limiteInferior = 62500.01;
                    cuotaFija = 15070.90;
                    pcent = 32.00;
                  } else{
                    //no creo que alguien gane mas jeje, espero :P
                  }   
                } 
              } 
            }    
          }  
        }
      } 
    }  
  } 
  var aux = ((gravado - limiteInferior) * (pcent/100)) + cuotaFija;
  aux = Math.round(aux * 100) / 100;
  return aux;
}

function dameISRDeGravado(gravado) {
  if (gravado==0.00)
  {
    return 0.0;
  }
  var limiteInferior = 0;
  var pcent = 0;
  var cuotaFija = 0;
  if(gravado<=578.52)
  {
    limiteInferior = 0.01;
    cuotaFija = 0;
    pcent = 1.92;
  } else{
    if(gravado<=4910.18)
    {
      limiteInferior = 578.53;
      cuotaFija = 11.11;
      pcent = 6.40;
    } else{
      if(gravado<=8629.20)
      {
        limiteInferior = 4910.19;
        cuotaFija = 288.33;
        pcent = 10.88;
      } else{
        if(gravado<=10031.07)
        {
          limiteInferior = 8629.21;
          cuotaFija = 692.96;
          pcent = 16.00;
        } else{
          if(gravado<=12009.94)
          {
            limiteInferior = 10031.08;
            cuotaFija = 917.26;
            pcent = 17.92;
          } else{
            if(gravado<=24222.31)
            {
              limiteInferior = 12009.95;
              cuotaFija = 1271.87;
              pcent = 21.36;
            } else{
              if(gravado<=38177.69)
              {
                limiteInferior = 24222.32;
                cuotaFija = 3880.44;
                pcent = 23.52;
              } else{
                if(gravado<=72887.50)
                {
                  limiteInferior = 38177.70;
                  cuotaFija = 7162.74;
                  pcent = 30.00;
                } else{
                  if(gravado<=97183.33)
                  {
                    limiteInferior = 72887.51;
                    cuotaFija = 17575.69;
                    pcent = 32.00;
                  } else{
                    //no creo que alguien gane mas jeje, espero :P
                  }   
                } 
              } 
            }    
          }  
        }
      } 
    }  
  }
  if(gravado==21444.96)
  {
    console.log(gravado);   
    console.log(limiteInferior);  
    console.log(pcent);   
    console.log(cuotaFija);   
  }
  
  var aux = ((gravado - limiteInferior) * (pcent/100)) + cuotaFija;
  //aux = roundNumberV2(aux);
  aux = Math.round(aux * 100) / 100;
  return aux;
}

function dameISRDeGravado2019(gravado) {
  if (gravado==0.00)
  {
    return 0.0;
  }
  var limiteInferior = 0;
  var pcent = 0;
  var cuotaFija = 0;
  if(gravado<=578.52)
  {
    limiteInferior = 0.01;
    cuotaFija = 0;
    pcent = 1.92;
  } else{
    if(gravado<=4910.18)
    {
      limiteInferior = 578.53;
      cuotaFija = 11.11;
      pcent = 6.40;
    } else{
      if(gravado<=8629.20)
      {
        limiteInferior = 4910.19;
        cuotaFija = 288.33;
        pcent = 10.88;
      } else{
        if(gravado<=10031.07)
        {
          limiteInferior = 8629.21;
          cuotaFija = 692.96;
          pcent = 16.00;
        } else{
          if(gravado<=12009.94)
          {
            limiteInferior = 10031.08;
            cuotaFija = 917.26;
            pcent = 17.92;
          } else{
            if(gravado<=24222.31)
            {
              limiteInferior = 12009.95;
              cuotaFija = 1271.87;
              pcent = 21.36;
            } else{
              if(gravado<=38177.69)
              {
                limiteInferior = 24222.32;
                cuotaFija = 3880.44;
                pcent = 23.52;
              } else{
                if(gravado<=72887.50)
                {
                  limiteInferior = 38177.70;
                  cuotaFija = 7162.74;
                  pcent = 30.00;
                } else{
                  if(gravado<=97183.33)
                  {
                    limiteInferior = 72887.51;
                    cuotaFija = 17575.69;
                    pcent = 32.00;
                  } else{
                    //no creo que alguien gane mas jeje, espero :P
                  }   
                } 
              } 
            }    
          }  
        }
      } 
    }  
  }
  if(gravado==21444.96)
  {
    console.log(gravado);   
    console.log(limiteInferior);  
    console.log(pcent);   
    console.log(cuotaFija);   
  }
  
  var aux = ((gravado - limiteInferior) * (pcent/100)) + cuotaFija;
  //aux = roundNumberV2(aux);
  aux = Math.round(aux * 100) / 100;
  return aux;
}

function round2() {
  var number5 = parseFloat(document.getElementById("number5").value);
  var scale5 = parseFloat(document.getElementById("scale5").value);
  document.getElementById("roundedNumber5").value = roundNumberV1(number5, scale5);
}

function roundNumberV1(num, scale) {
  if(!("" + num).includes("e")) {
    return +(Math.round(num + "e+" + scale)  + "e-" + scale);  
  } else {
    var arr = ("" + num).split("e");
    var sig = ""
    if(+arr[1] + scale > 0) {
      sig = "+";
    }
    var i = +arr[0] + "e" + sig + (+arr[1] + scale);
    var j = Math.round(i);
    var k = +(j + "e-" + scale);
    return k;  
  }
}

function roundNumberV2(num, scale) {
  if (Math.round(num) != num) {
    if (Math.pow(0.1, scale) > num) {
      return 0;
    }
    var sign = Math.sign(num);
    var arr = ("" + Math.abs(num)).split(".");
    if (arr.length > 1) {
      if (arr[1].length > scale) {
        var integ = +arr[0] * Math.pow(10, scale);
        var dec = integ + (+arr[1].slice(0, scale) + Math.pow(10, scale));
        var proc = +arr[1].slice(scale, scale + 1)
        if (proc >= 5) {
          dec = dec + 1;
        }
        dec = sign * (dec - Math.pow(10, scale)) / Math.pow(10, scale);
        return dec;
      }
    }
  }
  return num;
}

$(document).on("click", "#payrollAsociados", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Payroll Manutenci&oacute;n de Asociados Religiosos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div id="base" style="display:none;"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Payroll de Manutenci&oacute;n<small> de Asociados Religiosos</small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control actualizaPayrollAsociados" style="font-size:16px;" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                    '<a href="javascript:void(0)" class="vesAlSDI" id="vesAlSDI" periodo="2014012"><button type="submit" class="btn btn-success">Ver SDI del Mes</button></a>'+
                    '</div>'+
                    '<div class="form-group" id="hotNO">'+
                      '<label id="cambiaMensaje"></label><br>'+
                      '<label id="baseLabel">Base: </label>'+
                    '</div>'+
                    '<div class="form-group" id="hot" style="font-size:16px;">'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" tipo="1" id="generarPreContabilizacionClientSide" class="btn btn-success">Generar Prepoliza</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead id="headPreManutencion"></thead><tbody id="tablaContabilizarManutencion"></tbody></table>'+
                      '</div>'+
                      '<br><hr><br>'+
                    '<table class="table table-striped" style="text-align:center; font-size:18px;"><tbody id="contabilizarManuntencionTable"></tbody></table>'+
                    '<br><hr><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="submit" cad="" id="contabilizarManutencionMinistros" class="btn btn-warning">Contabilizar</button>'+
                      '</div>'+
                      '<div class="col-md-8 col-sm-8 col-xs-8">'+
                        '<button type="submit" id="generarTablaDeTimbradoManutencionMinistros" class="btn btn-success">Generar tabla de timbrado</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="tablaTimbrado">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12"></div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/damePeriodos",
        dataType : "json",
        type : "post",
        async : true,
        data : {},
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          var i;
          var cad = '';//'<select style="font-size:16px;" id="selectPeriodos">'
          for(i=0;i<aver2.length;i++)
          {
            if(i==0){
              $("#vesAlSDI").attr("periodo",aver2[i]);
            }
            cad = cad + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
          }
          var BUNITACTUAL = $("#BUNITACTUAL").html();
          
          
          //cad = cad + '</select>';
          $('#delPeriodo').html(cad);
          $('#delPeriodo').attr("folio",resp.folio);
          $('#delPeriodo').attr("date",resp.date);
          $('#delPeriodo').attr("rfc",resp.rfc);
          $('#delPeriodo').attr("regimen",resp.regimen);
          $('#delPeriodo').attr("razonSocial",resp.razonSocial);
          $('#delPeriodo').attr("regPatronal",resp.regPatronal);
          $('#delPeriodo').attr("lugarExpedicion",resp.lugarExpedicion);
          initializePayrollTableAsociados();  
        }
      });
          
});



$(document).on("change", "#selectCampoPayroll", function (){
  initializePayrollTableEmeritos();
});

$(document).on("change", ".actualizaPayrollEmeritos", function (){
  initializePayrollTableEmeritos();
});


$(document).on("change", ".actualizaPayroll", function (){
  initializePayrollTable();
});

$(document).on("change", ".actualizaPayrollAsociados", function (){
  var periodo = $(this).val();
  $("#vesAlSDI").attr("periodo",periodo);
  initializePayrollTableAsociados();
});
$(document).on("click", "#viejitosDimensiones", function (){
  var BUNIT = $("#selectCampoPayroll").val();
  var param = { BUNIT : BUNIT};
  $.ajax({
      url: "/creaDetallesParaViejitos",
      dataType : "json",
      type : "post",
      async : true,
      data : param,
      beforeSend : function (){
      },
      complete : function (){
        alert("Listo, las dimensiones fueron creadas para "+BUNIT);
      }, 
      success : function (resp) {
        
      }
    });
});

$(document).on("click", "#calcularTipoDeCambio", function (){
  var tipo = parseFloat($("#tipoDeCambioInput").val());
  if(tipo>0)
  {
    var rows=hot.countRows();  
    var cols=hot.countCols();
    var cuak = hot.getData(0,0,rows,cols);
    var i;
    for(i=0;i<cuak.length;i++)
    {

      var UnidadesSeguro = parseInt(cuak[i][24]);
      var valor = UnidadesSeguro*tipo;
      valor = Math.round(valor * 100) / 100;
      hot.setDataAtCell(i,9,valor);
      //cuak[i][9] = valor;
    }
  }
});
$(document).on("click", "#payrollEmeritos", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Payroll Manutenci&oacute;n de Emeritos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div id="base" style="display:none;"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Payroll de Manutenci&oacute;n<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />';
var USUARIOACTUAL = $("#USUARIOACTUAL").html();
  if(USUARIOACTUAL=="MPJ")
  {
    cad=cad+ '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<select id="selectCampoPayroll" style="font-size:16px;">'+
                        '<option value="MG1">Golfo</option>'+
                        '<option value="M41">Baja Nte</option>'+
                        '<option value="M4R">Baja Sur</option>'+
                        '<option value="MK1">Chihuahua</option>'+
                        '<option value="MM1">Noreste</option>'+
                        '<option value="MUR">Noroccidental</option>'+
                        '<option value="MP1">Norte de Tamaulipas</option>'+
                        '<option value="MU1">Occidente</option>'+
                        '<option value="MS1">Sinaloa</option>'+
                        '<option value="MN1">Sonora</option>'+
                        '<option value="MR1">Regiomontana</option>'+
                        '<option value="M11">Union</option>'+
                        '<option value="FOP">FOP</option>'+
                        '</select>'+
                      '</div>'+
                  '</div><br><br><button class="btn btn-success" id="viejitosDimensiones">Sube dimensiones</button>';
  }
                  cad=cad+'<br><hr><br><div class="form-group"><input type="input" id="tipoDeCambioInput" class="form-control col-md-6 soloNumeros" style="float: left;width:20%;"  /><button class="btn btn-success" id="calcularTipoDeCambio">Calcular tipo de cambio</button>'+
  '</div><br><hr><br>';
                  cad=cad+'<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control actualizaPayrollEmeritos" style="font-size:16px;" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group" id="hotNO">'+
                      '<label id="cambiaMensaje"></label><br>'+
                      '<label id="baseLabel">Base: </label>'+
                    '</div>'+
                    '<div class="form-group" id="hot" style="font-size:16px;">'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" tipo="3" id="generarPreContabilizacionClientSide" class="btn btn-success">Generar Prepoliza</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead id="headPreManutencion"></thead><tbody id="tablaContabilizarManutencion"></tbody></table>'+
                      '</div>'+
                      '<br><hr><br>'+
                    '<table class="table table-striped" style="text-align:center; font-size:18px;"><tbody id="contabilizarManuntencionTable"></tbody></table>'+
                    '<br><hr><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="submit" cad="" id="contabilizarManutencionMinistros" class="btn btn-warning">Contabilizar</button>'+
                      '</div>'+
                      '<div class="col-md-8 col-sm-8 col-xs-8">'+
                        '<button type="submit" id="generarTablaDeTimbradoManutencionMinistros" class="btn btn-success">Generar tabla de timbrado</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="tablaTimbrado">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12"></div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/damePeriodos",
        dataType : "json",
        type : "post",
        async : true,
        data : {},
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          var i;
          var cad = '';//'<select style="font-size:16px;" id="selectPeriodos">'
          for(i=0;i<aver2.length;i++)
          {
            cad = cad + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
          }
          var BUNITACTUAL = $("#BUNITACTUAL").html();
          //cad = cad + '</select>';
          $('#delPeriodo').html(cad);
          $('#delPeriodo').attr("folio",resp.folio);
          $('#delPeriodo').attr("date",resp.date);
          $('#delPeriodo').attr("rfc",resp.rfc);
          $('#delPeriodo').attr("regimen",resp.regimen);
          $('#delPeriodo').attr("razonSocial",resp.razonSocial);
          $('#delPeriodo').attr("regPatronal",resp.regPatronal);
          $('#delPeriodo').attr("lugarExpedicion",resp.lugarExpedicion);
          initializePayrollTableEmeritos();  
        }
      });
          
});



$(document).on("click", "#payroll", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Payroll Manutenci&oacute;n de Ministros</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div id="base" style="display:none;"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Payroll de Manutenci&oacute;n<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control actualizaPayroll" style="font-size:16px;" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group" id="hotNO">'+
                      '<label id="cambiaMensaje"></label><br>'+
                      '<label id="baseLabel">Base: </label>'+
                    '</div>'+
                    '<div class="form-group" id="hot" style="font-size:16px;">'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" tipo="2" id="generarPreContabilizacionClientSide" class="btn btn-success">Generar Prepoliza</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead id="headPreManutencion"></thead><tbody id="tablaContabilizarManutencion"></tbody></table>'+
                      '</div>'+
                      '<br><hr><br>'+
                    '<table class="table table-striped" style="text-align:center; font-size:18px;"><tbody id="contabilizarManuntencionTable"></tbody></table>'+
                    '<br><hr><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="submit" cad="" id="contabilizarManutencionMinistros" class="btn btn-warning">Contabilizar</button>'+
                      '</div>'+
                      '<div class="col-md-8 col-sm-8 col-xs-8">'+
                        '<button type="submit" id="generarTablaDeTimbradoManutencionMinistros" class="btn btn-success">Generar tabla de timbrado</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="tablaTimbrado">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12"></div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/damePeriodos",
        dataType : "json",
        type : "post",
        async : true,
        data : {},
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          var i;
          var cad = '';//'<select style="font-size:16px;" id="selectPeriodos">'
          for(i=0;i<aver2.length;i++)
          {
            cad = cad + '<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
          }
          var BUNITACTUAL = $("#BUNITACTUAL").html();
          
          //cad = cad + '</select>';
          $('#delPeriodo').html(cad);
          $('#delPeriodo').attr("folio",resp.folio);
          $('#delPeriodo').attr("date",resp.date);
          $('#delPeriodo').attr("rfc",resp.rfc);
          $('#delPeriodo').attr("regimen",resp.regimen);
          $('#delPeriodo').attr("razonSocial",resp.razonSocial);
          $('#delPeriodo').attr("regPatronal",resp.regPatronal);
          $('#delPeriodo').attr("lugarExpedicion",resp.lugarExpedicion);
          initializePayrollTable();  
        }
      });
          
});


$(document).on("click", "#contabilizarManuntencion", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Contabilizar Manutenci&oacute;n</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Contabilizar Manutenci&oacute;n<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarPreContabilizacion" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><thead id="headPreManutencion"></thead><tbody id="tablaContabilizarManutencion"></tbody></table>'+
                      '</div>'+
                      '<br><hr><br>'+
                    '<table class="table table-striped" style="text-align:center; font-size:24px;"><tbody id="contabilizarManuntencionTable"></tbody></table>'+
                    '<br><hr><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="contabilizarYTimbrar" class="btn btn-success">Contabilizar, timbrar y mandar por correo</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim();//.substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<anios.length;i++)
          {
            cad=cad+'<option value="'+anios[i].toString().trim()+'">'+anios[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
        //  $("#alPeriodo").html(cad);
         // $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });

$(document).on("click", "#iglesiasReporteDiezmos", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diezmos de iglesias</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diezmos de iglesias<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeIglesiasDiezmos" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeIglesiasDiezmosEnExcel" class="btn btn-success">Generar en Excel</button>'+
                      '</div>'+
                    '</div>'+
                      '<div class="x_content">'+
                        '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><tbody id="tablaDetalleSabana"></tbody></table>'+
                      '</div>'+
                    '<table class="table table-striped" style="text-align:center; font-size:24px;"><tbody id="iglesiasReporteDiezmosDistritos"></tbody></table>'
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var anios = new Array();
          for(i=0;i<aver2.length;i++)
          {
            anio = aver2[i].toString().trim().substring(0,4);
            if(anios.indexOf(anio)==-1)
            {
              anios.push(anio);
            }
          } 
          for(i=0;i<anios.length;i++)
          {
            cad=cad+'<option value="'+anios[i].toString().trim()+'">'+anios[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
        //  $("#alPeriodo").html(cad);
         // $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });

$(document).on("click", "#verPresupuestoVSGastado", function (){
  var anio = $("#selectAnioControlPresupuestal").val();
  var param = {anio : anio};
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/verControlPresupuestal",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var aver2 = Object.keys(resp.pres);
      var i=0,cad='';
        /*
       type A_B struct {
    ACCNT_CODE string
    PERIOD int
    AMOUNT_B float64
    AMOUNT_A float64
    D_C string
    DESCRIPTN string
    ANAL_T0 string
    ANAL_T1 string
    ANAL_T2 string
    ANAL_T3 string
    ANAL_T4 string
    ANAL_T5 string
    ANAL_T6 string
    ANAL_T7 string
    ANAL_T8 string
    ANAL_T9 string
  }*/
      var totalDeIngresos = 0;
      var totalDeGastos = 0;

      var totalPresupuestadoDeIngresos = 0;
      var totalPresupuestadoDeGastos = 0;
     
      for(i=0;i<aver2.length;i++){
        var string_b = numeral(parseFloat(resp.pres[aver2[i]].AMOUNT_B)).format('$0,0.00');
        var string_a = numeral(parseFloat(resp.pres[aver2[i]].AMOUNT_A)).format('$0,0.00');
        var clase = "rojo";
        if(resp.pres[aver2[i]].ACCNT_CODE=="338100" || parseFloat(resp.pres[aver2[i]].AMOUNT_A)<1.0) {
          continue;
        }
        var primera = resp.pres[aver2[i]].ACCNT_CODE.trim().substring(0,1);
        if(primera=="6" || primera =="7"){//ingreso
          if(resp.pres[aver2[i]].AMOUNT_A > resp.pres[aver2[i]].AMOUNT_B) {
            clase="verde";
          }
          if(resp.pres[aver2[i]].AMOUNT_A > 0) {
            totalDeIngresos+=resp.pres[aver2[i]].AMOUNT_A;
            totalPresupuestadoDeIngresos+=resp.pres[aver2[i]].AMOUNT_B;
          }
        }
        if(primera=="8" || primera =="9"){//gasto
          if(resp.pres[aver2[i]].AMOUNT_B > resp.pres[aver2[i]].AMOUNT_A) {
            clase="verde";
          }
          if(resp.pres[aver2[i]].AMOUNT_A > 0) {
            totalDeGastos+=resp.pres[aver2[i]].AMOUNT_A;
            totalPresupuestadoDeGastos+=resp.pres[aver2[i]].AMOUNT_B;
          }
        }
        cad=cad+'<tr><td>'+resp.pres[aver2[i]].DESCR+'-'+resp.pres[aver2[i]].DESCRIPTN+'</td><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+resp.pres[aver2[i]].ACCNT_CODE+'&delPeriodo='+resp.pres[aver2[i]].PERIOD+'&alPeriodo='+resp.pres[aver2[i]].PERIOD+'&descr=&d0s='+resp.pres[aver2[i]].ANAL_T0+'&d0e='+resp.pres[aver2[i]].ANAL_T0+'&d1s='+resp.pres[aver2[i]].ANAL_T1+'&d1e='+resp.pres[aver2[i]].ANAL_T1+'&d2s='+resp.pres[aver2[i]].ANAL_T2+'&d2e='+resp.pres[aver2[i]].ANAL_T2+'&d3s='+resp.pres[aver2[i]].ANAL_T3+'&d3e='+resp.pres[aver2[i]].ANAL_T3+'&d4s='+resp.pres[aver2[i]].ANAL_T4+'&d4e='+resp.pres[aver2[i]].ANAL_T4+'&d5s='+resp.pres[aver2[i]].ANAL_T5+'&d5e='+resp.pres[aver2[i]].ANAL_T5+'&d6s='+resp.pres[aver2[i]].ANAL_T6+'&d6e='+resp.pres[aver2[i]].ANAL_T6+'&d7s='+resp.pres[aver2[i]].ANAL_T7+'&d7e='+resp.pres[aver2[i]].ANAL_T7+'&d8s='+resp.pres[aver2[i]].ANAL_T8+'&d8e='+resp.pres[aver2[i]].ANAL_T8+'&d9s='+resp.pres[aver2[i]].ANAL_T9+'&d9e='+resp.pres[aver2[i]].ANAL_T9+'&busca=0"><u>'+resp.pres[aver2[i]].ACCNT_CODE+'</u></a></td><td>'+resp.pres[aver2[i]].ANAL_T0+'-'+resp.pres[aver2[i]].ANAL_T1+'-'+resp.pres[aver2[i]].ANAL_T2+'-'+resp.pres[aver2[i]].ANAL_T3+'-'+resp.pres[aver2[i]].ANAL_T4+'-'+resp.pres[aver2[i]].ANAL_T5+'-'+resp.pres[aver2[i]].ANAL_T6+'-'+resp.pres[aver2[i]].ANAL_T7+'-'+resp.pres[aver2[i]].ANAL_T8+'-'+resp.pres[aver2[i]].ANAL_T9+'</td><td>'+resp.pres[aver2[i]].PERIOD+'</td><td>'+resp.pres[aver2[i]].D_C+'</td><td style="font-size:20px;">'+string_b+'</td><td style="font-size:20px;" class="'+clase+'"><b>'+string_a+'</b></td></tr>';
      }
      $("#bodyControlPresupuestal").html(cad);
      var string1 = numeral(totalPresupuestadoDeIngresos).format('$0,0.00');
      var string2 = numeral(totalDeIngresos).format('$0,0.00');
      var string3 = numeral(totalPresupuestadoDeGastos).format('$0,0.00');
      var string4 = numeral(totalDeGastos).format('$0,0.00');
      $("#totalesPresupuesto").html('<tbody><tr><td>Total presupuestado de ingreso:</td><td>'+string1+'</td></tr><tr><td>Total de ingresos:</td><td>'+string2+'</td></tr><tr><td>Total presupuestado de gastos:</td><td >'+string3+'</td></tr><tr><td>Total de gastos:</td><td>'+string4+'</td></tr></tbody>');
      $("#loadingCampos").html('');
      $("#totalesPresupuesto").css("display","block");

// '<thead><tr><th>Descripci&oacute;n</th><th>Cuenta</th><th>Dimensiones</th><th>Periodo</th><th>D_C</th><th>Presupuesto</th><th>Real</th></tr></thead>'+
                        //'<tbody id="bodyControlPresupuestal"></tbody>'+
    }
  });
});

$(document).on("click", "#controlPresupuestal", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Control presupuestal</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Reporte de presupuesto contra gastado o ingresado<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                    '<div id="loadingCampos"></div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<select class="form-control" id="selectAnioControlPresupuestal" style="font-size:20px;"></select>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group"><br><br>'+
                    '<button class="btn btn-success" type="submit" id="verPresupuestoVSGastado">Ver presupuesto vs gastado</button>'+
                    '</div>'+
                    '<div class="form-group"><br><br>'+
                     '<table class="table table-hover">'+
                        '<thead><tr><th>Descripci&oacute;n</th><th>Cuenta</th><th>Dimensiones</th><th>Periodo</th><th>D_C</th><th>Presupuesto</th><th>Real</th></tr></thead>'+
                        '<tbody id="bodyControlPresupuestal"></tbody>'+
                      '</table>'+
                      '<table id="totalesPresupuesto" class="table table-striped" style="font-size:20px;display:none;">'+
                      '</table>'+
                      '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      var param = {libro : "B"}
      $.ajax({
        url: "/dameDiferentesAnios",
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.anios);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
          } 
          $("#selectAnioControlPresupuestal").html(cad);
        }
      });
  });



$(document).on("click", "#inventarioDetalle", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Occidente Detalle</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diezmos de iglesias<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="arreglarDetalleInventario" class="btn btn-success">Arreglar</button>'+
                      '</div>'+
                    '</div>'+
                     '<table class="table table-hover">'+
                        '<thead><tr><th>Descripci&oacute;n</th><th>Diario</th><th>Linea</th><th>Fecha Transacci&oacute;n</th><th>Fecha que ser&aacute;</th></tr></thead>'+
                        '<tbody id="tablaOccidente"></tbody>'+
                      '</table>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/generarInventarioDetalle",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.diarios);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'"> '+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T9"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T99"]+'</td></tr>';
          } 
          $("#tablaOccidente").html(cad);
          }
      });
  });



$(document).on("click", "#occidenteDetalle", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Occidente Detalle</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diezmos de iglesias<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                   '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="dueDateArreglar" class="btn btn-success">Arreglar Due Date</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="arreglarDetalleOccidente" class="btn btn-success">Arreglar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="arreglarDetalleOccidenteIGLESIA" class="btn btn-success">Arreglar Iglesia Noroccidental</button>'+
                      '</div>'+
                    '</div>'+
                     '<table class="table table-hover">'+
                        '<thead><tr><th>Descripci&oacute;n</th><th>Diario</th><th>Linea</th><th>Detalle actual</th><th>Detalle que ser&aacute;</th></tr></thead>'+
                        '<tbody id="tablaOccidente"></tbody>'+
                      '</table>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/generarOccidenteDetalle",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.diarios);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'"> '+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T9"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T99"]+'</td></tr>';
          } 
          $("#tablaOccidente").html(cad);
          }
      });
  });







$(document).on("click", "#dueDateArreglar", function (){
  $.ajax({
    url: "/dueDateArreglar",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        alert("revisa la base de datos");
      }
    }
  });
});

$(document).on("click", "#arreglarDetalleOccidenteIGLESIA", function (){
   $.ajax({
        url: "/arreglarDetalleOccidenteIGLESIA",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            alert("revisa la base de datos");
          }
          }
      });
  });




$(document).on("click", "#arreglarDetalleInventario", function (){
   $.ajax({
        url: "/arreglarDetalleInventario",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.diarios);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'"> '+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T9"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T99"]+'</td></tr>';
          } 
          $("#tablaOccidente").html(cad);
          }
      });
  });


$(document).on("click", "#arreglarDetalleOccidente", function (){
   $.ajax({
        url: "/arreglarDetalleOccidente",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.diarios);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.diarios[aver2[i]]["DESCRIPTN"]+'</td><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.diarios[aver2[i]]["Diario"]+'"> '+resp.diarios[aver2[i]]["Diario"]+'</a></td><td>'+resp.diarios[aver2[i]]["Linea"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T9"]+'</td><td>'+resp.diarios[aver2[i]]["ANAL_T99"]+'</td></tr>';
          } 
          $("#tablaOccidente").html(cad);
          }
      });
  });
$(document).on("click", "#iglesiasReporte", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Diezmos de iglesias</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Diezmos de iglesias<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeIglesias" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });



$(document).on("click", "#cedulaAnalisisDeCuentasDeBanco", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>An&aacute;lisis de cuentas de bancos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>An&aacute;lisis de cuentas de bancos<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="campoLista">Campo:</label>'+
                          '<select id="campoLista" class="form-control" required="" >'+
                          '<option value="/">Uni&oacute;n</option>'+
                            '</select></p>'+
                    '</div>'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarCedulaCuentasBancos" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="tablaConcentradoCedulaBancos"></div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          var cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
           $.ajax({
            url: "/dameListaDeCampos",
            dataType : "json",
            type : "post",
            async : true,
            beforeSend : function (){
            },
            complete : function (){
            }, 
            success : function (resp){
              if(resp.success==1)
              {
                var campos = Object.keys(resp.otrosCampos);
                cad = '<option value="/">Uni&oacute;n</option>';
                for(i=0;i<campos.length;i++)
                {
                  cad=cad+'<option value="'+resp.otrosCampos[campos[i]].URL+'">'+resp.otrosCampos[campos[i]].Nombre+'</option>';
                } 
                $("#campoLista").html(cad);
                $("#campoLista").attr("hash",resp.hash);
              }
            }
          });
        }
      });
  });



$(document).on("click", "#sabanaGastosPersonasReporte", function (){
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>S&aacute;bana de Gastos de Ministros/Asociados</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                    '<h2>Detalle <small>de la s&aacute;bana</small></h2>'+
                    '<ul class="nav navbar-right panel_toolbox">'+
                      '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                      '</li>'+
                      '<li><a class="close-link"><i class="fa fa-close"></i></a></li>'+
                    '</ul>'+
                    '<div class="clearfix"></div>'+
                  '</div>'+
                  '<div class="x_content">'+
                    '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><tbody id="tablaDetalleSabana"></tbody></table>'+
                  '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>S&aacute;bana de Gastos de Ministros/Asociados<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeMATSabana" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                    '<br><table class="table table-striped" style="text-align:center; font-size: 20px;"><tbody id="tablaSabana"></tbody></table>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });


$(document).on("click", "#guardarContraNueva", function (){
  var contraAnterior = $("#contraAnterior").val();
  var contraNueva = $("#contraNueva").val();
  var contraNueva2 = $("#contraNueva2").val();
  if(contraNueva!=contraNueva2)
  {
    alert("La contrasena nueva no coincide");
    return;
  }
   var param = {contraAnterior : sha512(contraAnterior), contraNueva : sha512(contraNueva)}
   
   $.ajax({
        url: "/cambiarContrasena",
        dataType : "json",
        type : "post",
        async : true,
        data : param,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
         if(resp.success==2) {
          alert("La contrasena anterior es incorrecta");
         }
         if(resp.success==1) {
          alert("La contrasena se modifico exitosamente");
         }
        }
      });

  });


$(document).on("keyup", "#JRNAL_NO_vistaPrevia", function (){
  var diario = $("#JRNAL_NO_vistaPrevia").val();
  $("#preview").html("");
  if(diario!="")
  {
    $.ajax({
      url: "/infoLibroDiario",
      dataType : "json",
      type : "post",
      async : true,
      data : {diario : diario},
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1) {
          var cad = '<table class="table table-striped"><thead><tr><th>Linea</th><th>Cuenta</th><th>Monto</th><th>Periodo</th><th>Fecha</th><th>Descripcion</th><th>Referencia</th></tr></thead><tbody>';
          var aver2 = Object.keys(resp.diarios);
          var i;
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td>'+resp.diarios[aver2[i]].Linea+'</td><td>'+resp.diarios[aver2[i]].D_C+'</td><td>'+format2(resp.diarios[aver2[i]].AMOUNT,'$')+'</td><td class="periodoAnterior">'+resp.diarios[aver2[i]].PERIOD+'</td><td class="fechaAnterior">'+resp.diarios[aver2[i]].TRANS_DATETIME+'</td><td>'+resp.diarios[aver2[i]].DESCRIPTN+'</td><td>'+resp.diarios[aver2[i]].TREFERENCE+'</td></tr>';
          }
          cad=cad+'</tbody></table>';
          $("#preview").html('<div style="font-size:20px">'+cad+'</div>');
        }
      }
    });
  }
});


$(document).on("keyup", "#JRNAL_LINE", function (){
  var diario = $("#JRNAL_NO").val();
  var linea = $("#JRNAL_LINE").val();
  $("#preview").html("");
  if(diario!="" && linea != "")
  {
    $.ajax({
      url: "/infoLibro",
      dataType : "json",
      type : "post",
      async : true,
      data : {diario : diario, linea : linea},
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1) {
          var palabra = "D&eacute;bito";
          if(resp.D_C=="C")
          {
            palabra = "Cr&eacute;dito";
          }
          $("#preview").html('<div style="font-size:20px"><br><p>Cuenta: <b><span id="cuenta">'+resp.ACCNT_CODE+'</span></b> </p>'+
            '<br><p>Periodo: <b><span id="periodo">'+resp.PERIOD+'</span></b> </p>'+
            '<br><p>Fecha: <b><span id="fecha">'+resp.fecha+'</span></b> </p>'+
            '<br><p>Tipo: <b><span id="D_C">'+palabra+'</span></b> </p>'+
            '<br><p>Cantidad: <b><span id="cantidad" cantidad="'+resp.cantidad+'">'+format2(resp.cantidad,'$')+'</span></b> </p>'+
            '<br><p>Bandera de activo: <b><span id="ASSET_IND">'+resp.ASSET_IND+'</span></b> </p>'+
            '<br><p>Activo adjuntado: <b><span id="ASSET_CODE">'+resp.ASSET_CODE+'</span></b> </p></div>');
        }
      }
    });
  }
});



$(document).on("click", "#guardarPeriodoNuevo", function (){
  Swal({
      type: 'error',
      title: 'ESTE MODULO YA NO ESTA DISPONIBLE. Si necesitas un cambio, dile a tu tesorero que solicite el cambio escribiendo un correo, enviandolo a:  floresca@adventistasumn.org , con copia a PrestolJ@gc.adventist.org , y a pecinafe@adventistasumn.org.',
    });
   return;
  var diario = $("#JRNAL_NO_vistaPrevia").val().trim();
  var PeriodoNuevo = $("#PeriodoNuevo").val().trim();
  var periodoAnterior = $($(".periodoAnterior")[0]).html();

if(diario=="" || PeriodoNuevo == "" || PeriodoNuevo.length != 7)
{
  alert("Llena todos los campos antes de continuar, recuerda que el periodo tiene 7 digitos");
  return;
}

   $.ajax({
    url: "/cambiarPeriodo",
    dataType : "json",
    type : "post",
    async : true,
    data : {diario : diario, PeriodoNuevo : PeriodoNuevo, periodoAnterior : periodoAnterior},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1) {
        $("#selectTipoAjuste").val("0");
        $("#contenidoACambiar").html("");
        alert("Periodo cambiado!");
      }
      if(resp.success==0) {
        alert("hubo un error desconocido!");
      }
      if(resp.success==-1) {
        alert("hubo un error en el correo!");
      }
    }
  });
});

$(document).on("click", "#guardarFechaNueva", function (){
  Swal({
      type: 'error',
      title: 'ESTE MODULO YA NO ESTA DISPONIBLE. Si necesitas un cambio, dile a tu tesorero que solicite el cambio escribiendo un correo, enviandolo a:  floresca@adventistasumn.org , con copia a PrestolJ@gc.adventist.org , y a pecinafe@adventistasumn.org.',
    });
   return;
  var diario = $("#JRNAL_NO_vistaPrevia").val().trim();
  var FechaNueva = $("#FechaNueva").val().trim();
  var fechaAnterior = $($(".fechaAnterior")[0]).html();

if(diario=="" || FechaNueva == "" || FechaNueva.length != 10)
{
  alert("Llena todos los campos antes de continuar, recuerda que la fecha tiene 10 digitos");
  return;
}

   $.ajax({
    url: "/cambiarFecha",
    dataType : "json",
    type : "post",
    async : true,
    data : {diario : diario, FechaNueva : FechaNueva, fechaAnterior : fechaAnterior},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1) {
        $("#selectTipoAjuste").val("0");
        $("#contenidoACambiar").html("");
        alert("Fecha cambiada!");
      }
      if(resp.success==0) {
        alert("hubo un error desconocido!");
      }
      if(resp.success==-1) {
        alert("hubo un error en el correo!");
      }
    }
  });
});

$(document).on("click", "#guardarCuentaNueva", function (){

   Swal({
      type: 'error',
      title: 'ESTE MODULO YA NO ESTA DISPONIBLE. Si necesitas un cambio, dile a tu tesorero que solicite el cambio escribiendo un correo, enviandolo a:  floresca@adventistasumn.org , con copia a PrestolJ@gc.adventist.org , y a pecinafe@adventistasumn.org.',
    });
    return;
  var diario = $("#JRNAL_NO").val().trim();
  var linea = $("#JRNAL_LINE").val().trim();
  var CuentaNueva = $("#CuentaNueva").val().trim();
  var cuentaAnterior = $("#cuenta").html();

if(diario=="" || linea == "" || CuentaNueva == "")
{
  alert("Llena todos los campos antes de continuar");
  return;
}

   $.ajax({
    url: "/cambiarCuenta",
    dataType : "json",
    type : "post",
    async : true,
    data : {diario : diario, linea : linea, CuentaNueva : CuentaNueva, cuentaAnterior : cuentaAnterior},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1) {
        $("#selectTipoAjuste").val("0");
        $("#contenidoACambiar").html("");
        alert("cuenta cambiada!");
      }
      if(resp.success==0) {
        alert("hubo un error desconocido!");
      }
      if(resp.success==-1) {
        alert("hubo un error en el correo!");
      }
    }
  });
});
$(document).on("change", "#selectTipoAjuste", function (){
  var cambio = parseInt($(this).val());
  if(cambio==0)//nada
  {
    $("#contenidoACambiar").html("");
  }
  if(cambio==1)//cambio de cuenta
  {
    $("#contenidoACambiar").html('<br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Diario:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="JRNAL_NO" class="form-control col-md-9 soloNumeros" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Linea:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="JRNAL_LINE" class="form-control col-md-9 soloNumeros" style="float: right;"  />'+
                      '</div>'+
                    '</div><br><div id="preview"></div><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Cuenta nueva:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="CuentaNueva" class="form-control col-md-9" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarCuentaNueva" class="btn btn-success">Cambiar cuenta</button>'+
                      '</div>'+
                    '</div>');
  }
  if(cambio==2)//cambio de periodo
  {
    $("#contenidoACambiar").html('<br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Diario:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="JRNAL_NO_vistaPrevia" class="form-control col-md-9 soloNumeros" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<br><div id="preview"></div><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Periodo nuevo:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="PeriodoNuevo" maxlength="7" placeholder="YYYY0MM" class="form-control col-md-9" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarPeriodoNuevo" class="btn btn-success">Cambiar fecha de todo el diario</button>'+
                      '</div>'+
                    '</div>');
    //var selector = document.getElementById("FechaNueva");
    //var im = new Inputmask("9999-99-99");
    //im.mask(selector);
  }
  if(cambio==3)//cambio de fecha
  {
    $("#contenidoACambiar").html('<br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Diario:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="JRNAL_NO_vistaPrevia" class="form-control col-md-9 soloNumeros" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<br><div id="preview"></div><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Fecha nueva:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="FechaNueva" maxlength="10" placeholder="YYYY-MM-DD" class="form-control col-md-9" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarFechaNueva" class="btn btn-success">Cambiar fecha de todo el diario</button>'+
                      '</div>'+
                    '</div>');
    //var selector = document.getElementById("FechaNueva");
    //var im = new Inputmask("9999-99-99");
    //im.mask(selector);
  }
});
function dameCorreoDelTesorero() {
   $.ajax({
        url: "/dameCorreoDelTesorero",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
         if(resp.success==1) {
          $("#advertencia").html("Advertencia: Todos los cambios que haga aqui, ser&aacute; notificado su tesorero al correo: "+resp.correoTesorero);  
         }
       }
     });
   $("#advertencia").html("Advertencia: NO EXISTE CORREO DEL TESORERO, FAVOR DE AVISAR A SU PERSONAL TECNICO"); 
}


$(document).on("click", "#exportarLibroMayor", function (){
      dameCorreoDelTesorero();
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Exportar el libro mayor a 6.2</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Exportar el libro mayor a 6.2<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                '<br><hr><br>'+
                  '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">URL del servidor receptor:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="servidor"  class="form-control col-md-9" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3"><span class="required">ejemplo:  http://localhost:754/    o   http://sunplus.redirectme.net:754/</span>'+
                    '</div><br><br><br><hr><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Unidad de negocio:</label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="input" id="bunit"  class="form-control col-md-9" style="float: right;"  />'+
                      '</div>'+
                    '</div><br>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3"><span class="required">ejemplo:  GM4    o   GMM</span>'+
                    '</div><br><br>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="mandarDimensionesYLibroMayor" class="btn btn-success">Exportar dimensiones y libro mayor</button>'+
                      '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<textarea style="width:100%;" rows="30" cols="200" id="log" readonly></textarea>'+
                    '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      
    });

$(document).on("click", "#mandarDimensionesYLibroMayor", function (){
  var servidor = $("#servidor").val();
  var bunit = $("#bunit").val();
  var param = {servidor : servidor , bunit : bunit};
  $.ajax({
    url: "/mandarDimensionesYLibroMayor",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
    }
  });
});


$(document).on("click", "#obtenerDiarioAnteriormentePosteado", function (){
  var diarioAnterior = parseInt($("#diarioAnterior").val().trim());
  if(diarioAnterior=="")
  {
    alert("Primero tienes que escribir un numero de diario");
    return;
  }
  var param = {diarioAnterior : diarioAnterior};
  $.ajax({
    url: "/obtenerDiarioAnteriormentePosteado",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var data = new Array();
      var aver2 = Object.keys(resp.diarios);
      var i, j;
      var debitos = 0.0;
      var creditos = 0.0;
      for(i=0;i<aver2.length;i++)
      {
        for(j=i+1;j<aver2.length;j++)
        {
          if(parseInt(aver2[i])>parseInt(aver2[j]))
          {
            var aux = resp.diarios[aver2[i]];
            resp.diarios[aver2[i]] = resp.diarios[aver2[j]];
            resp.diarios[aver2[j]] = aux;
          }
        }
      }
      for(i=0;i<aver2.length;i++)
      {
        var row = new Array();
        row["TransReference"] = resp.diarios[aver2[i]].TREFERENCE;
        row["Cuenta"] = resp.diarios[aver2[i]].Cuenta;
        row["NombreDeLaCuenta"] = resp.diarios[aver2[i]].NombreDeCuenta;
        row["Recurso"] = resp.diarios[aver2[i]].Recurso;
        row["TFWW"] = resp.diarios[aver2[i]].TFWW;
        row["Fondo"] = resp.diarios[aver2[i]].Fondo;
        row["Funcion"] = resp.diarios[aver2[i]].Funcion;
        row["RSTR"] = resp.diarios[aver2[i]].RSTR;
        row["OrgID"] = resp.diarios[aver2[i]].OrgID;
        row["WHO"] = resp.diarios[aver2[i]].WHO;
        row["Flag"] = resp.diarios[aver2[i]].Flag;
        row["Proyecto"] = resp.diarios[aver2[i]].Proyecto;
        row["Detalle"] = resp.diarios[aver2[i]].Detalle;
        row["Cantidad"] = resp.diarios[aver2[i]].AMOUNT;
        if(resp.diarios[aver2[i]].AMOUNT>0)//debitos
        {
          debitos+=resp.diarios[aver2[i]].AMOUNT;
        } 
        else
        {
          creditos+=resp.diarios[aver2[i]].AMOUNT;
        }
        row["Descripcion"] = resp.diarios[aver2[i]].DESCRIPTN;
        data.push(row);
        $("#journalType").val(resp.diarios[aver2[i]].JRNAL_TYPE);
        $("#fechaTransaccion").val(resp.diarios[aver2[i]].TRANS_DATETIME);
        $("#periodo").val(resp.diarios[aver2[i]].PERIOD);
      }
      hot.loadData(data);
      $("#debitos").html("D&eacute;bitos: $ "+debitos);
      $("#creditos").html("Cr&eacute;ditos: $ "+creditos);
      $("#porCuadrar").html("Por cuadrar: $ "+(debitos+creditos));
    }
  });
});
var hot;
$(document).on("click", "#clearScreen", function (){
  clearScreen();
});
var gmGlobal ,geGlobal;
var projectionGlobal, pathGlobal, svgGlobal, municipalitiesGlobal; 
var svgEngraneGlobal;
var toothRadius = 4;
   var holeRadius = 10;


$(document).on("click", "#entrarPresupuesto", function (){
  cargaEngranejitos()
});
var frameGlobal;
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.Victor=t()}}(function(){return function t(i,r,n){function o(s,h){if(!r[s]){if(!i[s]){var u="function"==typeof require&&require;if(!h&&u)return u(s,!0);if(e)return e(s,!0);throw new Error("Cannot find module '"+s+"'")}var p=r[s]={exports:{}};i[s][0].call(p.exports,function(t){var r=i[s][1][t];return o(r?r:t)},p,p.exports,t,i,r,n)}return r[s].exports}for(var e="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,i,r){function n(t,i){return this instanceof n?(this.x=t||0,void(this.y=i||0)):new n(t,i)}function o(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function e(t){return t*h}function s(t){return t/h}r=i.exports=n,n.fromArray=function(t){return new n(t[0]||0,t[1]||0)},n.fromObject=function(t){return new n(t.x||0,t.y||0)},n.prototype.addX=function(t){return this.x+=t.x,this},n.prototype.addY=function(t){return this.y+=t.y,this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},n.prototype.addScalarX=function(t){return this.x+=t,this},n.prototype.addScalarY=function(t){return this.y+=t,this},n.prototype.subtractX=function(t){return this.x-=t.x,this},n.prototype.subtractY=function(t){return this.y-=t.y,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},n.prototype.subtractScalarX=function(t){return this.x-=t,this},n.prototype.subtractScalarY=function(t){return this.y-=t,this},n.prototype.divideX=function(t){return this.x/=t.x,this},n.prototype.divideY=function(t){return this.y/=t.y,this},n.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.prototype.divideScalar=function(t){return 0!==t?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},n.prototype.divideScalarX=function(t){return 0!==t?this.x/=t:this.x=0,this},n.prototype.divideScalarY=function(t){return 0!==t?this.y/=t:this.y=0,this},n.prototype.invertX=function(){return this.x*=-1,this},n.prototype.invertY=function(){return this.y*=-1,this},n.prototype.invert=function(){return this.invertX(),this.invertY(),this},n.prototype.multiplyX=function(t){return this.x*=t.x,this},n.prototype.multiplyY=function(t){return this.y*=t.y,this},n.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},n.prototype.multiplyScalarX=function(t){return this.x*=t,this},n.prototype.multiplyScalarY=function(t){return this.y*=t,this},n.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=1,this.y=0):this.divide(n(t,t)),this},n.prototype.norm=n.prototype.normalize,n.prototype.limit=function(t,i){return Math.abs(this.x)>t&&(this.x*=i),Math.abs(this.y)>t&&(this.y*=i),this},n.prototype.randomize=function(t,i){return this.randomizeX(t,i),this.randomizeY(t,i),this},n.prototype.randomizeX=function(t,i){var r=Math.min(t.x,i.x),n=Math.max(t.x,i.x);return this.x=o(r,n),this},n.prototype.randomizeY=function(t,i){var r=Math.min(t.y,i.y),n=Math.max(t.y,i.y);return this.y=o(r,n),this},n.prototype.randomizeAny=function(t,i){return Math.round(Math.random())?this.randomizeX(t,i):this.randomizeY(t,i),this},n.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},n.prototype.toFixed=function(t){return"undefined"==typeof t&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},n.prototype.mixX=function(t,i){return"undefined"==typeof i&&(i=.5),this.x=(1-i)*this.x+i*t.x,this},n.prototype.mixY=function(t,i){return"undefined"==typeof i&&(i=.5),this.y=(1-i)*this.y+i*t.y,this},n.prototype.mix=function(t,i){return this.mixX(t,i),this.mixY(t,i),this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyX=function(t){return this.x=t.x,this},n.prototype.copyY=function(t){return this.y=t.y,this},n.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},n.prototype.zero=function(){return this.x=this.y=0,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.projectOnto=function(t){var i=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=i*t.x,this.y=i*t.y,this},n.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},n.prototype.horizontalAngleDeg=function(){return e(this.horizontalAngle())},n.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},n.prototype.verticalAngleDeg=function(){return e(this.verticalAngle())},n.prototype.angle=n.prototype.horizontalAngle,n.prototype.angleDeg=n.prototype.horizontalAngleDeg,n.prototype.direction=n.prototype.horizontalAngle,n.prototype.rotate=function(t){var i=this.x*Math.cos(t)-this.y*Math.sin(t),r=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=i,this.y=r,this},n.prototype.rotateDeg=function(t){return t=s(t),this.rotate(t)},n.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},n.prototype.rotateToDeg=function(t){return t=s(t),this.rotateTo(t)},n.prototype.rotateBy=function(t){var i=this.angle()+t;return this.rotate(i)},n.prototype.rotateByDeg=function(t){return t=s(t),this.rotateBy(t)},n.prototype.distanceX=function(t){return this.x-t.x},n.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},n.prototype.distanceY=function(t){return this.y-t.y},n.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},n.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},n.prototype.distanceSq=function(t){var i=this.distanceX(t),r=this.distanceY(t);return i*i+r*r},n.prototype.length=function(){return Math.sqrt(this.lengthSq())},n.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},n.prototype.magnitude=n.prototype.length,n.prototype.isZero=function(){return 0===this.x&&0===this.y},n.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},n.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},n.prototype.toArray=function(){return[this.x,this.y]},n.prototype.toObject=function(){return{x:this.x,y:this.y}};var h=180/Math.PI},{}]},{},[1])(1)});
function Firework(a, b, c) {
    this.ctx = a, this.w = b, this.h = c, this.pos = {
        x: b / 2,
        y: c / 2
    }, this.color = {
        h: 0,
        s: 1,
        l: .5
    }, this.duration = 2e3, this.num = 18, this.particles = [], this.speed = 6, this.size = 4, this.pre_time = (new Date).getTime(), this.cur_time = this.pre_time, this.time = 0, this.init = function(a, b, c, d, e) {
        this.pos = a ? a : this.pos, this.color = b ? b : this.color, this.duration = c ? c : this.duration, this.num = d ? d : this.num, this.speed = e ? e : this.speed;
        for (var f = d5.scaleLinear().domain([0, this.num - 1]).range([.5 * Math.PI, 2.5 * Math.PI]), g = 0; g < this.num; g++) {
            var h = f(g),
                i = Math.cos(h),
                j = Math.sin(h),
                k = new Victor(i, j);
            k.normalize(), this.particles.push({
                x: this.pos.x,
                y: this.pos.y,
                vx: k.x * this.speed,
                vy: k.y * this.speed
            })
        }
    }, this.update = function() {
        this.cur_time = (new Date).getTime(), this.time += this.cur_time - this.pre_time, this.pre_time = this.cur_time;
        for (var a = this.particles.length - 1; a >= 0; a--) this.particles[a].vy -= .2, this.particles[a].x += this.particles[a].vx, this.particles[a].y -= this.particles[a].vy
    }, this.render = function() {
        for (var b = this.particles.length - 1; b >= 0; b--) {
            var c = this.particles[b].x,
                d = this.particles[b].y,
                e = this.getColorString();
            a.beginPath(), a.fillStyle = e, a.arc(c, d, this.size, 0, 2 * Math.PI), a.fill()
        }
    }, this.getColorString = function() {
        var a = 360 * this.color.h,
            b = 100 * this.color.s,
            c = 100 * this.color.l;
        return "hsl(" + a + "," + b + "%," + c + "%)"
    }
}
function drawFPS() {
    delta = Date.now() - lastCalledTime, fps_count++, delta > 1e3 && (delta = (Date.now() - lastCalledTime) / 1e3, lastCalledTime = Date.now(), fps = fps_count, fps_count = 0), ctx.save(), ctx.globalCompositeOperation = "source-over", ctx.fillStyle = "white", ctx.fillText("FPS: " + fps, 20, 40), ctx.restore()
}

function drawDecemberCafe() {
}

function updateWindow() {
  var canvas = document.getElementById("mycanvas");
    w = window, d = document, e = d.documentElement, g = d.getElementsByTagName("body")[0], x = e.clientWidth || w.innerWidth || g.clientWidth, y = e.clientHeight || w.innerHeight || g.clientHeight, width = x < 800 ? 800 : x, height = .7 * y, canvas.setAttribute("width", width), canvas.setAttribute("height", height)
}
var lastCalledTime = Date.now(),
    fps = 100,
    delta = 0,
    fps_count = 0,
    time = 0,
    fireworks = [];
$(document).on("click", "#subirEngranaje", function (){
  clearInterval(interGlobal);
  var gm = d3.select("#svgEngrane").select("g");
      gm.transition()
      .duration(tiempo)
      .attr("transform", "translate(-400,-500)scale(7)").style("opacity","0");
setTimeout(function(){
        $("#mainContent").html('<canvas id="mycanvas" width="1399" height="387.79999999999995"></canvas>');
        var canvas = document.getElementById("mycanvas"),
    ctx = canvas.getContext("2d"),
    width = 1600,
    height = 768;
w = window, d = document, e = d.documentElement, g = d.getElementsByTagName("body")[0], x = e.clientWidth || w.innerWidth || g.clientWidth, y = e.clientHeight || w.innerHeight || g.clientHeight, width = x < 800 ? 800 : x, height = .7 * y, canvas.setAttribute("width", width), canvas.setAttribute("height", height);
var backimg = new Image;
backimg.src = "static/night-trees-stars.jpg";

setInterval(function() {
    ctx.save(), ctx.globalAlpha = .2, ctx.fillStyle = "black", ctx.fillRect(0, 0, width, height), ctx.drawImage(backimg, 0, 0, 1600, 1067, 0, 0, width, height), ctx.restore(), ctx.save(), ctx.globalCompositeOperation = "lighter", Math.random() < .1 && fireworks.length < 50 && (fireworks.push(new Firework(ctx, width, height)), fireworks[fireworks.length - 1].init({
        x: 50 + Math.random() * (width - 50),
        y: 90 + 100 * Math.random()
    }, {
        h: Math.random(),
        s: 1,
        l: .6 + .3 * Math.random()
    }, 1500 + 1e3 * Math.random(), parseInt(15 + 10 * Math.random()), 4 + 5 * Math.random()), fireworks[fireworks.length - 1].size = 4 + 3 * Math.random());
    for (var a = fireworks.length - 1; a >= 0; a--) fireworks[a].time < fireworks[a].duration ? (fireworks[a].update(), fireworks[a].render()) : fireworks.splice(a, 1);
    ctx.restore();
     delta = Date.now() - lastCalledTime, fps_count++, delta > 1e3 && (delta = (Date.now() - lastCalledTime) / 1e3, lastCalledTime = Date.now(), fps = fps_count, fps_count = 0), ctx.save(), ctx.globalCompositeOperation = "source-over", ctx.fillStyle = "white", ctx.restore();
}, 33), window.onresize = updateWindow;
      },tiempo);

  
});
  /*
     {text: "Empleados", count: "14953341"},
        {text: "Total de gastos", count: "20644843"},
        {text: "Viajes", count: "715000"},
        {text: "Programas", count: "3088262"},
        {text: "Administrativos", count: "672928"},
        {text: "Oficina", count: "274378"},
        {text: "Generales", count: "260446"},
        {text: "Operacion planta", count: "680485"},
    */

$(document).on("click", "#gastosEngranaje", function (){
   clearInterval(interGlobal);
  var gm = d3.select("#svgEngrane").select("g");
      gm.transition()
      .duration(tiempo)
      .attr("transform", "translate(-400,-500)scale(7)").style("opacity","0");
modoBolitasGlobal=1;
setTimeout(function(){
  //$("body").html('<div style="background-color:#000;" class="bubbleChart"/>');
        $("#mainContent").html('<div class="bubbleChart"/>');
        var bubbleChart = new d4.svg.BubbleChart({
    supportResponsive: true,
    //container: => use @default
    size: 600,
    //viewBoxSize: => use @default
    innerRadius: 600 / 3.5,
    //outerRadius: => use @default
    radiusMin: 50,
    //radiusMax: use @default
    //intersectDelta: use @default
    //intersectInc: use @default
    //circleColor: use @default
    /*

        {text: "Total de gastos", count: "20644"},
        {text: "Viajes", count: "715"},
        {text: "Programas", count: "3088"},
        {text: "Administrativos", count: "672"},
        {text: "Oficina", count: "274"},
        {text: "Generales", count: "260"},
        {text: "Operacion planta", count: "680"},
    */
    data: {
      items: [
       {text: "De empleados", count: "236000"},
        {text: "Total de gastos", count: "382000"},
        {text: "Viajes", count: "170000"},
        {text: "Programas", count: "123000"},
        {text: "Administrativos", count: "2000"},
     //   {text: "Oficina", count: "4000"},
      //  {text: "Generales", count: "8000"},
      //  {text: "Operacion planta", count: "6000"},
      ],
      eval: function (item) {return item.count;},
      classed: function (item) {return item.text.split(" ").join("");}
    },
    plugins: [
      {
        name: "central-click",
        options: {
          text: "(See more detail)",
          style: {
            "font-size": "12px",
            "font-style": "italic",
            "font-family": "Source Sans Pro, sans-serif",
            //"font-weight": "700",
            "text-anchor": "middle",
            "fill": "white"
          },
          attr: {dy: "65px"},
          centralClick: function() {
            alert("Here is more details!!");
          }
        }
      },
      {
        name: "lines",
        options: {
          format: [
            {// Line #0
              textField: "count",
              classed: {count: true},
              style: {
                "font-size": "28px",
                "font-family": "Source Sans Pro, sans-serif",
                "text-anchor": "middle",
                fill: "white"
              },
              attr: {
                dy: "0px",
                x: function (d) {return d.cx;},
                y: function (d) {return d.cy;}
              }
            },
            {// Line #1
              textField: "text",
              classed: {text: true},
              style: {
                "font-size": "14px",
                "font-family": "Source Sans Pro, sans-serif",
                "text-anchor": "middle",
                fill: "white"
              },
              attr: {
                dy: "20px",
                x: function (d) {return d.cx;},
                y: function (d) {return d.cy;}
              }
            }
          ],
          centralFormat: [
            {// Line #0
              style: {"font-size": "50px"},
              attr: {}
            },
            {// Line #1
              style: {"font-size": "30px"},
              attr: {dy: "40px"}
            }
          ]
        }
      }]
  });
      },tiempo);
  
});

$(document).on("click", "#ingresosEngranaje", function (){
  clearInterval(interGlobal);
  var gm = d3.select("#svgEngrane").select("g");
      gm.transition()
      .duration(tiempo)
      .attr("transform", "translate(-400,-500)scale(7)").style("opacity","0");
  modoBolitasGlobal=0;
setTimeout(function(){
  //$("body").html('<div style="background-color:#000;" class="bubbleChart"/>');
        $("#mainContent").html('<div class="bubbleChart"/>');
        var bubbleChart = new d4.svg.BubbleChart({
    supportResponsive: true,
    //container: => use @default
    size: 600,
    //viewBoxSize: => use @default
    innerRadius: 600 / 3.5,
    //outerRadius: => use @default
    radiusMin: 50,
    //radiusMax: use @default
    //intersectDelta: use @default
    //intersectInc: use @default
    //circleColor: use @default
    /*

       
    */
    data: {
      items: [
       {text: "De Diezmo", count: "236000"},
        {text: "Total de ingresos", count: "382000"},
        {text: "Especiales", count: "170000"},
        {text: "Otros ingresos Operativos", count: "123000"},
        {text: "Intereses Bancarios", count: "2000"},
      ],
      eval: function (item) {return item.count;},
      classed: function (item) {return item.text.split(" ").join("");}
    },
    plugins: [
      {
        name: "central-click",
        options: {
          text: "(See more detail)",
          style: {
            "font-size": "12px",
            "font-style": "italic",
            "font-family": "Source Sans Pro, sans-serif",
            //"font-weight": "700",
            "text-anchor": "middle",
            "fill": "white"
          },
          attr: {dy: "65px"},
          centralClick: function() {
            alert("Here is more details!!");
          }
        }
      },
      {
        name: "lines",
        options: {
          format: [
            {// Line #0
              textField: "count",
              classed: {count: true},
              style: {
                "font-size": "28px",
                "font-family": "Source Sans Pro, sans-serif",
                "text-anchor": "middle",
                fill: "white"
              },
              attr: {
                dy: "0px",
                x: function (d) {return d.cx;},
                y: function (d) {return d.cy;}
              }
            },
            {// Line #1
              textField: "text",
              classed: {text: true},
              style: {
                "font-size": "14px",
                "font-family": "Source Sans Pro, sans-serif",
                "text-anchor": "middle",
                fill: "white"
              },
              attr: {
                dy: "20px",
                x: function (d) {return d.cx;},
                y: function (d) {return d.cy;}
              }
            }
          ],
          centralFormat: [
            {// Line #0
              style: {"font-size": "50px"},
              attr: {}
            },
            {// Line #1
              style: {"font-size": "30px"},
              attr: {dy: "40px"}
            }
          ]
        }
      }]
  });
      },tiempo);

  
});
var tiempo = 2550;
function cargaEngranejitos() {
  
  gmGlobal.transition()
      .duration(tiempo)
      .attr("transform", "translate(-2200,-500)scale(7)").style("opacity","0");
  geGlobal.transition()
      .duration(tiempo)
      .attr("transform", "translate(-2200,-500)scale(7)").style("opacity","0");

      setTimeout(function(){
        $("#mainContent").html('<svg id="svgEngrane" width="100%" height="900" fill="none" stroke="#333"><path id="pathEngranaje"></path></svg>');
  var height = 500;
   var width = 500;
   var frameRadius = 250;
   var radius = 45;
   var speed = 4;
  var x = Math.sin(2 * Math.PI / 3);
  var y = Math.cos(2 * Math.PI / 3);
  var start = Date.now();

  svgEngraneGlobal = d3.select("#svgEngrane");
  
  frameGlobal = svgEngraneGlobal.append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
    .append("g")
      .datum({radius: +frameRadius});

  var path = frameGlobal.selectAll("g")
    .data([
      {fill: "#c6dbef", teeth: 80, radius: -radius * 5, origin: [0, 0], annulus: true},
      {fill: "#6baed6", teeth: 16, radius: radius, origin: [0, 0]},
      {fill: "#9ecae1", teeth: 32, radius: -radius * 2, origin: [0, -radius * 3]},
      {fill: "#9ecae1", teeth: 32, radius: -radius * 2, origin: [-radius * 3 * x, -radius * 3 * y]},
      {fill: "#9ecae1", teeth: 32, radius: -radius * 2, origin: [radius * 3 * x, -radius * 3 * y]}
     ])
    .join("g")
      .attr("transform", d => `translate(${d.origin})`)
    .append("path")
      .attr("stroke", "black")
      .attr("fill", d => d.fill)
      .attr("d", gear);

 frameGlobal.append("text").attr("id","ingresosEngranaje")
       .attr("dx", function(d){return 68}).attr("dy", function(d){return 100})
      .text(function(d){return "INGRESOS: $0.00"});

      frameGlobal.append("text").attr("id","gastosEngranaje")
      .attr("dx", function(d){return -38}).attr("dy", function(d){return -150})
      .text(function(d){return "GASTOS: $0.00"});

      frameGlobal.append("text").attr("id","subirEngranaje")
      .attr("dx", function(d){return -188}).attr("dy", function(d){return 100})
      .text(function(d){return "SUBIR PRESUPUESTO"});


      $("#ingresosEngranaje").css("cursor","pointer");
      $("#ingresosEngranaje").css("color","#00F");
      $("#ingresosEngranaje").css("text-decoration","underline");

      $("#gastosEngranaje").css("cursor","pointer");
      $("#gastosEngranaje").css("color","#00F");
      $("#gastosEngranaje").css("text-decoration","underline");

      $("#subirEngranaje").css("cursor","pointer");
      $("#subirEngranaje").css("color","#00F");
      $("#subirEngranaje").css("text-decoration","underline");
    /*  var canvas2 = d3.select("#svgEngrane");
  canvas2.call(d3.zoom()
    .scaleExtent([1 / 2, 4])
    .on("zoom", zoomedEngrane));
  */
  var gm = d3.select("#svgEngrane").select("g");
  gm.transition()
      .duration(1)
      .attr("transform", "translate(500,500)scale(0.1)");
gm.transition()
      .duration(tiempo)
      .attr("transform", "translate(500,500)scale(1)");

 interGlobal = setInterval( function() {
    var angle = (Date.now() - start) * speed;
    var transform1 = d => `rotate(${angle / d.radius})`;
    path.attr("transform", transform1);
    frameGlobal.attr("transform", transform1);
    svgEngraneGlobal.node();
},50);
  
      },tiempo);

  
  
}
var interGlobal;
function ponFuegosArtificiales() {
   $("#mainContent").html('<canvas id="mycanvas" width="1399" height="387.79999999999995"></canvas>');
        var canvas = document.getElementById("mycanvas"),
    ctx = canvas.getContext("2d"),
    width = 1600,
    height = 768;
w = window, d = document, e = d.documentElement, g = d.getElementsByTagName("body")[0], x = e.clientWidth || w.innerWidth || g.clientWidth, y = e.clientHeight || w.innerHeight || g.clientHeight, width = x < 800 ? 800 : x, height = .7 * y, canvas.setAttribute("width", width), canvas.setAttribute("height", height);
var backimg = new Image;
backimg.src = "static/night-trees-stars.jpg";

setInterval(function() {
    ctx.save(), ctx.globalAlpha = .2, ctx.fillStyle = "black", ctx.fillRect(0, 0, width, height), ctx.drawImage(backimg, 0, 0, 1600, 1067, 0, 0, width, height), ctx.restore(), ctx.save(), ctx.globalCompositeOperation = "lighter", Math.random() < .1 && fireworks.length < 50 && (fireworks.push(new Firework(ctx, width, height)), fireworks[fireworks.length - 1].init({
        x: 50 + Math.random() * (width - 50),
        y: 90 + 100 * Math.random()
    }, {
        h: Math.random(),
        s: 1,
        l: .6 + .3 * Math.random()
    }, 1500 + 1e3 * Math.random(), parseInt(15 + 10 * Math.random()), 4 + 5 * Math.random()), fireworks[fireworks.length - 1].size = 4 + 3 * Math.random());
    for (var a = fireworks.length - 1; a >= 0; a--) fireworks[a].time < fireworks[a].duration ? (fireworks[a].update(), fireworks[a].render()) : fireworks.splice(a, 1);
    ctx.restore();
     delta = Date.now() - lastCalledTime, fps_count++, delta > 1e3 && (delta = (Date.now() - lastCalledTime) / 1e3, lastCalledTime = Date.now(), fps = fps_count, fps_count = 0), ctx.save(), ctx.globalCompositeOperation = "source-over", ctx.fillStyle = "white", ctx.restore();
}, 33), window.onresize = updateWindow;
}
function cargaPresupuesto()  {
   
var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>PreSunplus</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Instrucciones: Elige el rango de meses que se leer&aacute del SunPlus para armar el presupuesto.<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<label for="delPeriodoPresupuesto">Del periodo:</label>'+
                          '<select id="delPeriodoPresupuesto" class="form-control" required="" >'+
                            '</select>'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                       '<label for="alPeriodoPresupuesto">Al periodo:</label>'+
                          '<select id="alPeriodoPresupuesto" class="form-control" required="" >'+
                            '</select>'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="" id="numMesesPresupuesto" disabled class="form-control" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" disabled  id="anioDelPresupuesto" class="form-control" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="button" id="empezarPresupuesto" class="btn btn-success">Hacer Presupuesto</button>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12" id="tablaBudgetMain">'+
                    '</div>'+
                  '</div>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12" id="tablaBudgetSecundaria">'+
                    '</div>'+
                  '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);

       $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          var cadDel = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
            if(i==aver2.length-12) {
              cadDel=cadDel+'<option selected value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';  
            } else {
              cadDel=cadDel+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
            }

            
          } 
          $("#delPeriodoPresupuesto").html(cadDel);
          $("#alPeriodoPresupuesto").html(cad);
          $("#alPeriodoPresupuesto option:last").attr("selected","selected");
          var alPeriodo = $("#alPeriodoPresupuesto").val();
  
          var anioAl = parseInt(alPeriodo.substring(0,4));
          anioAl++;
          $("#anioDelPresupuesto").val("Presupuesto del año "+anioAl);
          $("#anioDelPresupuesto").attr("anio",anioAl);
          $("#numMesesPresupuesto").val("12 Meses");
          $("#empezarPresupuesto").html("Hacer presupuesto "+anioAl);
          $("#numMesesPresupuesto").attr("meses",12);
        }
      });
}
function calculaNumMeses() {
  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  var anioAl = parseInt(alPeriodo.substring(0,4));
  var anioDel = parseInt(delPeriodo.substring(0,4));
  var numMeses = (anioAl - anioDel) * 12;
  var mesAl = parseInt(alPeriodo.substring(5));
  var mesDel = parseInt(delPeriodo.substring(5));
  numMeses += (mesAl - mesDel)+1;//Math.abs
  $("#numMesesPresupuesto").val(numMeses+" Meses");
  $("#numMesesPresupuesto").attr("meses",numMeses);
  anioAl++;
  $("#anioDelPresupuesto").val("Presupuesto del año "+anioAl);
  $("#anioDelPresupuesto").attr("anio",anioAl);
  $("#empezarPresupuesto").html("Hacer presupuesto "+anioAl);
}







function ponMediosComunicacionGastosPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoMediosComunicacion",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var anio = parseInt($("#anioDelPresupuesto").attr("anio"));

        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Departamento</b></td><td><b>Presupuesto para todo el a&ntilde;o '+(anio+0)+'</b></td><td><b>Proyecto</b></td><td><b>Eliminar</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.viajes);
        var total = 0.0;
        var cuenta = "865210";
        var aver3 = Object.keys(resp.proyectos);
        var proyecto = "";
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.viajes[aver2[i]].Anual)).format('$0,0.00');
          console.log(resp.viajes[aver2[i]].ANAL_T3);
          var funcion = resp.funciones[resp.viajes[aver2[i]].ANAL_T3].NAME;
          if(aver3.indexOf(resp.viajes[aver2[i]].ANAL_T8)==-1) {
            proyecto = "";
          } else {
            proyecto = resp.proyectos[resp.viajes[aver2[i]].ANAL_T8].NAME;
          }
          var desc = resp.viajes[aver2[i]].DESCRIPTN;
          total+= parseFloat(resp.viajes[aver2[i]].Anual);
          cad=cad+'<tr><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.viajes[aver2[i]].ANAL_T3+'&d3e='+resp.viajes[aver2[i]].ANAL_T3+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s='+resp.viajes[aver2[i]].ANAL_T8+'&d8e='+resp.viajes[aver2[i]].ANAL_T8+'&d9s=&d9e=&busca=0">'+funcion+' - '+proyecto+'</a></td><td>'+string+'</td><td>'+desc+'</td><td><img src="static/img/tacha.jpg" class="borrarMediosComunicacion" idPresupuestoEventos="'+aver2[i]+'" width="30px" height="30px"/></td></tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
          
        cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';

        aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Escribe el nombre del evento" class="form-control" id="eventoDESCR" /><br><br><br><h2>Selecciona un proyecto:</h2><br><select id="selectProyecto" class="form-group" style="font-size:20px">';
        aver2 = Object.keys(resp.proyectos);
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.proyectos[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Cantidad anual del evento" class="form-control soloNumeros" id="anualEventos" /><br><br><button type="button" id="addBudgetMediosComunicacion" class="btn btn-success">Agregar para medios y comunicaci&oacute;n</button><br><br>';
        
        $("#tablaBudgetSecundaria").html(cad);
        $("html, body").animate({ scrollTop: 10000 }, "slow");
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaMediosComunicacionPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}
function ponCongresosGastosPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoCongresos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var anio = parseInt($("#anioDelPresupuesto").attr("anio"));

        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Departamento</b></td><td><b>Presupuesto para todo el a&ntilde;o '+(anio+0)+'</b></td><td><b>Proyecto</b></td><td><b>Eliminar</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.viajes);
        var total = 0.0;
        var cuenta = "862160";
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.viajes[aver2[i]].Anual)).format('$0,0.00');
          console.log(resp.viajes[aver2[i]].ANAL_T3);
          var funcion = resp.funciones[resp.viajes[aver2[i]].ANAL_T3].NAME;
          var proyecto = resp.proyectos[resp.viajes[aver2[i]].ANAL_T8].NAME;
          var desc = resp.viajes[aver2[i]].DESCRIPTN;
          total+= parseFloat(resp.viajes[aver2[i]].Anual);
          cad=cad+'<tr><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.viajes[aver2[i]].ANAL_T3+'&d3e='+resp.viajes[aver2[i]].ANAL_T3+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s='+resp.viajes[aver2[i]].ANAL_T8+'&d8e='+resp.viajes[aver2[i]].ANAL_T8+'&d9s=&d9e=&busca=0">'+funcion+' - '+proyecto+'</a></td><td>'+string+'</td><td>'+desc+'</td><td><img src="static/img/tacha.jpg" class="borrarCongresos" idPresupuestoEventos="'+aver2[i]+'" width="30px" height="30px"/></td></tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
          
        cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';

        aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Escribe el nombre del evento" class="form-control" id="eventoDESCR" /><br><br><br><h2>Selecciona un proyecto:</h2><br><select id="selectProyecto" class="form-group" style="font-size:20px">';
        aver2 = Object.keys(resp.proyectos);
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.proyectos[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Cantidad anual del evento" class="form-control soloNumeros" id="anualEventos" /><br><br><button type="button" id="addBudgetCongresos" class="btn btn-success">Agregar presupuesto de congresos y eventos</button><br><br>';
        
        $("#tablaBudgetSecundaria").html(cad);
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaCongresosPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}

function ponProgramasGastosPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoEventos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var anio = parseInt($("#anioDelPresupuesto").attr("anio"));

        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Departamento</b></td><td><b>Presupuesto para todo el a&ntilde;o '+(anio+0)+'</b></td><td><b>Proyecto</b></td><td><b>Eliminar</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.viajes);
        var total = 0.0;
        var cuenta = "862110";
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.viajes[aver2[i]].Anual)).format('$0,0.00');
          console.log(resp.viajes[aver2[i]].ANAL_T3);
          var funcion = resp.funciones[resp.viajes[aver2[i]].ANAL_T3].NAME;
          var proyecto = resp.proyectos[resp.viajes[aver2[i]].ANAL_T8].NAME;
          var desc = resp.viajes[aver2[i]].DESCRIPTN;
          total+= parseFloat(resp.viajes[aver2[i]].Anual);
          cad=cad+'<tr><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.viajes[aver2[i]].ANAL_T3+'&d3e='+resp.viajes[aver2[i]].ANAL_T3+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s='+resp.viajes[aver2[i]].ANAL_T8+'&d8e='+resp.viajes[aver2[i]].ANAL_T8+'&d9s=&d9e=&busca=0">'+funcion+' - '+proyecto+'</a></td><td>'+string+'</td><td>'+desc+'</td><td><img src="static/img/tacha.jpg" class="borrarEventos" idPresupuestoEventos="'+aver2[i]+'" width="30px" height="30px"/></td></tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
          
        cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';

        aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Escribe el nombre del evento" class="form-control" id="eventoDESCR" /><br><br><br><h2>Selecciona un proyecto:</h2><br><select id="selectProyecto" class="form-group" style="font-size:20px">';
        aver2 = Object.keys(resp.proyectos);
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.proyectos[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Cantidad anual del evento" class="form-control soloNumeros" id="anualEventos" /><br><br><button type="button" id="addBudgetEventos" class="btn btn-success">Agregar presupuesto de programas espec&iacute;ficos de evengalismo</button><br><br>';
        
        $("#tablaBudgetSecundaria").html(cad);
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaEventosPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}

var baseParaPresupuesto = 15000;
$(document).on("click", ".seleccionaPersonaManutencionPresupuesto", function (){ 
  var idPresupuestoNomina = $(this).attr("idPresupuestoNomina");

  $.ajax({
    url: "/datosPresupuestoEmpleados",
    dataType : "json",
    type : "post",
    async : true,
    data : {idPresupuestoNomina : idPresupuestoNomina},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var funcion = resp.FNCT;
        var string = numeral(parseFloat(resp.Manutencion)).format('$0,0.00');
        var string2 = numeral(parseFloat(resp.SobreSueldo)).format('$0,0.00');
        var string3 = numeral(parseFloat(resp.AyudaAuto)).format('$0,0.00');
        var FOBONO = parseFloat(resp.Sueldo)*baseParaPresupuesto*0.029;
        var string4 = numeral(parseFloat(resp.FO)).format('$0,0.00');

        

        var string5 = numeral(parseFloat(resp.AJ)).format('$0,0.00');
        var string6 = numeral(parseFloat(resp.PI)).format('$0,0.00');
        var string7 = numeral(parseFloat(resp.PS)).format('$0,0.00');
        var string8 = numeral(parseFloat(resp.Maestria)).format('$0,0.00');

        var stringV = numeral(parseFloat(resp.V)).format('$0,0.00');
        var stringA = numeral(parseFloat(resp.A)).format('$0,0.00');
        
        //  ER,IMSS
        var granTotal = resp.Manutencion + resp.SobreSueldo + resp.AyudaAuto + resp.Maestria + resp.V + resp.A + resp.CG + resp.AT + resp.AE + resp.FO + resp.AJ + resp.PI + resp.PS + resp.IMSS;
        var string9 = numeral(parseFloat(granTotal)).format('$0,0.00');
        var swal_html='<div depar="'+resp.Departamento+'" id="guardaIDNomina" idPresupuestoNomina='+idPresupuestoNomina+' class="container">\
  <h2>'+resp.Nombre+'</h2>\
  <div class="card">\
    <div class="card-header">'+funcion+'</div>\
    <div class="card-body" style="text-align:center;"><table style="font-size:20px;" st class="table table-striped"><tbody>\
    <tr><td>Puntos de sueldo:</td><td><input  style="font-size:20px;" type="text" value="'+resp.Sueldo+'" placeholder="" id="puntosSueldos" class="soloNumeros form-control textNominaP"/></td>&nbsp;&nbsp;&nbsp;\
    <td>Puntos de sobresueldo:</td><td><input style="font-size:20px;" type="text" value="'+resp.SS+'" placeholder="" id="puntosSS" class="soloNumeros form-control textNominaP"/></td></tr>\
    <tr><td>Puntos de ayuda de auto:</td><td><input style="font-size:20px;" type="text" value="'+resp.AA+'" placeholder="" id="puntosAA" class="soloNumeros form-control textNominaP"/></td>&nbsp;&nbsp;&nbsp;\
    <td>Puntos de M/D:</td><td><input style="font-size:20px;" type="text" value="'+resp.MD+'" placeholder="" id="puntosMD" class="soloNumeros form-control textNominaP"/></td></tr>\
    <tr><td>Manutenci&oacute;n:</td><td id="manunPresupuesto">'+string+'</td>&nbsp;&nbsp;&nbsp;\
    <td>S/S:</td><td id="sobrePresupuesto">'+string2+'</td></tr>\
    <tr><td>A/A:</td><td id="AAPresupuesto">'+string3+'</td>&nbsp;&nbsp;&nbsp;<td>M/D:</td><td id="MDPresupuesto">'+string8+'</td></tr>\
    <tr><td>Puntos de Vacaciones:</td><td><input style="font-size:20px;" type="text" value="'+resp.VP+'" placeholder="" id="V" class="soloNumeros form-control textNominaP"/></td>&nbsp;&nbsp;&nbsp;\
    <td>Puntos de Aguinaldo:</td><td><input style="font-size:20px;" type="text" value="'+resp.AP+'" placeholder="" id="A" class="soloNumeros form-control textNominaP"/></td></tr>\
 <tr><td>Vacaciones:</td><td id="VPresupuesto">'+stringV+'</td>&nbsp;&nbsp;&nbsp;<td>Aguinaldo:</td><td id="APresupuesto">'+stringA+'</td></tr>\
    <tr><td>Renta anual en $</td><td><input style="font-size:20px;" type="text" value="'+resp.CG+'" placeholder="" id="CG" class="soloNumeros form-control textNominaP"/></td>&nbsp;&nbsp;&nbsp;\
    <td>Ayuda de transporte en $</td><td><input style="font-size:20px;" type="text" value="'+resp.AT+'" placeholder="" id="AT" class="soloNumeros form-control textNominaP"/></td></tr>\
    <tr><td colspan="2">Ayuda educacional en $</td><td colspan="2"><input style="font-size:20px;" type="text" value="'+resp.AE+'" placeholder="" id="AE" class="soloNumeros form-control textNominaP"/></td></tr>\
    <tr><td>FOBONO:</td><td id="FOPresupuesto">'+string4+'</td>&nbsp;&nbsp;&nbsp;\
    <td>Aport. Jubilaci&oacute;n:</td><td id="AJPresupuesto">'+string5+'</td></tr>\
    <tr><td>P. Incapacidad:</td><td id="PIPresupuesto">'+string6+'</td>&nbsp;&nbsp;&nbsp;\
    <td>P. de Salud:</td><td id="PSPresupuesto">'+string7+'</td></tr>\
    <tr><td colspan="2">IMSS E INFONAVIT en $:</td><td colspan="2"><input style="font-size:20px;" type="text" value="'+resp.IMSS+'" placeholder="" id="imssObrero" class="soloNumeros form-control textNominaP"/></td></tr>\
    <tr><td colspan="2"><b>Gran total del obrero:</b></td><td colspan="2"><b id="totalDelObrero">'+string9+'</b></td></tr>\
    </tbody></table></div>\
    <div class="card-footer">'+resp.Departamento+'</div>\
  </div>\
</div>';
        Swal({title:"", html: swal_html}).then((result) => {
          var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
          ponEmpleadosGastosPresupuesto(anio);
  
        });
      }
    }
  });
});

$(document).on("keyup", ".textNominaP", function (){ 
  grabaPersonaManutencionPresupuesto();
});
function grabaPersonaManutencionPresupuesto() {
  var puntosSueldos = $("#puntosSueldos").val().trim();
  if(puntosSueldos==""){
    puntosSueldos=0;
  } 
  var puntosSS = $("#puntosSS").val().trim();
  if(puntosSS==""){
    puntosSS=0;
  } 
  var puntosAA = $("#puntosAA").val().trim();
  if(puntosAA==""){
    puntosAA=0;
  } 
  var puntosMD = $("#puntosMD").val().trim();
  if(puntosMD==""){
    puntosMD=0;
  } 
  var V = $("#V").val().trim();
  if(V==""){
    V=0;
  }
  var A = $("#A").val().trim();
  if(A==""){
    A=0;
  } 
  var CG = $("#CG").val().trim();
  if(CG==""){
    CG=0;
  }
  var AT = $("#AT").val().trim();
  if(AT==""){
    AT=0;
  } 
  var AE = $("#AE").val().trim();
  if(AE==""){
    AE=0;
  } 
  var imssObrero = $("#imssObrero").val().trim();
  if(imssObrero==""){
    imssObrero=0;
  } 
  var idPresupuestoNomina = $("#guardaIDNomina").attr("idPresupuestoNomina");
  var Departamento = $("#guardaIDNomina").attr("depar");
  $.ajax({
    url: "/guardaDatosPresupuestoEmpleados",
    dataType : "json",
    type : "post",
    async : true,
    data : {Departamento : Departamento,puntosSueldos: puntosSueldos, puntosSS : puntosSS, puntosAA : puntosAA, puntosMD : puntosMD, idPresupuestoNomina : idPresupuestoNomina, imssObrero : imssObrero, AE : AE, AT: AT, CG:CG, A:A, V:V},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        recalculaPersonaManutencionPresupuesto(idPresupuestoNomina);
      }
    }
  });
}

function recalculaPersonaManutencionPresupuesto(idPresupuestoNomina) {
  $.ajax({
    url: "/datosPresupuestoEmpleados",
    dataType : "json",
    type : "post",
    async : true,
    data : {idPresupuestoNomina : idPresupuestoNomina},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var string = numeral(parseFloat(resp.Manutencion)).format('$0,0.00');
        var string2 = numeral(parseFloat(resp.SobreSueldo)).format('$0,0.00');
        var string3 = numeral(parseFloat(resp.AyudaAuto)).format('$0,0.00');
        var string8 = numeral(parseFloat(resp.Maestria)).format('$0,0.00');
        var stringV = numeral(parseFloat(resp.V)).format('$0,0.00');
        var stringA = numeral(parseFloat(resp.A)).format('$0,0.00');

        var string4 = numeral(parseFloat(resp.FO)).format('$0,0.00');
        var string5 = numeral(parseFloat(resp.AJ)).format('$0,0.00');
        var string6 = numeral(parseFloat(resp.PI)).format('$0,0.00');
        var string7 = numeral(parseFloat(resp.PS)).format('$0,0.00');
        
        

        $("#manunPresupuesto").html(string);
        $("#sobrePresupuesto").html(string2);
        $("#AAPresupuesto").html(string3);
        $("#MDPresupuesto").html(string8);

        $("#VPresupuesto").html(stringV);
        $("#APresupuesto").html(stringA);

        $("#FOPresupuesto").html(string4);
        $("#AJPresupuesto").html(string5);
        $("#PIPresupuesto").html(string6);
        $("#PSPresupuesto").html(string7);
        var granTotal = resp.Manutencion + resp.SobreSueldo + resp.AyudaAuto + resp.Maestria + resp.V + resp.A + resp.CG + resp.AT + resp.AE + resp.FO + resp.AJ + resp.PI + resp.PS + resp.IMSS;
        var string9 = numeral(parseFloat(granTotal)).format('$0,0.00');
        $("#totalDelObrero").html(string9);
      }
    }
  });
}

function ponEmpleadosGastosPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoEmpleados",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
 
        var cad = '<table id="manunTable" style="font-size:20px;" class="table table-striped"><tbody>';
        var tm = 0, ts = 0, taa = 0, tmd = 0, tv = 0, tag = 0, tae = 0, tat = 0;
        var tcg = 0, tfo =0, tju =0, tj = 0, tpi =0, tps=0, timss = 0, tt=0;
        cad=cad+'<tr><td><b>Nombre</b></td><td><b>Manutenci&oacute;n</b></td>\
        <td><b>Sobresueldo</b></td>\
        <td><b>Ayuda Auto</b></td>\
        <td><b>Maestria</b></td>\
        <td><b>Vacaciones</b></td>\
        <td><b>Aguinaldo</b></td>\
        <td><b>A. Educativa</b></td>\
        <td><b>A. Trasporte</b></td>\
        <td><b>C. Gobierno</b></td>\
        <td><b>Fobono</b></td>\
        <td><b>Jubilaci&oacute;n</b></td>\
        <td><b>P. Inca. Salud</b></td>\
        <td><b>P. Salud</b></td>\
        <td><b>IMSS</b></td>\
        <td><b>Total</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.manun);
        var total = 0.0;
        var cuenta = "822110";
        var aver3 = Object.keys(resp.funciones);
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.manun[aver2[i]].FNCT) || resp.manun[aver2[i]].FNCT.length<6) {
            console.log(resp.manun[aver2[i]].FNCT);
            continue;
          }
           tt+=parseFloat(resp.manun[aver2[i]].GT);
          var string = numeral(parseFloat(resp.manun[aver2[i]].GT)).format('$0,0.00');
          console.log(resp.manun[aver2[i]].FNCT);
         
          var stringM = numeral(parseFloat(resp.manun[aver2[i]].Manutencion)).format('$0,0.00');
          tm+=parseFloat(resp.manun[aver2[i]].Manutencion);
          var stringSS = numeral(parseFloat(resp.manun[aver2[i]].SobreSueldo)).format('$0,0.00');
          ts+=parseFloat(resp.manun[aver2[i]].SobreSueldo);
          var stringAA = numeral(parseFloat(resp.manun[aver2[i]].AyudaAuto)).format('$0,0.00');
          taa+=parseFloat(resp.manun[aver2[i]].AyudaAuto);
          var stringMD = numeral(parseFloat(resp.manun[aver2[i]].MD/100)*baseParaPresupuesto*12).format('$0,0.00');
          tmd+=parseFloat(resp.manun[aver2[i]].MD/100)*baseParaPresupuesto*12;
          var stringV = numeral(parseFloat(resp.manun[aver2[i]].V)).format('$0,0.00');
          tv+=parseFloat(resp.manun[aver2[i]].V);
          var stringA = numeral(parseFloat(resp.manun[aver2[i]].A)).format('$0,0.00');
          tag+=parseFloat(resp.manun[aver2[i]].A);
          var stringAE = numeral(parseFloat(resp.manun[aver2[i]].AE)).format('$0,0.00');
          tae+=parseFloat(resp.manun[aver2[i]].AE);
          var stringAT = numeral(parseFloat(resp.manun[aver2[i]].AT)).format('$0,0.00');
          tat+=parseFloat(resp.manun[aver2[i]].AT);
          var stringCG = numeral(parseFloat(resp.manun[aver2[i]].CG)).format('$0,0.00');
          tcg+=parseFloat(resp.manun[aver2[i]].CG);
          var stringFO = numeral(parseFloat(resp.manun[aver2[i]].FO)).format('$0,0.00');
          tfo+=parseFloat(resp.manun[aver2[i]].FO);
          var stringAJ = numeral(parseFloat(resp.manun[aver2[i]].AJ)).format('$0,0.00');
          tju+=parseFloat(resp.manun[aver2[i]].AJ);
          var stringPI = numeral(parseFloat(resp.manun[aver2[i]].PI)).format('$0,0.00');
          tpi+=parseFloat(resp.manun[aver2[i]].PI);
          var stringPS = numeral(parseFloat(resp.manun[aver2[i]].PS)).format('$0,0.00');
          tps+=parseFloat(resp.manun[aver2[i]].PS);
          var stringIMSS = numeral(parseFloat(resp.manun[aver2[i]].IMSS)).format('$0,0.00');
          timss+=parseFloat(resp.manun[aver2[i]].IMSS);
         
          var todos = tm+ts+taa+tmd+tv+tag+tae+tat+tcg+tfo+tju+tpi+tps+timss;

          var todos2 = resp.manun[aver2[i]].Manutencion+resp.manun[aver2[i]].SobreSueldo+resp.manun[aver2[i]].AyudaAuto+(parseFloat(resp.manun[aver2[i]].MD/100)*baseParaPresupuesto*12)+resp.manun[aver2[i]].V+resp.manun[aver2[i]].A+resp.manun[aver2[i]].AE+resp.manun[aver2[i]].AT+resp.manun[aver2[i]].CG+resp.manun[aver2[i]].FO+resp.manun[aver2[i]].AJ+resp.manun[aver2[i]].PI+resp.manun[aver2[i]].PS+resp.manun[aver2[i]].IMSS;
if(true || resp.manun[aver2[i]].FNCT.trim()=="DTNICOL01"){
  console.log(resp.manun[aver2[i]].Manutencion);
  console.log(resp.manun[aver2[i]].SobreSueldo);
  console.log(resp.manun[aver2[i]].AyudaAuto);
  console.log((parseFloat(resp.manun[aver2[i]].MD/100)*baseParaPresupuesto*12));
  console.log(resp.manun[aver2[i]].V);
  console.log(resp.manun[aver2[i]].A);
  console.log(resp.manun[aver2[i]].AE);
  console.log(resp.manun[aver2[i]].AT);
  console.log(resp.manun[aver2[i]].CG);
  console.log(resp.manun[aver2[i]].FO);
  console.log(resp.manun[aver2[i]].PI);
  console.log(resp.manun[aver2[i]].PS);
  console.log(resp.manun[aver2[i]].IMSS);
  console.log(resp.manun[aver2[i]].GT+"   VS   "+todos2);
  //15602552.05
}
          
       
          var funcion = resp.funciones[resp.manun[aver2[i]].FNCT].NAME;
          var depar = resp.manun[aver2[i]].Departamento + " - "+funcion;
          total+= parseFloat(resp.manun[aver2[i]].GT);
          cad=cad+'<tr><td idPresupuestoNomina="'+resp.manun[aver2[i]].IdPresupuestoNomina+'" class="seleccionaPersonaManutencionPresupuesto" er="'+resp.manun[aver2[i]].ER+'"><u style="cursor:pointer;">'+resp.manun[aver2[i]].Nombre+'</u></td><td>'+stringM+'</td>\
          <td>'+stringSS+'</td>\
          <td>'+stringAA+'</td>\
          <td>'+stringMD+'</td>\
          <td>'+stringV+'</td>\
          <td>'+stringA+'</td>\
          <td>'+stringAE+'</td>\
          <td>'+stringAT+'</td>\
          <td>'+stringCG+'</td>\
          <td>'+stringFO+'</td>\
          <td>'+stringAJ+'</td>\
          <td>'+stringPI+'</td>\
          <td>'+stringPS+'</td>\
          <td>'+stringIMSS+'</td>\
          <td>'+string+'</td></tr>';
        }
        var string = numeral(parseFloat(tt)).format('$0,0.00');

        var stringM = numeral(tm).format('$0,0.00');
        var stringSS = numeral(ts).format('$0,0.00');
        var stringAA = numeral(taa).format('$0,0.00');
        var stringMD = numeral(tmd).format('$0,0.00');
        var stringV = numeral(tv).format('$0,0.00');
        var stringA = numeral(tag).format('$0,0.00');
        var stringAE = numeral(tae).format('$0,0.00');
        var stringAT = numeral(tat).format('$0,0.00');
        var stringCG = numeral(tcg).format('$0,0.00');
        var stringFO = numeral(tfo).format('$0,0.00');
        var stringAJ = numeral(tju).format('$0,0.00');
        var stringPI = numeral(tpi).format('$0,0.00');
        var stringPS = numeral(tps).format('$0,0.00');
        var stringIMSS = numeral(timss).format('$0,0.00');

        var todos = tm+ts+taa+tmd+tv+tag+tae+tat+tcg+tfo+tju+tpi+tps+timss;
        console.log(tt+"  VS  "+todos);
        
        
        cad=cad+'<tr><td>Totales:</td><td>'+stringM+'</td>\
          <td>'+stringSS+'</td>\
          <td>'+stringAA+'</td>\
          <td>'+stringMD+'</td>\
          <td>'+stringV+'</td>\
          <td>'+stringA+'</td>\
          <td>'+stringAE+'</td>\
          <td>'+stringAT+'</td>\
          <td>'+stringCG+'</td>\
          <td>'+stringFO+'</td>\
          <td>'+stringAJ+'</td>\
          <td>'+stringPI+'</td>\
          <td>'+stringPS+'</td>\
          <td>'+stringIMSS+'</td><td>'+string+'</td></tr>';

        //aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table>';
        
        $("#tablaBudgetSecundaria").html(cad);
        //$('#manunTable').DataTable();
        $("html, body").animate({ scrollTop: 10000 }, "slow");
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaNominaPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
        
      }
    }
  });
}

function ponDiezmosEspecialesPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoDiezmosEspeciales",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
 
        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Org ID</b></td><td><b>Presupuesto para todo el a&ntilde;o '+(anio+0)+'</b></td><td><b>Eliminar</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.viajes);
        var total = 0.0;
        var cuenta = "612130";
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.viajes[aver2[i]].Anual)).format('$0,0.00');
          
          var reestriccion = resp.reestricciones[resp.viajes[aver2[i]].ANAL_T4].NAME;
          var orgId = resp.orgId[resp.viajes[aver2[i]].ANAL_T5].NAME;
          total+= parseFloat(resp.viajes[aver2[i]].Anual);
          cad=cad+'<tr><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s='+resp.viajes[aver2[i]].ANAL_T4+'&d4e='+resp.viajes[aver2[i]].ANAL_T4+'&d5s='+resp.viajes[aver2[i]].ANAL_T5+'&d5e='+resp.viajes[aver2[i]].ANAL_T5+'&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+reestriccion+' - '+orgId+'</a></td><td>'+string+'</td><td><img src="static/img/tacha.jpg" class="borrarDiezmosEspeciales" idPresupuestoViajes="'+aver2[i]+'" width="30px" height="30px"/></td></tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
          
        cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';

        aver2 = Object.keys(resp.reestricciones);

        cad=cad+'</tbody></table><br><hr><br><h2>Selecciona una reestricci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.reestricciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><h2>Selecciona un proyecto:</h2><br><select id="selectProyecto" class="form-group" style="font-size:20px">';
        aver2 = Object.keys(resp.orgId);
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.orgId[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Cantidad anual de diezmos especiales" class="form-control soloNumeros" id="anualDiezmosEspeciales" /><br><br><button type="button" id="addBudgetDiezmosEspeciales" class="btn btn-success">Agregar presupuesto de diezmos especiales</button><br><br>';
        
        $("#tablaBudgetSecundaria").html(cad);
        $("html, body").animate({ scrollTop: 10000 }, "slow");
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaDiezmosEspeciales",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}

function ponViajesGastosPresupuesto(anio) {
  var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
  anio--;
  var delPeriodo = ""+anio+"001";
  var alPeriodo = ""+anio+"012";
  
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/presupuestoViajes",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto,  delPeriodo:delPeriodo, alPeriodo:alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
 
        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Departamento</b></td><td><b>Presupuesto para todo el a&ntilde;o '+(anio+0)+'</b></td><td><b>Eliminar</b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.viajes);
        var total = 0.0;
        var cuenta = "822110";
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.viajes[aver2[i]].Anual)).format('$0,0.00');
          
          var funcion = resp.funciones[resp.viajes[aver2[i]].ANAL_T3].NAME;
          var proyecto = resp.proyectos[resp.viajes[aver2[i]].ANAL_T8].NAME;
          total+= parseFloat(resp.viajes[aver2[i]].Anual);
          cad=cad+'<tr><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.viajes[aver2[i]].ANAL_T3+'&d3e='+resp.viajes[aver2[i]].ANAL_T3+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s='+resp.viajes[aver2[i]].ANAL_T8+'&d8e='+resp.viajes[aver2[i]].ANAL_T8+'&d9s=&d9e=&busca=0">'+funcion+' - '+proyecto+'</a></td><td>'+string+'</td><td><img src="static/img/tacha.jpg" class="borrarViajes" idPresupuestoViajes="'+aver2[i]+'" width="30px" height="30px"/></td></tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
          
        cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';

        aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><h2>Selecciona un proyecto:</h2><br><select id="selectProyecto" class="form-group" style="font-size:20px">';
        aver2 = Object.keys(resp.proyectos);
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.proyectos[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Cantidad anual de viajes" class="form-control soloNumeros" id="anualViajes" /><br><br><button type="button" id="addBudgetViajes" class="btn btn-success">Agregar presupuesto de viajes</button><br><br>';
        
        $("#tablaBudgetSecundaria").html(cad);
        $("html, body").animate({ scrollTop: 10000 }, "slow");
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaViajesPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}


$(document).on("click", ".borrarDistritoDiezmo", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoDiezmosDistritos = $(this).attr("idPresupuestoDiezmosDistritos");
  $.ajax({
    url: "/eliminaLineaPresupuestoDiezmosDistritos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoDiezmosDistritos : idPresupuestoDiezmosDistritos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponPresupuestoAnio(anio);
      }
    }
  });
});


$(document).on("click", ".borrarDistritoOfrenda", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoOfrendasDistritos = $(this).attr("idPresupuestoOfrendasDistritos");
  $.ajax({
    url: "/eliminaLineaPresupuestoOfrendasDistritos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoOfrendasDistritos : idPresupuestoOfrendasDistritos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponPresupuestoAnio(anio);
      }
    }
  });
});

$(document).on("click", ".borrarMediosComunicacion", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoEventos = $(this).attr("idPresupuestoEventos");
  $.ajax({
    url: "/eliminaLineaPresupuestoMediosComunicacion",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoEventos : idPresupuestoEventos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
       // ponMediosComunicacionGastosPresupuesto(anio);
      }
    }
  });
});


$(document).on("click", ".borrarCongresos", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoEventos = $(this).attr("idPresupuestoEventos");
  $.ajax({
    url: "/eliminaLineaPresupuestoCongresos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoEventos : idPresupuestoEventos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponCongresosGastosPresupuesto(anio);
      }
    }
  });
});

$(document).on("click", ".borrarEventos", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoEventos = $(this).attr("idPresupuestoEventos");
  $.ajax({
    url: "/eliminaLineaPresupuestoEventos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoEventos : idPresupuestoEventos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponProgramasGastosPresupuesto(anio);
      }
    }
  });
});

$(document).on("click", ".borrarDiezmosEspeciales", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoViajes = $(this).attr("idPresupuestoViajes");
  $.ajax({
    url: "/eliminaLineaDiezmosEspeciales",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoViajes : idPresupuestoViajes},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponDiezmosEspecialesPresupuesto(anio);
      }
    }
  });
});


$(document).on("click", ".borrarViajes", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuestoViajes = $(this).attr("idPresupuestoViajes");
  $.ajax({
    url: "/eliminaLineaPresupuestoViajes",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuestoViajes : idPresupuestoViajes},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponViajesGastosPresupuesto(anio);
      }
    }
  });
});

$(document).on("click", "#addBudgetMediosComunicacion", function (){ 
  var can = $("#anualEventos").val();
  var descr = $("#eventoDESCR").val();
  var funcion = $("#selectFunction").val();
  var proyecto = $("#selectProyecto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoMediosComunicacion",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, proyecto : proyecto, funcion : funcion, can : can, descr:descr},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponMediosComunicacionGastosPresupuesto(anio);
      }
    }
  });
});


$(document).on("click", "#addBudgetCongresos", function (){ 
  var can = $("#anualEventos").val();
  var descr = $("#eventoDESCR").val();
  var funcion = $("#selectFunction").val();
  var proyecto = $("#selectProyecto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoCongresos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, proyecto : proyecto, funcion : funcion, can : can, descr:descr},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponCongresosGastosPresupuesto(anio);
      }
    }
  });
});


$(document).on("click", "#addBudgetEventos", function (){ 
  var can = $("#anualEventos").val();
  var descr = $("#eventoDESCR").val();
  var funcion = $("#selectFunction").val();
  var proyecto = $("#selectProyecto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoEventos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, proyecto : proyecto, funcion : funcion, can : can, descr:descr},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponProgramasGastosPresupuesto(anio);
      }
    }
  });
});




$(document).on("click", "#addBudgetDiezmo", function (){ 
  var can = $("#diezmoCantidad").val();
  var funcion = $("#selectFunction").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var descr = $("#selectFunction option:selected").html();
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoDiezmosDistrito",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, funcion : funcion, can : can, descr : descr},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponPresupuestoAnio(anio);
      }
    }
  });
});

$(document).on("click", "#addBudgeOfrenda", function (){ 
  var can = $("#ofrendaCantidad").val();
  var funcion = $("#selectFunction").val();
  var descripcion = $("#selectFunction option:selected").html();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoOfrendasDistrito",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, funcion : funcion, can : can, descripcion:descripcion},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponPresupuestoOfrendasAnio(anio);
      }
    }
  });
});


$(document).on("click", "#addBudgetDiezmosEspeciales", function (){ 
  var can = $("#anualDiezmosEspeciales").val();
  var funcion = $("#selectFunction").val();
  var proyecto = $("#selectProyecto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoDiezmosEspeciales",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, proyecto : proyecto, funcion : funcion, can : can},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponDiezmosEspecialesPresupuesto(anio);
      }
    }
  });
});


$(document).on("click", "#addBudgetViajes", function (){ 
  var can = $("#anualViajes").val();
  var funcion = $("#selectFunction").val();
  var proyecto = $("#selectProyecto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $("#anioDelPresupuesto").attr("idPresupuesto");
  $.ajax({
    url: "/grabaLineaPresupuestoViajes",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, idPresupuesto : idPresupuesto, proyecto : proyecto, funcion : funcion, can : can},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponViajesGastosPresupuesto(anio);
      }
    }
  });
});




function descontarIngresosAnio(anio) {
  var TotalDeIngresos = parseFloat($("#descontarDeIngresos").attr("TotalDeIngresos"));
  var string2 = numeral(parseFloat(TotalDeIngresos)).format('$0,0.00');
  var dia = TotalDeIngresos * 0.1;
  dia = Math.round(dia * 100) / 100;
  var umn = dia;
  var gc = TotalDeIngresos * 0.005;
  gc = Math.round(gc * 100) / 100;
  var nuevos = TotalDeIngresos * 0.01;
  nuevos = Math.round(nuevos * 100) / 100;
  var colpac = TotalDeIngresos * 0.03;
  colpac = Math.round(colpac * 100) / 100;
  var um = colpac;
  var publicaciones = nuevos;
  var total = dia + umn + gc + nuevos + colpac + um + publicaciones;
  total = Math.round(total * 100) / 100;
  var cad = '<br><br><br><h1>Base de Ingresos para cálculo del diezmo: '+string2+'</h1><table style="font-size:20px;" class="table table-striped"><tbody>';
  cad=cad+'<tr><td><b>Cuenta</b></td><td><b>Descripci&oacute;n</b></td><td><b>Presupuesto '+anio+'</b></td></tr>';
  var string = numeral(parseFloat(dia)).format('$0,0.00');
  cad=cad+'<tr><td><b>617110</b></td><td><b>Diezmo 10% DIA</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(umn)).format('$0,0.00');
  cad=cad+'<tr><td><b>617120</b></td><td><b>Diezmo 10% UMN</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(gc)).format('$0,0.00');
  cad=cad+'<tr><td><b>617130</b></td><td><b>Diezmo 0.5% GC</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(nuevos)).format('$0,0.00');
  cad=cad+'<tr><td><b>617140</b></td><td><b>Campos Nuevos 1%</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(colpac)).format('$0,0.00');
  cad=cad+'<tr><td><b>617150</b></td><td><b>Colpac 3%</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(um)).format('$0,0.00');
  cad=cad+'<tr><td><b>617170</b></td><td><b>UM 3%</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(publicaciones)).format('$0,0.00');
  cad=cad+'<tr><td><b>617180</b></td><td><b>Publicaciones 3%</b></td><td>'+string+'</td></tr>';
  string = numeral(parseFloat(total)).format('$0,0.00');
  cad=cad+'<tr><td>Total:</td><td colspan="2">'+string+'</td></tr>';
  cad=cad+'</tbody></table>';
  Swal({title:"", html: cad}).then((result) => {
  });  
  //$("#tablaBudgetSecundaria").html(cad);
}




function ponPresupuestoOfrendasAnio(anio) {
  console.log("HOLA OFRENDAS!");
  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  $.ajax({
    url: "/presupuestoOfrendasDistritos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
 
        var meses = parseInt($("#numMesesPresupuesto").attr("meses"));
        var cad = '<input type="text" value="'+resp.pcentIngresoDistrito+'" id="pcentVariacion" class="form-control soloNumeros" placeholder="Escribe el porcentaje de variacion" style="float: left;" /><br><hr><br><button type="button" id="pcentVariacionButtonOfrendas" class="btn btn-success">Recalcular Ofrendas de Distritos con Porcentaje de Variaci&oacute;n</button><table style="font-size:20px;text-align:center;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Distrito</b></td><td><b>Real de ingreso del '+delPeriodo+' al '+alPeriodo+'</b></td><td><b>Ingreso promedio mensual</b></td><td><b>Meses</b></td><td><b>Proyección Real a DIC '+(parseInt(anio)-1)+'</b></td><td><b>Presupuesto a DIC '+(parseInt(anio)-1)+'</b></td><td><b>Presupuestado del '+delPeriodo+' al '+alPeriodo+'  </b></td><td><b>Faltante / Sobrante </b></td><td><b>Aumento '+resp.pcentIngresoDistrito+'% al presupuesto</b></td><td><b>Presupuesto '+anio+' </b></td></tr>';
        var i;
        var aver2 = Object.keys(resp.distritos);
        var total = 0.0;
        var totalReal = 0.0;
        var totalIngresoPromedioMensual = 0.0;
        var totalProyeccionDicAnio = 0.0;
        var totalProyeccionDicAnioB = 0.0;
        var totalPresupuestado = 0.0;
        var totalFaltante = 0.0;
        var totalAumento = 0.0;
        var pcent = parseFloat(resp.pcentIngresoDistrito) / 100.0;
        var aver3 = Object.keys(resp.distritosb);
        var promedioB = 0.0;
        var presupuestado = 0.0;
        var faltanteb = 0.0;
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.distritos[aver2[i]].Original)).format('$0,0.00');
          var cuenta = "635120";
          if(!aver3.includes(resp.distritos[aver2[i]].DT)){ promedioB = 0.0;presupuestado=0.0;faltanteb=0.0;} else {
            promedioB = parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original) / meses;  
            presupuestado = parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original);
            faltanteb = parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original);
          }
          
          //var promedioB = parseFloat(resp.distritosb[aver2[i]].Original) / meses;
          var proyeccionB = promedioB *12.0;
          var stringProyeccionB = numeral(proyeccionB).format('$0,0.00');
          
          var promedio = parseFloat(resp.distritos[aver2[i]].Original) / meses;
          var stringPromedio = numeral(promedio).format('$0,0.00');
          var proyeccion = promedio *12.0;
          var stringProyeccion = numeral(proyeccion).format('$0,0.00');
          
          
          var stringPresupuestado = numeral(presupuestado).format('$0,0.00');
          totalReal += parseFloat(resp.distritos[aver2[i]].Original);
          totalIngresoPromedioMensual += promedio;
          totalProyeccionDicAnio += proyeccion;
          totalProyeccionDicAnioB += proyeccionB;
          totalPresupuestado += presupuestado;
          
          
        
          //var faltante = parseFloat(resp.distritos[aver2[i]].Original) - proyeccion;
          var faltante = parseFloat(resp.distritos[aver2[i]].Original) - faltanteb;

          totalFaltante += faltante;
          var classFaltante = "verde";
          if(faltante<0){classFaltante="rojo";}
          var stringFaltante = numeral(faltante).format('$0,0.00');
          var aumento =  proyeccion * pcent;
           totalAumento += aumento;
         
          var stringAumento = numeral(aumento).format('$0,0.00');
          var conAumento = proyeccion + aumento;
          //total += parseFloat(conAumento);
          total += parseFloat(resp.distritos[aver2[i]].Cantidad);
          var stringConAumento = numeral(parseFloat(conAumento)).format('$0,0.00');

          cad=cad+'<tr><td><img src="static/img/tacha.jpg" width="20px" class="borrarDistritoOfrenda" idPresupuestoOfrendasDistritos="'+aver2[i]+'"/>&nbsp;<a href="javascript:;" cuenta="'+cuenta+'" class="detalleDistrito" dt="'+resp.distritos[aver2[i]].DT+'">'+resp.distritos[aver2[i]].Name+'</a></td><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.distritos[aver2[i]].DT+'&d3e='+resp.distritos[aver2[i]].DT+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+string+'</a></td><td>'+stringPromedio+'</td><td>12</td><td>'+stringProyeccion+'</td><td><b>'+stringProyeccionB+'</b></td><td>'+stringPresupuestado+'</td><td class="'+classFaltante+'">'+stringFaltante+'</td><td>'+stringAumento+'</td><td><b>'+stringConAumento+'</b></td>  </tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
        var string2 = numeral(parseFloat(totalReal)).format('$0,0.00');
        var string3 = numeral(parseFloat(totalIngresoPromedioMensual)).format('$0,0.00');
        var string4 = numeral(parseFloat(totalProyeccionDicAnio)).format('$0,0.00');
        var string5 = numeral(parseFloat(totalPresupuestado)).format('$0,0.00');
        var string6 = numeral(parseFloat(totalFaltante)).format('$0,0.00');
        var string7 = numeral(parseFloat(totalAumento)).format('$0,0.00');
        var string8 = numeral(parseFloat(totalProyeccionDicAnioB)).format('$0,0.00');
         var classFaltante = "verde";
          if(totalFaltante<0){classFaltante="rojo";}
         
        cad=cad+'<tr><td>Total:</td><td>'+string2+'</td><td>'+string3+'</td><td>12</td><td>'+string4+'</td><td>'+string8+'</td><td>'+string5+'</td><td class="'+classFaltante+'">'+string6+'</td><td>'+string7+'</td><td>'+string+'</td></tr>';
            aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><h1>Agregar un distrito:</h1><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Escribe la cantidad de ofrenda anual a presupuestar" class="form-control soloNumeros" id="ofrendaCantidad" /><br><br><br>';
        cad = cad + '<button type="button" id="addBudgeOfrenda" class="btn btn-success">Agregar distrito</button><br><br>';
        

        $("#tablaBudgetSecundaria").html(cad);
            $("html, body").animate({ scrollTop: 10000 }, "slow");
      
         var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaOfrendasPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}




$(document).on("click", "#guardarCuentaGastos", function (){ 
  var cuentaGastos = $("#cuentaGastos").val();
  var cuenta = $(this).attr("cuenta");
  var anio = $("#anioDelPresupuesto").attr("anio");
  $.ajax({
    url: "/grabaCuentaGastosPresupuesto",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, valor : cuentaGastos, cuenta : cuenta},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        Swal.close();
        empezarPresupuesto();
      } else{
        Swal("Escribe bien la cantidad");
      }
    }
  });
});


$(document).on("click", "#guardarOtrosIngresos", function (){ 
  var otrosIngresos = $("#otrosIngresos").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  $.ajax({
    url: "/grabaOtrosIngresosPresupuesto",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, valor : otrosIngresos},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        Swal.close();
        empezarPresupuesto();
      }
    }
  });
});



function ponPresupuestoCuentaGastoAnio(anio, cuenta, nombre) {

  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  var anioAnterior = parseInt(anio)-1;
  $.ajax({
    url: "/presupuestoCuentaGastos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anioAnterior, cuenta : cuenta},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
        var string = numeral(parseFloat(resp.amount)).format('$0,0.00');
        var string_b = numeral(parseFloat(resp.amount_b)).format('$0,0.00');
        var meses = parseInt($("#numMesesPresupuesto").attr("meses"));
        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td>Libro A</td><td>Libro B</td><td><b>Cantidad anual para '+nombre+'</b></td><td> </td></tr><tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+string+'</a></td><td>'+string_b+'</td><td><input type="text" class="form-control soloNumeros" style="font-size:20px;font-weight:bolder;" placeholder="" id="cuentaGastos"/></td><td><button class="btn btn-success" id="guardarCuentaGastos" cuenta="'+cuenta+'">Guardar</button></td></tr></tbody></table>';

          Swal({title:"", html: cad, showConfirmButton: false}).then((result) => {
            empezarPresupuesto();
          });  
       $("#cuentaGastos").focus();
        //$("#tablaBudgetSecundaria").html(cad);
      }
    }
  });
}

function ponPresupuestoOperativoIngresoAnio(anio) {

  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  $.ajax({
    url: "/presupuestoOtrosIngresos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
        var string = numeral(parseFloat(resp.amount)).format('$0,0.00');
        var string_b = numeral(parseFloat(resp.amount_b)).format('$0,0.00');
        var meses = parseInt($("#numMesesPresupuesto").attr("meses"));
        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Libro A</b></td><td>Libro B</td><td><b>Escribe la cantidad anual</b></td><td> </td></tr><tr><td>'+string+'</td><td>'+string_b+'</td><td><input type="text" class="form-control soloNumeros" placeholder="cantidad al presupuesto" id="otrosIngresos"/></td><td><button class="btn btn-success" id="guardarOtrosIngresos">Guardar</button></td></tr></tbody></table>';
        Swal({title:"", html: cad}).then((result) => {
          empezarPresupuesto();
        });
        //$("#tablaBudgetSecundaria").html(cad);
      }
    }
  });
}

function ponPresupuestoAnio(anio) {
  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  var anio = $("#anioDelPresupuesto").attr("anio");
  $.ajax({
    url: "/presupuestoDiezmosDistritos",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
         var anio = parseInt($("#anioDelPresupuesto").attr("anio"));
 
        var meses = parseInt($("#numMesesPresupuesto").attr("meses"));
        var cad = '<input type="text" value="'+resp.pcentIngresoDistrito+'" id="pcentVariacion" class="form-control soloNumeros" placeholder="Escribe el porcentaje de variacion" style="float: left;" /><br><hr><br><button type="button" id="pcentVariacionButton" class="btn btn-success">Recalcular Diezmos de Distritos con Porcentaje de Variaci&oacute;n</button><table style="font-size:20px;text-align:center;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Distrito</b></td><td><b>Real de ingreso del '+delPeriodo+' al '+alPeriodo+'</b></td><td><b>Ingreso promedio mensual</b></td><td><b>Meses</b></td><td><b>Proyección Real a DIC '+(parseInt(anio)-1)+'</b></td><td><b>Presupuesto a DIC '+(parseInt(anio)-1)+'</b></td><td><b>Presupuestado del '+delPeriodo+' al '+alPeriodo+'  </b></td><td><b>Faltante / Sobrante </b></td><td><b>Aumento '+resp.pcentIngresoDistrito+'% al presupuesto</b></td><td><b>Presupuesto '+anio+' </b></td></tr>';

        var i;
        var aver2 = Object.keys(resp.distritos);
        var total = 0.0;
        var totalReal = 0.0;
        var totalIngresoPromedioMensual = 0.0;
        var totalProyeccionDicAnio = 0.0;
        var totalProyeccionDicAnioB = 0.0;
        var totalPresupuestado = 0.0;
        var totalFaltante = 0.0;
        var totalAumento = 0.0;
        var pcent = parseFloat(resp.pcentIngresoDistrito) / 100.0;
        var aver3 = Object.keys(resp.distritosb);
        var promedioB = 0;
        var presupuestado = 0;
        var faltanteb = 0;
        for(i=0;i<aver2.length;i++)
        {
          var string = numeral(parseFloat(resp.distritos[aver2[i]].Original)).format('$0,0.00');
          var cuenta = "611110";
          if(aver3.indexOf(resp.distritos[aver2[i]].DT)==-1 || resp.distritos[aver2[i]].DT.length<6) {
            //continue;
            promedioB = 0;
            presupuestado = 0;
            faltanteb = 0;
          } else {
            promedioB = parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original) / meses;
            presupuestado =  parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original);
            faltanteb = parseFloat(resp.distritosb[resp.distritos[aver2[i]].DT].Original);
          }

          
          
          var proyeccionB = promedioB *12.0;
          var stringProyeccionB = numeral(proyeccionB).format('$0,0.00');
          
          var promedio = parseFloat(resp.distritos[aver2[i]].Original) / meses;
          var stringPromedio = numeral(promedio).format('$0,0.00');
          var proyeccion = promedio *12.0;
          var stringProyeccion = numeral(proyeccion).format('$0,0.00');
          
          
          var stringPresupuestado = numeral(presupuestado).format('$0,0.00');
          totalReal += parseFloat(resp.distritos[aver2[i]].Original);
          totalIngresoPromedioMensual += promedio;
          totalProyeccionDicAnio += proyeccion;
          totalProyeccionDicAnioB += proyeccionB;
          totalPresupuestado += presupuestado;
          
          
        
          //var faltante = parseFloat(resp.distritos[aver2[i]].Original) - proyeccion;
          var faltante = parseFloat(resp.distritos[aver2[i]].Original) - faltanteb;
          totalFaltante += faltante;
          var classFaltante = "verde";
          if(faltante<0){classFaltante="rojo";}
          var stringFaltante = numeral(faltante).format('$0,0.00');
          var aumento =  proyeccion * pcent;
           totalAumento += aumento;
         
          var stringAumento = numeral(aumento).format('$0,0.00');
          var conAumento = proyeccion + aumento;
          //total += parseFloat(conAumento);
          total += parseFloat(resp.distritos[aver2[i]].Cantidad);
          var stringConAumento = numeral(parseFloat(conAumento)).format('$0,0.00');

          cad=cad+'<tr><td><img src="static/img/tacha.jpg" width="20px" class="borrarDistritoDiezmo" idPresupuestoDiezmosDistritos="'+aver2[i]+'" />&nbsp;<a href="javascript:;" cuenta="'+cuenta+'" class="detalleDistrito" dt="'+resp.distritos[aver2[i]].DT+'">'+resp.distritos[aver2[i]].Name+'</a></td><td><a target="_blank"  href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s='+resp.distritos[aver2[i]].DT+'&d3e='+resp.distritos[aver2[i]].DT+'&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+string+'</a></td><td>'+stringPromedio+'</td><td>12</td><td>'+stringProyeccion+'</td><td><b>'+stringProyeccionB+'</b></td><td>'+stringPresupuestado+'</td><td class="'+classFaltante+'">'+stringFaltante+'</td><td>'+stringAumento+'</td><td class="diezmosConAumento" ori="'+parseFloat(resp.distritos[aver2[i]].Original)+'" idPresupuestoDiezmosDistritos="'+aver2[i]+'" can="'+conAumento+'"><b>'+stringConAumento+'</b></td>  </tr>';
        }
        var string = numeral(parseFloat(total)).format('$0,0.00');
        var string2 = numeral(parseFloat(totalReal)).format('$0,0.00');
        var string3 = numeral(parseFloat(totalIngresoPromedioMensual)).format('$0,0.00');
        var string4 = numeral(parseFloat(totalProyeccionDicAnio)).format('$0,0.00');
        var string5 = numeral(parseFloat(totalPresupuestado)).format('$0,0.00');
        var string6 = numeral(parseFloat(totalFaltante)).format('$0,0.00');
        var string7 = numeral(parseFloat(totalAumento)).format('$0,0.00');
        var string8 = numeral(parseFloat(totalProyeccionDicAnioB)).format('$0,0.00');
         var classFaltante = "verde";
          if(totalFaltante<0){classFaltante="rojo";}
         
        cad=cad+'<tr><td>Total:</td><td>'+string2+'</td><td>'+string3+'</td><td>12</td><td>'+string4+'</td><td>'+string8+'</td><td>'+string5+'</td><td class="'+classFaltante+'">'+string6+'</td><td>'+string7+'</td><td>'+string+'</td></tr>';

        aver2 = Object.keys(resp.funciones);

        cad=cad+'</tbody></table><br><h1>Agregar un distrito:</h1><hr><br><h2>Selecciona una funci&oacute;n:</h2><select id="selectFunction" class="form-group" style="font-size:20px">';
        for(i=0;i<aver2.length;i++){
          cad=cad+'<option value="'+aver2[i]+'">'+resp.funciones[aver2[i]].NAME+'</option>';
        }
        cad = cad + '</select><br><br><input type="text" placeholder="Escribe la cantidad de diezmo anual a presupuestar" class="form-control soloNumeros" id="diezmoCantidad" /><br><br><br>';
        cad = cad + '<button type="button" id="addBudgetDiezmo" class="btn btn-success">Agregar distrito</button><br><br>';
        

        $("#tablaBudgetSecundaria").html(cad);
          $("html, body").animate({ scrollTop: 10000 }, "slow");
      
        //Swal({title:"", html: cad}).then((result) => {});  
        var anio = $("#anioDelPresupuesto").attr("anio");
        $.ajax({
          url: "/grabaDiezmoPresupuesto",
          dataType : "json",
          type : "post",
          async : true,
          data : {anio : anio, valor : total},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            if(resp.success==1)
            {
              empezarPresupuesto();
            }
          }
        });
      }
    }
  });
}


$(document).on("click", ".detalleDistrito", function (){ 
  var cuenta = $(this).attr("cuenta");
  var dt = $(this).attr("dt");
  var anio = $("#anioDelPresupuesto").attr("anio");
  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  window.open(
    "/generarEstadoDeCuenta?cuenta="+cuenta+"&delPeriodo="+delPeriodo+"&alPeriodo="+alPeriodo+"&d3s="+dt+"&d3e="+dt,
    '_blank'
  );
});
$(document).on("click", "#pcentVariacionButton", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var valor = $("#pcentVariacion").val();
  var diezmosConAumento = $(".diezmosConAumento");
  var i;
   $.ajax({
    url: "/grabaPcentDiezmoPresupuesto",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, valor : valor},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        ponPresupuestoAnio(anio);
      }
    }
  });
  var idPresupuesto = $("#contabilizarPresupuesto").attr("idPresupuesto");
  for(i=0;i<diezmosConAumento.length;i++) {
    var can = $(diezmosConAumento[i]).attr("can");
    var ori = $(diezmosConAumento[i]).attr("ori");
    var idPresupuestoDiezmosDistritos = $(diezmosConAumento[i]).attr("idPresupuestoDiezmosDistritos");
     $.ajax({
      url: "/grabaLineaDiezmoPresupuesto",
      dataType : "json",
      type : "post",
      async : false,
      data : {idPresupuestoDiezmosDistritos : idPresupuestoDiezmosDistritos, can : can, ori : ori},
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          
        }
      }
    });
  }
  ponPresupuestoAnio(anio);
 
});






$(document).on("click", "#mediosComunicacionGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponMediosComunicacionGastosPresupuesto(anio);
});


$(document).on("click", "#congresosGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponCongresosGastosPresupuesto(anio);
});

$(document).on("click", "#programasGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponProgramasGastosPresupuesto(anio);
});

$(document).on("click", "#viajesGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponViajesGastosPresupuesto(anio);
});



$(document).on("click", "#diezmosEspecialesPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponDiezmosEspecialesPresupuesto(anio);
});



$(document).on("click", "#descontarDeIngresos", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  descontarIngresosAnio(anio);
});


$(document).on("click", "#empleadosGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponEmpleadosGastosPresupuesto(anio);
});

$(document).on("click", "#ofrendasIngresoPresupuesto", function (){ 
  console.log("al menos ofrendas aqui entro!");
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponPresupuestoOfrendasAnio(anio);
});



$(document).on("click", "#diezmosIngresoPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponPresupuestoAnio(anio);
});


$(document).on("click", "#operativosIngresoPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  ponPresupuestoOperativoIngresoAnio(anio);
});



$(document).on("click", ".cuentaGastosPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var cuenta = $(this).attr("cuenta");
  var nombre = $(this).html();
  ponPresupuestoCuentaGastoAnio(anio,cuenta, nombre);
});



function empezarPresupuesto() {
  var anio = $("#anioDelPresupuesto").attr("anio");
  var delPeriodo = $("#delPeriodoPresupuesto").val();
  var alPeriodo = $("#alPeriodoPresupuesto").val();
  
  $.ajax({
    url: "/presupuestoAnio",
    dataType : "json",
    type : "post",
    async : true,
    data : {anio : anio, delPeriodo : delPeriodo, alPeriodo : alPeriodo},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#anioDelPresupuesto").attr("idPresupuesto", resp.idPresupuesto);
        var cad = '<table style="font-size:20px;" class="table table-striped"><tbody>';
        cad=cad+'<tr><td><b>Cuenta sunplus</b></td><td><b>INGRESOS</b></td><td><b>Presupuesto '+anio+'</b></td></tr>';
        var string = numeral(parseFloat("0")).format('$0,0.00');
        var string_diezmosDistritos = numeral(parseFloat(resp.diezmosDistritos)).format('$0,0.00');
        var string_ofrendasDistritos = numeral(parseFloat(resp.ofrendas)).format('$0,0.00');
        var string_otrosIngresos = numeral(parseFloat(resp.otrosIngresos)).format('$0,0.00');
        var string_diezmosEspeciales = numeral(parseFloat(resp.diezmosEspeciales)).format('$0,0.00');

        var TotalDeIngresos = parseFloat(resp.diezmosDistritos)+parseFloat(resp.ofrendas)+parseFloat(resp.otrosIngresos)+parseFloat(resp.diezmosEspeciales);
        var TotalDeEgresos = parseFloat(resp.viajes)+parseFloat(resp.eventos)+parseFloat(resp.nomina)+parseFloat(resp.congresos)+parseFloat(resp.medios_comunicacion)+parseFloat(resp.c870110)+parseFloat(resp.c870120)+parseFloat(resp.c871110)+parseFloat(resp.c872110)+parseFloat(resp.c872120)+parseFloat(resp.c875110)+parseFloat(resp.c881110)+parseFloat(resp.c882110)+parseFloat(resp.c887110)+parseFloat(resp.c887120)+parseFloat(resp.c887130)+parseFloat(resp.c894110)+parseFloat(resp.c896110)+parseFloat(resp.c896120)+parseFloat(resp.c896130)+parseFloat(resp.c898130)+parseFloat(resp.c898150)+parseFloat(resp.c902110)+parseFloat(resp.c902120)+parseFloat(resp.c902130)+parseFloat(resp.c903203)+parseFloat(resp.c903205)+parseFloat(resp.c903206)+parseFloat(resp.c904110)+parseFloat(resp.c905110)+parseFloat(resp.c906110)+parseFloat(resp.c906120)+parseFloat(resp.c907110)+parseFloat(resp.c907210)+parseFloat(resp.c908110);

        var string_viajes = numeral(parseFloat(resp.viajes)).format('$0,0.00');
        var string_eventos = numeral(parseFloat(resp.eventos)).format('$0,0.00');
        var string_congresos = numeral(parseFloat(resp.congresos)).format('$0,0.00');
        var string_medios_comunicacion = numeral(parseFloat(resp.medios_comunicacion)).format('$0,0.00');

        var string_nomina = numeral(parseFloat(resp.nomina)).format('$0,0.00');



        
        var string_TotalDeEgresos = numeral(parseFloat(TotalDeEgresos)).format('$0,0.00');


        var cuenta = "611110";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="diezmosIngresoPresupuesto">Diezmos</a></td><td>'+string_diezmosDistritos+'</td></tr>';
        cuenta = "635120";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="ofrendasIngresoPresupuesto">Ofrendas</a></td><td>'+string_ofrendasDistritos+'</td></tr>';
        cuenta = "601110";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="operativosIngresoPresupuesto">Otros Ingresos Operativos</a></td><td>'+string_otrosIngresos+'</td></tr>';
        cuenta = "612130";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="diezmosEspecialesPresupuesto">Diezmos especiales</a></td><td>'+string_diezmosEspeciales+'</td></tr>';
         var dia = TotalDeIngresos * 0.1;
        dia = Math.round(dia * 100) / 100;
        var umn = dia;
        var gc = TotalDeIngresos * 0.005;
        gc = Math.round(gc * 100) / 100;
        var nuevos = TotalDeIngresos * 0.01;
        nuevos = Math.round(nuevos * 100) / 100;
        var colpac = TotalDeIngresos * 0.03;
        colpac = Math.round(colpac * 100) / 100;
        var um = colpac;
        var publicaciones = nuevos;
        var totalDescuentosDeIngresos = dia + umn + gc + nuevos + colpac + um + publicaciones;
        totalDescuentosDeIngresos = Math.round(totalDescuentosDeIngresos * 100) / 100;
        var string_descuenta_ingresos = numeral(parseFloat(totalDescuentosDeIngresos)).format('$0,0.00');
         cuenta = "617";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" TotalDeIngresos="'+TotalDeIngresos+'" id="descontarDeIngresos">Descontar de ingresos</a></td><td>- '+string_descuenta_ingresos+'</td></tr>';
        var descuentaTotal = TotalDeIngresos - totalDescuentosDeIngresos;
        var string_TotalDeIngresos = numeral(parseFloat(descuentaTotal)).format('$0,0.00');
        cad=cad+'<tr><td><b>Total de ingresos:</b></td><td colspan="2"><b>'+string_TotalDeIngresos+'</b></td></tr>';
        cad=cad+'<tr><td><b></b></td><td><b></b></td></tr>';
        //EGRESOS
        cad=cad+'<tr><td><b>Cuenta sunplus</b></td><td><b>EGRESOS</b></td><td></td></tr>';
        cuenta = "811";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="empleadosGastosPresupuesto">Gastos relacionados con empleados</a></td><td>'+string_nomina+'</td></tr>';
        cuenta = "822110";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="viajesGastosPresupuesto">Gastos de viajes</a></td><td>'+string_viajes+'</td></tr>';
        cuenta = "862110";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="programasGastosPresupuesto">Programas Específicos Evangelismo</a></td><td>'+string_eventos+'</td></tr>';
        cuenta = "862160";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="congresosGastosPresupuesto">Congresos y Eventos</a></td><td>'+string_congresos+'</td></tr>';
         cuenta = "865210";
        cad=cad+'<tr><td><a target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" id="mediosComunicacionGastosPresupuesto">Apoyo a medios de comunicaci&oacute;n</a></td><td>'+string_medios_comunicacion+'</td></tr>';

        
        var colorGA = "#3C9EFF";
        var cGA = "#FFFFFF";
        var styleGA = ' style="background-color:'+colorGA+';color:'+cGA+'";" ';
        cad=cad+'<tr><td colspan="3" '+styleGA+' >Gastos administrativos </td></tr>';

        cuenta = "870110";
        string = numeral(parseFloat(resp.c870110)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Atencion a visitas y feligres&iacute;a</a></td><td>'+string+'</td></tr>';

        cuenta = "870120";
        string = numeral(parseFloat(resp.c870120)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Agua purificada</a></td><td>'+string+'</td></tr>';

        cuenta = "871110";
        string = numeral(parseFloat(resp.c871110)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Gastos de Auditor&iacute;a</a></td><td>'+string+'</td></tr>';

        cuenta = "872110";
        string = numeral(parseFloat(resp.c872110)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Juntas, Reuniones y Seminarios</a></td><td>'+string+'</td></tr>';
        
        cuenta = "872120";
        string = numeral(parseFloat(resp.c872120)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Reuniones Personal de Oficina</a></td><td>'+string+'</td></tr>';

        cuenta = "875110";
        string = numeral(parseFloat(resp.c875110)).format('$0,0.00');
        cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">Gastos Legales</a></td><td>'+string+'</td></tr>';

        var colorGA = "#A4009E";
        var cGA = "#FFFFFF";
        var styleGA = ' style="background-color:'+colorGA+';color:'+cGA+'";" ';
        cad=cad+'<tr><td colspan="3" '+styleGA+' >Gastos de oficina </td></tr>';
         var arrayCuentas = new Array();
         var dict = {
          "cuenta": "881110",
          "name": "Papeleria y Utiles de Oficina"
        };
        arrayCuentas.push(dict);
        var dict2 = {
          "cuenta": "882110",
          "name": "Portes, Fletes y Envios"
        };
        var dict3 = {
          "cuenta": "887110",
          "name": "Telefono, Internet y Fax"
        };
        var dict4 = {
          "cuenta": "887120",
          "name": "Telefonia Celular"
        };
        var dict5 = {
          "cuenta": "887130",
          "name": "Servicios de Red y Datos"
        };
        arrayCuentas.push(dict2);
        arrayCuentas.push(dict3);
        arrayCuentas.push(dict4);
        arrayCuentas.push(dict5);
        var i;
        for(i=0;i<arrayCuentas.length;i++) {
          cuenta = arrayCuentas[i]["cuenta"];
          var name = arrayCuentas[i]["name"];
          string = eval("numeral(parseFloat(resp.c"+cuenta+")).format('$0,0.00')");
           cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">'+name+'</a></td><td>'+string+'</td></tr>';
        }
        arrayCuentas = new Array();
        var colorGA = "#01F5FD";
        var cGA = "#000000";
        var styleGA = ' style="background-color:'+colorGA+';color:'+cGA+'";" ';
        cad=cad+'<tr><td colspan="3" '+styleGA+' >Gastos generales </td></tr>';
        arrayCuentas.push({"cuenta": "894110","name": "Seguro de Responsabilidad Civil"});
        arrayCuentas.push({"cuenta": "896110","name": "Comisiones Bancarias"});
        arrayCuentas.push({"cuenta": "896120","name": "Comisiones Servicios"});
        arrayCuentas.push({"cuenta": "896130","name": "Actualizaciones y Recargos"});
        arrayCuentas.push({"cuenta": "898130","name": "Equipos Menores"});
        arrayCuentas.push({"cuenta": "898150","name": "Inventarios Obsoletos"});
        for(i=0;i<arrayCuentas.length;i++) {
          cuenta = arrayCuentas[i]["cuenta"];
          var name = arrayCuentas[i]["name"];
          string = eval("numeral(parseFloat(resp.c"+cuenta+")).format('$0,0.00')");
           cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">'+name+'</a></td><td>'+string+'</td></tr>';
        }



        arrayCuentas = new Array();
        var colorGA = "#A9A9A9";
        var cGA = "#FFFFFF";
        var styleGA = ' style="background-color:'+colorGA+';color:'+cGA+'";" ';
        cad=cad+'<tr><td colspan="3" '+styleGA+' >Operaci&oacute;n de planta</td></tr>';
        arrayCuentas.push({"cuenta": "902110","name": "Mantenimiento de Equipo de Oficina"});
        arrayCuentas.push({"cuenta": "902120","name": "Mantenimiento de computo"});
        arrayCuentas.push({"cuenta": "902130","name": "Mantenimiento de Edificio"});
        arrayCuentas.push({"cuenta": "903203","name": "Depreciación de Edificios y Anexos"});
        arrayCuentas.push({"cuenta": "903205","name": "Depreciación de Mobiliario y Equipo"});
        arrayCuentas.push({"cuenta": "903206","name": "Depreciación de Vehículos"});
        arrayCuentas.push({"cuenta": "904110","name": "Impuesto Predial"});
        arrayCuentas.push({"cuenta": "905110","name": "Seguro de Propiedad Denominacional"});
        arrayCuentas.push({"cuenta": "906110","name": "Mantenimiento y Combustible de Vehiculos"});
        arrayCuentas.push({"cuenta": "906120","name": "Tenencia y Seguro de Vehiculo"});
        arrayCuentas.push({"cuenta": "907110","name": "Luz de oficina"});
        arrayCuentas.push({"cuenta": "907210","name": "Agua de Edificio"});
        arrayCuentas.push({"cuenta": "908110","name": "Material de Limpieza"});
        for(i=0;i<arrayCuentas.length;i++) {
          cuenta = arrayCuentas[i]["cuenta"];
          var name = arrayCuentas[i]["name"];
          string = eval("numeral(parseFloat(resp.c"+cuenta+")).format('$0,0.00')");
           cad=cad+'<tr '+styleGA+' ><td><a '+styleGA+' target="_blank" href="generarEstadoDeCuenta?cuenta='+cuenta+'&delPeriodo='+delPeriodo+'&alPeriodo='+alPeriodo+'&descr=&d0s=&d0e=&d1s=&d1e=&d2s=&d2e=&d3s=&d3e=&d4s=&d4e=&d5s=&d5e=&d6s=&d6e=&d7s=&d7e=&d8s=&d8e=&d9s=&d9e=&busca=0">'+cuenta+'</a></td><td><a href="javascript:;" '+styleGA+' class="cuentaGastosPresupuesto" cuenta="'+cuenta+'">'+name+'</a></td><td>'+string+'</td></tr>';
        }
        cad=cad+'<tr><td><b>Total de gastos:</b></td><td colspan="2"><b>'+string_TotalDeEgresos+'</b></td></tr>';
        cad=cad+'</tbody></table><button type="button" idPresupuesto="'+resp.idPresupuesto+'" id="contabilizarPresupuesto" class="btn btn-warning">Contabilizar presupuesto</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" idPresupuesto="'+resp.idPresupuesto+'" id="presupuestoExcel" class="btn btn-success">Formato excel</button>';
        $("#tablaBudgetMain").html(cad);
      }
    }
  });
}
$(document).on("click", "#empezarPresupuesto", function (){ 
  empezarPresupuesto();
});



$(document).on("click", "#presupuestoExcel", function (){ 
  var idPresupuesto = $(this).attr("idPresupuesto");
  var meses = $("#numMesesPresupuesto").attr("meses");
  window.open(
    "/presupuestoExcel?idPresupuesto=" +idPresupuesto+"&meses="+meses,
    '_blank'
  );  
});
$(document).on("click", "#contabilizarPresupuesto", function (){ 
  var anio = $("#anioDelPresupuesto").attr("anio");
  var idPresupuesto = $(this).attr("idPresupuesto");
  var meses = $("#numMesesPresupuesto").attr("meses");

  

  $.ajax({
    url: "/revisarPrecontabilizacionDePresupuesto",
    dataType : "json",
    type : "post",
    async : false,
    data : {idPresupuesto:idPresupuesto, meses : meses},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        //cess":1 , "OPEN_PERD_FROM" : OPEN_PERD_FROM, "OPEN_PERD_TO" : OPEN_PERD_TO, "OPEN_DATE_FROM" : OPEN_DATE_FROM, "OPEN_DATE_TO" : OPEN_DATE_TO, 
        var OPEN_PERD_FROM = parseInt (resp.OPEN_PERD_FROM);
        var OPEN_PERD_TO = parseInt (resp.OPEN_PERD_TO);
        var compareInicio = parseInt(anio+"001");
        var comparFinal = parseInt(anio+"012");
        if(OPEN_PERD_FROM > compareInicio || OPEN_PERD_TO < comparFinal) {
          cad=cad+'<tr><td>No estan abiertos los periodos en LES, del '+compareInicio+' al '+comparFinal+'</td></tr>';
        }
        var cad = '';
        if(resp.e870110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 870110 - Atencion a visitas y feligres&iacute;a</td></tr>';
        }
        if(resp.e870120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 870120 - Agua purificada</td></tr>';
        }
        if(resp.e871110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 871110 - Gastos de Auditor&iacute;a </td></tr>';
        }
        if(resp.e872110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 872110 - Juntas, Reuniones y Seminarios</td></tr>';
        }
        if(resp.e872120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 872120 - Reuniones Personal de Oficina</td></tr>';
        }



        if(resp.e875110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 875110 - Gastos Legales</td></tr>';
        }
        if(resp.e881110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 881110 - Papeleria y Utiles de Oficina</td></tr>';
        }
        if(resp.e882110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 882110 - Portes, Fletes y Envios</td></tr>';
        }
        if(resp.e887110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 887110 - Telefono, Internet y Fax</td></tr>';
        }
        if(resp.e887120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 887120 - Telefonia Celular</td></tr>';
        }
        if(resp.e887130=="0") {
          cad=cad+'<tr><td>No existe la cuenta 887130 - Servicios de Red y Datos</td></tr>';
        }
        


        if(resp.e894110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 894110 - Seguro de Responsabilidad Civil</td></tr>';
        }
        if(resp.e896110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 896110 - Comisiones Bancarias</td></tr>';
        }
        if(resp.e896120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 896120 - Comisiones Servicios</td></tr>';
        }
        if(resp.e896130=="0") {
          cad=cad+'<tr><td>No existe la cuenta 896130 - Actualizaciones y Recargos</td></tr>';
        }
        if(resp.e898130=="0") {
          cad=cad+'<tr><td>No existe la cuenta 898130 - Equipos Menores</td></tr>';
        }
        if(resp.e898150=="0") {
          cad=cad+'<tr><td>No existe la cuenta 898150 - Inventarios Obsoletos</td></tr>';
        }
        if(resp.e902110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 902110 - Mantenimiento de Equipo de Oficina</td></tr>';
        }
        if(resp.e902120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 902120 - Mantenimiento de computo</td></tr>';
        }
        if(resp.e902130=="0") {
          cad=cad+'<tr><td>No existe la cuenta 902130 - Mantenimiento de Edificio</td></tr>';
        }
        if(resp.e903203=="0") {
          cad=cad+'<tr><td>No existe la cuenta 903203 - Depreciaci&oacute;n de Edificios y Anexos</td></tr>';
        }
        if(resp.e903205=="0") {
          cad=cad+'<tr><td>No existe la cuenta 903205 - Depreciaci&oacute;n de Mobiliario y Equipo</td></tr>';
        }
        if(resp.e903206=="0") {
          cad=cad+'<tr><td>No existe la cuenta 903206 - Depreciaci&oacute;n de Veh&iacute;culos</td></tr>';
        }
        if(resp.e904110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 904110 - Impuesto Predial</td></tr>';
        }
        if(resp.e905110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 905110 - Seguro de Propiedad Denominacional</td></tr>';
        }

        if(resp.e906110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 906110 - Mantenimiento y Combustible de Vehiculos</td></tr>';
        }
        if(resp.e906120=="0") {
          cad=cad+'<tr><td>No existe la cuenta 906120 - Tenencia y Seguro de Vehiculo</td></tr>';
        }
        if(resp.e907110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 907110 - Luz de oficina</td></tr>';
        }
        if(resp.e907210=="0") {
          cad=cad+'<tr><td>No existe la cuenta 907210 - Agua de Edificio</td></tr>';
        }
        if(resp.e908110=="0") {
          cad=cad+'<tr><td>No existe la cuenta 908110 - Material de Limpieza</td></tr>';
        }

        if(cad!=''){
          var cadMain = '<table class="table table-striped" style="font-size:20px;"><thead><tr><th>Se encontraron los siguientes problemas:</th></tr></thead><tbody>'+cad+'</tbody></table>';
          Swal({title:"", html: cadMain}).then((result) => {
          
          });  
          return; 
        }
        
      }
    }
  });
 var bunit = $("#BUNITACTUAL").html().trim();
        var usuario = $("#USUARIOACTUAL").html().trim();
      
  $.ajax({
    url: "/dameDatosPresupuesto",
    dataType : "json",
    type : "post",
    async : true,
    data : {idPresupuesto:idPresupuesto, meses : meses},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.diezmosDistritos);
        var i;
        var cad='';
        var treference = "PRESUPUESTO"+anio;
        var periodo = "", fecha="", cuenta="611110";
        var descr = "PRESUPUESTO "+anio;
        var nLineas = 0;
        // INGRESOS DEL PRESUPUESTO
        var totalDeIngresos = 0.0;
        var totalDeGastos = 0.0;
        for(i=0;i<aver2.length;i++)
        {
          nLineas+=12;
          var todoElAnio = parseFloat(resp.diezmosDistritos[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          totalDeIngresos+=todoElAnio;
          fecha="0101"+anio;
          periodo = ""+anio+"001";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0102"+anio;
          periodo = ""+anio+"002";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0103"+anio;
          periodo = ""+anio+"003";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0104"+anio;
          periodo = ""+anio+"004";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0105"+anio;
          periodo = ""+anio+"005";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0106"+anio;
          periodo = ""+anio+"006";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0107"+anio;
          periodo = ""+anio+"007";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0108"+anio;
          periodo = ""+anio+"008";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0109"+anio;
          periodo = ""+anio+"009";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0110"+anio;
          periodo = ""+anio+"010";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0111"+anio;
          periodo = ""+anio+"011";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0112"+anio;
          periodo = ""+anio+"012";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+aver2[i]+'|31A|*|*|*|*|*|'+descr+'|'+ultimaMensualidad+'|C|';
        }//for diezmos distritos
        console.log("INGRESOS: diezmos "+totalDeIngresos);


        aver2 = Object.keys(resp.ofrendasDistritos);
        cuenta="635120";
        for(i=0;i<aver2.length;i++)
        {
          nLineas+=12;
          var todoElAnio = parseFloat(resp.ofrendasDistritos[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          totalDeIngresos+=todoElAnio;
          fecha="0101"+anio;
          periodo = ""+anio+"001";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0102"+anio;
          periodo = ""+anio+"002";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0103"+anio;
          periodo = ""+anio+"003";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0104"+anio;
          periodo = ""+anio+"004";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0105"+anio;
          periodo = ""+anio+"005";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0106"+anio;
          periodo = ""+anio+"006";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0107"+anio;
          periodo = ""+anio+"007";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0108"+anio;
          periodo = ""+anio+"008";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0109"+anio;
          periodo = ""+anio+"009";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0110"+anio;
          periodo = ""+anio+"010";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0111"+anio;
          periodo = ""+anio+"011";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';fecha="0112"+anio;
          periodo = ""+anio+"012";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+ultimaMensualidad+'|C|';
        }//for ofrendas distritos
         
console.log("INGRESOS: ofrendas "+totalDeIngresos);
        cuenta="601110";
        if(parseFloat(resp.otrosIngresos)>0){
          nLineas+=12;
          var todoElAnio = parseFloat(resp.otrosIngresos);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          totalDeIngresos+=todoElAnio;
          fecha="0101"+anio;
          periodo = ""+anio+"001";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0102"+anio;
          periodo = ""+anio+"002";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0103"+anio;
          periodo = ""+anio+"003";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0104"+anio;
          periodo = ""+anio+"004";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0105"+anio;
          periodo = ""+anio+"005";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0106"+anio;
          periodo = ""+anio+"006";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0107"+anio;
          periodo = ""+anio+"007";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0108"+anio;
          periodo = ""+anio+"008";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0109"+anio;
          periodo = ""+anio+"009";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0110"+anio;
          periodo = ""+anio+"010";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0111"+anio;
          periodo = ""+anio+"011";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0112"+anio;
          periodo = ""+anio+"012";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFNT|NF|10|PSGENER01|0|*|*|*|*|*|'+descr+'|'+ultimaMensualidad+'|C|';
        }
        //cad=cad+dameCadDePresupuestoDeIngreso("601110", "OTROS INGRESOS", resp.otrosIngresos, "0", "*", "PSGENER01","UFNT","C");

        console.log("INGRESOS: otros ingresos "+totalDeIngresos);
        aver2 = Object.keys(resp.diezmosEspeciales);
        //diezmosEspeciales
        cuenta="612130";
        for(i=0;i<aver2.length;i++)
        {
          nLineas+=12;
          var todoElAnio = parseFloat(resp.diezmosEspeciales[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          totalDeIngresos+=todoElAnio;
          fecha="0101"+anio;
          periodo = ""+anio+"001";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0102"+anio;
          periodo = ""+anio+"002";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0103"+anio;
          periodo = ""+anio+"003";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0104"+anio;
          periodo = ""+anio+"004";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0105"+anio;
          periodo = ""+anio+"005";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0106"+anio;
          periodo = ""+anio+"006";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0107"+anio;
          periodo = ""+anio+"007";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0108"+anio;
          periodo = ""+anio+"008";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0109"+anio;
          periodo = ""+anio+"009";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0110"+anio;
          periodo = ""+anio+"010";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0111"+anio;
          periodo = ""+anio+"011";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+montoMensual+'|C|';
          fecha="0112"+anio;
          periodo = ""+anio+"012";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|PSGENER01|31D|*|*|*|*|*|'+descr+'|'+ultimaMensualidad+'|C|';
        }//for diezmos especiales
        console.log("INGRESOS: diezmos especiales "+totalDeIngresos);

         function dameCadDePresupuestoDeIngreso(cuenta, nombre, cantidad, reestriccion, proyecto, funcion, recurso, D_C) {
          var todoElAnio = parseFloat(cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = nombre;
          var cadAux = '';
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            fecha="0101"+anio;
            totalDeIngresos-=todoElAnio;
            periodo = ""+anio+"001";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|'+D_C+'|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|10|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+ultimaMensualidad+'|'+D_C+'|';
            return cadAux;
          }
          return "";
        }
console.log("INGRESOS: total antes de disminucion "+totalDeIngresos);
         var dia = totalDeIngresos * 0.1;
        dia = Math.round(dia * 100) / 100;
        var umn = dia;
        var gc = totalDeIngresos * 0.005;
        gc = Math.round(gc * 100) / 100;
        var nuevos = totalDeIngresos * 0.01;
        nuevos = Math.round(nuevos * 100) / 100;
        var colpac = totalDeIngresos * 0.03;
        colpac = Math.round(colpac * 100) / 100;
        var um = colpac;
        var publicaciones = nuevos;
        var totalDescuentosDeIngresos = dia + umn + gc + nuevos + colpac + um + publicaciones;
        totalDescuentosDeIngresos = Math.round(totalDescuentosDeIngresos * 100) / 100;
        var string_descuenta_ingresos = numeral(parseFloat(totalDescuentosDeIngresos)).format('$0,0.00');
         
        cad=cad+dameCadDePresupuestoDeIngreso("617110", "Diezmo 10p DIA", dia, "31E", "*", "PSGENER01","UFTF","D");
       
        cad=cad+dameCadDePresupuestoDeIngreso("617120", "Diezmo 10p UMN", umn, "31E", "*", "PSGENER01","UFTF","D");
        cad=cad+dameCadDePresupuestoDeIngreso("617130", "0.5 de Diezmos GC", gc, "31E", "*", "PSGENER01","UFTF","D");
        cad=cad+dameCadDePresupuestoDeIngreso("617140", "Campos Nuevos 1p", nuevos, "31E", "*", "PSGENER01","UFTF","D");
        cad=cad+dameCadDePresupuestoDeIngreso("617150", "Colpac 3p", colpac, "31E", "*", "PSGENER01","UFTF","D");
        cad=cad+dameCadDePresupuestoDeIngreso("617170", "Montemorelos 3p", um, "31E", "*", "PSGENER01","UFTF","D");
        cad=cad+dameCadDePresupuestoDeIngreso("617180", "Publicaciones 1p", publicaciones, "31F", "*", "PSGENER01","UFTF","D");
        console.log("INGRESOS: como quedo "+totalDeIngresos);
 /*   $.ajax({
          url: "/dameHash",
          dataType : "json",
          type : "post",
          async : false,
          data : {},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            var hash = resp.hash;
            var cadFinal = "||"+nLineas+"|"+bunit+"|BG|"+cad;
            console.log(cadFinal);
            window.open(
              "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cadFinal+"&libro=B&pass=",
              '_blank'
            );
            
          }
        });
    return;
    nLineas = 0;
    cad = "";*/
        //AQUI EMPIEZAN LOS EGRESOS
         console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        aver2 = Object.keys(resp.nomina);
        //sueldo
        cuenta="811180";
        var aver3 = Object.keys(resp.funciones);
        for(i=0;i<aver2.length;i++)
        {
          //si no tiene bien el departamento, no lo tomes en cuenta!! perdon Giovanny!
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].Manutencion)+parseFloat(resp.nomina[aver2[i]].Maestria);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "MANUTENCION "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            //console.log()
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina sueldo
        //sobresueldo
         console.log("GASTOS sueldo: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        cuenta="811250";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].SobreSueldo);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          descr = "MINISTERIAL "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina sobresueldo
         console.log("GASTOS sobresueldo: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //depreciacion
        cuenta = "811260";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].AyudaAuto);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "P. PULPITO "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina depreciacion
        console.log("GASTOS depreciacion: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        //Renta
        cuenta = "811310";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].CG);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          descr = "Casa Gobierno "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina renta
        console.log("GASTOS renta: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //Prima vacacional
        cuenta = "811610";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].V);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          descr = "M. EX. PRIMA "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina prima vacacional
        console.log("GASTOS prima vacacional: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //Aguinaldo
        cuenta = "811620";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].A);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "M. EX. AGUINALDO "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina aguinaldo
        console.log("GASTOS aguinaldo: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //Ayuda de transporte
        cuenta = "811420";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].AT);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "AYUDA TRANSPORTE "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina ayuda transporte
        console.log("GASTOS ayuda transporte: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
         //Ayuda educacional
        cuenta = "814110";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].AE);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "AYUDA EDUCACIONAL "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|PBECAS01|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina ayuda educacional
        console.log("GASTOS ayuda educacional: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
         //FOBONO
        cuenta = "818160";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].FO);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "FOBONO "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina fobono
        console.log("GASTOS fobono: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
         //JUBILACION
        cuenta = "812110";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].AJ);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "JUBILACION "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            fecha="0101"+anio;
            totalDeGastos+=todoElAnio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32G|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina jubilacion
        console.log("GASTOS jubilacion: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //Plan de incapacidad
        cuenta = "815510";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].PI);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "P. INCAPACIDAD "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina plan de incapacidad
        console.log("GASTOS salud e incap: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        //Plan de salud
        cuenta = "815520";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].PS);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          descr = "PLAN DE SALUD "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            totalDeGastos+=todoElAnio;
            nLineas+=12;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32A|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina plan de salud
        console.log("GASTOS plan de salud: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        //IMSS e INFONAVIT?
        cuenta = "817110";
        for(i=0;i<aver2.length;i++)
        {
          if(!aver3.indexOf(resp.nomina[aver2[i]].ANAL_T3) || resp.nomina[aver2[i]].ANAL_T3.length<6) {
            continue;
          }

          var todoElAnio = parseFloat(resp.nomina[aver2[i]].IMSS);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = "IMSS E INFONAVIT "+resp.nomina[aver2[i]].Nombre;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.nomina[aver2[i]].ANAL_T3+'|32B|*|'+resp.nomina[aver2[i]].ANAL_T6+'|*|*|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for nomina imss e infonavit ?
        console.log("GASTOS imss e infonavit: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       /*  $.ajax({
          url: "/dameHash",
          dataType : "json",
          type : "post",
          async : false,
          data : {},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            var hash = resp.hash;
            var cadFinal = "||"+nLineas+"|"+bunit+"|BG|"+cad;
            console.log(cadFinal);
            window.open(
              "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cadFinal+"&libro=B&pass=",
              '_blank'
            );
            
          }
        });
    nLineas = 0;
    cad = "";
    */
         aver2 = Object.keys(resp.viajes);
        cuenta="822110";
        
        for(i=0;i<aver2.length;i++)
        {
          nLineas+=12;
          var todoElAnio = parseFloat(resp.viajes[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          totalDeGastos+=todoElAnio;
          fecha="0101"+anio;
          periodo = ""+anio+"001";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0102"+anio;
          periodo = ""+anio+"002";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0103"+anio;
          periodo = ""+anio+"003";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0104"+anio;
          periodo = ""+anio+"004";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0105"+anio;
          periodo = ""+anio+"005";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0106"+anio;
          periodo = ""+anio+"006";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0107"+anio;
          periodo = ""+anio+"007";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0108"+anio;
          periodo = ""+anio+"008";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0109"+anio;
          periodo = ""+anio+"009";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0110"+anio;
          periodo = ""+anio+"010";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0111"+anio;
          periodo = ""+anio+"011";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
          fecha="0112"+anio;
          periodo = ""+anio+"012";
          cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.viajes[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.viajes[aver2[i]].ANAL_T8+'|*|'+descr+'|'+ultimaMensualidad+'|D|';
        }//for viajes
         console.log("GASTOS viajes: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
       
        //Programas especificos de evangelismo
        aver2 = Object.keys(resp.programasEvangelismo);
        cuenta = "862110";
        for(i=0;i<aver2.length;i++)
        {
          var todoElAnio = parseFloat(resp.programasEvangelismo[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = ""+resp.programasEvangelismo[aver2[i]].NAME;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            fecha="0101"+anio;
            totalDeGastos+=todoElAnio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.programasEvangelismo[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.programasEvangelismo[aver2[i]].ANAL_T8+'|*|'+descr+'|'+ultimaMensualidad+'|D|';
            
          }
        }//for programas de evangelismo
        console.log("GASTOS prog evangelimos: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
         //Congresos y eventos
        aver2 = Object.keys(resp.eventos);
        cuenta = "862160";
        for(i=0;i<aver2.length;i++)
        {
          var todoElAnio = parseFloat(resp.eventos[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = ""+resp.eventos[aver2[i]].NAME;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.eventos[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.eventos[aver2[i]].ANAL_T8+'|*|'+descr+'|'+ultimaMensualidad+'|D|';
          }
        }//for congresos y eventos
        console.log("GASTOS congresos y eventos: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
         //Medios de comuniacion
        aver2 = Object.keys(resp.medios_comunicacion);
        cuenta = "865210";
        for(i=0;i<aver2.length;i++)
        {
          var todoElAnio = parseFloat(resp.medios_comunicacion[aver2[i]].Cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = ""+resp.medios_comunicacion[aver2[i]].NAME;
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          console.log(todoElAnio);
       
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+montoMensual+'|D|';
            
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cad=cad+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|UFTF|NF|10|'+resp.medios_comunicacion[aver2[i]].ANAL_T3+'|32B|*|*|*|'+resp.medios_comunicacion[aver2[i]].ANAL_T8+'|*|'+descr+'|'+ultimaMensualidad+'|D|';
            
          }
        }//for medios de comunicacion
        console.log("GASTOS medios comunicacion: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));

        //aqui empezar con 870110   atencion a visitas y feligresia
        //revisarPrecontabilizacionDePresupuesto
        //ya solo me faltan la lista de cuentas!!
      

        function dameCadDePresupuesto(cuenta, nombre, cantidad, reestriccion, proyecto, funcion,recurso) {
          var todoElAnio = parseFloat(cantidad);
          todoElAnio = Math.round(todoElAnio * 100) / 100;
          var montoMensual = todoElAnio/12.0;
          montoMensual = Math.round(montoMensual * 100) / 100;
          var comprobacion = montoMensual * 12;
          comprobacion = Math.round(comprobacion * 100) / 100;
          var ultimaMensualidad = montoMensual;
          if(comprobacion!=todoElAnio)
          {
            var dif = todoElAnio - comprobacion;
            dif = Math.round(dif * 100) / 100;
            ultimaMensualidad += dif;
            ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
          }
          
          descr = nombre;
          var cadAux = '';
          if(descr.length>50) {
            descr = descr.substring(0,49);
          }
          if(todoElAnio>0) {
            nLineas+=12;
            totalDeGastos+=todoElAnio;
            fecha="0101"+anio;
            periodo = ""+anio+"001";
            var fondo = "10";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0102"+anio;
            periodo = ""+anio+"002";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0103"+anio;
            periodo = ""+anio+"003";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0104"+anio;
            periodo = ""+anio+"004";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0105"+anio;
            periodo = ""+anio+"005";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0106"+anio;
            periodo = ""+anio+"006";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0107"+anio;
            periodo = ""+anio+"007";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0108"+anio;
            periodo = ""+anio+"008";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0109"+anio;
            periodo = ""+anio+"009";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0110"+anio;
            periodo = ""+anio+"010";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0111"+anio;
            periodo = ""+anio+"011";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+montoMensual+'|D|';
            fecha="0112"+anio;
            periodo = ""+anio+"012";
            cadAux=cadAux+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|'+recurso+'|NF|'+fondo+'|'+funcion+'|'+reestriccion+'|*|*|*|'+proyecto+'|*|'+descr+'|'+ultimaMensualidad+'|D|';
            return cadAux;
          }
          return "";
        }
     
        
        cad=cad+ dameCadDePresupuesto("870110", "Atencion a visitas y feligresia", resp.c870110, "32B","PATEVI01","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        cad=cad+ dameCadDePresupuesto("870120", "Agua purificada", resp.c870120, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        cad=cad+ dameCadDePresupuesto("871110", "Gastos de Auditoria", resp.c871110, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        cad=cad+ dameCadDePresupuesto("872110", "Juntas, Reuniones y Seminarios", resp.c872110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("872120", "Reuniones Personal de Oficina", resp.c872120, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("875110", "Gastos Legales", resp.c875110, "32B","*","DPLEGAL01","UFTF");
        cad=cad+ dameCadDePresupuesto("881110", "Papeleria y Utiles de Oficina", resp.c881110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("882110", "Portes, Fletes y Envios", resp.c882110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("887110", "Telefono, Internet y Fax", resp.c887110, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        cad=cad+ dameCadDePresupuesto("887120", "Telefonia Celular", resp.c887120, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("887130", "Servicios de Red y Datos", resp.c887130, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("894110", "Seguro de Responsabilidad Civil", resp.c894110, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        cad=cad+ dameCadDePresupuesto("896110", "Comisiones Bancarias", resp.c896110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("896120", "Comisiones Servicios", resp.c896120, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("896130", "Actualizaciones y Recargos", resp.c896130, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("898130", "Equipos Menores", resp.c898130, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("898150", "Inventarios Obsoletos", resp.c898150, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        //OPERACION PLANTA:
        cad=cad+ dameCadDePresupuesto("902110", "Mantenimiento de Equipo de Oficina", resp.c902110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("902120", "Mantenimiento de computo", resp.c902120, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("902130", "Mantenimiento de Edificio", resp.c902130, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("903203", "Depreciación de Edificios y Anexos", resp.c903203, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("903205", "Depreciación de Mobiliario y Equipo", resp.c903205, "0","*","PSGENER01","UFNT");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        cad=cad+ dameCadDePresupuesto("903206", "Depreciación de Vehiculos", resp.c903206, "0","*","PSGENER01","UFNT");
        cad=cad+ dameCadDePresupuesto("904110", "Impuesto Predial", resp.c904110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("905110", "Seguro de Propiedad Denominacional", resp.c905110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("906110", "Mantenimiento y Combustible de Vehiculos", resp.c906110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("906120", "Tenencia y Seguro de Vehiculo", resp.c906120, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        cad=cad+ dameCadDePresupuesto("907110", "Luz de oficina", resp.c907110, "32B","*","PSGENER01","UFTF");
        cad=cad+ dameCadDePresupuesto("907210", "Agua de Edificio", resp.c907210, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        cad=cad+ dameCadDePresupuesto("908110", "Material de Limpieza", resp.c908110, "32B","*","PSGENER01","UFTF");
        console.log("GASTOS: "+numeral(parseFloat(totalDeGastos)).format('$0,0.00'));
        
        
console.log(nLineas);        
//console.log(cad);
// quitar para comer
totalDeIngresos = Math.round(totalDeIngresos * 100) / 100;
totalDeGastos = Math.round(totalDeGastos * 100) / 100;
var diff2 = Math.abs(totalDeIngresos - totalDeGastos);
if(totalDeIngresos!=totalDeGastos && diff2 > 0.01)
{
  var string= numeral(parseFloat(totalDeIngresos)).format('$0,0.00');
  var string2= numeral(parseFloat(totalDeGastos)).format('$0,0.00');
  Swal("Ingresos: "+string+"      Egresos: "+string2+"     No se puede contabilizar hasta que se resuelva el desajuste.");
  return;  
}

         $.ajax({
          url: "/dameHash",
          dataType : "json",
          type : "post",
          async : true,
          data : {},
          beforeSend : function (){
          },
          complete : function (){
          }, 
          success : function (resp){
            var hash = resp.hash;
            var cadFinal = "||"+nLineas+"|"+bunit+"|BG|"+cad;
            console.log(cadFinal);
            window.open(
              "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cadFinal+"&libro=B&pass=",
              '_blank'
            );
            ponFuegosArtificiales();
          }
        });

      }
    }
  });
});


$(document).on("change", "#delPeriodoPresupuesto", function (){ 
  calculaNumMeses();
});
$(document).on("change", "#alPeriodoPresupuesto", function (){ 
  calculaNumMeses();
});
function actualizaAnioInInput() {
  var alPeriodo = $("#alPeriodo").val();
  var anio =alPeriodo.substring(0,4);

}
function cargaMapita() {
  $("#mainContent").html('<select id="selectAnioPresupuesto"><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option></select><br><button type="button" id="entrarPresupuesto">Entrar</button><br><br><svg id="svg" width="100%" height="900" fill="none" stroke="#333"><path id="municipalities" stroke-width="0.2"></path><path id="states"></path></svg>');
  projectionGlobal = d3.geoMercator();
  pathGlobal = d3.geoPath(projectionGlobal);

svgGlobal = $("#svg");
d3.json("static/data_bc2.json", function(error, mx) {
  if (error) throw error;
  var states = topojson.feature(mx, mx.objects.states);

      municipalitiesGlobal = topojson.feature(mx, mx.objects.municipalities);
  projectionGlobal.fitSize([960, 600], states);
  d3.select("#municipalities")
      .datum(municipalitiesGlobal)
      .attr("d", pathGlobal);
  d3.select("#states")
      .datum(states)
      .attr("d", pathGlobal);
      gmGlobal = d3.select("#municipalities").datum(municipalitiesGlobal);
      geGlobal = d3.select("#states").datum(states);
  });
  /*var canvas = d3.select("svg");
  canvas.call(d3.zoom()
    .scaleExtent([1 / 2, 4])
    .on("zoom", zoomed));
  canvas.on('mousemove', function () {
    var coordinates= d3.mouse(this);
    var x = coordinates[0];
    var y = coordinates[1];     
    console.log(x+"    "+y);
  });*/
  /////////
   
}
function zoomedEngrane() {
  //console.log(d3.event.transform);
  var gm = d3.select("#svgEngrane").select("g");
  gm.transition()
      .duration(750)
      .attr("transform", "translate("+d3.event.transform.x+","+d3.event.transform.y+")scale("+d3.event.transform.k+")");
}
function gear({teeth, radius, annulus}) {
  const n = teeth;
  let r2 = Math.abs(radius);
  let r0 = r2 - toothRadius;
  let r1 = r2 + toothRadius;
  let r3 = holeRadius;
  if (annulus) r3 = r0, r0 = r1, r1 = r3, r3 = r2 + toothRadius * 3;
  const da = Math.PI / n;
  let a0 = -Math.PI / 2 + (annulus ? Math.PI / n : 0);
  const path = ["M", r0 * Math.cos(a0), ",", r0 * Math.sin(a0)];
  let i = -1;
  while (++i < n) { // TODO Template literal.
    path.push(
      "A", r0, ",", r0, " 0 0,1 ", r0 * Math.cos(a0 += da), ",", r0 * Math.sin(a0),
      "L", r2 * Math.cos(a0), ",", r2 * Math.sin(a0),
      "L", r1 * Math.cos(a0 += da / 3), ",", r1 * Math.sin(a0),
      "A", r1, ",", r1, " 0 0,1 ", r1 * Math.cos(a0 += da / 3), ",", r1 * Math.sin(a0),
      "L", r2 * Math.cos(a0 += da / 3), ",", r2 * Math.sin(a0),
      "L", r0 * Math.cos(a0), ",", r0 * Math.sin(a0)
    );
  }
  path.push("M0,", -r3, "A", r3, ",", r3, " 0 0,0 0,", r3, "A", r3, ",", r3, " 0 0,0 0,", -r3, "Z");
  return path.join("");
}
function moused() {
  console.log(d3.event);
}
function zoomed() {
  //console.log(d3.event.transform);
  gmGlobal.transition()
      .duration(750)
      .attr("transform", "translate("+d3.event.transform.x+","+d3.event.transform.y+")scale("+d3.event.transform.k+")")
      .style("stroke-width", "2px");

 geGlobal.transition()
      .duration(750)
      .attr("transform", "translate("+d3.event.transform.x+","+d3.event.transform.y+")scale("+d3.event.transform.k+")")
      .style("stroke-width", "2px");
}
$(document).on("click", "#presupuesto", function (){
  cargaPresupuesto();
  //cargaMapita();
});
$(document).on("click", "#contabilizarLedgerImportPresupuesto", function (){
  var PERIOD = $("#periodo").val().trim();
  if(PERIOD.length!=7){
    alert("El periodo debe de ir a 7 digitos");
    return;
  }
  var fechaTransaccion = $("#fechaTransaccion").val().trim();
  if(fechaTransaccion.length!=10){
    alert("La fecha de transaccion debe de ir a 10 digitos");
    return;
  }
  var journalType = $("#journalType").val().trim();
  if(journalType==""){
    alert("El tipo de diario no puede ir vacio");
    return;
  }
  var libro = "B";
  
  var usuario = $("#usuarioPrellenado").val().trim();
  var bunit = $("#bunitPrellenada").val().trim();
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var hash = resp.hash;
      var nLineas = hot.countRows()*12;
      var cad = "||"+nLineas+"|"+bunit+"|"+journalType+"|";
      var auxT = fechaTransaccion;
      var ano = auxT.substring(0,4);
      var mes = auxT.substring(5,7);
      var dia = auxT.substring(8);
      var TransactionDate = dia+mes+ano;
      var hasta = nLineas/12;
      for(i=0;i<hasta;i++)
      {
        var descr = hot.getDataAtCell(i,12);
        if(descr.length>50) {
          descr = descr.substring(0,50);
        }
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);
        
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);


        descr = descr.replace(";","", -1);
        descr = descr.replace(";","", -1);

        descr = descr.replace("&","", -1);
        descr = descr.replace("&","", -1);
        
        var cantidadEnero = hot.getDataAtCell(i,16);
        var D_C = 'C';
        if(cantidadEnero>0)//debito
        {
          D_C = 'D';
        }
        else
        {
          cantidadEnero=cantidadEnero*-1;
        }
        //0 referencia
        //1 cuenta
        //3 tfww pero debo de poner recuro
        //10 detalle
        //16 es enero
        //28 recurso
        var transReference = hot.getDataAtCell(i,0);
        transReference = transReference.replace(";","", -1);
        transReference = transReference.replace(";","", -1);
        transReference = transReference.replace("&","", -1);
        transReference = transReference.replace("&","", -1);
        transReference = transReference.replace("%","", -1);
        transReference = transReference.replace("%","", -1);
        transReference = transReference.replace("#","", -1);
        transReference = transReference.replace("#","", -1);
        var TransactionDateEnero = "0101"+ano;
        cad=cad+transReference+"|"+ano+"001|"+TransactionDateEnero+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadEnero+"|"+D_C+"|";
        var TransactionDateFebrero = "0102"+ano;
        var cantidadFebrero = hot.getDataAtCell(i,17);D_C = 'C';
        if(cantidadFebrero>0){D_C = 'D';}else{cantidadFebrero=cantidadFebrero*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"002|"+TransactionDateFebrero+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadFebrero+"|"+D_C+"|";
        var TransactionDateMarzo = "0103"+ano;
        var cantidadMarzo = hot.getDataAtCell(i,18);D_C = 'C';
        if(cantidadMarzo>0){D_C = 'D';}else{cantidadMarzo=cantidadMarzo*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"003|"+TransactionDateMarzo+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadMarzo+"|"+D_C+"|";
        var TransactionDateAbril = "0104"+ano;
        var cantidadAbril = hot.getDataAtCell(i,19);D_C = 'C';
        if(cantidadAbril>0){D_C = 'D';}else{cantidadAbril=cantidadAbril*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"004|"+TransactionDateAbril+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadAbril+"|"+D_C+"|";
        var TransactionDateMayo = "0105"+ano;
        var cantidadMayo = hot.getDataAtCell(i,20);D_C = 'C';
        if(cantidadMayo>0){D_C = 'D';}else{cantidadMayo=cantidadMayo*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"005|"+TransactionDateMayo+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadMayo+"|"+D_C+"|";
        var TransactionDateJunio = "0106"+ano;
        var cantidadJunio = hot.getDataAtCell(i,21);D_C = 'C';
        if(cantidadJunio>0){D_C = 'D';}else{cantidadJunio=cantidadJunio*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"006|"+TransactionDateJunio+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadJunio+"|"+D_C+"|";
        var TransactionDateJulio = "0107"+ano;
        var cantidadJulio = hot.getDataAtCell(i,22);D_C = 'C';
        if(cantidadJulio>0){D_C = 'D';}else{cantidadJulio=cantidadJulio*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"007|"+TransactionDateJulio+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadJulio+"|"+D_C+"|";
        var TransactionDateAgosto = "0108"+ano;
        var cantidadAgosto = hot.getDataAtCell(i,23);D_C = 'C';
        if(cantidadAgosto>0){D_C = 'D';}else{cantidadAgosto=cantidadAgosto*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"008|"+TransactionDateAgosto+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadAgosto+"|"+D_C+"|";
        var TransactionDateSeptiembre = "0109"+ano;
        var cantidadSeptiembre = hot.getDataAtCell(i,24);D_C = 'C';
        if(cantidadSeptiembre>0){D_C = 'D';}else{cantidadSeptiembre=cantidadSeptiembre*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"009|"+TransactionDateSeptiembre+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadSeptiembre+"|"+D_C+"|";
        var TransactionDateOctubre = "0110"+ano;
        var cantidadOctubre = hot.getDataAtCell(i,25);D_C = 'C';
        if(cantidadOctubre>0){D_C = 'D';}else{cantidadOctubre=cantidadOctubre*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"010|"+TransactionDateOctubre+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadOctubre+"|"+D_C+"|";
        var TransactionDateNoviembre = "0111"+ano;
        var cantidadNoviembre = hot.getDataAtCell(i,26);D_C = 'C';
        if(cantidadNoviembre>0){D_C = 'D';}else{cantidadNoviembre=cantidadNoviembre*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"011|"+TransactionDateNoviembre+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadNoviembre+"|"+D_C+"|";
        var TransactionDateDiciembre = "0111"+ano;
        var cantidadDiciembre = hot.getDataAtCell(i,27);D_C = 'C';
        if(cantidadDiciembre>0){D_C = 'D';}else{cantidadDiciembre=cantidadDiciembre*-1;}
        cad=cad+hot.getDataAtCell(i,0)+"|"+ano+"012|"+TransactionDateDiciembre+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,28)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,11)+"|"+hot.getDataAtCell(i,10)+"|"+descr+"|"+cantidadDiciembre+"|"+D_C+"|";
        
        
        
        
        
        
        
        
        
        
        
                
      }
       window.open(
          "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cad+"&libro="+libro+"&pass=",
          '_blank'
        );

    }
  });
});

$(document).on("click", "#contabilizarLedgerImport", function (){
  var PERIOD = $("#periodo").val().trim();
  if(PERIOD.length!=7){
    alert("El periodo debe de ir a 7 digitos");
 //   return;
  }
  var fechaTransaccion = $("#fechaTransaccion").val().trim();
  if(fechaTransaccion.length!=10){
    alert("La fecha de transaccion debe de ir a 10 digitos");
   // return;
  }
  var journalType = $("#journalType").val().trim();
  if(journalType==""){
    alert("El tipo de diario no puede ir vacio");
    //return;
  }
  var libro = $("#selectLibro").val().trim();
  
  var usuario = $("#usuarioPrellenado").val().trim();
  var bunit = $("#bunitPrellenada").val().trim();
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var hash = resp.hash;
      var nLineas = hot.countRows();
      var cad = "||"+nLineas+"|"+bunit+"|"+journalType+"|";
      var auxT = fechaTransaccion;
      var ano = auxT.substring(0,4);
      var mes = auxT.substring(5,7);
      var dia = auxT.substring(8);
      var TransactionDate = dia+mes+ano;
      var sumaD = 0;
      var sumaC = 0;
      var suma = 0;
      var columna = "";
      for(i=0;i<nLineas;i++)
      {
        var descr = hot.getDataAtCell(i,14);
        if(descr.length>50) {
          descr = descr.substring(0,50);
        }
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);
        
        descr = descr.replace("#","", -1);
        descr = descr.replace("%","", -1);

        descr = descr.replace(";","", -1);
        descr = descr.replace(";","", -1);

        descr = descr.replace("&","", -1);
        descr = descr.replace("&","", -1);
        var transReference = hot.getDataAtCell(i,0);
        transReference = transReference.replace(";","", -1);
        transReference = transReference.replace(";","", -1);
        transReference = transReference.replace("&","", -1);
        transReference = transReference.replace("&","", -1);
        transReference = transReference.replace("%","", -1);
        transReference = transReference.replace("%","", -1);
        transReference = transReference.replace("#","", -1);
        transReference = transReference.replace("#","", -1);

        var cantidad = 0.0;
        cantidad = parseFloat(hot.getDataAtCell(i,13)).toPrecision(12);
        var D_C = 'C';
        if(parseFloat(cantidad)>0)//debito
        {
          D_C = 'D';

        }
        else
        {
         // cantidad=Math.abs(cantidad);
        }
        cantidad=Math.abs(cantidad).toPrecision(12);
        // cantidad = parseFloat(parseFloat(cantidad).toFixed(2)).toPrecision(12);
        //cantidad = Math.round(cantidad * 100) / 100;

        if(D_C=="C"){
          sumaC+=parseFloat(cantidad);
          suma-=parseFloat(cantidad);
        } else {
          sumaD+=parseFloat(cantidad);
          suma+=parseFloat(cantidad);
        }
cantidadString=""+cantidad;
console.log(cantidadString);
        cad=cad+transReference+"|"+PERIOD+"|"+TransactionDate+"|"+hot.getDataAtCell(i,1)+"|"+hot.getDataAtCell(i,3)+"|"+hot.getDataAtCell(i,4)+"|"+hot.getDataAtCell(i,5)+"|"+hot.getDataAtCell(i,6)+"|"+hot.getDataAtCell(i,7)+"|"+hot.getDataAtCell(i,8)+"|"+hot.getDataAtCell(i,9)+"|"+hot.getDataAtCell(i,10)+"|"+hot.getDataAtCell(i,12)+"|"+hot.getDataAtCell(i,11)+"|"+descr+"|"+cantidadString+"|"+D_C+"|";
                //$location = $row3["sevenplus"].'generarDiario?hash='.$hash."&diario=".$row["cadena"]."&source=".$row2["JournalSource"]."&pass=".$row2["passSSC"];
      }
      console.log(sumaD);
      console.log(sumaC);
      var sumaTotal = sumaD-sumaC;
      console.log(sumaTotal);
      console.log(suma);
      if(sumaTotal==0 && suma==0 ||1==1) {
         window.open(
          "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cad+"&libro="+libro+"&pass=",
          '_blank'
        );
       } else {
        alert("tienes un desajuste de $ "+suma);
       }
      

    }
  });
});


function checaQueEsteCuadrado() {
  var arr = $(".cantidadACuadrar");
  if(arr.length>0)
  {
    var i;
    var debitos = 0, creditos = 0;
    for(i=0;i<arr.length;i++)
    {
      var a = arr[i];
      var c = parseFloat($(a).html());
      if(c>0)//debitos
      {
        debitos+=c;
      }
      else
      {
        creditos+=c;
      }
    }
    $("#debitos").html("D&eacute;bitos: $ "+debitos);
    $("#creditos").html("Cr&eacute;ditos: $ "+creditos);
    $("#porCuadrar").html("Por cuadrar: $ "+(debitos+creditos));    
  }
}

$(document).on("click", "#subirPresupuesto", function (){
  var b = $("#BUNITACTUAL").html();
  var u = $("#USUARIOACTUAL").html();
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Subir Presupuesto</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Subir Presupuesto<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="fechaTransaccion" class="form-control" placeholder="yyyy-mm-dd" maxlength="10" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Journal Type" id="journalType" class="form-control" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Unidad de negocio" id="bunitPrellenada" value="'+b+'" disabled class="form-control" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" maxlength="7" id="periodo" class="form-control" placeholder="aaaa0mm" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Usuario" id="usuarioPrellenado" value="'+u+'" disabled class="form-control" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="submit" id="clearScreen" class="btn btn-warning">Clear screen</button>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="debitos"></div>'+
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="creditos"></div>'+
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="porCuadrar"></div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                    '<div class="form-group">'+
                        '<div id="hot"></div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="col-md-3 col-sm-3 col-xs-3">'+
                          '<button type="submit" id="contabilizarLedgerImportPresupuesto" class="btn btn-success">Contabilizar</button>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '<br><hr><br>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $("#fechaTransaccion").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
      clearScreenPresupuesto();
    });


$(document).on("click", "#ledgerImport", function (){
  var b = $("#BUNITACTUAL").html();
  var u = $("#USUARIOACTUAL").html();
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ledger import</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Ledger Import<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<input type="text" id="diarioAnterior" class="form-control soloNumeros" style="float: left;"  />'+
                      '</div>'+
                      '<div class="col-md-6 col-sm-6 col-xs-6">'+
                        '<button type="submit" id="obtenerDiarioAnteriormentePosteado" class="btn btn-success">Obtener diario</button>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" id="fechaTransaccion" class="form-control" placeholder="yyyy-mm-dd" maxlength="10" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Journal Type" id="journalType" class="form-control" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Unidad de negocio" id="bunitPrellenada" value="'+b+'" disabled class="form-control" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" maxlength="7" id="periodo" class="form-control" placeholder="aaaa0mm" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<input type="text" placeholder="Usuario" id="usuarioPrellenado" value="'+u+'" disabled class="form-control" style="float: left;" />'+
                      '</div>'+
                      '<div class="col-md-4 col-sm-4 col-xs-4">'+
                        '<button type="submit" id="clearScreen" class="btn btn-warning">Clear screen</button>'+
                      '</div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                     '<select id="selectLibro" style="font-size:20px;" class="form-control" required="">'+
                '<option value="A">Libro mayor</option>'+
                '<option value="B">Presupuesto</option>'+
                      '</select>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+ 
                  '<div class="form-group">'+
                    '<div class="col-md-12 col-sm-12 col-xs-12">'+
                      
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="debitos"></div>'+
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="creditos"></div>'+
                      '<div class="col-md-3 col-sm-3 col-xs-3" style="font-size:20px;" id="porCuadrar"></div>'+
                    '</div>'+
                  '</div>'+
                  '<br><hr><br>'+
                    '<div class="form-group">'+
                        '<div id="hot"></div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-12 col-sm-12 col-xs-12">'+
                        '<div class="col-md-3 col-sm-3 col-xs-3">'+
                          '<button type="submit" id="contabilizarLedgerImport" class="btn btn-success">Contabilizar</button>'+
                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '<br><hr><br>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $("#fechaTransaccion").mask("9999-99-99",{placeholder:"yyyy-mm-dd"});
      clearScreen();
    });
function clearScreenPresupuesto() {
  $("#debitos").html("");
  $("#creditos").html("");
  $("#porCuadrar").html("");


  var hotElement = document.querySelector('#hot');
      var hotElementContainer = hotElement.parentNode;
      var hotSettings = {
        //data: dataObject,
        columns: [
          {
            data: 'TransReference',
            type: 'text',
            width: 150
          },
          {
            data: 'Cuenta',
            type: 'text',
            width: 80
          },
          {
            data: 'NombreDeLaCuenta',
            type: 'text',
            width: 300
          },
          {
            data: 'TFWW',
            type: 'text',
            width: 80
          },
          {
            data: 'Fondo',
            type: 'text',
            width: 40
          },
          {
            data: 'Funcion',
            type: 'text',
            width: 80
          },
          {
            data: 'RSTR',
            type: 'text',
            width: 30
          },
          {
            data: 'OrgID',
            type: 'text',
            width: 80
          },
          {
            data: 'WHO',
            type: 'text',
            width: 80
          },
          {
            data: 'Flag',
            type: 'text',
            width: 70
          },
          {
            data: 'Detalle',
            type: 'text',
            width: 80
          },
          {
            data: 'Proyecto',
            type: 'text',
            width: 80
          },
          {
            data: 'Descripcion',
            type: 'text',
            width: 300
          },
          {
            data: 'Cantidad',
            type: 'numeric',
            width: 200,
            className : 'cantidadACuadrar',
            numericFormat: {
              pattern: '0.00'
            }
          },
          {
            data: 'Moneda',
            type: 'text',
            width: 50
          },
          {
            data: 'Nada',
            type: 'text',
            width: 1
          },
          {
            data: 'Enero',
            type: 'numeric',
            width: 200,
            className : 'enero',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Febrero',
            type: 'numeric',
            width: 200,
            className : 'febrero',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Marzo',
            type: 'numeric',
            width: 200,
            className : 'marzo',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Abril',
            type: 'numeric',
            width: 200,
            className : 'abril',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Mayo',
            type: 'numeric',
            width: 200,
            className : 'mayo',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Junio',
            type: 'numeric',
            width: 200,
            className : 'junio',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Julio',
            type: 'numeric',
            width: 200,
            className : 'julio',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Agosto',
            type: 'numeric',
            width: 200,
            className : 'agosto',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Septiembre',
            type: 'numeric',
            width: 200,
            className : 'septiembre',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Octubre',
            type: 'numeric',
            width: 200,
            className : 'octubre',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Noviembre',
            type: 'numeric',
            width: 200,
            className : 'noviembre',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Diciembre',
            type: 'numeric',
            width: 200,
            className : 'diciembre',
            numericFormat: {
              pattern: '0.0000'
            }
          },
          {
            data: 'Recurso',
            type: 'text',
            width: 100
          }
        ],
        stretchH: 'all',
        width: screen.width-0,
        autoWrapRow: true,
        height: 887,
        maxRows: 700,
        manualRowResize: true,
        manualColumnResize: true,
        rowHeaders: true,
        colHeaders: [
          'Trans Reference',
          'Cuenta',
          'Nombre de la Cuenta',
          'TFWW',
          'Fondo',
          'Función',
          'RSTR',
          'OrgID',
          'WHO',
          'Flag',
          'Detalle',
          'Proyecto',
          'Descripción',
          'Cantidad',
          'Moneda',
          '',
          'Enero',
          'Febrero',
          'Marzo',
          'Abril',
          'Mayo',
          'Junio',
          'Julio',
          'Agosto',
          'Septiembre',
          'Octubre',
          'Noviembre',
          'Diciembre',
          'Recurso'
        ],
        manualRowMove: true,
        manualColumnMove: true,
        contextMenu: true,
        filters: true,
        dropdownMenu: true
      };
      hot = new Handsontable(hotElement, hotSettings);
}


function clearScreen() {
  $("#debitos").html("");
  $("#creditos").html("");
  $("#porCuadrar").html("");

  var hotElement = document.querySelector('#hot');
      var hotElementContainer = hotElement.parentNode;
      var hotSettings = {
        //data: dataObject,
        columns: [
          {
            data: 'TransReference',
            type: 'text',
            width: 150
          },
          {
            data: 'Cuenta',
            type: 'text',
            width: 80
          },
          {
            data: 'NombreDeLaCuenta',
            type: 'text',
            width: 300
          },
          {
            data: 'Recurso',
            type: 'text',
            width: 100
          },
          {
            data: 'TFWW',
            type: 'text',
            width: 80
          },
          {
            data: 'Fondo',
            type: 'text',
            width: 40
          },
          {
            data: 'Funcion',
            type: 'text',
            width: 80
          },
          {
            data: 'RSTR',
            type: 'text',
            width: 30
          },
          {
            data: 'OrgID',
            type: 'text',
            width: 80
          },
          {
            data: 'WHO',
            type: 'text',
            width: 80
          },
          {
            data: 'Flag',
            type: 'text',
            width: 70
          },
          {
            data: 'Detalle',
            type: 'text',
            width: 80
          },
          {
            data: 'Proyecto',
            type: 'text',
            width: 80
          },
          {
            data: 'Cantidad',
            type: 'numeric',
            width: 200,
            className : 'cantidadACuadrar',
            numericFormat: {
              pattern: '0.00'
            }
          },
          {
            data: 'Descripcion',
            type: 'text',
            width: 300
          }
        ],
        stretchH: 'all',
        width: screen.width-0,
        autoWrapRow: true,
        height: 887,
        maxRows: 700,
        manualRowResize: true,
        manualColumnResize: true,
        rowHeaders: true,
        colHeaders: [
          'Trans Reference',
          'Cuenta',
          'Nombre de la Cuenta',
          'Recurso',
          'TFWW',
          'Fondo',
          'Función',
          'RSTR',
          'OrgID',
          'WHO',
          'Flag',
          'Detalle',
          'Proyecto',
          'Cantidad',
          'Descripción'
        ],
        manualRowMove: true,
        manualColumnMove: true,
        contextMenu: true,
        filters: true,
        dropdownMenu: true
      };
      hot = new Handsontable(hotElement, hotSettings);
}
$(document).on("click", "#ajustesLibroMayor", function (){
      dameCorreoDelTesorero();
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Ajustes al libro mayor</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Ajustes al libro mayor<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                '<br><hr><br>'+
                '<div class="form-group">'+
                      '<p><label style="font-size:20px" id="advertencia"></label></p></div>'+
                  '<br><hr><br>'+
                    '<div class="form-group">'+
                      '<p><label for="selectTipoAjuste">Tipo:</label>'+
                          '<select id="selectTipoAjuste" style="font-size:20px;" class="form-control" required="">'+
                '<option value="0">Selecciona tipo de ajuste al libro mayor</option>'+
                '<option value="1">Cambio de cuenta</option>'+
                '<option value="2">Cambio de periodo</option>'+
                '<option value="3">Cambio de fecha de transaccion</option>'+
                '<option value="4">Cambio de cantidad</option>'+
                '<option value="5">Cambio de asignacion a activo fijo</option>'+
                '<option value="6">Cambio de cantidades de activo fijo en su tabla</option>'+
                            '</select></p>'+
                    '</div>'+
                    '<div id="contenidoACambiar"></div>'+
                    '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
    });



$(document).on("click", "#cambiarContrasena", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Cambiar contrase&ntilde;a</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Cambiar contrase&ntilde;a<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-3">Contrase&ntilde;a anterior:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-9">'+
                        '<input type="password" maxlength="50" id="contraAnterior" class="form-control col-md-10" style="float: left;"  />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Contrase&ntilde;a nueva:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="password" maxlength="50" id="contraNueva" class="form-control col-md-10" style="float: left;"  />'+
                      '</div>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Confirma tu contrase&ntilde;a nueva:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="password" maxlength="50" id="contraNueva2" class="form-control col-md-10" style="float: left;"  />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="guardarContraNueva" class="btn btn-success">Cambiar contrase&ntilde;a</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      });


function capturarInformeDiezmos()
{
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Captura de informe</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Captura de informe, instrucciones: Selecciona un informe, y llena todos los campos, selecciona la foto de la ficha, e indica la fecha de deposito de la ficha, si un campo no vas a informar, favor de poner un 0.<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="tipoInforme">Informe:</label>'+
                          '<select id="tipoInforme" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                '</div>'+
                '<div class="x_content" id="cambiaContenido">'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/listaDiezmoConcepto",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.DiezmoConcepto);
          var cad = '<option value="0">Selecciona un tipo de informe</option>';
          for(i=0;i<aver2.length;i++)
          {
            if(parseInt(resp.DiezmoConcepto[aver2[i]]["Activo"])==1  )
            {
              cad=cad+'<option value="'+resp.DiezmoConcepto[aver2[i]]["IdDiezmoConcepto"]+'">'+resp.DiezmoConcepto[aver2[i]]["Concepto"]+'</option>';  
            }
          } 
          $("#tipoInforme").html(cad);
        }
      });
}

function readURLFichaIglesia(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
              $('#espacioParaFicha').attr('src', e.target.result);
          }
          reader.readAsDataURL(input.files[0]);
      }
  }
  
String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};
function readURLTicketCSV(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
           
            var data2 = Papa.parse(e.target.result);
            var data = data2.data;
            var i, exitosos = 0, repetidos = 0;
            var FechaMovimiento = "";
            var leyenda1 = "";
            var Descripcion = "";
            var Pesos = 0.0;
            var Abono = 0.0;
            var Cargo = 0.0;
            var leyenda2 = "";
            var cuenta = "";
            var Autorizacion = "";
            var Autorizacion1 = "";
            var STATUS = 1;//cargo
            var Saldo = 0.0;
            for(i=0;i<data.length;i++)
            {
              
              if(data[i].length==19)
              {
                FechaMovimiento = data[i][0];
                FechaMovimiento = FechaMovimiento.substring(0,10);
                FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(3,5)+"/"+FechaMovimiento.substring(8);
                leyenda1 = data[i][2];
                data[i][6] = data[i][6].replaceAll("'","")
                data[i][6] = data[i][6].replaceAll('"',"")

                data[i][7] = data[i][7].replaceAll("'","")
                data[i][7] = data[i][7].replaceAll('"',"")
                

                data[i][8] = data[i][8].replaceAll("'","")
                data[i][8] = data[i][8].replaceAll('"',"")
                
                Descripcion = data[i][6];
                data[i][13] = data[i][13].replace("$","")
                data[i][13] = data[i][13].replace(",","")
                data[i][13] = data[i][13].replace(",","")
                data[i][13] = data[i][13].replace(",","")
                
                data[i][12] = data[i][12].replace("$","")
                data[i][12] = data[i][12].replace(",","")
                data[i][12] = data[i][12].replace(",","")
                data[i][12] = data[i][12].replace(",","")
                
                
                Pesos = parseFloat(data[i][13]);
                Abono = parseFloat(data[i][12]);
                Cargo = parseFloat(data[i][13]);
                leyenda2 = data[i][7];
                cuenta = data[i][3];
                Autorizacion = data[i][10];
                Autorizacion1 = data[i][8];
                STATUS = 1;//cargo
                if(Cargo > 0.01)
                {
                  Pesos = Cargo;
                }
                if(Abono > 0.01)
                {
                  STATUS = 2;
                  Pesos = Abono;
                }
              }
               if(data[i].length==13)//cuenta cancelada!
              {
                cuenta=data[i][2];
                Descripcion = data[i][4];
                Autorizacion = data[i][6]; 
                FechaMovimiento = data[i][0];
                FechaMovimiento = FechaMovimiento.substring(0,10);
                FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(3,5)+"/"+FechaMovimiento.substring(8);
                data[i][8] = data[i][8].replace("$","")
                data[i][8] = data[i][8].replace(",","")
                data[i][8] = data[i][8].replace(",","")
                data[i][8] = data[i][8].replace(",","")
                  
                data[i][9] = data[i][9].replace("$","")
                data[i][9] = data[i][9].replace(",","")
                data[i][9] = data[i][9].replace(",","")
                data[i][9] = data[i][9].replace(",","")

                data[i][10] = data[i][10].replace("$","")
                data[i][10] = data[i][10].replace(",","")
                data[i][10] = data[i][10].replace(",","")
                data[i][10] = data[i][10].replace(",","")
                Abono = parseFloat(data[i][8]);
                Cargo = parseFloat(data[i][9]);
                Saldo = parseFloat(data[i][10]);
                STATUS = 1;//cargo
                if(Cargo > 0.01)
                {
                  Pesos = Cargo;
                }
                if(Abono > 0.01)
                {
                  STATUS = 2;
                  Pesos = Abono;
                }
                Autorizacion1 = data[i][5];
                leyenda1 = data[i][7];
                leyenda2 = data[i][1];
              }
              if(data[i].length==17)//cuenta madre!
              {
                var NumeroPedido = parseInt(data[i][7]);
                if(NumeroPedido>0)
                {
                  cuenta="CuentaMadre";
                  Descripcion = data[i][6];
                  Autorizacion = data[i][1];
                  Autorizacion1 = data[i][7];
                  FechaMovimiento = data[i][0];
                  FechaMovimiento = FechaMovimiento.substring(0,10);
                  FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(3,5)+"/"+FechaMovimiento.substring(8);

                  data[i][16] = data[i][16].replace("$","")
                  data[i][16] = data[i][16].replace(",","")
                  data[i][16] = data[i][16].replace(",","")
                  data[i][16] = data[i][16].replace(",","")
                  
                  data[i][13] = data[i][13].replace("$","")
                  data[i][13] = data[i][13].replace(",","")
                  data[i][13] = data[i][13].replace(",","")
                  data[i][13] = data[i][13].replace(",","")

                  data[i][11] = data[i][11].replace("$","")
                  data[i][11] = data[i][11].replace(",","")
                  data[i][11] = data[i][11].replace(",","")
                  data[i][11] = data[i][11].replace(",","")

                  leyenda1 = data[i][8];
                  leyenda2 = data[i][10];
               
                  Abono = parseFloat(data[i][11]);
                  Cargo = parseFloat(data[i][13]);
                  Saldo = parseFloat(data[i][16]);
                  STATUS = 1;//cargo
                  if(Cargo > 0.01)
                  {
                    Pesos = Cargo;
                  }
                  if(Abono > 0.01)
                  {
                    STATUS = 2;
                    Pesos = Abono;
                  }
              
                }
                
              }
              if(data[i].length>10)
              {
                  var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : Autorizacion+"-"+Autorizacion1, leyenda1: leyenda1, leyenda2 : leyenda2, Saldo : Saldo, Moneda : "MXN" }

                $.ajax({
                  url: "/sube1Banco",
                  dataType : "json",
                  type : "post",
                  async : false,
                  data : param,
                  beforeSend : function (){
                  },
                  complete : function (){
                  }, 
                  success : function (resp){
                    if(resp.success==1)
                    {
                      exitosos++;
                    }
                    else
                    {
                      if(resp.success==2)
                      {
                        repetidos++;
                      }
                      
                    }
                  }
                });
              }
            }
            var totalError = data.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            //$('#ticket').attr('src', e.target.result);
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }
  

function readURLSubeXML(input) {
  if (input.files && input.files[0]) 
  {
    var reader = new FileReader();
    reader.onload = function (e) 
    {
      var texto  = e.target.result;
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
      texto = texto.replace('\n',"");texto = texto.replace('\n',"");
           
      window.open(
        "/generarPDF?xml="+texto,
        '_blank'
      );
      console.log(texto);
    }
    reader.readAsText(input.files[0]);
  }
  else {
    console.log("No archivo xml");
  }
}



function readURLSubeTFWWALaBrava(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos=0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split(",");
              if(datos.length<3)
              {
                continue;
              }
              var cuenta = datos[0].trim();
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.trim();

              var cuentaNueva = datos[2].trim();
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.trim();
          
              var param = {cuentaVieja : cuenta, cuentaNueva: cuentaNueva}
              $.ajax({
                url: "/cambioLocoTFWW",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }

function readURLSubeCuentasALaBrava(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos=0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split(",");
              if(datos.length<3)
              {
                continue;
              }
              var cuenta = datos[0].trim();
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.trim();

              var cuentaNueva = datos[2].trim();
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.replace('"',"");
              cuentaNueva = cuentaNueva.trim();
          
              var param = {cuentaVieja : cuenta, cuentaNueva: cuentaNueva}
              $.ajax({
                url: "/cambioLoco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }



function readURLScotiabank(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos=0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split(",");
              if(datos.length<3)
              {
                continue;
              }
              var cuenta = datos[0].trim();
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.trim();
              var FechaMovimiento = datos[1].trim();

              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.trim();

              var arr = FechaMovimiento.split('/');
              FechaMovimiento = arr[0]+"/"+arr[1]+"/"+arr[2];

//              FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(2,4)+"/"+FechaMovimiento.substring(4);
              
              var referencia = datos[2].trim();
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.trim();
              
              var saldo = datos[5];
              saldo = saldo.replace("$","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              if(saldo.length==0){saldo="0";}
              referencia = referencia+"-"+saldo;
              var Descripcion = datos[6].trim();
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.trim();
              
              var importe = datos[3].trim();
              var quees = datos[4].trim();
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.trim();
              
              
              var STATUS = 1;//cargo
              importe = parseFloat(importe);
              var Pesos = 0;
              if(quees == "CARGO")
              {
                STATUS = 1;
                Pesos = importe;
              }else{
                if(quees == "ABONO")
                {
                  STATUS = 2;//abono
                  Pesos = importe;
                }else{
                  alert("hey, hay algo mal en el formato, interrumpiremos la subida:"+quees);
                  return;
                }
                  
              }
              var descr2 =  "";
              if(datos.length>=8)
              {
                 descr2 = datos[7].trim();
                descr2 = descr2.replace('"',"");
                descr2 = descr2.replace('"',"");
                descr2 = descr2.replace('"',"");
                descr2 = descr2.replace('"',"");
                descr2 = descr2.trim();
              }
             
              var Moneda = "MXN";
              if(datos.length>=10)
              {
                Moneda = datos[9].trim();
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.trim();
              }
              var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : referencia, leyenda1: descr2, leyenda2 : descr2, Saldo : saldo, Moneda : Moneda }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    repetidos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }



function readURLBancomer(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.fileName = input.files[0].name;
          reader.onload = function (e) {
            var nommbreDelArchivo = e.target.fileName;
            nommbreDelArchivo = nommbreDelArchivo.replace('.csv','');
            nommbreDelArchivo = nommbreDelArchivo.replace('.CSV','');
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos = 0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split(",");
              if(datos.length<3)
              {
                continue;
              }
              var cuenta = nommbreDelArchivo;
              cuenta = cuenta.trim();
              var FechaMovimiento = datos[0].trim();
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.trim();

              //FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(2,4)+"/"+FechaMovimiento.substring(4);
              
              var referencia = datos[1].trim();
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.trim();
              
              var saldo = datos[4];
              saldo = saldo.replace("$","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace('"',"");
              saldo = saldo.replace('"',"");
              saldo = saldo.replace('"',"");
              referencia = saldo;
              var Descripcion = datos[1].trim();
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.trim();
              if(Descripcion.length>30)
              {
                Descripcion = Descripcion.substring(0,30);
              }
              var abono = datos[3];
              abono = abono.replace("$","");
              abono = abono.replace(",","");
              abono = abono.replace(",","");
              abono = abono.replace(",","");
              abono = abono.replace('"',"");
              abono = abono.replace('"',"");
              abono = abono.replace('"',"");

              var cargo = datos[2];
              cargo = cargo.replace("$","");
              cargo = cargo.replace(",","");
              cargo = cargo.replace(",","");
              cargo = cargo.replace(",","");
              cargo = cargo.replace('"',"");
              cargo = cargo.replace('"',"");
              
              
              
            
              
              
              var STATUS = 1;//cargo
              var Pesos = parseFloat(cargo);
              if(cargo == "")
              {
                STATUS = 2;//abono
                Pesos = parseFloat(abono);
              }
              var descr2 = "";
              var Moneda = "MXN";
              if(datos.length>5)
              {
                Moneda = datos[5].trim();
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.trim();
              }
              var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : referencia, leyenda1: descr2, leyenda2 : descr2, Saldo : saldo, Moneda : Moneda }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    repetidos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }

function readURLSantander(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos=0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split(",");
              if(datos.length<3)
              {
                continue;
              }
              var cuenta = datos[0].trim();
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.replace('"',"");
              cuenta = cuenta.trim();
              var FechaMovimiento = datos[1].trim();
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.replace('"',"");
              FechaMovimiento = FechaMovimiento.trim();

              FechaMovimiento = FechaMovimiento.substring(0,2)+"/"+FechaMovimiento.substring(2,4)+"/"+FechaMovimiento.substring(4);
              
              var referencia = datos[8].trim();
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.replace('"',"");
              referencia = referencia.trim();
              
              var saldo = datos[7];
              saldo = saldo.replace("$","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              referencia = referencia+"-"+saldo;
              var Descripcion = datos[4].trim();
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.replace('"',"");
              Descripcion = Descripcion.trim();
              
              var importe = datos[6].trim();
              var quees = datos[5].trim();
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.replace('"',"");
              quees = quees.trim();
              
              
              var STATUS = 1;//cargo
              importe = parseFloat(importe);
              var Pesos = 0;
              if(quees == "-")
              {
                STATUS = 1;
                Pesos = importe;
              }else{
                if(quees == "+")
                {
                  STATUS = 2;//abono
                  Pesos = importe;
                }else{
                  alert("hey, hay algo mal en el formato, interrumpiremos la subida:"+quees);
                  return;
                }
                  
              }
              var descr2 = datos[9].trim();
              descr2 = descr2.replace('"',"");
              descr2 = descr2.replace('"',"");
              descr2 = descr2.replace('"',"");
              descr2 = descr2.replace('"',"");
              descr2 = descr2.trim();
              var Moneda = "MXN";
              if(datos.length>10)
              {
                Moneda = datos[10].trim();
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.replace('"',"");
                Moneda = Moneda.trim();
              }
              var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : referencia, leyenda1: descr2, leyenda2 : descr2, Saldo : saldo, Moneda : Moneda }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    exitosos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }

function readURL_TXT_Scotiabank(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos = 0;
            for(i=0;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var moneda = linea.substring(3,6);
              var cuenta = linea.substring(6,9) + linea.substring(18,26);
              var fecha = linea.substring(26,36);
              var referencia = linea.substring(36,46);
              var importe = linea.substring(46,63);
              var tipo = linea.substring(63,68);
              var saldo = linea.substring(68,85);
              var transaccion = linea.substring(85,135);
              var leyenda1 = linea.substring(135,165);
              var leyenda2 = linea.substring(165,195);
              //consecutivo := linea[195:198]
              var adicional = linea.substring(198);
              adicional = adicional.substring(0,49);
              var anio = fecha.substring(0,4);
              var mes = fecha.substring(5,7);
              var dia = fecha.substring(8,10);
              fechaNueva = dia+"/"+mes+"/"+anio;
              var STATUS = "1";
              if (tipo.toUpperCase() == "ABONO") {
                STATUS = "2";
              }
              transaccion = transaccion.trim();
              leyenda1 = leyenda1.trim();
              leyenda2 = leyenda2.trim();
              adicional = adicional.trim();
              transaccion = transaccion.replace("'", "");
              leyenda1 = leyenda1.replace("'", "");
              leyenda2 = leyenda2.replace("'", "");
              adicional = adicional.replace("'", "");
              var param = {cuenta : cuenta, importe: importe, fecha: fechaNueva, descripcion : transaccion, STATUS : STATUS, referencia : referencia, leyenda1: leyenda1, leyenda2 : leyenda2, Saldo : saldo, Moneda : moneda }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    repetidos++;
                  }
                  
                }
              });
            }
            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }

function readURLBanorte(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var texto  = e.target.result;
            var lineas = texto.split("\n");
            var i;
            var exitosos = 0, repetidos = 0;
            for(i=1;i<lineas.length;i++)
            {
              var linea = lineas[i];
              var datos = linea.split("|");
              var cuenta = datos[0];
              var FechaMovimiento = datos[1];
              var referencia = datos[3];
              var saldo = datos[9];
              saldo = saldo.replace("$","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              saldo = saldo.replace(",","");
              referencia = referencia+"-"+saldo;
              var Descripcion = datos[4];
              var abonos = datos[7];
              var gastos = datos[8];
              gastos = gastos.replace("$","");
              gastos = gastos.replace(",","");
              gastos = gastos.replace(",","");
              gastos = gastos.replace(",","");
              abonos = abonos.replace("$","");
              abonos = abonos.replace(",","");
              abonos = abonos.replace(",","");
              abonos = abonos.replace(",","");
             
              var STATUS = 1;//cargo
              abonos = parseFloat(abonos);
              gastos = parseFloat(gastos);
              var Pesos = 0;
              if(gastos > 0.01)
              {
                Pesos = gastos;
              }
              if(abonos > 0.01)
              {
                STATUS = 2;
                Pesos = abonos;
              }
              var descr2 = datos[11];
              var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : referencia, leyenda1: descr2, leyenda2 : descr2, Saldo : saldo, Moneda : "MXN" }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    repetidos++;
                  }
                  
                }
              });
            }

            var totalError = lineas.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }
function readURLTicket(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var parser = new DOMParser();
            var xmlDoc = parser.parseFromString(e.target.result, "text/xml");
            var movimientos = xmlDoc.getElementsByTagName("Detalles");
            var i, exitosos = 0, repetidos = 0;
            for(i=0;i<movimientos.length;i++)
            {
              var FechaMovimiento = movimientos[i].getAttribute('FechaMovimiento');
              FechaMovimiento = FechaMovimiento.substring(0,10);
              FechaMovimiento = FechaMovimiento.substring(8)+"/"+FechaMovimiento.substring(5,7)+"/"+FechaMovimiento.substring(2,4);
              var leyenda1 = movimientos[i].getAttribute('NombreEmpleado');
              var Descripcion = movimientos[i].getAttribute('Descripcion');
              var Pesos = parseFloat(movimientos[i].getAttribute('Pesos'));
              var Abono = parseFloat(movimientos[i].getAttribute('Abono'));
              var Cargo = parseFloat(movimientos[i].getAttribute('Cargo'));
              var leyenda2 = movimientos[i].getAttribute('TipoComercio');
              var cuenta = movimientos[i].getAttribute('NumeroTarjeta');
              var Autorizacion = movimientos[i].getAttribute('Autorizacion');
              var Autorizacion1 = movimientos[i].getAttribute('Autorizacion1');
              var STATUS = 1;//cargo
              if(Cargo > 0.01)
              {
                Pesos = Cargo;
              }
              if(Abono > 0.01)
              {
                STATUS = 2;
                Pesos = Abono;
              }
              if(cuenta==null || cuenta =="" )
              {
                var NumeroPedido = parseInt(movimientos[i].getAttribute('NumeroPedido'));
                if(NumeroPedido>0)
                {
                  cuenta="CuentaMadre";
                  Descripcion = movimientos[i].getAttribute('Descripcion1');
                  Autorizacion = movimientos[i].getAttribute('Concepto');
                  Autorizacion1 = movimientos[i].getAttribute('Responsable1');
                  FechaMovimiento = movimientos[i].getAttribute('FechaMovimiento');
                  FechaMovimiento = FechaMovimiento.substring(0,10);
                  FechaMovimiento =   FechaMovimiento.substring(0,6)+ FechaMovimiento.substring(8);
                }
              }

              var param = {cuenta : cuenta, importe: Pesos, fecha: FechaMovimiento, descripcion : Descripcion, STATUS : STATUS, referencia : Autorizacion+"-"+Autorizacion1, leyenda1: leyenda1, leyenda2 : leyenda2, Saldo : 0.0, Moneda : "MXN" }
              $.ajax({
                url: "/sube1Banco",
                dataType : "json",
                type : "post",
                async : false,
                data : param,
                beforeSend : function (){
                },
                complete : function (){
                }, 
                success : function (resp){
                  if(resp.success==1)
                  {
                    exitosos++;
                  }
                  if(resp.success==2)
                  {
                    repetidos++;
                  }
                  
                }
              });
            }
            var totalError = movimientos.length-2-exitosos-repetidos;
            alert("Exitosos: "+exitosos+"  Repetidos: "+repetidos+" Con error: "+totalError);
            
            
            //$('#ticket').attr('src', e.target.result);
          }
          //reader.readAsDataURL(input.files[0]);
          reader.readAsText(input.files[0]);
      }
  }
  

$(document).on("change", "#ticketCSV", function (){ 
  var fileName = $('#ticketCSV').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'csv' || extension == 'CSV')
    {
      readURLTicketCSV(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"csv\" o \"CSV\"");
  }
});



$(document).on("change", "#txtScotiabank", function (){ 
  var fileName = $('#txtScotiabank').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'txt' || extension == 'TXT')
    {
      readURL_TXT_Scotiabank(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"txt\" o \"TXT\"");
  }
});


$(document).on("change", "#txtBanorte", function (){ 
  var fileName = $('#txtBanorte').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'txt' || extension == 'TXT')
    {
      readURLBanorte(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"txt\" o \"TXT\"");
  }
});


$(document).on("change", "#ticket", function (){ 
  var fileName = $('#ticket').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'xml' || extension == 'XML')
    {
      readURLTicket(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"xml\" o \"XML\"");
  }
});

$(document).on("change", "#ficha", function (){ 
  var fileName = $('#ficha').val();
  var extension = fileName.substr(fileName.length-3);
  if(extension == 'jpg' || extension == 'png' || extension == 'JPG' || extension == 'PNG' || extension == 'jpeg' || extension == 'JPEG')
    {
      readURLFichaIglesia(this);
  }
  else
  {
    alert("El formato de archivo permitido es \"jpg\" o \"png\"");
   // $("#messageToChangeMensaje").html("El formato de archivo permitido es \"jpg\" o \"png\".<br><br>");
    //$("#dialog_Mensaje").dialog("open");
  }
});

//$(document).on("click", "#subirInforme", function (){});

 function DoSubmit() {
  $("#fechaFicha").attr('background-color','#FFF');
  var cadCampos = '';
                   
  var textos = $('.conceptoLinea');
  var i;
  for(i=0;i<textos.length;i++)
  {

    $(textos[i]).attr('background-color','#FFF');
  }
  var first = true;
  for(i=0;i<textos.length;i++)
  {
    var valor = parseFloat($(textos[i]).val());
    if(valor=="")
    {
      $(textos[i]).attr('background-color','#FF0');
      alert("Te falta llenar el campo que esta en amarillo, ponle un 0 si no aplica");
      return false;
    }
    if(first)
    {
      first=false;
      cadCampos = $(textos[i]).val().replace("$",""); 
    }
    else
    {
      cadCampos = cadCampos + '|' + $(textos[i]).val().replace("$","");  
    }
  }
  $("#cadCampos").val(cadCampos);
  var fecha = $("#fechaFicha").val().trim();
  if(fecha=="")
  {
    $("#fechaFicha").attr('background-color','#FF0');
    alert("Te falta llenar la fecha de deposito de la ficha");
    return false;
  }
  var fileName = $('#ficha').val().trim();
  if(fileName=="")
  {
    alert("Te falta seleccionar la foto de la ficha");
    return false;
  }
   return true;
}


$(document).on("change", "#tipoInforme", function (){
  var IdDiezmoConcepto = $(this).val();
  var param = {IdDiezmoConcepto : IdDiezmoConcepto}
  $.ajax({
    url: "/cargaTiposDeInformes",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var aver2 = Object.keys(resp.DiezmoConceptoLinea);
        var i;
        var cad =  '<form onsubmit="DoSubmit();" name="addProductForm" id="addProductForm" action="/subeInformeIglesia" enctype="multipart/form-data" method="post" accept-charset="utf-8"><input type="hidden" name="IdDiezmoConcepto" value="'+IdDiezmoConcepto+'" /><input type="hidden" id="cadIdDiezmoLinea" name="cadIdDiezmoLinea" /><input type="hidden" id="cadCampos" name="cadCampos" /><div class="form-group">'+
                      '<p><label for="ficha">Selecciona la foto de la ficha:</label>'+
                          '<input type="file" name="ficha" id="ficha"/></p>'+
                    '</div><br><br>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Fecha del deposito de la ficha:</label>'+
                      '<div class="col-md-3">'+
                        '<fieldset>'+
                          '<div class="control-group">'+
                            '<div class="controls">'+
                              '<div class="col-md-11 xdisplay_inputx form-group has-feedback">'+
                                '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="fechaFicha" name="fechaFicha" placeholder="Fecha del deposito de la ficha" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                              '</div>'+
                            '</div>'+
                          '</div>'+
                        '</fieldset>'+
                      '</div>'+
                    '</div><br><br>';
                    var cadCampos = '';
                    var cadIdDiezmoLinea = '';
                    var first = true;
                    for(i=0;i<aver2.length;i++)
                    {
                      if(first)
                      {
                        first = false;
                        cadIdDiezmoLinea = resp.DiezmoConceptoLinea[aver2[i]]["IdDiezmoLinea"];
                        cadCampos = resp.DiezmoConceptoLinea[aver2[i]]["Nombre"];
                      }
                      else
                      {
                        cadCampos = cadCampos+"|"+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"];
                        cadIdDiezmoLinea = cadIdDiezmoLinea+"|"+resp.DiezmoConceptoLinea[aver2[i]]["IdDiezmoLinea"];
                      }
                      cad=cad +  '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12"  style="text-align: right;"> '+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]+' </label>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="'+resp.DiezmoConceptoLinea[aver2[i]]["Nombre"]+'" IdDiezmoLinea="'+resp.DiezmoConceptoLinea[aver2[i]]["IdDiezmoLinea"]+'" class="form-control col-md-10 soloNumeros conceptoLinea" style="float: left;"  />'+
                      '</div>'+
                    '</div><br><br>';
                    }
                    cad = cad +  '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="subirInforme" class="btn btn-success">Guardar</button>'+
                      '</div>'+
                    '</div><div class="form-group" ><img id="espacioParaFicha"/></div></form>';
                    $("#cambiaContenido").html(cad);
                    $("#cadCampos").val(cadCampos);
                    $("#cadIdDiezmoLinea").val(cadIdDiezmoLinea);
                    $(".conceptoLinea").maskMoney({thousands:'', decimal:'.', allowZero:true, prefix: '$ '});
     

      $('#fechaFicha').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          //console.log(start.toISOString(), end.toISOString(), label);
        });
      }
    }
  });
});
$(document).on("keydown",".soloNumeros", function(e) {
if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
        (e.keyCode == 65 && e.ctrlKey === true) || 
        (e.keyCode >= 35 && e.keyCode <= 39)) {
             return;
    }
    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
        e.preventDefault();
    }
});
$(document).on("click", "#capturarInformeDiezmos", function (){
  capturarInformeDiezmos(); 
});

$(document).on("click", "#gastosPersonasReporte", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Gastos de Ministros/Asociados</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Gastos de Ministros/Asociados<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarReporteDeMAT" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/estadosDeCuenta",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.periodos);
          cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
          } 
          $("#delPeriodo").html(cad);
          $("#alPeriodo").html(cad);
          $("#alPeriodo option:last").attr("selected","selected");
        }
      });
  });

$(document).on("click", "#crearUnidadDeNegocio", function (){
 
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Estado de cuenta</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Estado de cuenta <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre de la nueva unidad de negocio: (3 letras)</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" maxlength="3" name="BUNIT" id="BUNIT" class="form-control col-md-10" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Descripci&oacute;n de la unidad de negocio</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text"  name="descr" id="descr" class="form-control col-md-10" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta de cuadre:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text"  name="cuadre" id="cuadre" class="form-control col-md-10" style="float: left;" />'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarBUNIT" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';
      $("#mainContent").html(cad);
  });

$(document).on("click", ".selectEmpiezaDimension", function (){
  var dimen = $(this).attr("dimen");
  var thisValue = $(this).val();
  var nombreEnd = "ANAL_T"+dimen+"_END";
  var bandera = 1;
  $('#'+nombreEnd).children('option').each(function () {
    if(this.value==thisValue)
    {
      bandera = 0;
    }
    if(bandera==1)
    {
      $(this).css("display","none");  
    }
    else
    {
      $(this).css("display","block");   
    }    
  });
});
$(document).on("change", ".selectEmpiezaDimension", function (){
  var dimen = $(this).attr("dimen");
  var thisValue = $(this).val();
  var nombreEnd = "ANAL_T"+dimen+"_END";
  $("#"+nombreEnd).val(thisValue);
});


$(document).on("click", "#estadosDeCuentaPorFNCTyPROJ", function (){
  $.ajax({
    url: "/estadosDeCuenta",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var cuentasArray = new Array();
      
      var descrArray = new Array();
      var aver2 = Object.keys(resp.cuentas);
      var ANAL_T0 = Object.keys(resp.ANAL_T0);
      var ANAL_T1 = Object.keys(resp.ANAL_T1);
      var ANAL_T2 = Object.keys(resp.ANAL_T2);
      var ANAL_T3 = Object.keys(resp.ANAL_T3);
      var ANAL_T4 = Object.keys(resp.ANAL_T4);
      var ANAL_T5 = Object.keys(resp.ANAL_T5);
      var ANAL_T6 = Object.keys(resp.ANAL_T6);
      var ANAL_T7 = Object.keys(resp.ANAL_T7);
      var ANAL_T8 = Object.keys(resp.ANAL_T8);
      var ANAL_T9 = Object.keys(resp.ANAL_T9);

      ANAL_T0 = new Array();
      ANAL_T1 = new Array();
      ANAL_T2 = new Array();
      ANAL_T4 = new Array();
      ANAL_T5 = new Array();
      ANAL_T6 = new Array();
      ANAL_T7 = new Array();
      ANAL_T9 = new Array();
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Estado de cuenta</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Estado de cuenta <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>';
                    cad=cad+'<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarEstadoDeCuentaPorFNCTyPROJ" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>';
                    if(ANAL_T0.length>0)
                    {
                      var nombre = resp.ANAL_T0[ANAL_T0[0]]["DESCR"];
                      cad=cad+'<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T0_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T0_START" class="form-control selectEmpiezaDimension" dimen="0" required="" >'+
                                        '</select> <label for="ANAL_T0_END">A:</label>'+
                                      '<select id="ANAL_T0_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                    if(ANAL_T1.length>0)
                    {
                      var nombre = resp.ANAL_T1[ANAL_T1[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T1_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T1_START" class="form-control selectEmpiezaDimension" dimen="1" required="" >'+
                                        '</select> <label for="ANAL_T1_END">A:</label>'+
                                      '<select id="ANAL_T1_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T2.length>0)
                    {
                      var nombre = resp.ANAL_T2[ANAL_T2[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T2_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T2_START" class="form-control selectEmpiezaDimension" dimen="2" required="" >'+
                                        '</select> <label for="ANAL_T2_END">A:</label>'+
                                      '<select id="ANAL_T2_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T3.length>0)
                    {
                      var nombre = resp.ANAL_T3[ANAL_T3[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T3_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T3_START" class="form-control selectEmpiezaDimension" dimen="3" required="" >'+
                                        '</select> <label for="ANAL_T3_END">A:</label>'+
                                      '<select id="ANAL_T3_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T4.length>0)
                    {
                      var nombre = resp.ANAL_T4[ANAL_T4[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T4_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T4_START" class="form-control selectEmpiezaDimension" dimen="4" required="" >'+
                                        '</select> <label for="ANAL_T4_END">A:</label>'+
                                      '<select id="ANAL_T4_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T5.length>0)
                    {
                      var nombre = resp.ANAL_T5[ANAL_T5[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T5_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T5_START" class="form-control selectEmpiezaDimension" dimen="5" required="" >'+
                                        '</select> <label for="ANAL_T5_END">A:</label>'+
                                      '<select id="ANAL_T5_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T6.length>0)
                    {
                      var nombre = resp.ANAL_T6[ANAL_T6[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T6_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T6_START" class="form-control selectEmpiezaDimension" dimen="6" required="" >'+
                                        '</select> <label for="ANAL_T6_END">A:</label>'+
                                      '<select id="ANAL_T6_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T7.length>0)
                    {
                      var nombre = resp.ANAL_T7[ANAL_T7[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T7_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T7_START" class="form-control selectEmpiezaDimension" dimen="7" required="" >'+
                                        '</select> <label for="ANAL_T7_END">A:</label>'+
                                      '<select id="ANAL_T7_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T8.length>0)
                    {
                      var nombre = resp.ANAL_T8[ANAL_T8[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T8_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T8_START" class="form-control selectEmpiezaDimension" dimen="8" required="" >'+
                                        '</select> <label for="ANAL_T8_END">A:</label>'+
                                      '<select id="ANAL_T8_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T9.length>0)
                    {
                      var nombre = resp.ANAL_T9[ANAL_T9[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T9_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T9_START" class="form-control selectEmpiezaDimension" dimen="9" required="" >'+
                                        '</select> <label for="ANAL_T9_END">A:</label>'+
                                      '<select id="ANAL_T9_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }

                    cad=cad+'<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarEstadoDeCuentaPorFNCTyPROJ" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';
      for(i=0;i<aver2.length;i++)
      {
        var aver3 = Object.keys(resp.cuentas[aver2[i]]);
        var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
        cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
        //cuentasArray.push(param);
        //descrArray.push(resp.cuentas[aver2[i]]["DESCR"]);
      }          
      $("#mainContent").html(cad);
      aver2 = Object.keys(resp.periodos);
      cad = '';
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
      } 
      $("#delPeriodo").html(cad);
      $("#alPeriodo").html(cad);

      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T0);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T0[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T0_START").html(cad);
      $("#ANAL_T0_END").html(cad);


      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T1);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T1[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T1_START").html(cad);
      $("#ANAL_T1_END").html(cad);

      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T2);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T2[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T2_START").html(cad);
      $("#ANAL_T2_END").html(cad);


      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T3);
      for(i=0;i<aver2.length;i++)
      {
        if(aver2[i].toString().trim().substring(0,2)=="DT")
        {
          cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T3[aver2[i]]["NAME"].toString().trim()+'</option>';  
        }
      } 
      $("#ANAL_T3_START").html(cad);
      $("#ANAL_T3_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T4);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T4[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T4_START").html(cad);
      $("#ANAL_T4_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T5);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T5[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T5_START").html(cad);
      $("#ANAL_T5_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T6);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T6[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T6_START").html(cad);
      $("#ANAL_T6_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T7);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T7[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T7_START").html(cad);
      $("#ANAL_T7_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T8);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T8[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T8_START").html(cad);
      $("#ANAL_T8_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T9);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T9[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T9_START").html(cad);
      $("#ANAL_T9_END").html(cad);
      
      
      

      $("#alPeriodo option:last").attr("selected","selected");
      $('#autocomplete-custom-append').autocomplete({
        lookup: cuentasArray,
        appendTo: '#autocomplete-container'
      });        
    }});  
  });
var jsonGlobal = new Array();

function actualizaInfoPrestamos() {
  var monto = parseFloat($("#monto2Meses").val());
  monto = Math.round(monto * 100) / 100;
  var periodo = $("#delPeriodoAnticipos2Meses").val();
  var numMeses = $("#numMeses").val();
  var anio = periodo.substring(0,4);
  var mes = periodo.substring(5);
  var mensualidad = monto / numMeses;
  mensualidad = Math.round(mensualidad * 100) / 100;
  var ultimaMensualidad = mensualidad;
  var comprobacion = mensualidad * numMeses;
  if(comprobacion!= monto)
  {
    var dif = monto - comprobacion;
    ultimaMensualidad += dif;
    ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
  }
  var pal = 'es';
  if(numMeses==2){pal='';}
  var fecha = $("#fechaTrans2Meses").val().trim();
  var fechaPrimerDescuento = anio+"-"+mes+"-25";
  if(fecha!="")
  {
    var anioDeFecha = fecha.substring(6,10);
    var mesDeFecha = fecha.substring(0,2);
    var diaDeFecha = fecha.substring(3,5);
    var deFechaFormato = anioDeFecha+"-"+mesDeFecha+"-"+diaDeFecha;
    fechaPrimerDescuento = anioDeFecha+"-"+mesDeFecha+"-25";
    if(parseInt(diaDeFecha)>=25)
    {
      if(parseInt(mesDeFecha)<12)
      {
        mesDeFecha++;
      }
      else{
        mesDeFecha="01";
        anioDeFecha = parseInt(anioDeFecha)+1;
      }
      fechaPrimerDescuento = anioDeFecha+"-"+mesDeFecha+"-25";
    }
      
  }
  $("#info2Meses").html('<b>Prestamo de $'+monto+' a '+numMeses+' meses. '+(numMeses-1)+' mensualidad'+pal+' de $'+mensualidad+' y la ultima mensualidad es de: '+ultimaMensualidad+'  El primer descuento ser&aacute; hecho el '+fechaPrimerDescuento+'</b>');

}



$(document).on("keyup", "#monto2Meses", function (){
  actualizaInfoPrestamos();
});
$(document).on("change", "#numMeses", function (){
  actualizaInfoPrestamos();
});

$(document).on("change", "#fechaTrans2Meses", function (){
  actualizaInfoPrestamos();
});
var interTadpoles;
function cargaTadpoles() {
  var param = {BUNIT : "M11"}//  $("#BUNITACTUAL").html()}
  $.ajax({
    url: "/cargaER",
    dataType : "json",
    type : "post",
    async : true,
    data : param,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#mainContent").html('<canvas id="svgTadpoles" width="900" height="900" ></canvas>');
          var canvas = document.querySelector("canvas");
   var context = canvas.getContext("2d");
    var width = 900;
  var height = 900;
 
// var  context = d3.select("svgTadpoles").context2d(width, height);
 
 // var context = DOM.context2d(width, height);
  context.lineJoin = "round";
  context.lineCap = "round";
  var aver2 = Object.keys(resp.esperma);
 // for(i=0;i<aver2.length;i++) {//if departamento
  //}
var n =aver2.length,m=12, v=2;
var i;
  var tadpoles = new Array(n).fill().map(() => ({
    vx: (Math.random() - 0.5) * v,
    vy: (Math.random() - 0.5) * v,
    px: new Array(m).fill(Math.random() * width),
    py: new Array(m).fill(Math.random() * height),
    count: 0
  }));
   for(i=0;i<n;i++) {
    var t = tadpoles[i];
     resp.esperma[aver2[i]].Nombre =  resp.esperma[aver2[i]].Nombre.trim().replace("ER -","");
    t["text"] = resp.esperma[aver2[i]].Nombre;
    t["depar"] = resp.esperma[aver2[i]].Departamento;
  }

 $("#svgTadpoles").mousemove(function(e){handleMouseMove(e);});


function handleMouseMove(e){
  // tell the browser we're handling this event
  e.preventDefault();
  e.stopPropagation();

  var mouseX=parseInt(e.clientX);//ofset
  var mouseY=parseInt(e.clientY);//ofset

  for(var i=0;i<tadpoles.length;i++){
    var h=tadpoles[i];
    var dx=mouseX-h.x;
    var dy=mouseY-h.y;
    if(dx*dx+dy*dy<h.radius*h.radius){
      context.fillText(h.depar,h.px,h.py);
    }
  }

}
 

 

  //while (true) {
    interTadpoles = setInterval( function() {
    context.clearRect(0, 0, width, height);
     for (const t of tadpoles) {
      let dx = t.vx;
      let dy = t.vy;
      let x = t.px[0] += dx;
      let y = t.py[0] += dy;
      let speed = Math.sqrt(dx * dx + dy * dy);
      const count = speed * 10;
      const k1 = -5 - speed / 3;

      // Bounce off the walls.
      if (x < 0 || x > width) t.vx *= -1;
      if (y < 0 || y > height) t.vy *= -1;

      // Swim!
      for (var j = 1; j < m; ++j) {
        const vx = x - t.px[j];
        const vy = y - t.py[j];
        const k2 = Math.sin(((t.count += count) + j * 3) / 300) / speed;
        t.px[j] = (x += dx / speed * k1) - dy * k2;
        t.py[j] = (y += dy / speed * k1) + dx * k2;
        speed =  Math.sqrt((dx = vx) * dx + (dy = vy) * dy);
      }
      
      // Head
      context.save();
      context.translate(t.px[0], t.py[0]);
      context.rotate(Math.atan2(t.vy, t.vx));
      context.beginPath();

////
      context.font = "14px Comic Sans MS";
      //context.fillStyle = "black";
      context.fillStyle = "rgba(0, 0, 0, 0.3)";
      context.textAlign = "center";
            context.fillText(t.text, dx, dy+ 2.5 );
            context.fillStyle = "black";
       //// 

      context.ellipse(0, 0, 6.5, 4, 0, 0, 2 * Math.PI);
      context.fill();
      context.restore();
      
      // Body
      context.beginPath();
      context.moveTo(t.px[0], t.py[0]);
      for (let i = 1; i < 3; ++i) context.lineTo(t.px[i], t.py[i]);
      context.lineWidth = 4;
      context.stroke();
      
      // Tail
      context.beginPath();
      context.moveTo(t.px[0], t.py[0]);
      for (let i = 1; i < m; ++i) context.lineTo(t.px[i], t.py[i]);
      context.lineWidth = 2;
      context.stroke();
    }
    
     context.canvas;

},10);
  

      }
    }
  });  
  }
$(document).on("click", "#tadpoles", function (){
  cargaTadpoles();
  /*
$("#mainContent").html('<canvas id="svgTadpoles" width="900" height="900" ></canvas>');

  var width = 900;
  var height = 900;
   var canvas = document.querySelector("canvas");
   var context = canvas.getContext("2d");
// var  context = d3.select("svgTadpoles").context2d(width, height);
 
 // var context = DOM.context2d(width, height);
  context.lineJoin = "round";
  context.lineCap = "round";
var n =100,m=12, v=2;
  var tadpoles = new Array(n).fill().map(() => ({
    vx: (Math.random() - 0.5) * v,
    vy: (Math.random() - 0.5) * v,
    px: new Array(m).fill(Math.random() * width),
    py: new Array(m).fill(Math.random() * height),
    count: 0
  }));

  //while (true) {
    interTadpoles = setInterval( function() {
    context.clearRect(0, 0, width, height);
     for (const t of tadpoles) {
      let dx = t.vx;
      let dy = t.vy;
      let x = t.px[0] += dx;
      let y = t.py[0] += dy;
      let speed = Math.sqrt(dx * dx + dy * dy);
      const count = speed * 10;
      const k1 = -5 - speed / 3;

      // Bounce off the walls.
      if (x < 0 || x > width) t.vx *= -1;
      if (y < 0 || y > height) t.vy *= -1;

      // Swim!
      for (var j = 1; j < m; ++j) {
        const vx = x - t.px[j];
        const vy = y - t.py[j];
        const k2 = Math.sin(((t.count += count) + j * 3) / 300) / speed;
        t.px[j] = (x += dx / speed * k1) - dy * k2;
        t.py[j] = (y += dy / speed * k1) + dx * k2;
        speed = Math.sqrt((dx = vx) * dx + (dy = vy) * dy);
      }
      
      // Head
      context.save();
      context.translate(t.px[0], t.py[0]);
      context.rotate(Math.atan2(t.vy, t.vx));
      context.beginPath();
      context.ellipse(0, 0, 6.5, 4, 0, 0, 2 * Math.PI);
      context.fill();
      context.restore();
      
      // Body
      context.beginPath();
      context.moveTo(t.px[0], t.py[0]);
      for (let i = 1; i < 3; ++i) context.lineTo(t.px[i], t.py[i]);
      context.lineWidth = 4;
      context.stroke();
      
      // Tail
      context.beginPath();
      context.moveTo(t.px[0], t.py[0]);
      for (let i = 1; i < m; ++i) context.lineTo(t.px[i], t.py[i]);
      context.lineWidth = 2;
      context.stroke();
    }
    
     context.canvas;

},10);
  


    
   
 // }
 */
});




function ponMesesDisponibles() {
  var depar = $("#autocomplete-custom-append").val().trim();
  var ar = depar.split('|');
  var departamento = ar[0].trim().substring(0,3);
  if(departamento=="MIN")
  {
    var periodo = $("#delPeriodoAnticipos2Meses").val();
    var mes = parseInt(periodo.substring(5));
    var mesesDisponibles = 12 - mes +1;
    var i, cad ='';
    for(i=2;i<=mesesDisponibles;i++)
    {
      cad=cad+'<option value="'+i+'">'+i+' meses</option>';
    }
    $("#numMeses").html(cad);
  }
  else
  {
$("#numMeses").html('<option value="2">2 Meses</option><option value="3">3 Meses</option><option value="4">4 Meses</option><option value="5">5 Meses</option><option value="6">6 Meses</option><option value="7">7 Meses</option><option value="8">8 Meses</option><option value="9">9 Meses</option><option value="10">10 Meses</option><option value="11">11 Meses</option><option value="12">12 Meses</option>');
  }
}

$(document).on("change", "#delPeriodoAnticipos2Meses", function (){
  ponMesesDisponibles();
});

$(document).on("click", "#autocomplete-container_Prestamos", function (){
  ponMesesDisponibles();
});

$(document).on("click", "#prestamosMenu", function (){
  var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Prestamos de 2 meses para arriba</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Anticipos <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Persona:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container_Prestamos" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodoAnticipos2Meses">Del periodo:</label>'+
                          '<select id="delPeriodoAnticipos2Meses" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="numMeses">Meses de duración del prestamo:</label>'+
                          '<select id="numMeses" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="monto">Monto:</label>'+
                          '<input type="number" class="form-control soloNumeros" id="monto2Meses" /></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<input type="text" style="width: 200%;" class="form-control has-feedback-left" id="fechaTrans2Meses" name="fechaTrans2Meses" placeholder="Fecha de transaccion" aria-describedby="inputSuccess2Status">'+
                                '<span class="fa fa-calendar-o form-control-feedback left" id="calendarioFecha2MEses" aria-hidden="true"></span>'+
                                '<span id="inputSuccess2Status" class="sr-only">(success)</span>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p style="font-size:20px;" id="info2Meses"></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="cuenta">Cuenta:</label>'+
                          '<select id="cuenta" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="tipoDeDiario">Tipo de Diario:</label>'+
                          '<select id="tipoDeDiario" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="monto">Referencia de transaccion:</label>'+
                          '<input type="text" class="form-control" maxlength="15" id="treference2Meses" /></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12">'+
                        '<button type="submit" id="contabilizarAnticipo2Meses" class="btn btn-success">Contabilizar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="loadingCampos">'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-9">'+
                        '<button type="submit" deVerdad="1" id="timbrarAnticipoMasDe1Mes" class="btn btn-warning">Timbrar</button>'+
                      '</div><br><br><div id="loadingCampos"></div>'+
                    '</div>'+
                    '</div></div></div></div></div></div>';
      $("#mainContent").html(cad);
$('#fechaTrans2Meses').daterangepicker({
          singleDatePicker: true,
          calender_style: "picker_1"
        }, function(start, end, label) {
          //console.log(start.toISOString(), end.toISOString(), label);
        });
  $.ajax({
    url: "/dameFolioQueSigue",
    dataType : "json",
    type : "post",
    async : false,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp2){
      var folio = resp2.folio;
       $.ajax({
    url: "/infoAnticiposMinistros",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        //nomina
        $("#timbrarAnticipoMasDe1Mes").attr("folio",folio);
        $("#timbrarAnticipoMasDe1Mes").attr("regPatronal",resp.regPatronal);
        $("#timbrarAnticipoMasDe1Mes").attr("razonSocial",resp.razonSocial);
        $("#timbrarAnticipoMasDe1Mes").attr("regimen",resp.regimen);
        $("#timbrarAnticipoMasDe1Mes").attr("rfc",resp.rfc);
        $("#timbrarAnticipoMasDe1Mes").attr("date",resp.date);
        $("#timbrarAnticipoMasDe1Mes").attr("lugarExpedicion",resp.lugarExpedicion);
        jsonGlobal = resp.PayrollList;  
        //fin nomina
        var aver2 = Object.keys(resp.periodos);  
        var i, cad ='', j;
        for(i=0;i<aver2.length;i++)
        {
          for(j=i;j<aver2.length;j++)
          {
            if(parseInt(aver2[i])<parseInt(aver2[j]))
            {
              var aux = aver2[i];
              aver2[i] = aver2[j];
              aver2[j] = aux;
            }
          }
        }
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#delPeriodoAnticipos2Meses").html(cad);

        aver2 = Object.keys(resp.CuentasList);
        cad='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#cuenta").html(cad);

         aver2 = Object.keys(resp.TipoDiarioList);
        cad='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#tipoDeDiario").html(cad);
        var personas = new Array();
        var personas2 = new Array();
        aver2 = Object.keys(resp.PayrollList);
        for(i=0;i<aver2.length;i++)
        {
          var per = resp.PayrollList[aver2[i]].Departamento+ " | "+resp.PayrollList[aver2[i]].ER+ " | "+resp.PayrollList[aver2[i]].Nombre.trim();
          personas.push({label:resp.PayrollList[aver2[i]].Nombre.trim(), name:per});
            
          personas2.push(per);
        }
        $('#autocomplete-custom-append').autocomplete({
          lookup: personas2,
          appendTo: '#autocomplete-container_Prestamos',
         select:function(value) {
          //your selection code goes here
          console.log("aqui entrego");
          alert(value);
          
          }
        });        


        
      }
      
     }
   });
    }
  });
 
});


$(document).on("click", "#anticiposMenu", function (){
  var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Anticipos</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Anticipos <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Asociado Religioso:</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="monto">Monto:</label>'+
                          '<input type="number" class="form-control soloNumeros" id="monto" /></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="cuenta">Cuenta:</label>'+
                          '<select id="cuenta" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="tipoDeDiario">Tipo de Diario:</label>'+
                          '<select id="tipoDeDiario" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                     '<div class="form-group">'+
                      '<p><label for="treference">Referencia de Transacci&oacute;n:</label>'+
                          '<input type="text" class="form-control" maxlength="15" id="treference" /></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="contabilizarAnticipo" class="btn btn-success">Contabilizar</button>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group" id="loadingCampos">'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="timbrarAnticipo" class="btn btn-warning">Timbrar</button>'+
                      '</div><br><br><div id="loadingCampos"></div>'+
                    '</div>'+
                    '</div></div></div></div></div></div>';
      $("#mainContent").html(cad);

  $.ajax({
    url: "/dameFolioQueSigue",
    dataType : "json",
    type : "post",
    async : false,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp2){
      var folio = resp2.folio;
       $.ajax({
    url: "/infoAnticipos",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        //nomina
        $("#timbrarAnticipo").attr("folio",folio);
        $("#timbrarAnticipo").attr("regPatronal",resp.regPatronal);
        $("#timbrarAnticipo").attr("razonSocial",resp.razonSocial);
        $("#timbrarAnticipo").attr("regimen",resp.regimen);
        $("#timbrarAnticipo").attr("rfc",resp.rfc);
        $("#timbrarAnticipo").attr("date",resp.date);
        $("#timbrarAnticipo").attr("lugarExpedicion",resp.lugarExpedicion);
        jsonGlobal = resp.PayrollList;  
        //fin nomina
        var aver2 = Object.keys(resp.periodos);  
        var i, cad ='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#delPeriodo").html(cad);

        aver2 = Object.keys(resp.CuentasList);
        cad='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#cuenta").html(cad);

         aver2 = Object.keys(resp.TipoDiarioList);
        cad='';
        for(i=0;i<aver2.length;i++)
        {
          cad=cad+'<option value="'+aver2[i]+'">'+aver2[i]+'</option>';
        }
        $("#tipoDeDiario").html(cad);
        var personas = new Array();
        aver2 = Object.keys(resp.PayrollList);
        for(i=0;i<aver2.length;i++)
        {
          var per = resp.PayrollList[aver2[i]].ER+ " | "+resp.PayrollList[aver2[i]].Nombre;
          personas.push(per);
        }
        $('#autocomplete-custom-append').autocomplete({
          lookup: personas,
          appendTo: '#autocomplete-container'
        });        


        
      }
      
     }
   });
    }
  });
 
});

$(document).on("click", "#contabilizarAlgo", function (){
  var cad = $(this).attr("cad");
  var usuario = $("#USUARIOACTUAL").html();
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var hash = resp.hash;
      window.open(
          "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cad+"&libro=A&pass=",
          '_blank'
      );
    }
  });
});

$(document).on("click", "#contabilizarAnticipo2Meses", function (){
  var valor = $("#autocomplete-custom-append").val();
  var ver = valor.split("|");
  if(ver.length==0)
  {
    alert("Tienes que seleccionar con el mouse una opcion, un trabajador o ministro");
    return;
  }
  var ER = ver[1].trim();
  var nombre = ver[2].trim();
  var periodo = $("#delPeriodoAnticipos2Meses").val();
  var cuenta = $("#cuenta").val();
  var monto = $("#monto2Meses").val();
  var tipoDeDiario = $("#tipoDeDiario").val().trim();
  var anio = periodo.substring(0,4);
  var mes = periodo.substring(5);
  var numMeses = parseInt($("#numMeses").val());
  

  var treference = $("#treference2Meses").val().trim()
  if(treference==""){
    alert("Tienes que escribir una referencia de transaccion");
    return;
  }

  ////////////////////////////
  var mensualidad = monto / numMeses;
  mensualidad = Math.round(mensualidad * 100) / 100;
  var ultimaMensualidad = mensualidad;
  var comprobacion = mensualidad * numMeses;
  if(comprobacion!= monto)
  {
    var dif = monto - comprobacion;
    ultimaMensualidad += dif;
    ultimaMensualidad = Math.round(ultimaMensualidad * 100) / 100;
  }
  var pal = 'es';
  if(numMeses==2){pal='';}
  var fecha = $("#fechaTrans2Meses").val().trim();
  var fechaPrimerDescuento = anio+"-"+mes+"-25";
  var anioDeFecha,  mesDeFecha , diaDeFecha;
  var periodoPrimerDescuento;
  if(fecha!="")
  {
    anioDeFecha = fecha.substring(6,10);
    mesDeFecha = fecha.substring(0,2);
    diaDeFecha = fecha.substring(3,5);
    var deFechaFormato = anioDeFecha+"-"+mesDeFecha+"-"+diaDeFecha;
    fechaPrimerDescuento = "25"+mesDeFecha+anioDeFecha;

    if(parseInt(diaDeFecha)>=25)
    {
      if(parseInt(mesDeFecha)<12)
      {
        mesDeFecha = parseInt(mesDeFecha)+1;
        if(mesDeFecha<10){mesDeFecha="0"+mesDeFecha;}
      }
      else{
        mesDeFecha="01";
        anioDeFecha = parseInt(anioDeFecha)+1;
      }
      fechaPrimerDescuento = "25"+mesDeFecha+anioDeFecha;
    }
    periodoPrimerDescuento = anioDeFecha+"0"+mesDeFecha; 
  }
  else{
    alert("Tienes que seleccionar la fecha de transaccion del diario");
    return;
  }
 // $("#info2Meses").html('<b>Prestamo de $'+monto+' a '+numMeses+' meses. '+(numMeses-1)+' mensualidad'+pal+' de $'+mensualidad+' y la ultima mensualidad es de: '+ultimaMensualidad+'  El primer descuento ser&aacute; hecho el '+fechaPrimerDescuento+'</b>');

  ////////////////////////////


var numLineas = (numMeses*2)+2
fecha = diaDeFecha +mesDeFecha+anioDeFecha;
//  var fecha = "15"+mes+anio;
  var BUNIT = $("#BUNITACTUAL").html();
  var cad = '||'+numLineas+'|'+BUNIT+'|'+tipoDeDiario+'|';
  var treferenceInicial = treference;
  var cuentaPrestamo = '178180';
  if(BUNIT=="FOP")//la latosa de Karina Osoria
  {
    cuentaPrestamo = "178110";
  }
  if(BUNIT=="MP1")//la latosa de Cindy
  {
    cuentaPrestamo = "178210";
  }

  cad=cad+treferenceInicial+'|'+periodo+'|'+fecha+'|'+cuenta+'||NF|10||||'+ER+'||||'+nombre+'|'+monto+'|C|'+treferenceInicial+'|'+periodo+'|'+fecha+'|'+cuentaPrestamo+'||NF|10||||'+ER+'||||ANTICIPO A '+numMeses+' MESES|'+monto+'|D|';
  var i;
  for(i=0;i<numMeses;i++)
  {
    //monto checar
    var treferenceI = "PRESTAMO "+anioDeFecha+mesDeFecha;
    var montoMensual=mensualidad;
    if(i==numMeses-1){
      montoMensual =ultimaMensualidad;
    }
    cad=cad+treferenceI+'|'+periodoPrimerDescuento+'|'+fechaPrimerDescuento+'|'+ER+'||NF|10||||||||OTROS - PULPITO '+periodoPrimerDescuento+'|'+montoMensual+'|D|'+treferenceI+'|'+periodoPrimerDescuento+'|'+fechaPrimerDescuento+'|'+cuentaPrestamo+'||NF|10||||'+ER+'||||DEPRECIACION '+periodoPrimerDescuento+'|'+montoMensual+'|C|';
    
    if(parseInt(mesDeFecha)<12)
    {
      mesDeFecha = parseInt(mesDeFecha)+1;
        if(mesDeFecha<10){mesDeFecha="0"+mesDeFecha;}
    }
    else{
      mesDeFecha="01";
      anioDeFecha = parseInt(anioDeFecha)+1;
    }
    fechaPrimerDescuento = "25"+mesDeFecha+anioDeFecha;
    periodoPrimerDescuento = anioDeFecha+"0"+mesDeFecha; 

  }



  var usuario = $("#USUARIOACTUAL").html();
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var hash = resp.hash;
      window.open(
          "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cad+"&libro=A&pass=",
          '_blank'
      );
    }
  });
});

$(document).on("click", "#contabilizarAnticipo", function (){
  var valor = $("#autocomplete-custom-append").val();
  var ver = valor.split("|");
  if(ver.length==0)
  {
    alert("Tienes que seleccionar con el mouse una opcion");
    return;
  }
  var ER = ver[0].trim();
  var nombre = ver[1].trim();
  var periodo = $("#delPeriodo").val();
  var cuenta = $("#cuenta").val();
  var monto = $("#monto").val();
  var tipoDeDiario = $("#tipoDeDiario").val();
  var treference = $("#treference").val();
  if(treference.length==0)
  {
    alert("Tienes que escribir la referencia de transaccion del diario");
    return;
  }
  var anio = periodo.substring(0,4);
  var mes = periodo.substring(5);
  var fecha = "15"+mes+anio;
  var BUNIT = $("#BUNITACTUAL").html();
  var cad = '||2|'+BUNIT+'|'+tipoDeDiario+'|'+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|||10||||||||'+nombre+'|'+monto+'|C|'+treference+'|'+periodo+'|'+fecha+'|'+ER+'|||10||||||||ANTICIPO '+periodo+'|'+monto+'|D|';
  var usuario = $("#USUARIOACTUAL").html();
  $.ajax({
    url: "/dameHash",
    dataType : "json",
    type : "post",
    async : true,
    data : {},
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var hash = resp.hash;
      window.open(
          "/generarDiario?hash="+hash+"&source="+usuario+"&diario="+cad+"&libro=A&pass=",
          '_blank'
      );
    }
  });
});

$(document).on("click", "#timbrarAnticipoMasDe1Mes", function (){
  var valor = $("#autocomplete-custom-append").val();
  var ver = valor.split("|");
  if(ver.length==0)
  {
    alert("Tienes que seleccionar con el mouse una opcion");
    return;
  }
  var departamento = ver[0].trim();
  var ER = ver[1].trim();
  var nombre = ver[2].trim();
  var periodo = $("#delPeriodoAnticipos2Meses").val();
  var cuenta = $("#cuenta").val();
  var monto = $("#monto2Meses").val();

  monto = Math.round(monto * 100) / 100;
  var montoS = ""+monto;
  var arr = montoS.split(".");
  var montoReal = montoS;
  if(arr.length==1)
  {
    montoReal = montoS+".00";
  }
  else {
    if(arr[1].length==1)
    {
      montoReal=montoS+"0";
    }
  }

  var tipoDeDiario = $("#tipoDeDiario").val();
 
  var anio = periodo.substring(0,4);
  var mes = periodo.substring(5);
  var fecha = "15"+mes+anio;
  var BUNIT = $("#BUNITACTUAL").html();
  
  var usuario = $("#USUARIOACTUAL").html();
 
  //////////////////
  var TimeStamp = 0;
  var aver2 = Object.keys(jsonGlobal);  
  var fechaCompleta = $(this).attr("date");
  var i;
  var rfcPersona = "";
  var curpPersona = "";
  var numPersona = "";
  var nssPersona = "";

  var cuentaBancariaPersona = "";
  var correoPersona = "";
  var bancoPersona = "";
  var departamentoPersona = "";
  var estadoPersona = "";
  var sdiPersona = "";

  var fechaInicioRelLaboralPersona = "";
  for(i=0;i<aver2.length;i++)
  {
    if(ER==jsonGlobal[aver2[i]].ER)
    {
      rfcPersona = jsonGlobal[aver2[i]].Rfc.trim();
      curpPersona = jsonGlobal[aver2[i]].Curp.trim();
      numPersona = jsonGlobal[aver2[i]].Num.trim();
      nssPersona = jsonGlobal[aver2[i]].NumSeguridadSocial.trim();

      
      fechaInicioRelLaboralPersona = jsonGlobal[aver2[i]].FechaInicioRelLaboral.trim();
      cuentaBancariaPersona = jsonGlobal[aver2[i]].CuentaBancaria.trim();
      correoPersona = jsonGlobal[aver2[i]].Correo.trim();
      bancoPersona = jsonGlobal[aver2[i]].Banco.trim();
      departamentoPersona = jsonGlobal[aver2[i]].Departamento.trim();
      estadoPersona = jsonGlobal[aver2[i]].Estado.trim();
      sdiPersona = jsonGlobal[aver2[i]].SDI;
      break;
    }
  }
  if(numPersona.length==1)
  {
    numPersona = "00"+numPersona;
  }
  if(numPersona.length==2)
  {
    numPersona = "0"+numPersona;
  }
  
  var datex = $(this).attr("date"); 
  var rfc = $(this).attr("rfc");
  var razonsocial = $(this).attr("razonsocial"); 
  var regpatronal = $(this).attr("regpatronal"); 
  var lugarExpedicion = $(this).attr("lugarExpedicion"); 
  var folio = $(this).attr("folio"); 

  var dateDiez = datex.substring(0,10);

    


    var anio = fechaInicioRelLaboralPersona.substring(6);
           var mes = fechaInicioRelLaboralPersona.substring(3,5);
           var dia = fechaInicioRelLaboralPersona.substring(0,2);

           var nuevo = anio+"-"+mes+"-"+dia;


           var date1 = new Date(nuevo);
        var date2 = new Date();
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var semanas =  Math.trunc(diffDays/7);

        var antiguedad = "P"+semanas+"W";
           
  
  var certificado = dameNoCertificadoSegunRFC(rfc);
  var tipoContrato = "01";
  var fechaTrans2Meses = $("#fechaTrans2Meses").val().trim();
  var anioDeFecha,  mesDeFecha , diaDeFecha;
  var deFechaFormatoX;
  if(fechaTrans2Meses!="")
  {
    anioDeFecha = fechaTrans2Meses.substring(6,10);
    mesDeFecha = fechaTrans2Meses.substring(0,2);
    diaDeFecha = fechaTrans2Meses.substring(3,5);
    deFechaFormatoX = anioDeFecha+"-"+mesDeFecha+"-"+diaDeFecha;
  }
  var cadOriginal = '||3.3|N|'+folio+'|'+datex+'|99|'+certificado+'|'+montoReal+'|MXN|'+montoReal+'|N|PUE|'+lugarExpedicion+'|'+rfc+'|'+razonsocial+'|603|'+rfcPersona+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+montoReal+'|'+montoReal+'|1.2|E|'+deFechaFormatoX+'|'+dateDiez+'|'+dateDiez+'|1|'+montoReal+'|'+regpatronal+'|'+curpPersona+'|'+nssPersona+'|'+nuevo+'|'+antiguedad+'|'+tipoContrato+'|01|02|'+numPersona+'|'+departamentoPersona+'|Ninguno|1|99|';

  if(departamento.substring(0,3)=="MIN" || departamento.substring(0,3)=="EME")
  {
    tipoContrato = "09";
    cadOriginal = '||3.3|N|'+folio+'|'+datex+'|99|'+certificado+'|'+montoReal+'|MXN|'+montoReal+'|N|PUE|'+lugarExpedicion+'|'+rfc+'|'+razonsocial+'|603|'+rfcPersona+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+montoReal+'|'+montoReal+'|1.2|E|'+dateDiez+'|'+dateDiez+'|'+dateDiez+'|1|'+montoReal+'|'+curpPersona+'|'+tipoContrato+'|01|09|'+numPersona+'|'+departamentoPersona+'|Ninguno|99|';    
  }

if(cuentaBancariaPersona.length!=18)
{
 cadOriginal = cadOriginal + bancoPersona + '|'; 
}
if(departamento.substring(0,3)=="MIN" || departamento.substring(0,3)=="EME")
  {
    cadOriginal = cadOriginal + cuentaBancariaPersona +'|'+estadoPersona+'|999|999|PRESTAMO|'+monto+'||';

   }
   else{
  cadOriginal = cadOriginal + cuentaBancariaPersona + '|'+sdiPersona+'|'+estadoPersona+'|999|999|PRESTAMO|'+monto+'||';
  
   }
  
//ejemplo real
  //||3.3|N|5|2019-01-31T15:55:07|99|00001000000406720491|20530.31|6482.11|MXN|14048.20|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|603|CURM860912AF6|Michelle Cruz Rojas|P01|84111505|1|ACT|Pago de nómina|20530.31|20530.31|6482.11|1.2|O|2019-01-25|2019-01-01|2019-01-31|31|20530.31|6482.11|0.00|D4918553105|CURM860912MNLRJC07|43138608922|2018-09-01|P20W|01|01|02|038|ASOCIADOS RELIGIOSOS|Ninguno|1|05|044|56582176717|705.87|NLE|20530.31|8279.11|12251.20|038|015|MANUTENCION|8279.11|12251.20|5827.24|654.87|004|005|OTROS|5250|001|001|IMSS|331.07|003|003|RCV|246.17|002|010|ISR|654.87||
 console.log(cadOriginal);
 //estoy generando
 //||3.3|N|425|2019-02-13T10:44:07|99|00001000000406720491|1.23|MXN|1.23|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|603|CURM860912AF6|Michelle Cruz Rojas|P01|84111505|1|ACT|Pago de nómina|1.23|1.23|0.00|1.2|E|2019-02-13|2019-02-13|2019-02-13|0.01|1.23|0.00|D4918553105|CURM860912MNLRJC07|43138608922|2018-09-01|P57W|01|01|02|038|ASOCIADOS RELIGIOSOS|Ninguno|1|05|044|56582176717|693.35|NLE|1.23|0.00|1.23|038|001|MANUTENCION|0.00|1.23||
  var deducciones = 0;
  var percepciones = 0;
  var otros = 1;
  var deVerdad = $(this).attr("deVerdad");
  var param = {periodo : periodo, ER : ER, TimeStamp : "TimeStamp", deVerdad : deVerdad, esManual : 0, manual :4, cadOriginal : cadOriginal, TipoContrato : tipoContrato, cuantasPercepciones : percepciones, cuantasDeducciones : deducciones, cuantasOtrosPagos : otros, nombre : nombre}
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/timbraNomina3.3",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#loadingCampos").html('');
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: "+resp.error+" REVISAR: "+resp.revisar);
      }
    }
  });
});



$(document).on("click", "#timbrarAnticipo", function (){
  var valor = $("#autocomplete-custom-append").val();
  var ver = valor.split("|");
  if(ver.length==0)
  {
    alert("Tienes que seleccionar con el mouse una opcion");
    return;
  }
  var ER = ver[0].trim();
  var nombre = ver[1].trim();
  var periodo = $("#delPeriodo").val();
  var cuenta = $("#cuenta").val();
  var monto = $("#monto").val();

  monto = Math.round(monto * 100) / 100;
  var montoS = ""+monto;
  var arr = montoS.split(".");
  var montoReal = montoS;
  if(arr.length==1)
  {
    montoReal = montoS+".00";
  }
  else {
    if(arr[1].length==1)
    {
      montoReal=montoS+"0";
    }
  }

  var tipoDeDiario = $("#tipoDeDiario").val();
  var treference = $("#treference").val();
  if(treference.length==0)
  {
    alert("Tienes que escribir la referencia de transaccion del diario");
    return;
  }
  var anio = periodo.substring(0,4);
  var mes = periodo.substring(5);
  var fecha = "15"+mes+anio;
  var BUNIT = $("#BUNITACTUAL").html();
  var cad = '||2|'+BUNIT+'|'+tipoDeDiario+'|'+treference+'|'+periodo+'|'+fecha+'|'+cuenta+'|||10||||||||'+nombre+'|'+monto+'|C|'+treference+'|'+periodo+'|'+fecha+'|'+ER+'|||10||||||||ANTICIPO '+periodo+'|'+monto+'|D|';
  var usuario = $("#USUARIOACTUAL").html();
 
  //////////////////
  var TimeStamp = 0;
  var aver2 = Object.keys(jsonGlobal);  
  var fechaCompleta = $(this).attr("date");
  var i;
  var rfcPersona = "";
  var curpPersona = "";
  var numPersona = "";
  var nssPersona = "";

  var cuentaBancariaPersona = "";
  var correoPersona = "";
  var bancoPersona = "";
  var departamentoPersona = "";
  var estadoPersona = "";
  var sdiPersona = "";

  var fechaInicioRelLaboralPersona = "";
  for(i=0;i<aver2.length;i++)
  {
    if(ER==jsonGlobal[aver2[i]].ER)
    {
      rfcPersona = jsonGlobal[aver2[i]].Rfc;
      curpPersona = jsonGlobal[aver2[i]].Curp;
      numPersona = jsonGlobal[aver2[i]].Num;
      nssPersona = jsonGlobal[aver2[i]].NumSeguridadSocial;

      
      fechaInicioRelLaboralPersona = jsonGlobal[aver2[i]].FechaInicioRelLaboral;
      cuentaBancariaPersona = jsonGlobal[aver2[i]].CuentaBancaria;
      correoPersona = jsonGlobal[aver2[i]].Correo;
      bancoPersona = jsonGlobal[aver2[i]].Banco;
      departamentoPersona = jsonGlobal[aver2[i]].Departamento;
      estadoPersona = jsonGlobal[aver2[i]].Estado;
      sdiPersona = jsonGlobal[aver2[i]].SDI;
      break;
    }
  }
  if(numPersona.length==1)
  {
    numPersona = "00"+numPersona;
  }
  if(numPersona.length==2)
  {
    numPersona = "0"+numPersona;
  }
  
  var datex = $(this).attr("date"); 
  var rfc = $(this).attr("rfc");
  var razonsocial = $(this).attr("razonsocial"); 
  var regpatronal = $(this).attr("regpatronal"); 
  var lugarExpedicion = $(this).attr("lugarExpedicion"); 
  var folio = $(this).attr("folio"); 

  var dateDiez = datex.substring(0,10);

    


    var anio = fechaInicioRelLaboralPersona.substring(6);
           var mes = fechaInicioRelLaboralPersona.substring(3,5);
           var dia = fechaInicioRelLaboralPersona.substring(0,2);

           var nuevo = anio+"-"+mes+"-"+dia;


           var date1 = new Date(nuevo);
        var date2 = new Date();
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
        var semanas =  Math.trunc(diffDays/7);

        var antiguedad = "P"+semanas+"W";
           
  
  var certificado = dameNoCertificadoSegunRFC(rfc);
  var tipoContrato = "01";
  
  var cadOriginal = '||3.3|N|'+folio+'|'+datex+'|99|'+certificado+'|'+montoReal+'|MXN|'+montoReal+'|N|PUE|'+lugarExpedicion+'|'+rfc+'|'+razonsocial+'|603|'+rfcPersona+'|'+nombre+'|P01|84111505|1|ACT|Pago de nómina|'+montoReal+'|'+montoReal+'|1.2|E|'+dateDiez+'|'+dateDiez+'|'+dateDiez+'|1|'+montoReal+'|'+regpatronal+'|'+curpPersona+'|'+nssPersona+'|'+nuevo+'|'+antiguedad+'|'+tipoContrato+'|01|02|'+numPersona+'|'+departamentoPersona+'|Ninguno|1|99|';
if(cuentaBancariaPersona.length!=18)
{
 cadOriginal = cadOriginal + bancoPersona + '|'; 
}
  cadOriginal = cadOriginal + cuentaBancariaPersona + '|'+sdiPersona+'|'+estadoPersona+'|'+monto+'|0.00|'+monto+'|038|001|MANUTENCION|0.00|'+monto+'||';

//ejemplo real
  //||3.3|N|5|2019-01-31T15:55:07|99|00001000000406720491|20530.31|6482.11|MXN|14048.20|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|603|CURM860912AF6|Michelle Cruz Rojas|P01|84111505|1|ACT|Pago de nómina|20530.31|20530.31|6482.11|1.2|O|2019-01-25|2019-01-01|2019-01-31|31|20530.31|6482.11|0.00|D4918553105|CURM860912MNLRJC07|43138608922|2018-09-01|P20W|01|01|02|038|ASOCIADOS RELIGIOSOS|Ninguno|1|05|044|56582176717|705.87|NLE|20530.31|8279.11|12251.20|038|015|MANUTENCION|8279.11|12251.20|5827.24|654.87|004|005|OTROS|5250|001|001|IMSS|331.07|003|003|RCV|246.17|002|010|ISR|654.87||
 console.log(cadOriginal);
 //estoy generando
 //||3.3|N|425|2019-02-13T10:44:07|99|00001000000406720491|1.23|MXN|1.23|N|PUE|67500|IAS160707U62|IGLESIA ADVENTISTA DEL SEPTIMO DIA UNION DEL NORTE A.R.|603|CURM860912AF6|Michelle Cruz Rojas|P01|84111505|1|ACT|Pago de nómina|1.23|1.23|0.00|1.2|E|2019-02-13|2019-02-13|2019-02-13|0.01|1.23|0.00|D4918553105|CURM860912MNLRJC07|43138608922|2018-09-01|P57W|01|01|02|038|ASOCIADOS RELIGIOSOS|Ninguno|1|05|044|56582176717|693.35|NLE|1.23|0.00|1.23|038|001|MANUTENCION|0.00|1.23||
  var deducciones = 0;
  var percepciones = 1;
  var otros = 0;
  
  var param = {periodo : periodo, ER : ER, TimeStamp : "TimeStamp", deVerdad : 1, esManual : 0, manual :3, cadOriginal : cadOriginal, TipoContrato : tipoContrato, cuantasPercepciones : percepciones, cuantasDeducciones : deducciones, cuantasOtrosPagos : otros, nombre : nombre}
  $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
  $.ajax({
    url: "/timbraNomina3.3",
    dataType : "json",
    type : "post",
    data : param,
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        $("#loadingCampos").html('');
        window.open(
          "/" + resp.pdf,
          '_blank'
        );
      }
      if(resp.success==-1)
      {
       alert("Hubo un error: "+resp.error+" REVISAR: "+resp.revisar);
      }
    }
  });
});

$(document).on("click", "#estadosDeCuenta", function (){
  $.ajax({
    url: "/estadosDeCuenta",
    dataType : "json",
    type : "post",
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      var cuentasArray = new Array();
      
      var descrArray = new Array();
      var aver2 = Object.keys(resp.cuentas);
      var ANAL_T0 = Object.keys(resp.ANAL_T0);
      var ANAL_T1 = Object.keys(resp.ANAL_T1);
      var ANAL_T2 = Object.keys(resp.ANAL_T2);
      var ANAL_T3 = Object.keys(resp.ANAL_T3);
      var ANAL_T4 = Object.keys(resp.ANAL_T4);
      var ANAL_T5 = Object.keys(resp.ANAL_T5);
      var ANAL_T6 = Object.keys(resp.ANAL_T6);
      var ANAL_T7 = Object.keys(resp.ANAL_T7);
      var ANAL_T8 = Object.keys(resp.ANAL_T8);
      var ANAL_T9 = Object.keys(resp.ANAL_T9);

      
      var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Estado de cuenta</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Estado de cuenta <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                     '<div class="form-group">'+
                      '<label class="control-label col-md-3 col-sm-3 col-xs-12">Cuenta</label><span class="required">*</span>'+
                      '<div class="col-md-9 col-sm-9 col-xs-12">'+
                        '<input type="text" name="country" id="autocomplete-custom-append" class="form-control col-md-10" style="float: left;" />'+
                        '<div id="autocomplete-container" style="position: relative; float: left; width: 400px; margin: 10px;"></div>'+
                      '</div>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="delPeriodo">Del periodo:</label>'+
                          '<select id="delPeriodo" class="form-control" required="" >'+
                            '</select></p>'+
                    '</div>'+
                    '<div class="form-group">'+
                      '<p><label for="alPeriodo">Al periodo:</label>'+
                          '<select id="alPeriodo" class="form-control" required="">'+
                            '</select></p>'+
                    '</div>';
                    cad=cad+'<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarEstadoDeCuenta" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>';
                    if(ANAL_T0.length>0)
                    {
                      var nombre = resp.ANAL_T0[ANAL_T0[0]]["DESCR"];
                      cad=cad+'<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T0_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T0_START" class="form-control selectEmpiezaDimension" dimen="0" required="" >'+
                                        '</select> <label for="ANAL_T0_END">A:</label>'+
                                      '<select id="ANAL_T0_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                    if(ANAL_T1.length>0)
                    {
                      var nombre = resp.ANAL_T1[ANAL_T1[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T1_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T1_START" class="form-control selectEmpiezaDimension" dimen="1" required="" >'+
                                        '</select> <label for="ANAL_T1_END">A:</label>'+
                                      '<select id="ANAL_T1_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T2.length>0)
                    {
                      var nombre = resp.ANAL_T2[ANAL_T2[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T2_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T2_START" class="form-control selectEmpiezaDimension" dimen="2" required="" >'+
                                        '</select> <label for="ANAL_T2_END">A:</label>'+
                                      '<select id="ANAL_T2_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T3.length>0)
                    {
                      var nombre = resp.ANAL_T3[ANAL_T3[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T3_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T3_START" class="form-control selectEmpiezaDimension" dimen="3" required="" >'+
                                        '</select> <label for="ANAL_T3_END">A:</label>'+
                                      '<select id="ANAL_T3_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T4.length>0)
                    {
                      var nombre = resp.ANAL_T4[ANAL_T4[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T4_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T4_START" class="form-control selectEmpiezaDimension" dimen="4" required="" >'+
                                        '</select> <label for="ANAL_T4_END">A:</label>'+
                                      '<select id="ANAL_T4_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T5.length>0)
                    {
                      var nombre = resp.ANAL_T5[ANAL_T5[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T5_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T5_START" class="form-control selectEmpiezaDimension" dimen="5" required="" >'+
                                        '</select> <label for="ANAL_T5_END">A:</label>'+
                                      '<select id="ANAL_T5_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T6.length>0)
                    {
                      var nombre = resp.ANAL_T6[ANAL_T6[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T6_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T6_START" class="form-control selectEmpiezaDimension" dimen="6" required="" >'+
                                        '</select> <label for="ANAL_T6_END">A:</label>'+
                                      '<select id="ANAL_T6_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T7.length>0)
                    {
                      var nombre = resp.ANAL_T7[ANAL_T7[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T7_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T7_START" class="form-control selectEmpiezaDimension" dimen="7" required="" >'+
                                        '</select> <label for="ANAL_T7_END">A:</label>'+
                                      '<select id="ANAL_T7_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T8.length>0)
                    {
                      var nombre = resp.ANAL_T8[ANAL_T8[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T8_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T8_START" class="form-control selectEmpiezaDimension" dimen="8" required="" >'+
                                        '</select> <label for="ANAL_T8_END">A:</label>'+
                                      '<select id="ANAL_T8_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }
                     if(ANAL_T9.length>0)
                    {
                      var nombre = resp.ANAL_T9[ANAL_T9[0]]["DESCR"];
                      cad=cad+ '<br><div class="form-group">'+
                                  '<p><label style="width: 100%; border-top: 2px solid #E6E9ED;" for="ANAL_T9_START">'+nombre+'</label>'+
                                      '<select id="ANAL_T9_START" class="form-control selectEmpiezaDimension" dimen="9" required="" >'+
                                        '</select> <label for="ANAL_T9_END">A:</label>'+
                                      '<select id="ANAL_T9_END" class="form-control" required="">'+
                                        '</select></p>'+
                                '</div>';
                    }

                    cad=cad+'<div class="form-group">'+
                      '<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">'+
                        '<button type="submit" id="generarEstadoDeCuenta" class="btn btn-success">Generar</button>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>';
      for(i=0;i<aver2.length;i++)
      {
        var aver3 = Object.keys(resp.cuentas[aver2[i]]);
        var param = {value : aver2[i].toString(), data : resp.cuentas[aver2[i]]["DESCR"] }
        cuentasArray.push( aver2[i].toString().trim() + "|"+ resp.cuentas[aver2[i]]["DESCR"]);
        //cuentasArray.push(param);
        //descrArray.push(resp.cuentas[aver2[i]]["DESCR"]);
      }          
      $("#mainContent").html(cad);
      aver2 = Object.keys(resp.periodos);
      cad = '';
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+aver2[i].toString().trim()+'</option>';
      } 
      $("#delPeriodo").html(cad);
      $("#alPeriodo").html(cad);

      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T0);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T0[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T0_START").html(cad);
      $("#ANAL_T0_END").html(cad);


      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T1);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T1[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T1_START").html(cad);
      $("#ANAL_T1_END").html(cad);

      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T2);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T2[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T2_START").html(cad);
      $("#ANAL_T2_END").html(cad);


      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T3);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T3[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T3_START").html(cad);
      $("#ANAL_T3_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T4);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T4[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T4_START").html(cad);
      $("#ANAL_T4_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T5);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T5[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T5_START").html(cad);
      $("#ANAL_T5_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T6);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T6[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T6_START").html(cad);
      $("#ANAL_T6_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T7);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T7[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T7_START").html(cad);
      $("#ANAL_T7_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T8);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T8[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T8_START").html(cad);
      $("#ANAL_T8_END").html(cad);
      
      cad = '<option value="">Selecciona una opci&oacute;n</option>';
      aver2 = Object.keys(resp.ANAL_T9);
      for(i=0;i<aver2.length;i++)
      {
        cad=cad+'<option value="'+aver2[i].toString().trim()+'">'+resp.ANAL_T9[aver2[i]]["NAME"].toString().trim()+'</option>';
      } 
      $("#ANAL_T9_START").html(cad);
      $("#ANAL_T9_END").html(cad);
      
      
      

      $("#alPeriodo option:last").attr("selected","selected");
      $('#autocomplete-custom-append').autocomplete({
        lookup: cuentasArray,
        appendTo: '#autocomplete-container'
      });        
    }});  
  });

function factura(rfc,importe,referencia,fecha,saldo,referencia,leyenda1,correo)
{
   var api ="http://umn.redirectme.net:755/factura";
      var param = {
      Empresa : 'IASD_UMN',
      servicio : '2',
      cliente : rfc,
      concepto : '4',
      precio : importe,
      contra : 'SUFTRDkyNjAzOVNBSQ==',
      correoReceptor : correo,
      _xsrf : '61oETzKXQAGaYdkL5gEmGeJJFuYh7EQnp2XdTP1o'
    };
    $.ajax({
      url: api,
      data : param,
      dataType : "json",
      type : "GET",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
 var todasLasLineas = {};
          //debito a bancos
          //credito a ingreso x diezmos!
          var anio = fecha.substring(0,4);
          var mes = fecha.substring(5,2);
          var PERIOD = anio+"0"+mes;
          PERIOD = PERIOD.substring(0,7);
          fecha.replace("/","-");
            todasLasLineas[0] = {};
            todasLasLineas[0]["PERIOD"] = PERIOD;
            todasLasLineas[0]["treference"] = "ING "+fecha;
            todasLasLineas[0]["fecha"] = fecha;
            todasLasLineas[0]["cuenta"] = "102110"
            todasLasLineas[0]["fondo"] = "10"
            todasLasLineas[0]["funcion"] = "";
            todasLasLineas[0]["reestriccion"] = "";
            todasLasLineas[0]["orgid"] = "";
            todasLasLineas[0]["who"] = "";
            todasLasLineas[0]["detalle"] = "";
            todasLasLineas[0]["proyecto"] = "";
            todasLasLineas[0]["descripcion"] = "Ingreso automatico";
            todasLasLineas[0]["cantidad"] = -1*parseFloat(importe);


            todasLasLineas[1] = {};
            todasLasLineas[1]["PERIOD"] = PERIOD;
            todasLasLineas[1]["treference"] = "ING "+fecha;
            todasLasLineas[1]["fecha"] = fecha;
            todasLasLineas[1]["cuenta"] = "611110"
            todasLasLineas[1]["fondo"] = "10"
            todasLasLineas[1]["funcion"] = "";
            todasLasLineas[1]["reestriccion"] = "";
            todasLasLineas[1]["orgid"] = "";
            todasLasLineas[1]["who"] = "";
            todasLasLineas[1]["detalle"] = "";
            todasLasLineas[1]["proyecto"] = "";
            todasLasLineas[1]["descripcion"] = "Ingreso automatico";
            todasLasLineas[1]["cantidad"] = parseFloat(importe);
          
          var lineasJSON = JSON.stringify(todasLasLineas);
          var param = { 
            lineas : lineasJSON
          }
          $.ajax({
            url: "/registraDiario",
           dataType : "json",
            data: param,
            type : "post",
            crossDomain: true,
            //jsonpCallback : "requestLineaDelPresupuesto",
            async : true,
            beforeSend : function (){
            },
            error : function (jqXHR, textStatus, errorThrown) {
                alert('Error cos: ' + textStatus + " " + errorThrown);
            },
            complete : function (algo){
              
            }, 
            success : function (resp){
                if(resp.success==1)
                {
                  window.open(
                    "/generarDiario?libro=A&diario=" + resp.diario,
                    '_blank'
                  );
                }
              }
          });
      }, 
      success : function (resp){
        if(resp.success==1)
        {

        }
      }
    });
setTimeout(function(){
    
        },3000);
}
    function veAVerBancos()
    {
      var api ="http://juntas.adventistasumn.org/ban.php";
      var param = {
        servicio : 'app',
        accion : 'damePendientesPorFacturar',
        rfc : "IAS9306298H0"
      };
    /*$.ajax({
      url: api,
      data : param,
        crossDomain:true,
      dataType : "jsonp",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){

        if(resp.success==1)
        {*/
          var i;
          var pendientes = new Array();
         // pendientes.push({fecha:'2016/06/01', saldo:6080954.9, importe: 3.21, referencia:1, leyenda1:'DEPOSITO SALVO BUEN COBRO', leyenda2:'',leyenda3:''});
          pendientes.push({fecha:'2016/06/03', saldo:6081924.9, importe: 1.23, referencia:253000154, leyenda1:'AGMK11 ENVIO REMESAS JUNIO', leyenda2:'',leyenda3:''});
          
          for(i=0;i<pendientes.length;i++)
          {
            var fecha = pendientes[i].fecha;
            var saldo = pendientes[i].saldo;
            var importe = pendientes[i].importe;
            var referencia = pendientes[i].referencia;
            var leyenda1 = pendientes[i].leyenda1;
            var leyenda2 = pendientes[i].leyenda2;
            var leyenda3 = pendientes[i].leyenda3;
            //busca AGM111
            var todos1 = leyenda1.split(" ");
            var j;
            for(j=0;j<todos1.length;j++)
            {
              var palabra = todos1[j];
              var rfc="138CLIEN01";
              var correo = "agm111@unav.edu.mx";
              if(palabra.length==6)
              {
                if(palabra.substring(0,2)=="AG")
                {
                  rfc=palabra;
                  correo=rfc.toLowerCase()+"@unav.edu.mx";
                }
              }
            }
            factura(rfc,importe,referencia,fecha,saldo,referencia,leyenda1,correo);
          }
     /*   }
      }
    });*/

    }
  //  veAVerBancos();
  function requestCampo(resp2)
  {
     if(resp2.success==1)
                {
                  var t1 = Date.now()+parseInt(resp2.idCampo);
                  var t2 = t1+1; 
                  var cadGlobal='';

                   cadGlobal=cadGlobal+' <div class="row">\
          <div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>'+resp2.nombre+'</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <form class="form-horizontal form-label-left">\
                      <div class="form-group">\
                        <label class="control-label col-md-12 col-sm-12 col-xs-12" style="text-align: center;font-size: 40px;">'+resp2.nombre+'</label>\
                      </div>\
                    </form>\
                    </div>\
                  </div>\
                </div>\
              </div>\
          </div>\
          <div class="clearfix"></div>\
          <div class="row">\
          <div class="col-md-4 col-sm-4 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Capital operativo</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <div id="echart_guage'+resp2.idCampo+'" style="height: 370px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;" ><div style="position: relative; overflow: hidden; width: 269px; height: 370px; cursor: default;"><canvas width="538" height="740" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 269px; height: 370px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 28.3438px; top: 208px; background-color: rgba(0, 0, 0, 0.498039);">Performance <br>Performance : 50%</div></div>\
                  </div>\
                </div>\
              </div>\
              <div class="col-md-8 col-sm-8 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Calculado al periodo: <small>'+resp2.periodoAnterior+' </small></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Concepto</th>\
                          <th>Monto</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaCapitalOperativo'+resp2.idCampo+'">';
                        cadGlobal = cadGlobal+ '<tr><td><a href="javascript:void(0)" busqueda="\'1\'" tipo="1" class="veDetalle">Activos corrientes</a></td><td>'+format2(resp2.corrientesActivos,"$")+'</td></tr>';
                        cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="2" class="veDetalle">Pasivos corrientes</td><td>'+format2(resp2.corrientesPasivos,"$")+'</a></td></tr>';
                        var capitalTrabajoActual = resp2.corrientesActivos - resp2.corrientesPasivos;
                        cadGlobal=cadGlobal + '<tr><td>Capital de trabajo actual</td><td>'+format2(capitalTrabajoActual,"$")+'</td></tr>';
                        cadGlobal=cadGlobal + '<tr><td colspan="2">Capital de trabajo recomendado por el reglamento</td></tr>';
                        var gastosOperativos = resp2.gastosOperativos;
                        cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'8\',\'9\'" tipo="3" class="veDetalle">'+(resp2.pcent*100) +'% de los gastos operativos</td><td>'+format2(gastosOperativos,"$")+'</a></td></tr>';            
                        cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'2\'" tipo="4" class="veDetalle">Saldo fondos asignados</td><td>'+format2(resp2.activosNetosAsignados,"$")+'</a></td></tr>';
                        var capitalDeTrabajoRecomendado = gastosOperativos+resp2.activosNetosAsignados;
                        cadGlobal=cadGlobal + '<tr><td>Capital de trabajo recomendado</td><td>'+format2(capitalDeTrabajoRecomendado,"$")+'</td></tr>';
                        var excedenteODeficit = capitalTrabajoActual - capitalDeTrabajoRecomendado;
                        cadGlobal=cadGlobal + '<tr><td>Excedente (D&eacute;ficit) de real sobre recomendado</td><td>'+format2(excedenteODeficit,"$")+'</td></tr>';
                        var porcentaje = (capitalTrabajoActual/capitalDeTrabajoRecomendado)*100;
                        porcentaje = Math.round(porcentaje * 100) / 100;
                         cadGlobal=cadGlobal + '<tr><td>Porcentaje</td><td>'+porcentaje+' %</td></tr>';
                      cadGlobal=cadGlobal+'</tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>\
              </div>\
              <div class="clearfix"></div>\
               <div class="row">\
              <div class="col-md-4 col-sm-4 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Liquidez</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <div id="liquidez_chart'+resp2.idCampo+'" style="height: 370px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;"><div style="position: relative; overflow: hidden; width: 269px; height: 370px; cursor: default;"><canvas width="538" height="740" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 269px; height: 370px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 28.3438px; top: 208px; background-color: rgba(0, 0, 0, 0.498039);">Performance <br>Performance : 50%</div></div>\
                  </div>\
                </div>\
              </div>\
              <div class="col-md-8 col-sm-8 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Calculado al periodo: <small>'+resp2.periodoAnterior+' </small></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Concepto</th>\
                          <th>Monto</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaLiquidez'+resp2.idCampo+'">';
                        cadGlobal = cadGlobal+ '<tr><td><a href="javascript:void(0)" busqueda="\'1\'" tipo="5" class="veDetalle">Efectivo</a></td><td>'+format2(resp2.efectivo,"$")+'</td></tr>';
                       cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="6" class="veDetalle">Inversiones</td><td>'+format2(resp2.inversiones,"$")+'</a></td></tr>';
                       cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="7" class="veDetalle">Cuentas x cobrar a org. superiores</td><td>'+format2(resp2.cuentaCobrarOrgSuperior,"$")+'</a></td></tr>';
                       var totalDeActivosLiquidos = parseFloat(resp2.efectivo) + parseFloat(resp2.inversiones) + parseFloat(resp2.cuentaCobrarOrgSuperior);
                        cadGlobal=cadGlobal + '<tr><td>Total de activos liquidos</td><td>'+format2(totalDeActivosLiquidos,"$")+'</td></tr>';
                        cadGlobal=cadGlobal + '<tr><td colspan="2">Menos compromisos</td></tr>';
                        cadGlobal=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="2" class="veDetalle">Pasivos corrientes</td><td>'+format2(resp2.corrientesPasivos,"$")+'</a></td></tr>';
                        cacadGlobald=cadGlobal + '<tr><td><a href="javascript:void(0)" busqueda="\'2\'" tipo="4" class="veDetalle">Saldo fondos asignados</td><td>'+format2(resp2.activosNetosAsignados,"$")+'</a></td></tr>';
                        var totalDeCompromisos = resp2.activosNetosAsignados + resp2.corrientesPasivos;
                        cadGlobal=cadGlobal + '<tr><td>Total de compromisos</td><td>'+format2(totalDeCompromisos,"$")+'</td></tr>';
                        var activosLiquidosNetos = totalDeActivosLiquidos - totalDeCompromisos;
                        var porcentajeLiquidez = (totalDeActivosLiquidos/totalDeCompromisos)*100;
                        porcentajeLiquidez = Math.round(porcentajeLiquidez * 100) / 100;
                      cadGlobal=cadGlobal + '<tr><td>Porcentaje</td><td>'+porcentajeLiquidez+' %</td></tr>';
                      cadGlobal=cadGlobal+'</tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>';
           //   console.log(resp.idCampo+" "+porcentaje+" "+porcentajeLiquidez);
              
                $("#contenidoOtrosCampos").append(cadGlobal);  
              
              
             
      var echartGauge = echarts.init(document.getElementById("echart_guage"+resp2.idCampo), theme);
      echartGauge.setOption({
        tooltip: {
          formatter: "{a} <br/>{b} : {c}%"
        },
        toolbox: {
          show: true,
          feature: {
            restore: {
              show: true,
              title: "Restore"
            },
            saveAsImage: {
              show: true,
              title: "Save Image"
            }
          }
        },
        series: [{
          name: "Capital Operativo",
          type: "gauge",
          center: ["50%", "50%"],
          startAngle: 140,
          endAngle: -140,
          min: 0,
          max: 100,
          precision: 0,
          splitNumber: 10,
          axisLine: {
            show: true,
            lineStyle: {
              color: [
                [0.4, "#ff4500"],
                [0.8, "orange"],
                [0.9, "skyblue"],
                [1, "lightgreen"]
              ],
              width: 30
            }
          },
          axisTick: {
            show: true,
            splitNumber: 5,
            length: 8,
            lineStyle: {
              color: "#eee",
              width: 1,
              type: "solid"
            }
          },
          axisLabel: {
            show: true,
            formatter: function(v) {
              switch (v + "") {
                case "40":
                  return "40";
                case "80":
                  return "80";
                case "90":
                  return "90";
                case "100":
                  return "100";
                default:
                  return "";
              }
            },
            textStyle: {
              color: "#333"
            }
          },
          splitLine: {
            show: true,
            length: 30,
            lineStyle: {
              color: "#eee",
              width: 2,
              type: "solid"
            }
          },
          pointer: {
            length: "80%",
            width: 8,
            color: "auto"
          },
          title: {
            show: true,
            offsetCenter: ["-65%", -10],
            textStyle: {
              color: "#333",
              fontSize: 15
            }
          },
          detail: {
            show: true,
            backgroundColor: "rgba(0,0,0,0)",
            borderWidth: 0,
            borderColor: "#ccc",
            width: 100,
            height: 40,
            offsetCenter: ["-60%", 10],
            formatter: "{value}%",
            textStyle: {
              color: "auto",
              fontSize: 30
            }
          },
          data: [{
            value: porcentaje,
            name: "Capital operativo"
          }]
        }]
      });
      var liquidezChart = echarts.init(document.getElementById("liquidez_chart"+resp2.idCampo), theme);
      liquidezChart.setOption({
        tooltip: {
          formatter: "{a} <br/>{b} : {c}%"
        },
        toolbox: {
          show: true,
          feature: {
            restore: {
              show: true,
              title: "Restore"
            },
            saveAsImage: {
              show: true,
              title: "Guardar"
            }
          }
        },
        series: [{
          name: "Liquidez",
          type: "gauge",
          center: ["50%", "50%"],
          startAngle: 140,
          endAngle: -140,
          min: 0,
          max: 100,
          precision: 0,
          splitNumber: 10,
          axisLine: {
            show: true,
            lineStyle: {
              color: [
              
                [0.4, "#ff4500"],
                [0.8, "orange"],
                [0.9, "skyblue"],
                [1, "lightgreen"]
              ],
              width: 30
            }
          },
          axisTick: {
            show: true,
            splitNumber: 5,
            length: 8,
            lineStyle: {
              color: "#eee",
              width: 1,
              type: "solid"
            }
          },
          axisLabel: {
            show: true,
            formatter: function(v) {
              switch (v + "") {
                case "40":
                  return "40";
                case "80":
                  return "80";
                case "90":
                  return "90";
                case "100":
                  return "100";
                default:
                  return "";
              }
            },
            textStyle: {
              color: "#333"
            }
          },
          splitLine: {
            show: true,
            length: 30,
            lineStyle: {
              color: "#eee",
              width: 2,
              type: "solid"
            }
          },
          pointer: {
            length: "80%",
            width: 8,
            color: "auto"
          },
          title: {
            show: true,
            offsetCenter: ["-65%", -10],
            textStyle: {
              color: "#333",
              fontSize: 15
            }
          },
          detail: {
            show: true,
            backgroundColor: "rgba(0,0,0,0)",
            borderWidth: 0,
            borderColor: "#ccc",
            width: 100,
            height: 40,
            offsetCenter: ["-60%", 10],
            formatter: "{value}%",
            textStyle: {
              color: "auto",
              fontSize: 30
            }
          },
          data: [{
            value: porcentajeLiquidez,
            name: "Liquidez"
          }]
        }]
      });
      indexGlobal++;
      if(indexGlobal<listaParam.length)
      {
        mandaAjaxChecarCampos();
      }
      else
      {
        $("#loadingCampos").html('');
      }
     }//if ajax
  }
  var  URL_GLOBAL, NOMBRE_GLOBAL, idCampo_GLOBAL,primeraVezGlobal;
    var listaParam, indexGlobal;
         
  function mandaAjaxChecarCampos()
  {
      $.ajax({
        url: listaParam[indexGlobal].url+"dashboard",
        dataType : "jsonp",
        type : "GET",
        cache: false,
        crossDomain: true,
        jsonpCallback : "requestCampo",
        data : listaParam[indexGlobal],
        async : false,
       error: function (request, status, error) {
        //error: function () {
            //console.log(request.responseText+"   "+status);
            var cadGlobal='';
            var nombre = listaParam[indexGlobal].nombre;

                   cadGlobal=cadGlobal+' <div class="row">\
          <div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>'+nombre+' </h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <form class="form-horizontal form-label-left">\
                      <div class="form-group">\
                        <label class="control-label col-md-12 col-sm-12 col-xs-12" style="text-align: center;font-size: 40px;">'+nombre+' est&aacute; offline</label>\
                      </div>\
                    </form>\
                    </div>\
                  </div>\
                </div>\
              </div>\
          </div>\
          <div class="clearfix"></div>\
          </div>';   
          $("#contenidoOtrosCampos").append(cadGlobal);  
          indexGlobal++;
          if(indexGlobal<listaParam.length)
          {
            mandaAjaxChecarCampos();
          }
          else
          {
            $("#loadingCampos").html('');
          }
        },
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
        }
      });//ajax dashboard

  }
  function checaOtrosCampos(PERIOD)
  {
     $.ajax({
      url: "/checaOtrosCampos",
      dataType : "json",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp1){
        if(resp1.success==1)
        {
          primeraVezGlobal=1;
          $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="30%"  /><center>');
          var campos = Object.keys(resp1.otrosCampos);
          var i = 0;
          listaParam = new Array();
          indexGlobal=0;
          for(i=0;i<campos.length;i++)
          {
            URL_GLOBAL  = resp1.otrosCampos[campos[i]]["URL"];
            NOMBRE_GLOBAL  = resp1.otrosCampos[campos[i]]["Nombre"];
            idCampo_GLOBAL = resp1.otrosCampos[campos[i]]["IdCampo"];
            //hacer una lista con param, y recursivamente cargar esa lista
            listaParam.push({PERIOD : PERIOD, hash : resp1.hash, BUNIT : resp1.BUNIT, nombre: NOMBRE_GLOBAL, idCampo : idCampo_GLOBAL, url :resp1.otrosCampos[campos[i]]["URL"] });
          }
          mandaAjaxChecarCampos();
        }
      }
    });

  }
  function calculaDashboard1()
  {
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1; //January is 0!
    var yyyy = today.getFullYear();
    if(dd<10) {
        dd='0'+dd
    } 

    if(mm<10) {
        mm='0'+mm
    } 

    today = mm+'/'+dd+'/'+yyyy;
    var PERIOD = yyyy+"0"+mm;
    capitalOperativoAlPeriodo(PERIOD);
  }

  function timeConverter(UNIX_timestamp){
  var a = new Date((UNIX_timestamp-0) * 1000);//ya tiene su timezone!
  var year = a.getFullYear();
  var month = parseInt(a.getMonth())+1;
  var mes=""+month;
  if(month<10)
  {
    mes="0"+month;
  }
  var date = parseInt(a.getDate());
  var hour = a.getHours();
  var minute = parseInt(a.getMinutes());
  if(minute<10)
  {
    minutos="0"+minute
  }

  var dia = ""+date;
  if(date<10)
  {
    dia="0"+date
  }
  var time = year + '-' + mes + '-' + dia + '   '+hour+':'+minutos;
  return time;
}
  function calculaDashboardFiscalista() {
     $.ajax({
      url: "/dashboardFiscalista",
      dataType : "json",
      type : "post",
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Fiscalista</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Fiscalista<small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                  '<br />'+
                  '<div class="form-group">'+
                      '<h3>Esta cuenta caduca el '+timeConverter(resp.caducidad)+'</h3>'+
                  '</div>'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
        '</div>';
          $("#mainContent").html(cad);
        }
      }
    });
  }

  function capitalOperativoAlPeriodo(PERIOD){
     $.ajax({
      url: "/dashboard",
      dataType : "json",
      type : "post",
      async : true,
      data : {PERIOD : PERIOD},
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
         var cad = '<div class="">\
          <div class="page-title">\
            <div class="title_left">\
              <h3>Dashboard</h3>\
            </div>\
          </div>\
          <iv class="clearfix"></div>\
          <div class="row">\
          <div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Selecciona un periodo</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <form class="form-horizontal form-label-left">\
                      <div class="form-group">\
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Periodo:</label>\
                        <div class="col-md-9 col-sm-9 col-xs-12">\
                          <select class="form-control" id="periodosSelect">';
                          var periodos = Object.keys(resp.periodos);
                          var j;
                          for(j=0;j<periodos.length;j++)
                          {
                            cad=cad+'<option value="'+periodos[j]+'">'+periodos[j]+'</option>';
                          }
                            cad=cad+'</select>\
                        </div>\
                      </div>\
                    </form>\
                    </div>\
                  </div>\
                </div>\
              </div>\
          </div>\
          <div class="clearfix"></div>\
          <div class="row">\
          <div class="col-md-4 col-sm-4 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Capital operativo</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <div id="echart_guage" style="height: 370px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;" _echarts_instance_="ec_1469722676878"><div style="position: relative; overflow: hidden; width: 269px; height: 370px; cursor: default;"><canvas width="538" height="740" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 269px; height: 370px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 28.3438px; top: 208px; background-color: rgba(0, 0, 0, 0.498039);">Performance <br>Performance : 50%</div></div>\
                  </div>\
                </div>\
              </div>\
              <div class="col-md-8 col-sm-8 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Calculado al periodo: <small>'+resp.periodoAnterior+' </small></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Concepto</th>\
                          <th>Monto</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaCapitalOperativo">\
                      </tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>\
              </div>\
              <div class="clearfix"></div>\
               <div class="row">\
              <div class="col-md-4 col-sm-4 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Liquidez</h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <div id="liquidez_chart" style="height: 370px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; position: relative; background-color: transparent;" _echarts_instance_="ec_1469722676879"><div style="position: relative; overflow: hidden; width: 269px; height: 370px; cursor: default;"><canvas width="538" height="740" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 269px; height: 370px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div><div style="position: absolute; display: none; border: 0px solid rgb(51, 51, 51); white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); border-radius: 4px; color: rgb(255, 255, 255); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; font-family: Arial, Verdana, sans-serif; line-height: 21px; padding: 5px; left: 28.3438px; top: 208px; background-color: rgba(0, 0, 0, 0.498039);">Performance <br>Performance : 50%</div></div>\
                  </div>\
                </div>\
              </div>\
              <div class="col-md-8 col-sm-8 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>Calculado al periodo: <small>'+resp.periodoAnterior+' </small></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Concepto</th>\
                          <th>Monto</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaLiquidez">\
                      </tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>\
              <div id="contenidoOtrosCampos"></div>\
              <div id="loadingCampos"></div>\
              </div>';
            $("#mainContent").html(cad);
           // checaOtrosCampos(PERIOD);
            $('#periodosSelect option[value="'+PERIOD+'"]').attr("selected","selected");



            $("#periodosSelect").change( function (){
               $("#mainContent").html('<center><img id="loading" src="static/images/loading2.gif" width="30%"  /><center>');
              var PERIOD = $(this).val();
              capitalOperativoAlPeriodo(PERIOD);
              
            });

            var cad = '<tr><td><a href="javascript:void(0)" busqueda="\'1\'" tipo="1" PERIOD="'+PERIOD+'" class="veDetalle">Activos corrientes</a></td><td>'+format2(resp.corrientesActivos,"$")+'</td></tr>';
            cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="2" PERIOD="'+PERIOD+'" class="veDetalle">Pasivos corrientes</td><td>'+format2(resp.corrientesPasivos,"$")+'</a></td></tr>';
            var capitalTrabajoActual = resp.corrientesActivos - resp.corrientesPasivos;
            cad=cad + '<tr><td>Capital de trabajo actual</td><td>'+format2(capitalTrabajoActual,"$")+'</td></tr>';
            cad=cad + '<tr><td colspan="2">Capital de trabajo recomendado por el reglamento</td></tr>';
            var gastosOperativos = resp.gastosOperativos;
            cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'8\',\'9\'" tipo="3" PERIOD="'+PERIOD+'" class="veDetalle">'+(resp.pcent*100) +'% de los gastos operativos</td><td>'+format2(gastosOperativos,"$")+'</a></td></tr>';            
            cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'2\'" tipo="4" PERIOD="'+PERIOD+'" class="veDetalle">Saldo fondos asignados</td><td>'+format2(resp.activosNetosAsignados,"$")+'</a></td></tr>';
            var capitalDeTrabajoRecomendado = gastosOperativos+resp.activosNetosAsignados;
            cad=cad + '<tr><td>Capital de trabajo recomendado</td><td>'+format2(capitalDeTrabajoRecomendado,"$")+'</td></tr>';
            var excedenteODeficit = capitalTrabajoActual - capitalDeTrabajoRecomendado;
            cad=cad + '<tr><td>Excedente (D&eacute;ficit) de real sobre recomendado</td><td>'+format2(excedenteODeficit,"$")+'</td></tr>';
            var porcentaje = (capitalTrabajoActual/capitalDeTrabajoRecomendado)*100;
            porcentaje = Math.round(porcentaje * 100) / 100;
           // porcentaje=Math.round(porcentaje*100);
            cad=cad + '<tr><td>Porcentaje</td><td>'+porcentaje+' %</td></tr>';
            $("#tablaCapitalOperativo").html(cad);


            cad = '<tr><td><a href="javascript:void(0)" busqueda="\'1\'" tipo="5" PERIOD="'+PERIOD+'" class="veDetalle">Efectivo</a></td><td>'+format2(resp.efectivo,"$")+'</td></tr>';
             cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="6" PERIOD="'+PERIOD+'" class="veDetalle">Inversiones</td><td>'+format2(resp.inversiones,"$")+'</a></td></tr>';
             cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="7" PERIOD="'+PERIOD+'" class="veDetalle">Cuentas x cobrar a org. superiores</td><td>'+format2(resp.cuentaCobrarOrgSuperior,"$")+'</a></td></tr>';
             var totalDeActivosLiquidos = parseFloat(resp.efectivo) + parseFloat(resp.inversiones) + parseFloat(resp.cuentaCobrarOrgSuperior);
              cad=cad + '<tr><td>Total de activos liquidos</td><td>'+format2(totalDeActivosLiquidos,"$")+'</td></tr>';
              cad=cad + '<tr><td colspan="2">Menos compromisos</td></tr>';
              cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'3\'" tipo="2" PERIOD="'+PERIOD+'" class="veDetalle">Pasivos corrientes</td><td>'+format2(resp.corrientesPasivos,"$")+'</a></td></tr>';
              cad=cad + '<tr><td><a href="javascript:void(0)" busqueda="\'2\'" tipo="4" PERIOD="'+PERIOD+'" class="veDetalle">Saldo fondos asignados</td><td>'+format2(resp.activosNetosAsignados,"$")+'</a></td></tr>';
              var totalDeCompromisos = resp.activosNetosAsignados + resp.corrientesPasivos;
              cad=cad + '<tr><td>Total de compromisos</td><td>'+format2(totalDeCompromisos,"$")+'</td></tr>';
              var activosLiquidosNetos = totalDeActivosLiquidos - totalDeCompromisos;
              var porcentajeLiquidez = (totalDeActivosLiquidos/totalDeCompromisos)*100;
              porcentajeLiquidez = Math.round(porcentajeLiquidez * 100) / 100;
            cad=cad + '<tr><td>Porcentaje</td><td>'+porcentajeLiquidez+' %</td></tr>';
           
            $("#tablaLiquidez").html(cad);

     
      var echartGauge = echarts.init(document.getElementById("echart_guage"), theme);
      echartGauge.setOption({
        tooltip: {
          formatter: "{a} <br/>{b} : {c}%"
        },
        toolbox: {
          show: true,
          feature: {
            restore: {
              show: true,
              title: "Restore"
            },
            saveAsImage: {
              show: true,
              title: "Save Image"
            }
          }
        },
        series: [{
          name: "Capital Operativo",
          type: "gauge",
          center: ["50%", "50%"],
          startAngle: 140,
          endAngle: -140,
          min: 0,
          max: 100,
          precision: 0,
          splitNumber: 10,
          axisLine: {
            show: true,
            lineStyle: {
              color: [
                [0.4, "#ff4500"],
                [0.8, "orange"],
                [0.9, "skyblue"],
                [1, "lightgreen"]
              ],
              width: 30
            }
          },
          axisTick: {
            show: true,
            splitNumber: 5,
            length: 8,
            lineStyle: {
              color: "#eee",
              width: 1,
              type: "solid"
            }
          },
          axisLabel: {
            show: true,
            formatter: function(v) {
              switch (v + "") {
                case "40":
                  return "40";
                case "80":
                  return "80";
                case "90":
                  return "90";
                case "100":
                  return "100";
                default:
                  return "";
              }
            },
            textStyle: {
              color: "#333"
            }
          },
          splitLine: {
            show: true,
            length: 30,
            lineStyle: {
              color: "#eee",
              width: 2,
              type: "solid"
            }
          },
          pointer: {
            length: "80%",
            width: 8,
            color: "auto"
          },
          title: {
            show: true,
            offsetCenter: ["-65%", -10],
            textStyle: {
              color: "#333",
              fontSize: 15
            }
          },
          detail: {
            show: true,
            backgroundColor: "rgba(0,0,0,0)",
            borderWidth: 0,
            borderColor: "#ccc",
            width: 100,
            height: 40,
            offsetCenter: ["-60%", 10],
            formatter: "{value}%",
            textStyle: {
              color: "auto",
              fontSize: 30
            }
          },
          data: [{
            value: porcentaje,
            name: "Capital operativo"
          }]
        }]
      });
      var liquidezChart = echarts.init(document.getElementById("liquidez_chart"), theme);
      liquidezChart.setOption({
        tooltip: {
          formatter: "{a} <br/>{b} : {c}%"
        },
        toolbox: {
          show: true,
          feature: {
            restore: {
              show: true,
              title: "Restore"
            },
            saveAsImage: {
              show: true,
              title: "Guardar"
            }
          }
        },
        series: [{
          name: "Liquidez",
          type: "gauge",
          center: ["50%", "50%"],
          startAngle: 140,
          endAngle: -140,
          min: 0,
          max: 100,
          precision: 0,
          splitNumber: 10,
          axisLine: {
            show: true,
            lineStyle: {
              color: [
              
                [0.4, "#ff4500"],
                [0.8, "orange"],
                [0.9, "skyblue"],
                [1, "lightgreen"]
              ],
              width: 30
            }
          },
          axisTick: {
            show: true,
            splitNumber: 5,
            length: 8,
            lineStyle: {
              color: "#eee",
              width: 1,
              type: "solid"
            }
          },
          axisLabel: {
            show: true,
            formatter: function(v) {
              switch (v + "") {
                case "40":
                  return "40";
                case "80":
                  return "80";
                case "90":
                  return "90";
                case "100":
                  return "100";
                default:
                  return "";
              }
            },
            textStyle: {
              color: "#333"
            }
          },
          splitLine: {
            show: true,
            length: 30,
            lineStyle: {
              color: "#eee",
              width: 2,
              type: "solid"
            }
          },
          pointer: {
            length: "80%",
            width: 8,
            color: "auto"
          },
          title: {
            show: true,
            offsetCenter: ["-65%", -10],
            textStyle: {
              color: "#333",
              fontSize: 15
            }
          },
          detail: {
            show: true,
            backgroundColor: "rgba(0,0,0,0)",
            borderWidth: 0,
            borderColor: "#ccc",
            width: 100,
            height: 40,
            offsetCenter: ["-60%", 10],
            formatter: "{value}%",
            textStyle: {
              color: "auto",
              fontSize: 30
            }
          },
          data: [{
            value: porcentajeLiquidez,
            name: "Liquidez"
          }]
        }]
      });




     
    
    
        }
      }
    });
  }
  

  
 $(document).on("click", ".vesAlOtroDettale", function (){
     $("body").css("cursor","wait");
      var subdetalle = $(this).attr("subdetalle");
      var PERIOD = $(this).attr("PERIOD");
      var param = {subdetalle : subdetalle, PERIOD : PERIOD}
      $.ajax({
        url: "/veDetalleSegundoNivel",
        dataType : "json",
        type : "post",
        data: param,
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var cad = '<div class="">\
          <div class="page-title">\
            <div class="title_left">\
              <h3></h3>\
            </div>\
          </div>\
          <div class="clearfix"></div>\
          <div class="row">\
              <div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Nombre</th>\
                          <th>Cantidad</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaVeDetalles">\
                      </tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>\
              </div></div>';
            $("#mainContent").html(cad);
            var aver2 = Object.keys(resp.lineas);
            cad = '';
            var empiezo = 1;
            while(empiezo<=aver2.length)
            {
              for(i=0;i<aver2.length;i++)
              {
                if(parseInt(resp.lineas[aver2[i]]["Subdetalle"]) ==empiezo)
                {
                  cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlOtroDettale" subdetalle="'+resp.lineas[aver2[i]]["Subdetalle"]+'">'+resp.lineas[aver2[i]]["Nombre"]+'</a></td><td>'+format2(resp.lineas[aver2[i]]["AMOUNT"],"$")+'</td></tr>';
                  empiezo++;
                }
              }  
            }
         
            $("#tablaVeDetalles").html(cad);
             $("body").css("cursor","default");
          }
        }
      });  
    });
  
  $(document).on("click", ".veDetalle", function (){
     $("body").css("cursor","wait");
      var busqueda = $(this).attr("busqueda");
      var titulo = $(this).html();
      var tipo = $(this).attr("tipo");
      var PERIOD = $(this).attr("PERIOD");
      
     
      var param = {tipo : tipo, PERIOD : PERIOD}
      $.ajax({
        url: "/veDetallePrimerNivel",
        dataType : "json",
        type : "post",
        data: param,
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var cad = '<div class="">\
          <div class="page-title">\
            <div class="title_left">\
              <h3>Calculo de '+titulo+'</h3>\
            </div>\
          </div>\
          <div class="clearfix"></div>\
          <div class="row">\
              <div class="col-md-12 col-sm-12 col-xs-12">\
                <div class="x_panel">\
                  <div class="x_title">\
                    <h2>'+titulo+' calculado al periodo: <small>'+resp.periodoAnterior+'</small></h2>\
                    <ul class="nav navbar-right panel_toolbox">\
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>\
                      </li>\
                      <li class="dropdown">\
                        <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>\
                        <ul class="dropdown-menu" role="menu">\
                          <li><a href="javascript:void(0)">Settings 1</a>\
                          </li>\
                          <li><a href="javascript:void(0)">Settings 2</a>\
                          </li>\
                        </ul>\
                      </li>\
                      <li><a class="close-link"><i class="fa fa-close"></i></a>\
                      </li>\
                    </ul>\
                    <div class="clearfix"></div>\
                  </div>\
                  <div class="x_content">\
                    <table class="table table-striped">\
                      <thead>\
                        <tr>\
                          <th>Nombre</th>\
                          <th>Cantidad</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tablaVeDetalles">\
                      </tbody>\
                    </table>\
                  </div>\
                </div>\
              </div>\
              </div></div>';
            $("#mainContent").html(cad);
            var aver2 = Object.keys(resp.lineas);
            cad = '';
            var empiezo = 1;
            while(empiezo<=aver2.length)
            {
              for(i=0;i<aver2.length;i++)
              {
                if(parseInt(resp.lineas[aver2[i]]["Subdetalle"]) ==empiezo)
                {
                  cad=cad+'<tr><td><a href="javascript:void(0)" PERIOD="'+PERIOD+'" class="vesAlOtroDettale" subdetalle="'+resp.lineas[aver2[i]]["Subdetalle"]+'">'+resp.lineas[aver2[i]]["Nombre"]+'</a></td><td>'+format2(resp.lineas[aver2[i]]["AMOUNT"],"$")+'</td></tr>';
                  empiezo++;
                }
              }  
            }
            
           /* var sumaTotal=0.0;
            var sumaDebitos=0;
            var sumaCreditos=0;
            for(i=0;i<aver2.length;i++)
            {
              if(resp.lineas[aver2[i]]["D_C"]=="D")
              {
                sumaDebitos=sumaDebitos+parseFloat(resp.lineas[aver2[i]]["AMOUNT"]);  
              }
              else
              {
                sumaCreditos=sumaCreditos-parseFloat(resp.lineas[aver2[i]]["AMOUNT"]);
              }
              
              cad=cad+'<tr><td><a href="javascript:void(0)" class="vesAlDiario" diario="'+resp.lineas[aver2[i]]["JRNAL_NO"]+'">'+resp.lineas[aver2[i]]["JRNAL_NO"]+'</a></td><td>'+resp.lineas[aver2[i]]["JRNAL_LINE"]+'</td><td>'+format2(resp.lineas[aver2[i]]["AMOUNT"],"$")+'</td><td>'+resp.lineas[aver2[i]]["D_C"]+'</td><td>'+resp.lineas[aver2[i]]["ACNT_CODE"]+'</td><td>'+resp.lineas[aver2[i]]["DESCRIPTN"]+'</td><td>'+resp.lineas[aver2[i]]["PERIOD"]+'</td><td>'+resp.lineas[aver2[i]]["JRNAL_SRCE"]+'</td><td>'+resp.lineas[aver2[i]]["JRNAL_TYPE"]+'</td><td>'+resp.lineas[aver2[i]]["TRANS_DATETIME"]+'</td></tr>';
            }    
            sumaTotal=sumaDebitos+sumaCreditos;
            sumaTotal=sumaTotal*-1;
            cad=cad+'<tr><td colspan="3">Sumas:</td><td colspan="2">D: '+format2(sumaDebitos,"$")+'</td><td colspan="2">C: '+format2(sumaCreditos,"$")+'</td><td colspan="3">Total: '+format2(sumaTotal,"$")+'</td></tr>';
            */
            $("#tablaVeDetalles").html(cad);
             $("body").css("cursor","default");
          }
        }
      });  
    });
  
  $(document).on("click", "#inicio", function (){
    calculaDashboard1();
    //pendientesDeTimbrar();
  });
  $(document).on("click", "#inicio2", function (){
    calculaDashboardFiscalista();
  });

  function cargaInformePendiente(idInforme)
  {
    var param = {idInforme : idInforme}
    $.ajax({
      url: "/damePrepolizaDeInforme",
      dataType : "json",
      type : "post",
      data : param,
      async : true,
      beforeSend : function (){
      },
      complete : function (){
      }, 
      success : function (resp){
        if(resp.success==1)
        {
          var cad = '';
          var i;
        }
      }
    });
  }

function timeDifference(date1,date2) {
  var difference = date1.getTime() - date2.getTime();
  var daysDifference = Math.floor(difference/1000/60/60/24);
  difference -= daysDifference*1000*60*60*24
  var hoursDifference = Math.floor(difference/1000/60/60);
  difference -= hoursDifference*1000*60*60
  var minutesDifference = Math.floor(difference/1000/60);
  difference -= minutesDifference*1000*60
  var secondsDifference = Math.floor(difference/1000);
  if(daysDifference>0)
  {
    if(daysDifference==1)
    {
      return 'Hace ' + daysDifference + ' dia';  
    }
    return 'Hace ' + daysDifference + ' dias';
  }
  if(hoursDifference>0)
  {
    if(hoursDifference==1)
    {
      return 'Hace ' + hoursDifference + ' hora';  
    }
    return 'Hace ' + hoursDifference + ' horas ';
  }
  if(minutesDifference>0)
  {
    if(minutesDifference==1)
    {
      return 'Hace ' + minutesDifference + ' minuto';  
    }
    return 'Hace '+ minutesDifference + ' minutos ';
  }
  return ' Hace unos segundos ';
}
   function revisaNotificaciones()
   {
      $.ajax({
        url: "/revisaNotificaciones",
        dataType : "json",
        type : "post",
       async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            var cad = '';
            var i;
            var aver2 = Object.keys(resp.notificaciones);
            $("#numeroDeNotificaciones").html(aver2.length);
            for(i=0;i<aver2.length;i++)
            {
              var dateTimestamp = new Date(resp.notificaciones[aver2[i]].Timestamp*1000);
              var haceCuanto = timeDifference(Date.now(), dateTimestamp);
              cad = cad + ' <li>\
                <a href="javascript:void(0)" onclick="'+resp.notificaciones[aver2[i]].Accion+'">\
                  <span class="image"><img src="static/images/img.jpg" alt="Profile Image" /></span>\
                  <p>'+resp.notificaciones[aver2[i]].Titulo+'</p>\
                  <p>'+resp.notificaciones[aver2[i]].Descripcion+'</p>\
                  <p><b>'+haceCuanto+'</b></p>\
                </a>\
              </li>';
            }
            $("#menu1").html(cad);
          }
        }
      });
   }
   function pendientesDeTimbrar()
   {
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Pendientes de timbrar</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div id="loadingCampos"></div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Instrucciones: <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                   '<table class="table table-striped">'+
                      '<thead>'+
                        '<tr>'+
                          '<th>Diario-Linea</th>'+
                          '<th>Periodo</th>'+
                          '<th>Fecha</th>'+
                          '<th>Descripci&oacute;n</th>'+
                          '<th>Cantidad</th>'+
                          '<th>RFC</th>'+
                          '<th>Razon Social</th>'+
                          '<th>Nombre</th>'+
                          '<th>Vista previa</th>'+
                          '<th>Timbrar</th>'+
                        '</tr>'+
                      '</thead>'+
                      '<tbody id="tablaPendientesDeTimbrar">'+
                      '</tbody>'+
                    '</table>'+
                '</div>'+
                '<div class="x_content" id="cambiaContenido">'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/listaPreviaDeTimbrado",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.CandidatosTimbrado);
          var cad = '';
          for(i=0;i<aver2.length;i++)
          {
            cad=cad+'<tr><td><a  class="vesAlDiario" diario="'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_NO"]+'" target="_blank">'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_NO"]+'-'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_LINE"]+'</a></td><td>'+resp.CandidatosTimbrado[aver2[i]]["PERIOD"]+'</td><td>'+resp.CandidatosTimbrado[aver2[i]]["Fecha"]+'</td><td>'+resp.CandidatosTimbrado[aver2[i]]["DESCRIPTN"]+'</td><td>'+format2(resp.CandidatosTimbrado[aver2[i]]["AmountPrima"],'$')+'</td><td>'+resp.CandidatosTimbrado[aver2[i]]["RFC"]+'</td><td>'+resp.CandidatosTimbrado[aver2[i]]["RazonSocial"]+'</td><td>'+resp.CandidatosTimbrado[aver2[i]]["Nombre"]+'</td><td><button type="button" cantidad="'+resp.CandidatosTimbrado[aver2[i]]["AmountPrima"]+'" nombre="'+resp.CandidatosTimbrado[aver2[i]]["Nombre"]+'" diario="'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_NO"]+'" linea="'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_LINE"]+'" RazonSocial="'+resp.CandidatosTimbrado[aver2[i]]["RazonSocial"]+'"  RFC="'+resp.CandidatosTimbrado[aver2[i]]["RFC"]+'" correo="'+resp.CandidatosTimbrado[aver2[i]]["Correo"]+'" NumCtaPago="'+resp.CandidatosTimbrado[aver2[i]]["NumCtaPago"]+'" MetodoDePago="'+resp.CandidatosTimbrado[aver2[i]]["MetodoDePago"]+'"  class="btn btn-round btn-warning vistaPreviaFactura">Vista previa</button></td><td><button type="button" cantidad="'+resp.CandidatosTimbrado[aver2[i]]["AmountPrima"]+'" nombre="'+resp.CandidatosTimbrado[aver2[i]]["Nombre"]+'" diario="'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_NO"]+'" linea="'+resp.CandidatosTimbrado[aver2[i]]["JRNAL_LINE"]+'" RazonSocial="'+resp.CandidatosTimbrado[aver2[i]]["RazonSocial"]+'"  RFC="'+resp.CandidatosTimbrado[aver2[i]]["RFC"]+'" correo="'+resp.CandidatosTimbrado[aver2[i]]["Correo"]+'" NumCtaPago="'+resp.CandidatosTimbrado[aver2[i]]["NumCtaPago"]+'" MetodoDePago="'+resp.CandidatosTimbrado[aver2[i]]["MetodoDePago"]+'"  class="btn btn-round btn-warning timbrarFacturaDeIngreso">Timbrar</button></td></tr>';  
            
          } 
          $("#tablaPendientesDeTimbrar").html(cad);
        }
      });
   }
   

 function pendientesDeLigarMain()
   {
    var cad = '<div class="">'+
          '<div class="page-title">'+
            '<div class="title_left">'+
              '<h3>Pendientes de ligar</h3>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div id="loadingCampos"></div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row">'+
            '<div class="col-md-12 col-sm-12 col-xs-12">'+
              '<div class="x_panel">'+
                '<div class="x_title">'+
                  '<h2>Instrucciones: <small></small></h2>'+
                  '<ul class="nav navbar-right panel_toolbox">'+
                    '<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>'+
                    '</li>'+
                    '<li><a class="close-link"><i class="fa fa-close"></i></a>'+
                    '</li>'+
                  '</ul>'+
                  '<div class="clearfix"></div>'+
                '</div>'+
                '<div class="x_content">'+
                   '<table class="table table-striped">'+
                      '<thead>'+
                        '<tr>'+
                          '<th>Cuenta</th>'+
                          '<th>Fecha</th>'+
                          '<th>Descripci&oacute;n</th>'+
                          '<th>Importe</th>'+
                          '<th>Ligado</th>'+
                          '<th>Faltante</th>'+
                        '</tr>'+
                      '</thead>'+
                      '<tbody id="tablaPendientesDeLigar">'+
                      '</tbody>'+
                    '</table>'+
                '</div>'+
                '<div class="x_content" id="cambiaContenido">'+
                '</div>'+
              '</div>'+
            '</div>'+
          '</div>'+
          '<div class="clearfix"></div>'+
          '<div class="row" id="graficas"></div>'+
          '<div stye="display:none" id="graficasJS"></div>'+
        '</div>';
      $("#mainContent").html(cad);
      $.ajax({
        url: "/damePendientesDeLigar",
        dataType : "json",
        type : "post",
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          var aver2 = Object.keys(resp.reporte);
          var cad = '';
          var i , j;
          for(i=0;i<aver2.length;i++)
          {
            for(j=i;j<aver2.length;j++)
            {
              if(parseInt(resp.reporte[aver2[i]].IdBanco) < parseInt(resp.reporte[aver2[j]].IdBanco))
              {
                var aux = aver2[i];
                aver2[i] = aver2[j];
                aver2[j] = aux;
              }

            }
          }
          for(i=0;i<aver2.length;i++)
          {
            var importe = parseFloat(resp.reporte[aver2[i]]["Importe"]);
            var ligado = parseFloat(resp.reporte[aver2[i]]["Ligado"]);
            var dif = importe - ligado;
            var color = "";
            if(dif > 0.10)
            {
              color = "background-color:#FF0;"
            }
            cad=cad+'<tr style="'+color+'"><td>'+resp.reporte[aver2[i]]["Nombre"]+'</td><td>'+resp.reporte[aver2[i]]["Fecha"]+'</td><td>'+resp.reporte[aver2[i]]["Descripcion"]+'</td><td>'+format2(resp.reporte[aver2[i]]["Importe"],'$')+'</td><td>'+format2(resp.reporte[aver2[i]]["Ligado"],'$')+'</td><td>'+format2(dif,'$')+'</td></tr>';  
            
          } 
          $("#tablaPendientesDeLigar").html(cad);
        }
      });
   }
   

    $(document).on("click", ".vistaPreviaFactura", function (){
    var cantidad = $(this).attr("cantidad");
    var nombre=  $(this).attr("nombre"); 
    var diario= $(this).attr("diario"); 
    var linea= $(this).attr("linea"); 
    var RazonSocial= $(this).attr("RazonSocial"); 
    var RFC= $(this).attr("RFC"); 

    var correo= $(this).attr("correo"); 
    var NumCtaPago= $(this).attr("NumCtaPago");

    var MetodoDePago= $(this).attr("MetodoDePago");
    var param = {cantidad : cantidad, nombre : nombre, diario: diario, linea: linea, RFC: RFC, RazonSocial : RazonSocial, correo : correo, NumCtaPago : NumCtaPago, MetodoDePago : MetodoDePago }
     $.ajax({
        url: "/vistaPreviaFactura",
        dataType : "json",
        type : "post",
        data: param,
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            window.open(
                "/" + resp.pdf,
                '_blank'
              );

          }
        }
      });
  });

    $(document).on("click", ".timbrarFacturaDeIngreso", function (){
    $("#loadingCampos").html('<center><img id="loading" src="static/images/loading2.gif" width="20%"  /><center>');
          
    var cantidad = $(this).attr("cantidad");
    var nombre=  $(this).attr("nombre"); 
    var diario= $(this).attr("diario"); 
    var linea= $(this).attr("linea"); 
    var RazonSocial= $(this).attr("RazonSocial"); 
    var RFC= $(this).attr("RFC"); 

    var correo= $(this).attr("correo"); 
    var NumCtaPago= $(this).attr("NumCtaPago");

    var MetodoDePago= $(this).attr("MetodoDePago");
    var param = {cantidad : cantidad, nombre : nombre, diario: diario, linea: linea, RFC: RFC, RazonSocial : RazonSocial, correo : correo, NumCtaPago : NumCtaPago, MetodoDePago : MetodoDePago }
     $.ajax({
        url: "/timbrarFacturaDeIngreso",
        dataType : "json",
        type : "post",
        data: param,
        async : true,
        beforeSend : function (){
        },
        complete : function (){
        }, 
        success : function (resp){
          if(resp.success==1)
          {
            window.open(
                "/" + resp.pdf,
                '_blank'
              );
             pendientesDeTimbrar();
             $("#loadingCampos").html('');
    
          }
        }
      });

  });
function verProblemas() {
  $.ajax({
    url: "/verProblemas",
    dataType : "json",
    type : "post",
    data: {},
    async : true,
    beforeSend : function (){
    },
    complete : function (){
    }, 
    success : function (resp){
      if(resp.success==1)
      {
        var swal_html = '<h1>Activos fijos con problemas</h1><table style="font-size:20px;" class="table table-striped"><thead><tr><td>Activo</td><td>Tipo de problema</td><td>Cantidad en tabla de activo</td><td>Cantidad en libro mayor</td></tr></thead><tbody>';
        var aver2 = Object.keys(resp.DepreList);
        var i;
        var entre = false;
        for(i=0;i<aver2.length;i++) {
          entre = true;
          var string= numeral(parseFloat(resp.DepreList[aver2[i]].Base)).format('$0,0.00');
          var stringL= numeral(parseFloat(resp.DepreList[aver2[i]].Libro)).format('$0,0.00');
          swal_html = swal_html + '<tr><td>'+resp.DepreList[aver2[i]].Codigo+'</td><td>Depreciaci&oacute;n</td><td>'+string+'</td><td>'+stringL+'</td></tr>';
        }
        aver2 = Object.keys(resp.InicialList);
        for(i=0;i<aver2.length;i++) {
          entre = true;
          var string= numeral(parseFloat(resp.InicialList[aver2[i]].Base)).format('$0,0.00');
          var stringL= numeral(parseFloat(resp.InicialList[aver2[i]].Libro)).format('$0,0.00');
          swal_html = swal_html + '<tr><td>'+resp.InicialList[aver2[i]].Codigo+'</td><td>Valor inicial</td><td>'+string+'</td><td>'+stringL+'</td></tr>';
        }
        aver2 = Object.keys(resp.NetoList);
        for(i=0;i<aver2.length;i++) {
          entre = true;
          var string= numeral(parseFloat(resp.NetoList[aver2[i]].Base)).format('$0,0.00');
          var stringL= numeral(parseFloat(resp.NetoList[aver2[i]].Libro)).format('$0,0.00');
          swal_html = swal_html + '<tr><td>'+resp.NetoList[aver2[i]].Codigo+'</td><td>Valor Neto</td><td>'+string+'</td><td>'+stringL+'</td></tr>';
        }
        swal_html = swal_html + '</tbody></table>';
        if(entre) {
          Swal({title:"", html: swal_html}).then((result) => {
          
          });  
        }
      }
    }
  });
}
    $(document).ready(function() {
      setInterval(function(){
        checaQueEsteCuadrado();
      },1000);
      $.ajaxSetup({ cache: false });
      var tipoDeUsuario = parseInt($("#tipoDeUsuario").html());
      if(tipoDeUsuario==3)//contador
      {
        //calculaDashboard1();    
        //pendientesDeTimbrar();
        //revisaNotificaciones();
        pendientesDeLigarMain();
        //verProblemas();
        var BUNIT = $("#BUNITACTUAL").html();
        if(BUNIT=="M11"){
         $("#menu_reportes").append('<li><a id="contabilizarFOBONOaCampos" class="cancelaAjax" href="#">Contabilizar FOBONO a Campos</a></li>'); 
         $("#menu_reportes").append('<li><a id="contabilizarSaludEIncapacidadaCampos" class="cancelaAjax" href="#">Contabilizar Salud e Incapacidad a Campos</a></li>'); 
        }
        var USUARIOACTUAL = $("#USUARIOACTUAL").html();
        if(USUARIOACTUAL=="ARC")//valedor fiscal
        {
          $("#menu_reportes").append('<li><a id="verTimbradoDeNominaCampos" class="cancelaAjax" href="#">Ver como timbran los campos la manutencion</a></li>');
        }
        if(USUARIOACTUAL=="MPJ")//super Marilu
        {
          $("#menu_reportes").append('<li><a id="contabilizarFOBONO" class="cancelaAjax" href="#">FOBONO intereses</a></li>');
        }
          
      }
      if(tipoDeUsuario==4)//fiscalista
      {
        calculaDashboardFiscalista();    
      }
       if(tipoDeUsuario==7)//tesorero lomo plateado
      {
        cargaPresupuesto();
        //cargaMapita();
      }
      if(tipoDeUsuario==5)//hermano
      {
        $("#BUNITACTUAL").html("Sevenplus");
        capturarInformeDiezmos();

        var mensaje = $("#mensaje").html().trim();
        if(mensaje!="")
        {
          alert(mensaje);
        }
      }

      
    });
  </script>
  
            
  <script>
    NProgress.done();
  </script>
  <!-- /datepicker -->
  <!-- /footer content -->
</body>
</html>